(function(){const Wt=document.createElement("link").relList;if(Wt&&Wt.supports&&Wt.supports("modulepreload"))return;for(const yt of document.querySelectorAll('link[rel="modulepreload"]'))Se(yt);new MutationObserver(yt=>{for(const mt of yt)if(mt.type==="childList")for(const O of mt.addedNodes)O.tagName==="LINK"&&O.rel==="modulepreload"&&Se(O)}).observe(document,{childList:!0,subtree:!0});function Tt(yt){const mt={};return yt.integrity&&(mt.integrity=yt.integrity),yt.referrerPolicy&&(mt.referrerPolicy=yt.referrerPolicy),yt.crossOrigin==="use-credentials"?mt.credentials="include":yt.crossOrigin==="anonymous"?mt.credentials="omit":mt.credentials="same-origin",mt}function Se(yt){if(yt.ep)return;yt.ep=!0;const mt=Tt(yt);fetch(yt.href,mt)}})();function gg(et){return et&&et.__esModule&&Object.prototype.hasOwnProperty.call(et,"default")?et.default:et}var lg={exports:{}},Up={};var Dg;function n_(){if(Dg)return Up;Dg=1;var et=Symbol.for("react.transitional.element"),Wt=Symbol.for("react.fragment");function Tt(Se,yt,mt){var O=null;if(mt!==void 0&&(O=""+mt),yt.key!==void 0&&(O=""+yt.key),"key"in yt){mt={};for(var f in yt)f!=="key"&&(mt[f]=yt[f])}else mt=yt;return yt=mt.ref,{$$typeof:et,type:Se,key:O,ref:yt!==void 0?yt:null,props:mt}}return Up.Fragment=Wt,Up.jsx=Tt,Up.jsxs=Tt,Up}var Pg;function a_(){return Pg||(Pg=1,lg.exports=n_()),lg.exports}var At=a_(),ug={exports:{}},Zt={};var Ig;function r_(){if(Ig)return Zt;Ig=1;var et=Symbol.for("react.transitional.element"),Wt=Symbol.for("react.portal"),Tt=Symbol.for("react.fragment"),Se=Symbol.for("react.strict_mode"),yt=Symbol.for("react.profiler"),mt=Symbol.for("react.consumer"),O=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),De=Symbol.for("react.suspense"),qe=Symbol.for("react.memo"),xt=Symbol.for("react.lazy"),ut=Symbol.for("react.activity"),Bt=Symbol.iterator;function Xt(de){return de===null||typeof de!="object"?null:(de=Bt&&de[Bt]||de["@@iterator"],typeof de=="function"?de:null)}var di={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},bt=Object.assign,Te={};function Yi(de,Ge,st){this.props=de,this.context=Ge,this.refs=Te,this.updater=st||di}Yi.prototype.isReactComponent={},Yi.prototype.setState=function(de,Ge){if(typeof de!="object"&&typeof de!="function"&&de!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,de,Ge,"setState")},Yi.prototype.forceUpdate=function(de){this.updater.enqueueForceUpdate(this,de,"forceUpdate")};function fi(){}fi.prototype=Yi.prototype;function qt(de,Ge,st){this.props=de,this.context=Ge,this.refs=Te,this.updater=st||di}var Qn=qt.prototype=new fi;Qn.constructor=qt,bt(Qn,Yi.prototype),Qn.isPureReactComponent=!0;var ma=Array.isArray;function On(){}var It={H:null,A:null,T:null,S:null},Dn=Object.prototype.hasOwnProperty;function Kn(de,Ge,st){var ht=st.ref;return{$$typeof:et,type:de,key:Ge,ref:ht!==void 0?ht:null,props:st}}function Ma(de,Ge){return Kn(de.type,Ge,de.props)}function aa(de){return typeof de=="object"&&de!==null&&de.$$typeof===et}function en(de){var Ge={"=":"=0",":":"=2"};return"$"+de.replace(/[=:]/g,function(st){return Ge[st]})}var ra=/\/+/g;function Va(de,Ge){return typeof de=="object"&&de!==null&&de.key!=null?en(""+de.key):Ge.toString(36)}function Jn(de){switch(de.status){case"fulfilled":return de.value;case"rejected":throw de.reason;default:switch(typeof de.status=="string"?de.then(On,On):(de.status="pending",de.then(function(Ge){de.status==="pending"&&(de.status="fulfilled",de.value=Ge)},function(Ge){de.status==="pending"&&(de.status="rejected",de.reason=Ge)})),de.status){case"fulfilled":return de.value;case"rejected":throw de.reason}}throw de}function Oe(de,Ge,st,ht,_t){var kt=typeof de;(kt==="undefined"||kt==="boolean")&&(de=null);var Yt=!1;if(de===null)Yt=!0;else switch(kt){case"bigint":case"string":case"number":Yt=!0;break;case"object":switch(de.$$typeof){case et:case Wt:Yt=!0;break;case xt:return Yt=de._init,Oe(Yt(de._payload),Ge,st,ht,_t)}}if(Yt)return _t=_t(de),Yt=ht===""?"."+Va(de,0):ht,ma(_t)?(st="",Yt!=null&&(st=Yt.replace(ra,"$&/")+"/"),Oe(_t,Ge,st,"",function(ga){return ga})):_t!=null&&(aa(_t)&&(_t=Ma(_t,st+(_t.key==null||de&&de.key===_t.key?"":(""+_t.key).replace(ra,"$&/")+"/")+Yt)),Ge.push(_t)),1;Yt=0;var Mi=ht===""?".":ht+":";if(ma(de))for(var Bi=0;Bi<de.length;Bi++)ht=de[Bi],kt=Mi+Va(ht,Bi),Yt+=Oe(ht,Ge,st,kt,_t);else if(Bi=Xt(de),typeof Bi=="function")for(de=Bi.call(de),Bi=0;!(ht=de.next()).done;)ht=ht.value,kt=Mi+Va(ht,Bi++),Yt+=Oe(ht,Ge,st,kt,_t);else if(kt==="object"){if(typeof de.then=="function")return Oe(Jn(de),Ge,st,ht,_t);throw Ge=String(de),Error("Objects are not valid as a React child (found: "+(Ge==="[object Object]"?"object with keys {"+Object.keys(de).join(", ")+"}":Ge)+"). If you meant to render a collection of children, use an array instead.")}return Yt}function Ke(de,Ge,st){if(de==null)return de;var ht=[],_t=0;return Oe(de,ht,"","",function(kt){return Ge.call(st,kt,_t++)}),ht}function St(de){if(de._status===-1){var Ge=de._result;Ge=Ge(),Ge.then(function(st){(de._status===0||de._status===-1)&&(de._status=1,de._result=st)},function(st){(de._status===0||de._status===-1)&&(de._status=2,de._result=st)}),de._status===-1&&(de._status=0,de._result=Ge)}if(de._status===1)return de._result.default;throw de._result}var gt=typeof reportError=="function"?reportError:function(de){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ge=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof de=="object"&&de!==null&&typeof de.message=="string"?String(de.message):String(de),error:de});if(!window.dispatchEvent(Ge))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",de);return}console.error(de)},li={map:Ke,forEach:function(de,Ge,st){Ke(de,function(){Ge.apply(this,arguments)},st)},count:function(de){var Ge=0;return Ke(de,function(){Ge++}),Ge},toArray:function(de){return Ke(de,function(Ge){return Ge})||[]},only:function(de){if(!aa(de))throw Error("React.Children.only expected to receive a single React element child.");return de}};return Zt.Activity=ut,Zt.Children=li,Zt.Component=Yi,Zt.Fragment=Tt,Zt.Profiler=yt,Zt.PureComponent=qt,Zt.StrictMode=Se,Zt.Suspense=De,Zt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=It,Zt.__COMPILER_RUNTIME={__proto__:null,c:function(de){return It.H.useMemoCache(de)}},Zt.cache=function(de){return function(){return de.apply(null,arguments)}},Zt.cacheSignal=function(){return null},Zt.cloneElement=function(de,Ge,st){if(de==null)throw Error("The argument must be a React element, but you passed "+de+".");var ht=bt({},de.props),_t=de.key;if(Ge!=null)for(kt in Ge.key!==void 0&&(_t=""+Ge.key),Ge)!Dn.call(Ge,kt)||kt==="key"||kt==="__self"||kt==="__source"||kt==="ref"&&Ge.ref===void 0||(ht[kt]=Ge[kt]);var kt=arguments.length-2;if(kt===1)ht.children=st;else if(1<kt){for(var Yt=Array(kt),Mi=0;Mi<kt;Mi++)Yt[Mi]=arguments[Mi+2];ht.children=Yt}return Kn(de.type,_t,ht)},Zt.createContext=function(de){return de={$$typeof:O,_currentValue:de,_currentValue2:de,_threadCount:0,Provider:null,Consumer:null},de.Provider=de,de.Consumer={$$typeof:mt,_context:de},de},Zt.createElement=function(de,Ge,st){var ht,_t={},kt=null;if(Ge!=null)for(ht in Ge.key!==void 0&&(kt=""+Ge.key),Ge)Dn.call(Ge,ht)&&ht!=="key"&&ht!=="__self"&&ht!=="__source"&&(_t[ht]=Ge[ht]);var Yt=arguments.length-2;if(Yt===1)_t.children=st;else if(1<Yt){for(var Mi=Array(Yt),Bi=0;Bi<Yt;Bi++)Mi[Bi]=arguments[Bi+2];_t.children=Mi}if(de&&de.defaultProps)for(ht in Yt=de.defaultProps,Yt)_t[ht]===void 0&&(_t[ht]=Yt[ht]);return Kn(de,kt,_t)},Zt.createRef=function(){return{current:null}},Zt.forwardRef=function(de){return{$$typeof:f,render:de}},Zt.isValidElement=aa,Zt.lazy=function(de){return{$$typeof:xt,_payload:{_status:-1,_result:de},_init:St}},Zt.memo=function(de,Ge){return{$$typeof:qe,type:de,compare:Ge===void 0?null:Ge}},Zt.startTransition=function(de){var Ge=It.T,st={};It.T=st;try{var ht=de(),_t=It.S;_t!==null&&_t(st,ht),typeof ht=="object"&&ht!==null&&typeof ht.then=="function"&&ht.then(On,gt)}catch(kt){gt(kt)}finally{Ge!==null&&st.types!==null&&(Ge.types=st.types),It.T=Ge}},Zt.unstable_useCacheRefresh=function(){return It.H.useCacheRefresh()},Zt.use=function(de){return It.H.use(de)},Zt.useActionState=function(de,Ge,st){return It.H.useActionState(de,Ge,st)},Zt.useCallback=function(de,Ge){return It.H.useCallback(de,Ge)},Zt.useContext=function(de){return It.H.useContext(de)},Zt.useDebugValue=function(){},Zt.useDeferredValue=function(de,Ge){return It.H.useDeferredValue(de,Ge)},Zt.useEffect=function(de,Ge){return It.H.useEffect(de,Ge)},Zt.useEffectEvent=function(de){return It.H.useEffectEvent(de)},Zt.useId=function(){return It.H.useId()},Zt.useImperativeHandle=function(de,Ge,st){return It.H.useImperativeHandle(de,Ge,st)},Zt.useInsertionEffect=function(de,Ge){return It.H.useInsertionEffect(de,Ge)},Zt.useLayoutEffect=function(de,Ge){return It.H.useLayoutEffect(de,Ge)},Zt.useMemo=function(de,Ge){return It.H.useMemo(de,Ge)},Zt.useOptimistic=function(de,Ge){return It.H.useOptimistic(de,Ge)},Zt.useReducer=function(de,Ge,st){return It.H.useReducer(de,Ge,st)},Zt.useRef=function(de){return It.H.useRef(de)},Zt.useState=function(de){return It.H.useState(de)},Zt.useSyncExternalStore=function(de,Ge,st){return It.H.useSyncExternalStore(de,Ge,st)},Zt.useTransition=function(){return It.H.useTransition()},Zt.version="19.2.3",Zt}var Rg;function _g(){return Rg||(Rg=1,ug.exports=r_()),ug.exports}var bs=_g();const s_=gg(bs);var cg={exports:{}},Gp={},hg={exports:{}},dg={};var Lg;function o_(){return Lg||(Lg=1,(function(et){function Wt(Oe,Ke){var St=Oe.length;Oe.push(Ke);e:for(;0<St;){var gt=St-1>>>1,li=Oe[gt];if(0<yt(li,Ke))Oe[gt]=Ke,Oe[St]=li,St=gt;else break e}}function Tt(Oe){return Oe.length===0?null:Oe[0]}function Se(Oe){if(Oe.length===0)return null;var Ke=Oe[0],St=Oe.pop();if(St!==Ke){Oe[0]=St;e:for(var gt=0,li=Oe.length,de=li>>>1;gt<de;){var Ge=2*(gt+1)-1,st=Oe[Ge],ht=Ge+1,_t=Oe[ht];if(0>yt(st,St))ht<li&&0>yt(_t,st)?(Oe[gt]=_t,Oe[ht]=St,gt=ht):(Oe[gt]=st,Oe[Ge]=St,gt=Ge);else if(ht<li&&0>yt(_t,St))Oe[gt]=_t,Oe[ht]=St,gt=ht;else break e}}return Ke}function yt(Oe,Ke){var St=Oe.sortIndex-Ke.sortIndex;return St!==0?St:Oe.id-Ke.id}if(et.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var mt=performance;et.unstable_now=function(){return mt.now()}}else{var O=Date,f=O.now();et.unstable_now=function(){return O.now()-f}}var De=[],qe=[],xt=1,ut=null,Bt=3,Xt=!1,di=!1,bt=!1,Te=!1,Yi=typeof setTimeout=="function"?setTimeout:null,fi=typeof clearTimeout=="function"?clearTimeout:null,qt=typeof setImmediate<"u"?setImmediate:null;function Qn(Oe){for(var Ke=Tt(qe);Ke!==null;){if(Ke.callback===null)Se(qe);else if(Ke.startTime<=Oe)Se(qe),Ke.sortIndex=Ke.expirationTime,Wt(De,Ke);else break;Ke=Tt(qe)}}function ma(Oe){if(bt=!1,Qn(Oe),!di)if(Tt(De)!==null)di=!0,On||(On=!0,en());else{var Ke=Tt(qe);Ke!==null&&Jn(ma,Ke.startTime-Oe)}}var On=!1,It=-1,Dn=5,Kn=-1;function Ma(){return Te?!0:!(et.unstable_now()-Kn<Dn)}function aa(){if(Te=!1,On){var Oe=et.unstable_now();Kn=Oe;var Ke=!0;try{e:{di=!1,bt&&(bt=!1,fi(It),It=-1),Xt=!0;var St=Bt;try{t:{for(Qn(Oe),ut=Tt(De);ut!==null&&!(ut.expirationTime>Oe&&Ma());){var gt=ut.callback;if(typeof gt=="function"){ut.callback=null,Bt=ut.priorityLevel;var li=gt(ut.expirationTime<=Oe);if(Oe=et.unstable_now(),typeof li=="function"){ut.callback=li,Qn(Oe),Ke=!0;break t}ut===Tt(De)&&Se(De),Qn(Oe)}else Se(De);ut=Tt(De)}if(ut!==null)Ke=!0;else{var de=Tt(qe);de!==null&&Jn(ma,de.startTime-Oe),Ke=!1}}break e}finally{ut=null,Bt=St,Xt=!1}Ke=void 0}}finally{Ke?en():On=!1}}}var en;if(typeof qt=="function")en=function(){qt(aa)};else if(typeof MessageChannel<"u"){var ra=new MessageChannel,Va=ra.port2;ra.port1.onmessage=aa,en=function(){Va.postMessage(null)}}else en=function(){Yi(aa,0)};function Jn(Oe,Ke){It=Yi(function(){Oe(et.unstable_now())},Ke)}et.unstable_IdlePriority=5,et.unstable_ImmediatePriority=1,et.unstable_LowPriority=4,et.unstable_NormalPriority=3,et.unstable_Profiling=null,et.unstable_UserBlockingPriority=2,et.unstable_cancelCallback=function(Oe){Oe.callback=null},et.unstable_forceFrameRate=function(Oe){0>Oe||125<Oe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Dn=0<Oe?Math.floor(1e3/Oe):5},et.unstable_getCurrentPriorityLevel=function(){return Bt},et.unstable_next=function(Oe){switch(Bt){case 1:case 2:case 3:var Ke=3;break;default:Ke=Bt}var St=Bt;Bt=Ke;try{return Oe()}finally{Bt=St}},et.unstable_requestPaint=function(){Te=!0},et.unstable_runWithPriority=function(Oe,Ke){switch(Oe){case 1:case 2:case 3:case 4:case 5:break;default:Oe=3}var St=Bt;Bt=Oe;try{return Ke()}finally{Bt=St}},et.unstable_scheduleCallback=function(Oe,Ke,St){var gt=et.unstable_now();switch(typeof St=="object"&&St!==null?(St=St.delay,St=typeof St=="number"&&0<St?gt+St:gt):St=gt,Oe){case 1:var li=-1;break;case 2:li=250;break;case 5:li=1073741823;break;case 4:li=1e4;break;default:li=5e3}return li=St+li,Oe={id:xt++,callback:Ke,priorityLevel:Oe,startTime:St,expirationTime:li,sortIndex:-1},St>gt?(Oe.sortIndex=St,Wt(qe,Oe),Tt(De)===null&&Oe===Tt(qe)&&(bt?(fi(It),It=-1):bt=!0,Jn(ma,St-gt))):(Oe.sortIndex=li,Wt(De,Oe),di||Xt||(di=!0,On||(On=!0,en()))),Oe},et.unstable_shouldYield=Ma,et.unstable_wrapCallback=function(Oe){var Ke=Bt;return function(){var St=Bt;Bt=Ke;try{return Oe.apply(this,arguments)}finally{Bt=St}}}})(dg)),dg}var Bg;function l_(){return Bg||(Bg=1,hg.exports=o_()),hg.exports}var fg={exports:{}},Ar={};var kg;function u_(){if(kg)return Ar;kg=1;var et=_g();function Wt(De){var qe="https://react.dev/errors/"+De;if(1<arguments.length){qe+="?args[]="+encodeURIComponent(arguments[1]);for(var xt=2;xt<arguments.length;xt++)qe+="&args[]="+encodeURIComponent(arguments[xt])}return"Minified React error #"+De+"; visit "+qe+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Tt(){}var Se={d:{f:Tt,r:function(){throw Error(Wt(522))},D:Tt,C:Tt,L:Tt,m:Tt,X:Tt,S:Tt,M:Tt},p:0,findDOMNode:null},yt=Symbol.for("react.portal");function mt(De,qe,xt){var ut=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:yt,key:ut==null?null:""+ut,children:De,containerInfo:qe,implementation:xt}}var O=et.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(De,qe){if(De==="font")return"";if(typeof qe=="string")return qe==="use-credentials"?qe:""}return Ar.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Se,Ar.createPortal=function(De,qe){var xt=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!qe||qe.nodeType!==1&&qe.nodeType!==9&&qe.nodeType!==11)throw Error(Wt(299));return mt(De,qe,null,xt)},Ar.flushSync=function(De){var qe=O.T,xt=Se.p;try{if(O.T=null,Se.p=2,De)return De()}finally{O.T=qe,Se.p=xt,Se.d.f()}},Ar.preconnect=function(De,qe){typeof De=="string"&&(qe?(qe=qe.crossOrigin,qe=typeof qe=="string"?qe==="use-credentials"?qe:"":void 0):qe=null,Se.d.C(De,qe))},Ar.prefetchDNS=function(De){typeof De=="string"&&Se.d.D(De)},Ar.preinit=function(De,qe){if(typeof De=="string"&&qe&&typeof qe.as=="string"){var xt=qe.as,ut=f(xt,qe.crossOrigin),Bt=typeof qe.integrity=="string"?qe.integrity:void 0,Xt=typeof qe.fetchPriority=="string"?qe.fetchPriority:void 0;xt==="style"?Se.d.S(De,typeof qe.precedence=="string"?qe.precedence:void 0,{crossOrigin:ut,integrity:Bt,fetchPriority:Xt}):xt==="script"&&Se.d.X(De,{crossOrigin:ut,integrity:Bt,fetchPriority:Xt,nonce:typeof qe.nonce=="string"?qe.nonce:void 0})}},Ar.preinitModule=function(De,qe){if(typeof De=="string")if(typeof qe=="object"&&qe!==null){if(qe.as==null||qe.as==="script"){var xt=f(qe.as,qe.crossOrigin);Se.d.M(De,{crossOrigin:xt,integrity:typeof qe.integrity=="string"?qe.integrity:void 0,nonce:typeof qe.nonce=="string"?qe.nonce:void 0})}}else qe==null&&Se.d.M(De)},Ar.preload=function(De,qe){if(typeof De=="string"&&typeof qe=="object"&&qe!==null&&typeof qe.as=="string"){var xt=qe.as,ut=f(xt,qe.crossOrigin);Se.d.L(De,xt,{crossOrigin:ut,integrity:typeof qe.integrity=="string"?qe.integrity:void 0,nonce:typeof qe.nonce=="string"?qe.nonce:void 0,type:typeof qe.type=="string"?qe.type:void 0,fetchPriority:typeof qe.fetchPriority=="string"?qe.fetchPriority:void 0,referrerPolicy:typeof qe.referrerPolicy=="string"?qe.referrerPolicy:void 0,imageSrcSet:typeof qe.imageSrcSet=="string"?qe.imageSrcSet:void 0,imageSizes:typeof qe.imageSizes=="string"?qe.imageSizes:void 0,media:typeof qe.media=="string"?qe.media:void 0})}},Ar.preloadModule=function(De,qe){if(typeof De=="string")if(qe){var xt=f(qe.as,qe.crossOrigin);Se.d.m(De,{as:typeof qe.as=="string"&&qe.as!=="script"?qe.as:void 0,crossOrigin:xt,integrity:typeof qe.integrity=="string"?qe.integrity:void 0})}else Se.d.m(De)},Ar.requestFormReset=function(De){Se.d.r(De)},Ar.unstable_batchedUpdates=function(De,qe){return De(qe)},Ar.useFormState=function(De,qe,xt){return O.H.useFormState(De,qe,xt)},Ar.useFormStatus=function(){return O.H.useHostTransitionStatus()},Ar.version="19.2.3",Ar}var Og;function c_(){if(Og)return fg.exports;Og=1;function et(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(et)}catch(Wt){console.error(Wt)}}return et(),fg.exports=u_(),fg.exports}var Fg;function h_(){if(Fg)return Gp;Fg=1;var et=l_(),Wt=_g(),Tt=c_();function Se(a){var s="https://react.dev/errors/"+a;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)s+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+a+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function yt(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function mt(a){var s=a,c=a;if(a.alternate)for(;s.return;)s=s.return;else{a=s;do s=a,(s.flags&4098)!==0&&(c=s.return),a=s.return;while(a)}return s.tag===3?c:null}function O(a){if(a.tag===13){var s=a.memoizedState;if(s===null&&(a=a.alternate,a!==null&&(s=a.memoizedState)),s!==null)return s.dehydrated}return null}function f(a){if(a.tag===31){var s=a.memoizedState;if(s===null&&(a=a.alternate,a!==null&&(s=a.memoizedState)),s!==null)return s.dehydrated}return null}function De(a){if(mt(a)!==a)throw Error(Se(188))}function qe(a){var s=a.alternate;if(!s){if(s=mt(a),s===null)throw Error(Se(188));return s!==a?null:a}for(var c=a,g=s;;){var w=c.return;if(w===null)break;var M=w.alternate;if(M===null){if(g=w.return,g!==null){c=g;continue}break}if(w.child===M.child){for(M=w.child;M;){if(M===c)return De(w),a;if(M===g)return De(w),s;M=M.sibling}throw Error(Se(188))}if(c.return!==g.return)c=w,g=M;else{for(var L=!1,Z=w.child;Z;){if(Z===c){L=!0,c=w,g=M;break}if(Z===g){L=!0,g=w,c=M;break}Z=Z.sibling}if(!L){for(Z=M.child;Z;){if(Z===c){L=!0,c=M,g=w;break}if(Z===g){L=!0,g=M,c=w;break}Z=Z.sibling}if(!L)throw Error(Se(189))}}if(c.alternate!==g)throw Error(Se(190))}if(c.tag!==3)throw Error(Se(188));return c.stateNode.current===c?a:s}function xt(a){var s=a.tag;if(s===5||s===26||s===27||s===6)return a;for(a=a.child;a!==null;){if(s=xt(a),s!==null)return s;a=a.sibling}return null}var ut=Object.assign,Bt=Symbol.for("react.element"),Xt=Symbol.for("react.transitional.element"),di=Symbol.for("react.portal"),bt=Symbol.for("react.fragment"),Te=Symbol.for("react.strict_mode"),Yi=Symbol.for("react.profiler"),fi=Symbol.for("react.consumer"),qt=Symbol.for("react.context"),Qn=Symbol.for("react.forward_ref"),ma=Symbol.for("react.suspense"),On=Symbol.for("react.suspense_list"),It=Symbol.for("react.memo"),Dn=Symbol.for("react.lazy"),Kn=Symbol.for("react.activity"),Ma=Symbol.for("react.memo_cache_sentinel"),aa=Symbol.iterator;function en(a){return a===null||typeof a!="object"?null:(a=aa&&a[aa]||a["@@iterator"],typeof a=="function"?a:null)}var ra=Symbol.for("react.client.reference");function Va(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===ra?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case bt:return"Fragment";case Yi:return"Profiler";case Te:return"StrictMode";case ma:return"Suspense";case On:return"SuspenseList";case Kn:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case di:return"Portal";case qt:return a.displayName||"Context";case fi:return(a._context.displayName||"Context")+".Consumer";case Qn:var s=a.render;return a=a.displayName,a||(a=s.displayName||s.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case It:return s=a.displayName||null,s!==null?s:Va(a.type)||"Memo";case Dn:s=a._payload,a=a._init;try{return Va(a(s))}catch{}}return null}var Jn=Array.isArray,Oe=Wt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ke=Tt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,St={pending:!1,data:null,method:null,action:null},gt=[],li=-1;function de(a){return{current:a}}function Ge(a){0>li||(a.current=gt[li],gt[li]=null,li--)}function st(a,s){li++,gt[li]=a.current,a.current=s}var ht=de(null),_t=de(null),kt=de(null),Yt=de(null);function Mi(a,s){switch(st(kt,s),st(_t,a),st(ht,null),s.nodeType){case 9:case 11:a=(a=s.documentElement)&&(a=a.namespaceURI)?Ql(a):0;break;default:if(a=s.tagName,s=s.namespaceURI)s=Ql(s),a=yp(s,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}Ge(ht),st(ht,a)}function Bi(){Ge(ht),Ge(_t),Ge(kt)}function ga(a){a.memoizedState!==null&&st(Yt,a);var s=ht.current,c=yp(s,a.type);s!==c&&(st(_t,a),st(ht,c))}function Ys(a){_t.current===a&&(Ge(ht),Ge(_t)),Yt.current===a&&(Ge(Yt),eh._currentValue=St)}var Ua,gl;function $i(a){if(Ua===void 0)try{throw Error()}catch(c){var s=c.stack.trim().match(/\n( *(at )?)/);Ua=s&&s[1]||"",gl=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ua+a+gl}var Aa=!1;function sr(a,s){if(!a||Aa)return"";Aa=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var g={DetermineComponentFrameRoot:function(){try{if(s){var Ze=function(){throw Error()};if(Object.defineProperty(Ze.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ze,[])}catch(Ie){var ze=Ie}Reflect.construct(a,[],Ze)}else{try{Ze.call()}catch(Ie){ze=Ie}a.call(Ze.prototype)}}else{try{throw Error()}catch(Ie){ze=Ie}(Ze=a())&&typeof Ze.catch=="function"&&Ze.catch(function(){})}}catch(Ie){if(Ie&&ze&&typeof Ie.stack=="string")return[Ie.stack,ze.stack]}return[null,null]}};g.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var w=Object.getOwnPropertyDescriptor(g.DetermineComponentFrameRoot,"name");w&&w.configurable&&Object.defineProperty(g.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var M=g.DetermineComponentFrameRoot(),L=M[0],Z=M[1];if(L&&Z){var le=L.split(`
`),Ce=Z.split(`
`);for(w=g=0;g<le.length&&!le[g].includes("DetermineComponentFrameRoot");)g++;for(;w<Ce.length&&!Ce[w].includes("DetermineComponentFrameRoot");)w++;if(g===le.length||w===Ce.length)for(g=le.length-1,w=Ce.length-1;1<=g&&0<=w&&le[g]!==Ce[w];)w--;for(;1<=g&&0<=w;g--,w--)if(le[g]!==Ce[w]){if(g!==1||w!==1)do if(g--,w--,0>w||le[g]!==Ce[w]){var Fe=`
`+le[g].replace(" at new "," at ");return a.displayName&&Fe.includes("<anonymous>")&&(Fe=Fe.replace("<anonymous>",a.displayName)),Fe}while(1<=g&&0<=w);break}}}finally{Aa=!1,Error.prepareStackTrace=c}return(c=a?a.displayName||a.name:"")?$i(c):""}function tn(a,s){switch(a.tag){case 26:case 27:case 5:return $i(a.type);case 16:return $i("Lazy");case 13:return a.child!==s&&s!==null?$i("Suspense Fallback"):$i("Suspense");case 19:return $i("SuspenseList");case 0:case 15:return sr(a.type,!1);case 11:return sr(a.type.render,!1);case 1:return sr(a.type,!0);case 31:return $i("Activity");default:return""}}function ws(a){try{var s="",c=null;do s+=tn(a,c),c=a,a=a.return;while(a);return s}catch(g){return`
Error generating stack: `+g.message+`
`+g.stack}}var Ts=Object.prototype.hasOwnProperty,$s=et.unstable_scheduleCallback,Hr=et.unstable_cancelCallback,Er=et.unstable_shouldYield,_l=et.unstable_requestPaint,Fn=et.unstable_now,Ea=et.unstable_getCurrentPriorityLevel,me=et.unstable_ImmediatePriority,V=et.unstable_UserBlockingPriority,j=et.unstable_NormalPriority,H=et.unstable_LowPriority,re=et.unstable_IdlePriority,oe=et.log,ve=et.unstable_setDisableYieldValue,fe=null,ue=null;function xe(a){if(typeof oe=="function"&&ve(a),ue&&typeof ue.setStrictMode=="function")try{ue.setStrictMode(fe,a)}catch{}}var Be=Math.clz32?Math.clz32:ct,ke=Math.log,nt=Math.LN2;function ct(a){return a>>>=0,a===0?32:31-(ke(a)/nt|0)|0}var Et=256,ui=262144,Qt=4194304;function ge(a){var s=a&42;if(s!==0)return s;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function pi(a,s,c){var g=a.pendingLanes;if(g===0)return 0;var w=0,M=a.suspendedLanes,L=a.pingedLanes;a=a.warmLanes;var Z=g&134217727;return Z!==0?(g=Z&~M,g!==0?w=ge(g):(L&=Z,L!==0?w=ge(L):c||(c=Z&~a,c!==0&&(w=ge(c))))):(Z=g&~M,Z!==0?w=ge(Z):L!==0?w=ge(L):c||(c=g&~a,c!==0&&(w=ge(c)))),w===0?0:s!==0&&s!==w&&(s&M)===0&&(M=w&-w,c=s&-s,M>=c||M===32&&(c&4194048)!==0)?s:w}function yn(a,s){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&s)===0}function Dt(a,s){switch(a){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mi(){var a=Qt;return Qt<<=1,(Qt&62914560)===0&&(Qt=4194304),a}function Pn(a){for(var s=[],c=0;31>c;c++)s.push(a);return s}function vi(a,s){a.pendingLanes|=s,s!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function nn(a,s,c,g,w,M){var L=a.pendingLanes;a.pendingLanes=c,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=c,a.entangledLanes&=c,a.errorRecoveryDisabledLanes&=c,a.shellSuspendCounter=0;var Z=a.entanglements,le=a.expirationTimes,Ce=a.hiddenUpdates;for(c=L&~c;0<c;){var Fe=31-Be(c),Ze=1<<Fe;Z[Fe]=0,le[Fe]=-1;var ze=Ce[Fe];if(ze!==null)for(Ce[Fe]=null,Fe=0;Fe<ze.length;Fe++){var Ie=ze[Fe];Ie!==null&&(Ie.lane&=-536870913)}c&=~Ze}g!==0&&Ai(a,g,0),M!==0&&w===0&&a.tag!==0&&(a.suspendedLanes|=M&~(L&~s))}function Ai(a,s,c){a.pendingLanes|=s,a.suspendedLanes&=~s;var g=31-Be(s);a.entangledLanes|=s,a.entanglements[g]=a.entanglements[g]|1073741824|c&261930}function vn(a,s){var c=a.entangledLanes|=s;for(a=a.entanglements;c;){var g=31-Be(c),w=1<<g;w&s|a[g]&s&&(a[g]|=s),c&=~w}}function yl(a,s){var c=s&-s;return c=(c&42)!==0?1:Ao(c),(c&(a.suspendedLanes|s))!==0?0:c}function Ao(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function He(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function sa(){var a=Ke.p;return a!==0?a:(a=window.event,a===void 0?32:ic(a.type))}function oa(a,s){var c=Ke.p;try{return Ke.p=a,s()}finally{Ke.p=c}}var Cr=Math.random().toString(36).slice(2),Ri="__reactFiber$"+Cr,$e="__reactProps$"+Cr,Rt="__reactContainer$"+Cr,Nt="__reactEvents$"+Cr,Ga="__reactListeners$"+Cr,rc="__reactHandles$"+Cr,Xr="__reactResources$"+Cr,Pt="__reactMarker$"+Cr;function Eo(a){delete a[Ri],delete a[$e],delete a[Nt],delete a[Ga],delete a[rc]}function Yr(a){var s=a[Ri];if(s)return s;for(var c=a.parentNode;c;){if(s=c[Rt]||c[Ri]){if(c=s.alternate,s.child!==null||c!==null&&c.child!==null)for(a=Wh(a);a!==null;){if(c=a[Ri])return c;a=Wh(a)}return s}a=c,c=a.parentNode}return null}function Ss(a){if(a=a[Ri]||a[Rt]){var s=a.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return a}return null}function $r(a){var s=a.tag;if(s===5||s===26||s===27||s===6)return a.stateNode;throw Error(Se(33))}function Wr(a){var s=a[Xr];return s||(s=a[Xr]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function an(a){a[Pt]=!0}var vl=new Set,la={};function Kt(a,s){Ms(a,s),Ms(a+"Capture",s)}function Ms(a,s){for(la[a]=s,a=0;a<s.length;a++)vl.add(s[a])}var xl=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),bl={},Ws={};function zr(a){return Ts.call(Ws,a)?!0:Ts.call(bl,a)?!1:xl.test(a)?Ws[a]=!0:(bl[a]=!0,!1)}function ou(a,s,c){if(zr(s))if(c===null)a.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":a.removeAttribute(s);return;case"boolean":var g=s.toLowerCase().slice(0,5);if(g!=="data-"&&g!=="aria-"){a.removeAttribute(s);return}}a.setAttribute(s,""+c)}}function Qr(a,s,c){if(c===null)a.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(s);return}a.setAttribute(s,""+c)}}function or(a,s,c,g){if(g===null)a.removeAttribute(c);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(c);return}a.setAttributeNS(s,c,""+g)}}function ai(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function ah(a){var s=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function pd(a,s,c){var g=Object.getOwnPropertyDescriptor(a.constructor.prototype,s);if(!a.hasOwnProperty(s)&&typeof g<"u"&&typeof g.get=="function"&&typeof g.set=="function"){var w=g.get,M=g.set;return Object.defineProperty(a,s,{configurable:!0,get:function(){return w.call(this)},set:function(L){c=""+L,M.call(this,L)}}),Object.defineProperty(a,s,{enumerable:g.enumerable}),{getValue:function(){return c},setValue:function(L){c=""+L},stopTracking:function(){a._valueTracker=null,delete a[s]}}}}function Co(a){if(!a._valueTracker){var s=ah(a)?"checked":"value";a._valueTracker=pd(a,s,""+a[s])}}function rh(a){if(!a)return!1;var s=a._valueTracker;if(!s)return!0;var c=s.getValue(),g="";return a&&(g=ah(a)?a.checked?"true":"false":a.value),a=g,a!==c?(s.setValue(a),!0):!1}function lu(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var md=/[\n"\\]/g;function _a(a){return a.replace(md,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function uu(a,s,c,g,w,M,L,Z){a.name="",L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"?a.type=L:a.removeAttribute("type"),s!=null?L==="number"?(s===0&&a.value===""||a.value!=s)&&(a.value=""+ai(s)):a.value!==""+ai(s)&&(a.value=""+ai(s)):L!=="submit"&&L!=="reset"||a.removeAttribute("value"),s!=null?cu(a,L,ai(s)):c!=null?cu(a,L,ai(c)):g!=null&&a.removeAttribute("value"),w==null&&M!=null&&(a.defaultChecked=!!M),w!=null&&(a.checked=w&&typeof w!="function"&&typeof w!="symbol"),Z!=null&&typeof Z!="function"&&typeof Z!="symbol"&&typeof Z!="boolean"?a.name=""+ai(Z):a.removeAttribute("name")}function sc(a,s,c,g,w,M,L,Z){if(M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"&&(a.type=M),s!=null||c!=null){if(!(M!=="submit"&&M!=="reset"||s!=null)){Co(a);return}c=c!=null?""+ai(c):"",s=s!=null?""+ai(s):c,Z||s===a.value||(a.value=s),a.defaultValue=s}g=g??w,g=typeof g!="function"&&typeof g!="symbol"&&!!g,a.checked=Z?a.checked:!!g,a.defaultChecked=!!g,L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"&&(a.name=L),Co(a)}function cu(a,s,c){s==="number"&&lu(a.ownerDocument)===a||a.defaultValue===""+c||(a.defaultValue=""+c)}function Qs(a,s,c,g){if(a=a.options,s){s={};for(var w=0;w<c.length;w++)s["$"+c[w]]=!0;for(c=0;c<a.length;c++)w=s.hasOwnProperty("$"+a[c].value),a[c].selected!==w&&(a[c].selected=w),w&&g&&(a[c].defaultSelected=!0)}else{for(c=""+ai(c),s=null,w=0;w<a.length;w++){if(a[w].value===c){a[w].selected=!0,g&&(a[w].defaultSelected=!0);return}s!==null||a[w].disabled||(s=a[w])}s!==null&&(s.selected=!0)}}function gd(a,s,c){if(s!=null&&(s=""+ai(s),s!==a.value&&(a.value=s),c==null)){a.defaultValue!==s&&(a.defaultValue=s);return}a.defaultValue=c!=null?""+ai(c):""}function wl(a,s,c,g){if(s==null){if(g!=null){if(c!=null)throw Error(Se(92));if(Jn(g)){if(1<g.length)throw Error(Se(93));g=g[0]}c=g}c==null&&(c=""),s=c}c=ai(s),a.defaultValue=c,g=a.textContent,g===c&&g!==""&&g!==null&&(a.value=g),Co(a)}function As(a,s){if(s){var c=a.firstChild;if(c&&c===a.lastChild&&c.nodeType===3){c.nodeValue=s;return}}a.textContent=s}var _d=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function zo(a,s,c){var g=s.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?g?a.setProperty(s,""):s==="float"?a.cssFloat="":a[s]="":g?a.setProperty(s,c):typeof c!="number"||c===0||_d.has(s)?s==="float"?a.cssFloat=c:a[s]=(""+c).trim():a[s]=c+"px"}function oc(a,s,c){if(s!=null&&typeof s!="object")throw Error(Se(62));if(a=a.style,c!=null){for(var g in c)!c.hasOwnProperty(g)||s!=null&&s.hasOwnProperty(g)||(g.indexOf("--")===0?a.setProperty(g,""):g==="float"?a.cssFloat="":a[g]="");for(var w in s)g=s[w],s.hasOwnProperty(w)&&c[w]!==g&&zo(a,w,g)}else for(var M in s)s.hasOwnProperty(M)&&zo(a,M,s[M])}function Do(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ks=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Tl=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ft(a){return Tl.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function Dr(){}var sh=null;function hu(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var In=null,xn=null;function Vi(a){var s=Ss(a);if(s&&(a=s.stateNode)){var c=a[$e]||null;e:switch(a=s.stateNode,s.type){case"input":if(uu(a,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),s=c.name,c.type==="radio"&&s!=null){for(c=a;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+_a(""+s)+'"][type="radio"]'),s=0;s<c.length;s++){var g=c[s];if(g!==a&&g.form===a.form){var w=g[$e]||null;if(!w)throw Error(Se(90));uu(g,w.value,w.defaultValue,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name)}}for(s=0;s<c.length;s++)g=c[s],g.form===a.form&&rh(g)}break e;case"textarea":gd(a,c.value,c.defaultValue);break e;case"select":s=c.value,s!=null&&Qs(a,!!c.multiple,s,!1)}}}var wt=!1;function Ei(a,s,c){if(wt)return a(s,c);wt=!0;try{var g=a(s);return g}finally{if(wt=!1,(In!==null||xn!==null)&&(Uh(),In&&(s=In,a=xn,xn=In=null,Vi(s),a)))for(s=0;s<a.length;s++)Vi(a[s])}}function lr(a,s){var c=a.stateNode;if(c===null)return null;var g=c[$e]||null;if(g===null)return null;c=g[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(a=a.type,g=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!g;break e;default:a=!1}if(a)return null;if(c&&typeof c!="function")throw Error(Se(231,s,typeof c));return c}var rn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ya=!1;if(rn)try{var Rn={};Object.defineProperty(Rn,"passive",{get:function(){ya=!0}}),window.addEventListener("test",Rn,Rn),window.removeEventListener("test",Rn,Rn)}catch{ya=!1}var qa=null,Kr=null,Ui=null;function Js(){if(Ui)return Ui;var a,s=Kr,c=s.length,g,w="value"in qa?qa.value:qa.textContent,M=w.length;for(a=0;a<c&&s[a]===w[a];a++);var L=c-a;for(g=1;g<=L&&s[c-g]===w[M-g];g++);return Ui=w.slice(a,1<g?1-g:void 0)}function Za(a){var s=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&s===13&&(a=13)):a=s,a===10&&(a=13),32<=a||a===13?a:0}function Po(){return!0}function va(){return!1}function An(a){function s(c,g,w,M,L){this._reactName=c,this._targetInst=w,this.type=g,this.nativeEvent=M,this.target=L,this.currentTarget=null;for(var Z in a)a.hasOwnProperty(Z)&&(c=a[Z],this[Z]=c?c(M):M[Z]);return this.isDefaultPrevented=(M.defaultPrevented!=null?M.defaultPrevented:M.returnValue===!1)?Po:va,this.isPropagationStopped=va,this}return ut(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Po)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Po)},persist:function(){},isPersistent:Po}),s}var xa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},du=An(xa),Io=ut({},xa,{view:0,detail:0}),Ro=An(Io),xi,eo,Ut,Lt=ut({},Io,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:mu,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Ut&&(Ut&&a.type==="mousemove"?(xi=a.screenX-Ut.screenX,eo=a.screenY-Ut.screenY):eo=xi=0,Ut=a),xi)},movementY:function(a){return"movementY"in a?a.movementY:eo}}),Lo=An(Lt),Jt=ut({},Lt,{dataTransfer:0}),fu=An(Jt),ur=ut({},Io,{relatedTarget:0}),to=An(ur),io=ut({},xa,{animationName:0,elapsedTime:0,pseudoElement:0}),yd=An(io),pu=ut({},xa,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),oh=An(pu),kf=ut({},xa,{data:0}),lh=An(kf),ba={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Jr={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Gi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Bo(a){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(a):(a=Gi[a])?!!s[a]:!1}function mu(){return Bo}var gu=ut({},Io,{key:function(a){if(a.key){var s=ba[a.key]||a.key;if(s!=="Unidentified")return s}return a.type==="keypress"?(a=Za(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?Jr[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:mu,charCode:function(a){return a.type==="keypress"?Za(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Za(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),sn=An(gu),vd=ut({},Lt,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),lc=An(vd),xd=ut({},Io,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:mu}),Of=An(xd),Sl=ut({},xa,{propertyName:0,elapsedTime:0,pseudoElement:0}),uc=An(Sl),Ml=ut({},Lt,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),uh=An(Ml),_u=ut({},xa,{newState:0,oldState:0}),Al=An(_u),El=[9,13,27,32],fn=rn&&"CompositionEvent"in window,Cl=null;rn&&"documentMode"in document&&(Cl=document.documentMode);var zl=rn&&"TextEvent"in window&&!Cl,Dl=rn&&(!fn||Cl&&8<Cl&&11>=Cl),no=" ",bd=!1;function yu(a,s){switch(a){case"keyup":return El.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wd(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Pr=!1;function cc(a,s){switch(a){case"compositionend":return wd(s);case"keypress":return s.which!==32?null:(bd=!0,no);case"textInput":return a=s.data,a===no&&bd?null:a;default:return null}}function Td(a,s){if(Pr)return a==="compositionend"||!fn&&yu(a,s)?(a=Js(),Ui=Kr=qa=null,Pr=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Dl&&s.locale!=="ko"?null:s.data;default:return null}}var Sd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function hc(a){var s=a&&a.nodeName&&a.nodeName.toLowerCase();return s==="input"?!!Sd[a.type]:s==="textarea"}function dc(a,s,c,g){In?xn?xn.push(g):xn=[g]:In=g,s=Hh(s,"onChange"),0<s.length&&(c=new du("onChange","change",null,c,g),a.push({event:c,listeners:s}))}var ko=null,Pl=null;function Md(a){wm(a,0)}function vu(a){var s=$r(a);if(rh(s))return a}function ao(a,s){if(a==="change")return s}var ch=!1;if(rn){var xu;if(rn){var ro="oninput"in document;if(!ro){var hh=document.createElement("div");hh.setAttribute("oninput","return;"),ro=typeof hh.oninput=="function"}xu=ro}else xu=!1;ch=xu&&(!document.documentMode||9<document.documentMode)}function bu(){ko&&(ko.detachEvent("onpropertychange",Ad),Pl=ko=null)}function Ad(a){if(a.propertyName==="value"&&vu(Pl)){var s=[];dc(s,Pl,a,hu(a)),Ei(Md,s)}}function Ff(a,s,c){a==="focusin"?(bu(),ko=s,Pl=c,ko.attachEvent("onpropertychange",Ad)):a==="focusout"&&bu()}function Ed(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return vu(Pl)}function wu(a,s){if(a==="click")return vu(s)}function Cd(a,s){if(a==="input"||a==="change")return vu(s)}function dh(a,s){return a===s&&(a!==0||1/a===1/s)||a!==a&&s!==s}var Ca=typeof Object.is=="function"?Object.is:dh;function so(a,s){if(Ca(a,s))return!0;if(typeof a!="object"||a===null||typeof s!="object"||s===null)return!1;var c=Object.keys(a),g=Object.keys(s);if(c.length!==g.length)return!1;for(g=0;g<c.length;g++){var w=c[g];if(!Ts.call(s,w)||!Ca(a[w],s[w]))return!1}return!0}function cr(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Tu(a,s){var c=cr(a);a=0;for(var g;c;){if(c.nodeType===3){if(g=a+c.textContent.length,a<=s&&g>=s)return{node:c,offset:s-a};a=g}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=cr(c)}}function fc(a,s){return a&&s?a===s?!0:a&&a.nodeType===3?!1:s&&s.nodeType===3?fc(a,s.parentNode):"contains"in a?a.contains(s):a.compareDocumentPosition?!!(a.compareDocumentPosition(s)&16):!1:!1}function pc(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var s=lu(a.document);s instanceof a.HTMLIFrameElement;){try{var c=typeof s.contentWindow.location.href=="string"}catch{c=!1}if(c)a=s.contentWindow;else break;s=lu(a.document)}return s}function Su(a){var s=a&&a.nodeName&&a.nodeName.toLowerCase();return s&&(s==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||s==="textarea"||a.contentEditable==="true")}var mc=rn&&"documentMode"in document&&11>=document.documentMode,hr=null,Mu=null,Au=null,gc=!1;function zd(a,s,c){var g=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;gc||hr==null||hr!==lu(g)||(g=hr,"selectionStart"in g&&Su(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),Au&&so(Au,g)||(Au=g,g=Hh(Mu,"onSelect"),0<g.length&&(s=new du("onSelect","select",null,s,c),a.push({event:s,listeners:g}),s.target=hr)))}function Oo(a,s){var c={};return c[a.toLowerCase()]=s.toLowerCase(),c["Webkit"+a]="webkit"+s,c["Moz"+a]="moz"+s,c}var Fo={animationend:Oo("Animation","AnimationEnd"),animationiteration:Oo("Animation","AnimationIteration"),animationstart:Oo("Animation","AnimationStart"),transitionrun:Oo("Transition","TransitionRun"),transitionstart:Oo("Transition","TransitionStart"),transitioncancel:Oo("Transition","TransitionCancel"),transitionend:Oo("Transition","TransitionEnd")},fh={},ri={};rn&&(ri=document.createElement("div").style,"AnimationEvent"in window||(delete Fo.animationend.animation,delete Fo.animationiteration.animation,delete Fo.animationstart.animation),"TransitionEvent"in window||delete Fo.transitionend.transition);function es(a){if(fh[a])return fh[a];if(!Fo[a])return a;var s=Fo[a],c;for(c in s)if(s.hasOwnProperty(c)&&c in ri)return fh[a]=s[c];return a}var Eu=es("animationend"),Cu=es("animationiteration"),_c=es("animationstart"),No=es("transitionrun"),zu=es("transitionstart"),Il=es("transitioncancel"),Ha=es("transitionend"),ph=new Map,yc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");yc.push("scrollEnd");function Xa(a,s){ph.set(a,s),Kt(s,[a])}var ts=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},wa=[],Es=0,jo=0;function Vo(){for(var a=Es,s=jo=Es=0;s<a;){var c=wa[s];wa[s++]=null;var g=wa[s];wa[s++]=null;var w=wa[s];wa[s++]=null;var M=wa[s];if(wa[s++]=null,g!==null&&w!==null){var L=g.pending;L===null?w.next=w:(w.next=L.next,L.next=w),g.pending=w}M!==0&&mh(c,w,M)}}function Du(a,s,c,g){wa[Es++]=a,wa[Es++]=s,wa[Es++]=c,wa[Es++]=g,jo|=g,a.lanes|=g,a=a.alternate,a!==null&&(a.lanes|=g)}function oo(a,s,c,g){return Du(a,s,c,g),Rl(a)}function dr(a,s){return Du(a,null,null,s),Rl(a)}function mh(a,s,c){a.lanes|=c;var g=a.alternate;g!==null&&(g.lanes|=c);for(var w=!1,M=a.return;M!==null;)M.childLanes|=c,g=M.alternate,g!==null&&(g.childLanes|=c),M.tag===22&&(a=M.stateNode,a===null||a._visibility&1||(w=!0)),a=M,M=M.return;return a.tag===3?(M=a.stateNode,w&&s!==null&&(w=31-Be(c),a=M.hiddenUpdates,g=a[w],g===null?a[w]=[s]:g.push(s),s.lane=c|536870912),M):null}function Rl(a){if(50<Vh)throw Vh=0,ip=null,Error(Se(185));for(var s=a.return;s!==null;)a=s,s=a.return;return a.tag===3?a.stateNode:null}var Ot={};function vc(a,s,c,g){this.tag=a,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ya(a,s,c,g){return new vc(a,s,c,g)}function xc(a){return a=a.prototype,!(!a||!a.isReactComponent)}function $a(a,s){var c=a.alternate;return c===null?(c=Ya(a.tag,s,a.key,a.mode),c.elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=s,c.type=a.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=a.flags&65011712,c.childLanes=a.childLanes,c.lanes=a.lanes,c.child=a.child,c.memoizedProps=a.memoizedProps,c.memoizedState=a.memoizedState,c.updateQueue=a.updateQueue,s=a.dependencies,c.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},c.sibling=a.sibling,c.index=a.index,c.ref=a.ref,c.refCleanup=a.refCleanup,c}function Dd(a,s){a.flags&=65011714;var c=a.alternate;return c===null?(a.childLanes=0,a.lanes=s,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=c.childLanes,a.lanes=c.lanes,a.child=c.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=c.memoizedProps,a.memoizedState=c.memoizedState,a.updateQueue=c.updateQueue,a.type=c.type,s=c.dependencies,a.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),a}function bc(a,s,c,g,w,M){var L=0;if(g=a,typeof a=="function")xc(a)&&(L=1);else if(typeof a=="string")L=Sf(a,c,ht.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case Kn:return a=Ya(31,c,s,w),a.elementType=Kn,a.lanes=M,a;case bt:return lo(c.children,w,M,s);case Te:L=8,w|=24;break;case Yi:return a=Ya(12,c,s,w|2),a.elementType=Yi,a.lanes=M,a;case ma:return a=Ya(13,c,s,w),a.elementType=ma,a.lanes=M,a;case On:return a=Ya(19,c,s,w),a.elementType=On,a.lanes=M,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case qt:L=10;break e;case fi:L=9;break e;case Qn:L=11;break e;case It:L=14;break e;case Dn:L=16,g=null;break e}L=29,c=Error(Se(130,a===null?"null":typeof a,"")),g=null}return s=Ya(L,c,s,w),s.elementType=a,s.type=g,s.lanes=M,s}function lo(a,s,c,g){return a=Ya(7,a,g,s),a.lanes=c,a}function gh(a,s,c){return a=Ya(6,a,null,s),a.lanes=c,a}function wc(a){var s=Ya(18,null,null,0);return s.stateNode=a,s}function uo(a,s,c){return s=Ya(4,a.children!==null?a.children:[],a.key,s),s.lanes=c,s.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},s}var Ll=new WeakMap;function Ta(a,s){if(typeof a=="object"&&a!==null){var c=Ll.get(a);return c!==void 0?c:(s={value:a,source:s,stack:ws(s)},Ll.set(a,s),s)}return{value:a,source:s,stack:ws(s)}}var co=[],ho=0,Uo=null,fo=0,Ln=[],Nn=0,is=null,ns=1,za="";function Cs(a,s){co[ho++]=fo,co[ho++]=Uo,Uo=a,fo=s}function _h(a,s,c){Ln[Nn++]=ns,Ln[Nn++]=za,Ln[Nn++]=is,is=a;var g=ns;a=za;var w=32-Be(g)-1;g&=~(1<<w),c+=1;var M=32-Be(s)+w;if(30<M){var L=w-w%5;M=(g&(1<<L)-1).toString(32),g>>=L,w-=L,ns=1<<32-Be(s)+w|c<<w|g,za=M+a}else ns=1<<M|c<<w|g,za=a}function Go(a){a.return!==null&&(Cs(a,1),_h(a,1,0))}function Bl(a){for(;a===Uo;)Uo=co[--ho],co[ho]=null,fo=co[--ho],co[ho]=null;for(;a===is;)is=Ln[--Nn],Ln[Nn]=null,za=Ln[--Nn],Ln[Nn]=null,ns=Ln[--Nn],Ln[Nn]=null}function yh(a,s){Ln[Nn++]=ns,Ln[Nn++]=za,Ln[Nn++]=is,ns=s.id,za=s.overflow,is=a}var jn=null,Ci=null,$t=!1,zs=null,Wa=!1,Wi=Error(Se(519));function Da(a){var s=Error(Se(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Ds(Ta(s,a)),Wi}function Pa(a){var s=a.stateNode,c=a.type,g=a.memoizedProps;switch(s[Ri]=a,s[$e]=g,c){case"dialog":ni("cancel",s),ni("close",s);break;case"iframe":case"object":case"embed":ni("load",s);break;case"video":case"audio":for(c=0;c<Wl.length;c++)ni(Wl[c],s);break;case"source":ni("error",s);break;case"img":case"image":case"link":ni("error",s),ni("load",s);break;case"details":ni("toggle",s);break;case"input":ni("invalid",s),sc(s,g.value,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name,!0);break;case"select":ni("invalid",s);break;case"textarea":ni("invalid",s),wl(s,g.value,g.defaultValue,g.children)}c=g.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||s.textContent===""+c||g.suppressHydrationWarning===!0||gp(s.textContent,c)?(g.popover!=null&&(ni("beforetoggle",s),ni("toggle",s)),g.onScroll!=null&&ni("scroll",s),g.onScrollEnd!=null&&ni("scrollend",s),g.onClick!=null&&(s.onclick=Dr),s=!0):s=!1,s||Da(a,!0)}function Pu(a){for(jn=a.return;jn;)switch(jn.tag){case 5:case 31:case 13:Wa=!1;return;case 27:case 3:Wa=!0;return;default:jn=jn.return}}function as(a){if(a!==jn)return!1;if(!$t)return Pu(a),$t=!0,!1;var s=a.tag,c;if((c=s!==3&&s!==27)&&((c=s===5)&&(c=a.type,c=!(c!=="form"&&c!=="button")||_f(a.type,a.memoizedProps)),c=!c),c&&Ci&&Da(a),Pu(a),s===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(Se(317));Ci=Yn(a)}else if(s===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(Se(317));Ci=Yn(a)}else s===27?(s=Ci,Jl(a.type)?(a=ar,ar=null,Ci=a):Ci=s):Ci=jn?Gr(a.stateNode.nextSibling):null;return!0}function rs(){Ci=jn=null,$t=!1}function ss(){var a=zs;return a!==null&&(wr===null?wr=a:wr.push.apply(wr,a),zs=null),a}function Ds(a){zs===null?zs=[a]:zs.push(a)}var Ps=de(null),fr=null,os=null;function Is(a,s,c){st(Ps,s._currentValue),s._currentValue=c}function ls(a){a._currentValue=Ps.current,Ge(Ps)}function Tc(a,s,c){for(;a!==null;){var g=a.alternate;if((a.childLanes&s)!==s?(a.childLanes|=s,g!==null&&(g.childLanes|=s)):g!==null&&(g.childLanes&s)!==s&&(g.childLanes|=s),a===c)break;a=a.return}}function Sc(a,s,c,g){var w=a.child;for(w!==null&&(w.return=a);w!==null;){var M=w.dependencies;if(M!==null){var L=w.child;M=M.firstContext;e:for(;M!==null;){var Z=M;M=w;for(var le=0;le<s.length;le++)if(Z.context===s[le]){M.lanes|=c,Z=M.alternate,Z!==null&&(Z.lanes|=c),Tc(M.return,c,a),g||(L=null);break e}M=Z.next}}else if(w.tag===18){if(L=w.return,L===null)throw Error(Se(341));L.lanes|=c,M=L.alternate,M!==null&&(M.lanes|=c),Tc(L,c,a),L=null}else L=w.child;if(L!==null)L.return=w;else for(L=w;L!==null;){if(L===a){L=null;break}if(w=L.sibling,w!==null){w.return=L.return,L=w;break}L=L.return}w=L}}function Qa(a,s,c,g){a=null;for(var w=s,M=!1;w!==null;){if(!M){if((w.flags&524288)!==0)M=!0;else if((w.flags&262144)!==0)break}if(w.tag===10){var L=w.alternate;if(L===null)throw Error(Se(387));if(L=L.memoizedProps,L!==null){var Z=w.type;Ca(w.pendingProps.value,L.value)||(a!==null?a.push(Z):a=[Z])}}else if(w===Yt.current){if(L=w.alternate,L===null)throw Error(Se(387));L.memoizedState.memoizedState!==w.memoizedState.memoizedState&&(a!==null?a.push(eh):a=[eh])}w=w.return}a!==null&&Sc(s,a,c,g),s.flags|=262144}function kl(a){for(a=a.firstContext;a!==null;){if(!Ca(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function Rs(a){fr=a,os=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function bn(a){return Mc(fr,a)}function Iu(a,s){return fr===null&&Rs(a),Mc(a,s)}function Mc(a,s){var c=s._currentValue;if(s={context:s,memoizedValue:c,next:null},os===null){if(a===null)throw Error(Se(308));os=s,a.dependencies={lanes:0,firstContext:s},a.flags|=524288}else os=os.next=s;return c}var vh=typeof AbortController<"u"?AbortController:function(){var a=[],s=this.signal={aborted:!1,addEventListener:function(c,g){a.push(g)}};this.abort=function(){s.aborted=!0,a.forEach(function(c){return c()})}},Pd=et.unstable_scheduleCallback,xh=et.unstable_NormalPriority,pn={$$typeof:qt,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function us(){return{controller:new vh,data:new Map,refCount:0}}function Ol(a){a.refCount--,a.refCount===0&&Pd(xh,function(){a.controller.abort()})}var ua=null,Ka=0,qo=0,ca=null;function Nf(a,s){if(ua===null){var c=ua=[];Ka=0,qo=hp(),ca={status:"pending",value:void 0,then:function(g){c.push(g)}}}return Ka++,s.then(Fl,Fl),s}function Fl(){if(--Ka===0&&ua!==null){ca!==null&&(ca.status="fulfilled");var a=ua;ua=null,qo=0,ca=null;for(var s=0;s<a.length;s++)(0,a[s])()}}function Ru(a,s){var c=[],g={status:"pending",value:null,reason:null,then:function(w){c.push(w)}};return a.then(function(){g.status="fulfilled",g.value=s;for(var w=0;w<c.length;w++)(0,c[w])(s)},function(w){for(g.status="rejected",g.reason=w,w=0;w<c.length;w++)(0,c[w])(void 0)}),g}var Bn=Oe.S;Oe.S=function(a,s){rm=Fn(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&Nf(a,s),Bn!==null&&Bn(a,s)};var Ir=de(null);function Ac(){var a=Ir.current;return a!==null?a:Hi.pooledCache}function Ec(a,s){s===null?st(Ir,Ir.current):st(Ir,s.pool)}function Id(){var a=Ac();return a===null?null:{parent:pn._currentValue,pool:a}}var Rr=Error(Se(460)),po=Error(Se(474)),Ia=Error(Se(542)),tt={then:function(){}};function Lu(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Cc(a,s,c){switch(c=a[c],c===void 0?a.push(s):c!==s&&(s.then(Dr,Dr),s=c),s.status){case"fulfilled":return s.value;case"rejected":throw a=s.reason,zc(a),a;default:if(typeof s.status=="string")s.then(Dr,Dr);else{if(a=Hi,a!==null&&100<a.shellSuspendCounter)throw Error(Se(482));a=s,a.status="pending",a.then(function(g){if(s.status==="pending"){var w=s;w.status="fulfilled",w.value=g}},function(g){if(s.status==="pending"){var w=s;w.status="rejected",w.reason=g}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw a=s.reason,zc(a),a}throw Lr=s,Rr}}function pr(a){try{var s=a._init;return s(a._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(Lr=c,Rr):c}}var Lr=null;function Nl(){if(Lr===null)throw Error(Se(459));var a=Lr;return Lr=null,a}function zc(a){if(a===Rr||a===Ia)throw Error(Se(483))}var cs=null,Zo=0;function Bu(a){var s=Zo;return Zo+=1,cs===null&&(cs=[]),Cc(cs,a,s)}function hs(a,s){s=s.props.ref,a.ref=s!==void 0?s:null}function Dc(a,s){throw s.$$typeof===Bt?Error(Se(525)):(a=Object.prototype.toString.call(s),Error(Se(31,a==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":a)))}function ku(a){function s(pe,he){if(a){var Ae=pe.deletions;Ae===null?(pe.deletions=[he],pe.flags|=16):Ae.push(he)}}function c(pe,he){if(!a)return null;for(;he!==null;)s(pe,he),he=he.sibling;return null}function g(pe){for(var he=new Map;pe!==null;)pe.key!==null?he.set(pe.key,pe):he.set(pe.index,pe),pe=pe.sibling;return he}function w(pe,he){return pe=$a(pe,he),pe.index=0,pe.sibling=null,pe}function M(pe,he,Ae){return pe.index=Ae,a?(Ae=pe.alternate,Ae!==null?(Ae=Ae.index,Ae<he?(pe.flags|=67108866,he):Ae):(pe.flags|=67108866,he)):(pe.flags|=1048576,he)}function L(pe){return a&&pe.alternate===null&&(pe.flags|=67108866),pe}function Z(pe,he,Ae,Ve){return he===null||he.tag!==6?(he=gh(Ae,pe.mode,Ve),he.return=pe,he):(he=w(he,Ae),he.return=pe,he)}function le(pe,he,Ae,Ve){var Mt=Ae.type;return Mt===bt?Fe(pe,he,Ae.props.children,Ve,Ae.key):he!==null&&(he.elementType===Mt||typeof Mt=="object"&&Mt!==null&&Mt.$$typeof===Dn&&pr(Mt)===he.type)?(he=w(he,Ae.props),hs(he,Ae),he.return=pe,he):(he=bc(Ae.type,Ae.key,Ae.props,null,pe.mode,Ve),hs(he,Ae),he.return=pe,he)}function Ce(pe,he,Ae,Ve){return he===null||he.tag!==4||he.stateNode.containerInfo!==Ae.containerInfo||he.stateNode.implementation!==Ae.implementation?(he=uo(Ae,pe.mode,Ve),he.return=pe,he):(he=w(he,Ae.children||[]),he.return=pe,he)}function Fe(pe,he,Ae,Ve,Mt){return he===null||he.tag!==7?(he=lo(Ae,pe.mode,Ve,Mt),he.return=pe,he):(he=w(he,Ae),he.return=pe,he)}function Ze(pe,he,Ae){if(typeof he=="string"&&he!==""||typeof he=="number"||typeof he=="bigint")return he=gh(""+he,pe.mode,Ae),he.return=pe,he;if(typeof he=="object"&&he!==null){switch(he.$$typeof){case Xt:return Ae=bc(he.type,he.key,he.props,null,pe.mode,Ae),hs(Ae,he),Ae.return=pe,Ae;case di:return he=uo(he,pe.mode,Ae),he.return=pe,he;case Dn:return he=pr(he),Ze(pe,he,Ae)}if(Jn(he)||en(he))return he=lo(he,pe.mode,Ae,null),he.return=pe,he;if(typeof he.then=="function")return Ze(pe,Bu(he),Ae);if(he.$$typeof===qt)return Ze(pe,Iu(pe,he),Ae);Dc(pe,he)}return null}function ze(pe,he,Ae,Ve){var Mt=he!==null?he.key:null;if(typeof Ae=="string"&&Ae!==""||typeof Ae=="number"||typeof Ae=="bigint")return Mt!==null?null:Z(pe,he,""+Ae,Ve);if(typeof Ae=="object"&&Ae!==null){switch(Ae.$$typeof){case Xt:return Ae.key===Mt?le(pe,he,Ae,Ve):null;case di:return Ae.key===Mt?Ce(pe,he,Ae,Ve):null;case Dn:return Ae=pr(Ae),ze(pe,he,Ae,Ve)}if(Jn(Ae)||en(Ae))return Mt!==null?null:Fe(pe,he,Ae,Ve,null);if(typeof Ae.then=="function")return ze(pe,he,Bu(Ae),Ve);if(Ae.$$typeof===qt)return ze(pe,he,Iu(pe,Ae),Ve);Dc(pe,Ae)}return null}function Ie(pe,he,Ae,Ve,Mt){if(typeof Ve=="string"&&Ve!==""||typeof Ve=="number"||typeof Ve=="bigint")return pe=pe.get(Ae)||null,Z(he,pe,""+Ve,Mt);if(typeof Ve=="object"&&Ve!==null){switch(Ve.$$typeof){case Xt:return pe=pe.get(Ve.key===null?Ae:Ve.key)||null,le(he,pe,Ve,Mt);case di:return pe=pe.get(Ve.key===null?Ae:Ve.key)||null,Ce(he,pe,Ve,Mt);case Dn:return Ve=pr(Ve),Ie(pe,he,Ae,Ve,Mt)}if(Jn(Ve)||en(Ve))return pe=pe.get(Ae)||null,Fe(he,pe,Ve,Mt,null);if(typeof Ve.then=="function")return Ie(pe,he,Ae,Bu(Ve),Mt);if(Ve.$$typeof===qt)return Ie(pe,he,Ae,Iu(he,Ve),Mt);Dc(he,Ve)}return null}function dt(pe,he,Ae,Ve){for(var Mt=null,Ti=null,ft=he,vt=he=0,ei=null;ft!==null&&vt<Ae.length;vt++){ft.index>vt?(ei=ft,ft=null):ei=ft.sibling;var yi=ze(pe,ft,Ae[vt],Ve);if(yi===null){ft===null&&(ft=ei);break}a&&ft&&yi.alternate===null&&s(pe,ft),he=M(yi,he,vt),Ti===null?Mt=yi:Ti.sibling=yi,Ti=yi,ft=ei}if(vt===Ae.length)return c(pe,ft),$t&&Cs(pe,vt),Mt;if(ft===null){for(;vt<Ae.length;vt++)ft=Ze(pe,Ae[vt],Ve),ft!==null&&(he=M(ft,he,vt),Ti===null?Mt=ft:Ti.sibling=ft,Ti=ft);return $t&&Cs(pe,vt),Mt}for(ft=g(ft);vt<Ae.length;vt++)ei=Ie(ft,pe,vt,Ae[vt],Ve),ei!==null&&(a&&ei.alternate!==null&&ft.delete(ei.key===null?vt:ei.key),he=M(ei,he,vt),Ti===null?Mt=ei:Ti.sibling=ei,Ti=ei);return a&&ft.forEach(function(dl){return s(pe,dl)}),$t&&Cs(pe,vt),Mt}function Ct(pe,he,Ae,Ve){if(Ae==null)throw Error(Se(151));for(var Mt=null,Ti=null,ft=he,vt=he=0,ei=null,yi=Ae.next();ft!==null&&!yi.done;vt++,yi=Ae.next()){ft.index>vt?(ei=ft,ft=null):ei=ft.sibling;var dl=ze(pe,ft,yi.value,Ve);if(dl===null){ft===null&&(ft=ei);break}a&&ft&&dl.alternate===null&&s(pe,ft),he=M(dl,he,vt),Ti===null?Mt=dl:Ti.sibling=dl,Ti=dl,ft=ei}if(yi.done)return c(pe,ft),$t&&Cs(pe,vt),Mt;if(ft===null){for(;!yi.done;vt++,yi=Ae.next())yi=Ze(pe,yi.value,Ve),yi!==null&&(he=M(yi,he,vt),Ti===null?Mt=yi:Ti.sibling=yi,Ti=yi);return $t&&Cs(pe,vt),Mt}for(ft=g(ft);!yi.done;vt++,yi=Ae.next())yi=Ie(ft,pe,vt,yi.value,Ve),yi!==null&&(a&&yi.alternate!==null&&ft.delete(yi.key===null?vt:yi.key),he=M(yi,he,vt),Ti===null?Mt=yi:Ti.sibling=yi,Ti=yi);return a&&ft.forEach(function(Fp){return s(pe,Fp)}),$t&&Cs(pe,vt),Mt}function Oi(pe,he,Ae,Ve){if(typeof Ae=="object"&&Ae!==null&&Ae.type===bt&&Ae.key===null&&(Ae=Ae.props.children),typeof Ae=="object"&&Ae!==null){switch(Ae.$$typeof){case Xt:e:{for(var Mt=Ae.key;he!==null;){if(he.key===Mt){if(Mt=Ae.type,Mt===bt){if(he.tag===7){c(pe,he.sibling),Ve=w(he,Ae.props.children),Ve.return=pe,pe=Ve;break e}}else if(he.elementType===Mt||typeof Mt=="object"&&Mt!==null&&Mt.$$typeof===Dn&&pr(Mt)===he.type){c(pe,he.sibling),Ve=w(he,Ae.props),hs(Ve,Ae),Ve.return=pe,pe=Ve;break e}c(pe,he);break}else s(pe,he);he=he.sibling}Ae.type===bt?(Ve=lo(Ae.props.children,pe.mode,Ve,Ae.key),Ve.return=pe,pe=Ve):(Ve=bc(Ae.type,Ae.key,Ae.props,null,pe.mode,Ve),hs(Ve,Ae),Ve.return=pe,pe=Ve)}return L(pe);case di:e:{for(Mt=Ae.key;he!==null;){if(he.key===Mt)if(he.tag===4&&he.stateNode.containerInfo===Ae.containerInfo&&he.stateNode.implementation===Ae.implementation){c(pe,he.sibling),Ve=w(he,Ae.children||[]),Ve.return=pe,pe=Ve;break e}else{c(pe,he);break}else s(pe,he);he=he.sibling}Ve=uo(Ae,pe.mode,Ve),Ve.return=pe,pe=Ve}return L(pe);case Dn:return Ae=pr(Ae),Oi(pe,he,Ae,Ve)}if(Jn(Ae))return dt(pe,he,Ae,Ve);if(en(Ae)){if(Mt=en(Ae),typeof Mt!="function")throw Error(Se(150));return Ae=Mt.call(Ae),Ct(pe,he,Ae,Ve)}if(typeof Ae.then=="function")return Oi(pe,he,Bu(Ae),Ve);if(Ae.$$typeof===qt)return Oi(pe,he,Iu(pe,Ae),Ve);Dc(pe,Ae)}return typeof Ae=="string"&&Ae!==""||typeof Ae=="number"||typeof Ae=="bigint"?(Ae=""+Ae,he!==null&&he.tag===6?(c(pe,he.sibling),Ve=w(he,Ae),Ve.return=pe,pe=Ve):(c(pe,he),Ve=gh(Ae,pe.mode,Ve),Ve.return=pe,pe=Ve),L(pe)):c(pe,he)}return function(pe,he,Ae,Ve){try{Zo=0;var Mt=Oi(pe,he,Ae,Ve);return cs=null,Mt}catch(ft){if(ft===Rr||ft===Ia)throw ft;var Ti=Ya(29,ft,null,pe.mode);return Ti.lanes=Ve,Ti.return=pe,Ti}}}var ds=ku(!0),bh=ku(!1),fs=!1;function Pc(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ou(a,s){a=a.updateQueue,s.updateQueue===a&&(s.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function ps(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function Ls(a,s,c){var g=a.updateQueue;if(g===null)return null;if(g=g.shared,(Pi&2)!==0){var w=g.pending;return w===null?s.next=s:(s.next=w.next,w.next=s),g.pending=s,s=Rl(a),mh(a,null,c),s}return Du(a,g,s,c),Rl(a)}function mr(a,s,c){if(s=s.updateQueue,s!==null&&(s=s.shared,(c&4194048)!==0)){var g=s.lanes;g&=a.pendingLanes,c|=g,s.lanes=c,vn(a,c)}}function gi(a,s){var c=a.updateQueue,g=a.alternate;if(g!==null&&(g=g.updateQueue,c===g)){var w=null,M=null;if(c=c.firstBaseUpdate,c!==null){do{var L={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};M===null?w=M=L:M=M.next=L,c=c.next}while(c!==null);M===null?w=M=s:M=M.next=s}else w=M=s;c={baseState:g.baseState,firstBaseUpdate:w,lastBaseUpdate:M,shared:g.shared,callbacks:g.callbacks},a.updateQueue=c;return}a=c.lastBaseUpdate,a===null?c.firstBaseUpdate=s:a.next=s,c.lastBaseUpdate=s}var wh=!1;function Bs(){if(wh){var a=ca;if(a!==null)throw a}}function mo(a,s,c,g){wh=!1;var w=a.updateQueue;fs=!1;var M=w.firstBaseUpdate,L=w.lastBaseUpdate,Z=w.shared.pending;if(Z!==null){w.shared.pending=null;var le=Z,Ce=le.next;le.next=null,L===null?M=Ce:L.next=Ce,L=le;var Fe=a.alternate;Fe!==null&&(Fe=Fe.updateQueue,Z=Fe.lastBaseUpdate,Z!==L&&(Z===null?Fe.firstBaseUpdate=Ce:Z.next=Ce,Fe.lastBaseUpdate=le))}if(M!==null){var Ze=w.baseState;L=0,Fe=Ce=le=null,Z=M;do{var ze=Z.lane&-536870913,Ie=ze!==Z.lane;if(Ie?(ii&ze)===ze:(g&ze)===ze){ze!==0&&ze===qo&&(wh=!0),Fe!==null&&(Fe=Fe.next={lane:0,tag:Z.tag,payload:Z.payload,callback:null,next:null});e:{var dt=a,Ct=Z;ze=s;var Oi=c;switch(Ct.tag){case 1:if(dt=Ct.payload,typeof dt=="function"){Ze=dt.call(Oi,Ze,ze);break e}Ze=dt;break e;case 3:dt.flags=dt.flags&-65537|128;case 0:if(dt=Ct.payload,ze=typeof dt=="function"?dt.call(Oi,Ze,ze):dt,ze==null)break e;Ze=ut({},Ze,ze);break e;case 2:fs=!0}}ze=Z.callback,ze!==null&&(a.flags|=64,Ie&&(a.flags|=8192),Ie=w.callbacks,Ie===null?w.callbacks=[ze]:Ie.push(ze))}else Ie={lane:ze,tag:Z.tag,payload:Z.payload,callback:Z.callback,next:null},Fe===null?(Ce=Fe=Ie,le=Ze):Fe=Fe.next=Ie,L|=ze;if(Z=Z.next,Z===null){if(Z=w.shared.pending,Z===null)break;Ie=Z,Z=Ie.next,Ie.next=null,w.lastBaseUpdate=Ie,w.shared.pending=null}}while(!0);Fe===null&&(le=Ze),w.baseState=le,w.firstBaseUpdate=Ce,w.lastBaseUpdate=Fe,M===null&&(w.shared.lanes=0),rl|=L,a.lanes=L,a.memoizedState=Ze}}function Fu(a,s){if(typeof a!="function")throw Error(Se(191,a));a.call(s)}function Ic(a,s){var c=a.callbacks;if(c!==null)for(a.callbacks=null,a=0;a<c.length;a++)Fu(c[a],s)}var Ho=de(null),Nu=de(0);function Th(a,s){a=al,st(Nu,a),st(Ho,s),al=a|s.baseLanes}function Ja(){st(Nu,al),st(Ho,Ho.current)}function Xo(){al=Nu.current,Ge(Ho),Ge(Nu)}var at=de(null),lt=null;function gr(a){var s=a.alternate;st(on,on.current&1),st(at,a),lt===null&&(s===null||Ho.current!==null||s.memoizedState!==null)&&(lt=a)}function jl(a){st(on,on.current),st(at,a),lt===null&&(lt=a)}function ju(a){a.tag===22?(st(on,on.current),st(at,a),lt===null&&(lt=a)):mn()}function mn(){st(on,on.current),st(at,at.current)}function Qi(a){Ge(at),lt===a&&(lt=null),Ge(on)}var on=de(0);function Vu(a){for(var s=a;s!==null;){if(s.tag===13){var c=s.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||ka(c)||Cn(c)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break;for(;s.sibling===null;){if(s.return===null||s.return===a)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var ks=0,Vt=null,ci=null,jt=null,qi=!1,_r=!1,Br=!1,Yo=0,$o=0,Os=null,Sh=0;function Fi(){throw Error(Se(321))}function kr(a,s){if(s===null)return!1;for(var c=0;c<s.length&&c<a.length;c++)if(!Ca(a[c],s[c]))return!1;return!0}function Vl(a,s,c,g,w,M){return ks=M,Vt=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Oe.H=a===null||a.memoizedState===null?Di:wn,Br=!1,M=c(g,w),Br=!1,_r&&(M=Uu(s,c,g,w)),Ul(a),M}function Ul(a){Oe.H=_i;var s=ci!==null&&ci.next!==null;if(ks=0,jt=ci=Vt=null,qi=!1,$o=0,Os=null,s)throw Error(Se(300));a===null||Gn||(a=a.dependencies,a!==null&&kl(a)&&(Gn=!0))}function Uu(a,s,c,g){Vt=a;var w=0;do{if(_r&&(Os=null),$o=0,_r=!1,25<=w)throw Error(Se(301));if(w+=1,jt=ci=null,a.updateQueue!=null){var M=a.updateQueue;M.lastEffect=null,M.events=null,M.stores=null,M.memoCache!=null&&(M.memoCache.index=0)}Oe.H=En,M=s(c,g)}while(_r);return M}function Gu(){var a=Oe.H,s=a.useState()[0];return s=typeof s.then=="function"?Wo(s):s,a=a.useState()[0],(ci!==null?ci.memoizedState:null)!==a&&(Vt.flags|=1024),s}function qu(){var a=Yo!==0;return Yo=0,a}function go(a,s,c){s.updateQueue=a.updateQueue,s.flags&=-2053,a.lanes&=~c}function Fs(a){if(qi){for(a=a.memoizedState;a!==null;){var s=a.queue;s!==null&&(s.pending=null),a=a.next}qi=!1}ks=0,jt=ci=Vt=null,_r=!1,$o=Yo=0,Os=null}function ea(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return jt===null?Vt.memoizedState=jt=a:jt=jt.next=a,jt}function Zi(){if(ci===null){var a=Vt.alternate;a=a!==null?a.memoizedState:null}else a=ci.next;var s=jt===null?Vt.memoizedState:jt.next;if(s!==null)jt=s,ci=a;else{if(a===null)throw Vt.alternate===null?Error(Se(467)):Error(Se(310));ci=a,a={memoizedState:ci.memoizedState,baseState:ci.baseState,baseQueue:ci.baseQueue,queue:ci.queue,next:null},jt===null?Vt.memoizedState=jt=a:jt=jt.next=a}return jt}function ms(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Wo(a){var s=$o;return $o+=1,Os===null&&(Os=[]),a=Cc(Os,a,s),s=Vt,(jt===null?s.memoizedState:jt.next)===null&&(s=s.alternate,Oe.H=s===null||s.memoizedState===null?Di:wn),a}function Qo(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Wo(a);if(a.$$typeof===qt)return bn(a)}throw Error(Se(438,String(a)))}function Gl(a){var s=null,c=Vt.updateQueue;if(c!==null&&(s=c.memoCache),s==null){var g=Vt.alternate;g!==null&&(g=g.updateQueue,g!==null&&(g=g.memoCache,g!=null&&(s={data:g.data.map(function(w){return w.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),c===null&&(c=ms(),Vt.updateQueue=c),c.memoCache=s,c=s.data[s.index],c===void 0)for(c=s.data[s.index]=Array(a),g=0;g<a;g++)c[g]=Ma;return s.index++,c}function Or(a,s){return typeof s=="function"?s(a):s}function m(a){var s=Zi();return t(s,ci,a)}function t(a,s,c){var g=a.queue;if(g===null)throw Error(Se(311));g.lastRenderedReducer=c;var w=a.baseQueue,M=g.pending;if(M!==null){if(w!==null){var L=w.next;w.next=M.next,M.next=L}s.baseQueue=w=M,g.pending=null}if(M=a.baseState,w===null)a.memoizedState=M;else{s=w.next;var Z=L=null,le=null,Ce=s,Fe=!1;do{var Ze=Ce.lane&-536870913;if(Ze!==Ce.lane?(ii&Ze)===Ze:(ks&Ze)===Ze){var ze=Ce.revertLane;if(ze===0)le!==null&&(le=le.next={lane:0,revertLane:0,gesture:null,action:Ce.action,hasEagerState:Ce.hasEagerState,eagerState:Ce.eagerState,next:null}),Ze===qo&&(Fe=!0);else if((ks&ze)===ze){Ce=Ce.next,ze===qo&&(Fe=!0);continue}else Ze={lane:0,revertLane:Ce.revertLane,gesture:null,action:Ce.action,hasEagerState:Ce.hasEagerState,eagerState:Ce.eagerState,next:null},le===null?(Z=le=Ze,L=M):le=le.next=Ze,Vt.lanes|=ze,rl|=ze;Ze=Ce.action,Br&&c(M,Ze),M=Ce.hasEagerState?Ce.eagerState:c(M,Ze)}else ze={lane:Ze,revertLane:Ce.revertLane,gesture:Ce.gesture,action:Ce.action,hasEagerState:Ce.hasEagerState,eagerState:Ce.eagerState,next:null},le===null?(Z=le=ze,L=M):le=le.next=ze,Vt.lanes|=Ze,rl|=Ze;Ce=Ce.next}while(Ce!==null&&Ce!==s);if(le===null?L=M:le.next=Z,!Ca(M,a.memoizedState)&&(Gn=!0,Fe&&(c=ca,c!==null)))throw c;a.memoizedState=M,a.baseState=L,a.baseQueue=le,g.lastRenderedState=M}return w===null&&(g.lanes=0),[a.memoizedState,g.dispatch]}function r(a){var s=Zi(),c=s.queue;if(c===null)throw Error(Se(311));c.lastRenderedReducer=a;var g=c.dispatch,w=c.pending,M=s.memoizedState;if(w!==null){c.pending=null;var L=w=w.next;do M=a(M,L.action),L=L.next;while(L!==w);Ca(M,s.memoizedState)||(Gn=!0),s.memoizedState=M,s.baseQueue===null&&(s.baseState=M),c.lastRenderedState=M}return[M,g]}function l(a,s,c){var g=Vt,w=Zi(),M=$t;if(M){if(c===void 0)throw Error(Se(407));c=c()}else c=s();var L=!Ca((ci||w).memoizedState,c);if(L&&(w.memoizedState=c,Gn=!0),w=w.queue,we(v.bind(null,g,w,a),[a]),w.getSnapshot!==s||L||jt!==null&&jt.memoizedState.tag&1){if(g.flags|=2048,ee(9,{destroy:void 0},_.bind(null,g,w,c,s),null),Hi===null)throw Error(Se(349));M||(ks&127)!==0||h(g,s,c)}return c}function h(a,s,c){a.flags|=16384,a={getSnapshot:s,value:c},s=Vt.updateQueue,s===null?(s=ms(),Vt.updateQueue=s,s.stores=[a]):(c=s.stores,c===null?s.stores=[a]:c.push(a))}function _(a,s,c,g){s.value=c,s.getSnapshot=g,b(s)&&S(a)}function v(a,s,c){return c(function(){b(s)&&S(a)})}function b(a){var s=a.getSnapshot;a=a.value;try{var c=s();return!Ca(a,c)}catch{return!0}}function S(a){var s=dr(a,2);s!==null&&Sr(s,a,2)}function E(a){var s=ea();if(typeof a=="function"){var c=a;if(a=c(),Br){xe(!0);try{c()}finally{xe(!1)}}}return s.memoizedState=s.baseState=a,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Or,lastRenderedState:a},s}function z(a,s,c,g){return a.baseState=c,t(a,ci,typeof g=="function"?g:Or)}function R(a,s,c,g,w){if(er(a))throw Error(Se(485));if(a=s.action,a!==null){var M={payload:w,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(L){M.listeners.push(L)}};Oe.T!==null?c(!0):M.isTransition=!1,g(M),c=s.pending,c===null?(M.next=s.pending=M,I(s,M)):(M.next=c.next,s.pending=c.next=M)}}function I(a,s){var c=s.action,g=s.payload,w=a.state;if(s.isTransition){var M=Oe.T,L={};Oe.T=L;try{var Z=c(w,g),le=Oe.S;le!==null&&le(L,Z),F(a,s,Z)}catch(Ce){Y(a,s,Ce)}finally{M!==null&&L.types!==null&&(M.types=L.types),Oe.T=M}}else try{M=c(w,g),F(a,s,M)}catch(Ce){Y(a,s,Ce)}}function F(a,s,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(g){U(a,s,g)},function(g){return Y(a,s,g)}):U(a,s,c)}function U(a,s,c){s.status="fulfilled",s.value=c,W(s),a.state=c,s=a.pending,s!==null&&(c=s.next,c===s?a.pending=null:(c=c.next,s.next=c,I(a,c)))}function Y(a,s,c){var g=a.pending;if(a.pending=null,g!==null){g=g.next;do s.status="rejected",s.reason=c,W(s),s=s.next;while(s!==g)}a.action=null}function W(a){a=a.listeners;for(var s=0;s<a.length;s++)(0,a[s])()}function $(a,s){return s}function K(a,s){if($t){var c=Hi.formState;if(c!==null){e:{var g=Vt;if($t){if(Ci){t:{for(var w=Ci,M=Wa;w.nodeType!==8;){if(!M){w=null;break t}if(w=Gr(w.nextSibling),w===null){w=null;break t}}M=w.data,w=M==="F!"||M==="F"?w:null}if(w){Ci=Gr(w.nextSibling),g=w.data==="F!";break e}}Da(g)}g=!1}g&&(s=c[0])}}return c=ea(),c.memoizedState=c.baseState=s,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:$,lastRenderedState:s},c.queue=g,c=ql.bind(null,Vt,g),g.dispatch=c,g=E(!1),M=La.bind(null,Vt,!1,g.queue),g=ea(),w={state:s,dispatch:null,action:a,pending:null},g.queue=w,c=R.bind(null,Vt,w,M,c),w.dispatch=c,g.memoizedState=a,[s,c,!1]}function ne(a){var s=Zi();return Q(s,ci,a)}function Q(a,s,c){if(s=t(a,s,$)[0],a=m(Or)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var g=Wo(s)}catch(L){throw L===Rr?Ia:L}else g=s;s=Zi();var w=s.queue,M=w.dispatch;return c!==s.memoizedState&&(Vt.flags|=2048,ee(9,{destroy:void 0},ie.bind(null,w,c),null)),[g,M,a]}function ie(a,s){a.action=s}function se(a){var s=Zi(),c=ci;if(c!==null)return Q(s,c,a);Zi(),s=s.memoizedState,c=Zi();var g=c.queue.dispatch;return c.memoizedState=a,[s,g,!1]}function ee(a,s,c,g){return a={tag:a,create:c,deps:g,inst:s,next:null},s=Vt.updateQueue,s===null&&(s=ms(),Vt.updateQueue=s),c=s.lastEffect,c===null?s.lastEffect=a.next=a:(g=c.next,c.next=a,a.next=g,s.lastEffect=a),a}function ce(){return Zi().memoizedState}function Me(a,s,c,g){var w=ea();Vt.flags|=a,w.memoizedState=ee(1|s,{destroy:void 0},c,g===void 0?null:g)}function _e(a,s,c,g){var w=Zi();g=g===void 0?null:g;var M=w.memoizedState.inst;ci!==null&&g!==null&&kr(g,ci.memoizedState.deps)?w.memoizedState=ee(s,M,c,g):(Vt.flags|=a,w.memoizedState=ee(1|s,M,c,g))}function be(a,s){Me(8390656,8,a,s)}function we(a,s){_e(2048,8,a,s)}function Xe(a){Vt.flags|=4;var s=Vt.updateQueue;if(s===null)s=ms(),Vt.updateQueue=s,s.events=[a];else{var c=s.events;c===null?s.events=[a]:c.push(a)}}function Ye(a){var s=Zi().memoizedState;return Xe({ref:s,nextImpl:a}),function(){if((Pi&2)!==0)throw Error(Se(440));return s.impl.apply(void 0,arguments)}}function Ne(a,s){return _e(4,2,a,s)}function We(a,s){return _e(4,4,a,s)}function zt(a,s){if(typeof s=="function"){a=a();var c=s(a);return function(){typeof c=="function"?c():s(null)}}if(s!=null)return a=a(),s.current=a,function(){s.current=null}}function hi(a,s,c){c=c!=null?c.concat([a]):null,_e(4,4,zt.bind(null,s,a),c)}function Li(){}function zi(a,s){var c=Zi();s=s===void 0?null:s;var g=c.memoizedState;return s!==null&&kr(s,g[1])?g[0]:(c.memoizedState=[a,s],a)}function Ni(a,s){var c=Zi();s=s===void 0?null:s;var g=c.memoizedState;if(s!==null&&kr(s,g[1]))return g[0];if(g=a(),Br){xe(!0);try{a()}finally{xe(!1)}}return c.memoizedState=[g,s],g}function bi(a,s,c){return c===void 0||(ks&1073741824)!==0&&(ii&261930)===0?a.memoizedState=s:(a.memoizedState=c,a=om(),Vt.lanes|=a,rl|=a,c)}function Ki(a,s,c,g){return Ca(c,s)?c:Ho.current!==null?(a=bi(a,c,g),Ca(a,s)||(Gn=!0),a):(ks&42)===0||(ks&1073741824)!==0&&(ii&261930)===0?(Gn=!0,a.memoizedState=c):(a=om(),Vt.lanes|=a,rl|=a,s)}function ji(a,s,c,g,w){var M=Ke.p;Ke.p=M!==0&&8>M?M:8;var L=Oe.T,Z={};Oe.T=Z,La(a,!1,s,c);try{var le=w(),Ce=Oe.S;if(Ce!==null&&Ce(Z,le),le!==null&&typeof le=="object"&&typeof le.then=="function"){var Fe=Ru(le,g);Nr(a,s,Fe,Tr(a))}else Nr(a,s,g,Tr(a))}catch(Ze){Nr(a,s,{then:function(){},status:"rejected",reason:Ze},Tr())}finally{Ke.p=M,L!==null&&Z.types!==null&&(L.types=Z.types),Oe.T=L}}function Vn(){}function ln(a,s,c,g){if(a.tag!==5)throw Error(Se(476));var w=un(a).queue;ji(a,w,s,St,c===null?Vn:function(){return Un(a),c(g)})}function un(a){var s=a.memoizedState;if(s!==null)return s;s={memoizedState:St,baseState:St,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Or,lastRenderedState:St},next:null};var c={};return s.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Or,lastRenderedState:c},next:null},a.memoizedState=s,a=a.alternate,a!==null&&(a.memoizedState=s),s}function Un(a){var s=un(a);s.next===null&&(s=a.alternate.memoizedState),Nr(a,s.next.queue,{},Tr())}function gs(){return bn(eh)}function _s(){return Zi().memoizedState}function Fr(){return Zi().memoizedState}function Ra(a){for(var s=a.return;s!==null;){switch(s.tag){case 24:case 3:var c=Tr();a=ps(c);var g=Ls(s,a,c);g!==null&&(Sr(g,s,c),mr(g,s,c)),s={cache:us()},a.payload=s;return}s=s.return}}function Ko(a,s,c){var g=Tr();c={lane:g,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},er(a)?yr(s,c):(c=oo(a,s,c,g),c!==null&&(Sr(c,a,g),vr(c,s,g)))}function ql(a,s,c){var g=Tr();Nr(a,s,c,g)}function Nr(a,s,c,g){var w={lane:g,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(er(a))yr(s,w);else{var M=a.alternate;if(a.lanes===0&&(M===null||M.lanes===0)&&(M=s.lastRenderedReducer,M!==null))try{var L=s.lastRenderedState,Z=M(L,c);if(w.hasEagerState=!0,w.eagerState=Z,Ca(Z,L))return Du(a,s,w,0),Hi===null&&Vo(),!1}catch{}if(c=oo(a,s,w,g),c!==null)return Sr(c,a,g),vr(c,s,g),!0}return!1}function La(a,s,c,g){if(g={lane:2,revertLane:hp(),gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null},er(a)){if(s)throw Error(Se(479))}else s=oo(a,c,g,2),s!==null&&Sr(s,a,2)}function er(a){var s=a.alternate;return a===Vt||s!==null&&s===Vt}function yr(a,s){_r=qi=!0;var c=a.pending;c===null?s.next=s:(s.next=c.next,c.next=s),a.pending=s}function vr(a,s,c){if((c&4194048)!==0){var g=s.lanes;g&=a.pendingLanes,c|=g,s.lanes=c,vn(a,c)}}var _i={readContext:bn,use:Qo,useCallback:Fi,useContext:Fi,useEffect:Fi,useImperativeHandle:Fi,useLayoutEffect:Fi,useInsertionEffect:Fi,useMemo:Fi,useReducer:Fi,useRef:Fi,useState:Fi,useDebugValue:Fi,useDeferredValue:Fi,useTransition:Fi,useSyncExternalStore:Fi,useId:Fi,useHostTransitionStatus:Fi,useFormState:Fi,useActionState:Fi,useOptimistic:Fi,useMemoCache:Fi,useCacheRefresh:Fi};_i.useEffectEvent=Fi;var Di={readContext:bn,use:Qo,useCallback:function(a,s){return ea().memoizedState=[a,s===void 0?null:s],a},useContext:bn,useEffect:be,useImperativeHandle:function(a,s,c){c=c!=null?c.concat([a]):null,Me(4194308,4,zt.bind(null,s,a),c)},useLayoutEffect:function(a,s){return Me(4194308,4,a,s)},useInsertionEffect:function(a,s){Me(4,2,a,s)},useMemo:function(a,s){var c=ea();s=s===void 0?null:s;var g=a();if(Br){xe(!0);try{a()}finally{xe(!1)}}return c.memoizedState=[g,s],g},useReducer:function(a,s,c){var g=ea();if(c!==void 0){var w=c(s);if(Br){xe(!0);try{c(s)}finally{xe(!1)}}}else w=s;return g.memoizedState=g.baseState=w,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:w},g.queue=a,a=a.dispatch=Ko.bind(null,Vt,a),[g.memoizedState,a]},useRef:function(a){var s=ea();return a={current:a},s.memoizedState=a},useState:function(a){a=E(a);var s=a.queue,c=ql.bind(null,Vt,s);return s.dispatch=c,[a.memoizedState,c]},useDebugValue:Li,useDeferredValue:function(a,s){var c=ea();return bi(c,a,s)},useTransition:function(){var a=E(!1);return a=ji.bind(null,Vt,a.queue,!0,!1),ea().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,s,c){var g=Vt,w=ea();if($t){if(c===void 0)throw Error(Se(407));c=c()}else{if(c=s(),Hi===null)throw Error(Se(349));(ii&127)!==0||h(g,s,c)}w.memoizedState=c;var M={value:c,getSnapshot:s};return w.queue=M,be(v.bind(null,g,M,a),[a]),g.flags|=2048,ee(9,{destroy:void 0},_.bind(null,g,M,c,s),null),c},useId:function(){var a=ea(),s=Hi.identifierPrefix;if($t){var c=za,g=ns;c=(g&~(1<<32-Be(g)-1)).toString(32)+c,s="_"+s+"R_"+c,c=Yo++,0<c&&(s+="H"+c.toString(32)),s+="_"}else c=Sh++,s="_"+s+"r_"+c.toString(32)+"_";return a.memoizedState=s},useHostTransitionStatus:gs,useFormState:K,useActionState:K,useOptimistic:function(a){var s=ea();s.memoizedState=s.baseState=a;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=c,s=La.bind(null,Vt,!0,c),c.dispatch=s,[a,s]},useMemoCache:Gl,useCacheRefresh:function(){return ea().memoizedState=Ra.bind(null,Vt)},useEffectEvent:function(a){var s=ea(),c={impl:a};return s.memoizedState=c,function(){if((Pi&2)!==0)throw Error(Se(440));return c.impl.apply(void 0,arguments)}}},wn={readContext:bn,use:Qo,useCallback:zi,useContext:bn,useEffect:we,useImperativeHandle:hi,useInsertionEffect:Ne,useLayoutEffect:We,useMemo:Ni,useReducer:m,useRef:ce,useState:function(){return m(Or)},useDebugValue:Li,useDeferredValue:function(a,s){var c=Zi();return Ki(c,ci.memoizedState,a,s)},useTransition:function(){var a=m(Or)[0],s=Zi().memoizedState;return[typeof a=="boolean"?a:Wo(a),s]},useSyncExternalStore:l,useId:_s,useHostTransitionStatus:gs,useFormState:ne,useActionState:ne,useOptimistic:function(a,s){var c=Zi();return z(c,ci,a,s)},useMemoCache:Gl,useCacheRefresh:Fr};wn.useEffectEvent=Ye;var En={readContext:bn,use:Qo,useCallback:zi,useContext:bn,useEffect:we,useImperativeHandle:hi,useInsertionEffect:Ne,useLayoutEffect:We,useMemo:Ni,useReducer:r,useRef:ce,useState:function(){return r(Or)},useDebugValue:Li,useDeferredValue:function(a,s){var c=Zi();return ci===null?bi(c,a,s):Ki(c,ci.memoizedState,a,s)},useTransition:function(){var a=r(Or)[0],s=Zi().memoizedState;return[typeof a=="boolean"?a:Wo(a),s]},useSyncExternalStore:l,useId:_s,useHostTransitionStatus:gs,useFormState:se,useActionState:se,useOptimistic:function(a,s){var c=Zi();return ci!==null?z(c,ci,a,s):(c.baseState=a,[a,c.queue.dispatch])},useMemoCache:Gl,useCacheRefresh:Fr};En.useEffectEvent=Ye;function Rc(a,s,c,g){s=a.memoizedState,c=c(g,s),c=c==null?s:ut({},s,c),a.memoizedState=c,a.lanes===0&&(a.updateQueue.baseState=c)}var Lc={enqueueSetState:function(a,s,c){a=a._reactInternals;var g=Tr(),w=ps(g);w.payload=s,c!=null&&(w.callback=c),s=Ls(a,w,g),s!==null&&(Sr(s,a,g),mr(s,a,g))},enqueueReplaceState:function(a,s,c){a=a._reactInternals;var g=Tr(),w=ps(g);w.tag=1,w.payload=s,c!=null&&(w.callback=c),s=Ls(a,w,g),s!==null&&(Sr(s,a,g),mr(s,a,g))},enqueueForceUpdate:function(a,s){a=a._reactInternals;var c=Tr(),g=ps(c);g.tag=2,s!=null&&(g.callback=s),s=Ls(a,g,c),s!==null&&(Sr(s,a,c),mr(s,a,c))}};function _o(a,s,c,g,w,M,L){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(g,M,L):s.prototype&&s.prototype.isPureReactComponent?!so(c,g)||!so(w,M):!0}function Rd(a,s,c,g){a=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(c,g),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(c,g),s.state!==a&&Lc.enqueueReplaceState(s,s.state,null)}function yo(a,s){var c=s;if("ref"in s){c={};for(var g in s)g!=="ref"&&(c[g]=s[g])}if(a=a.defaultProps){c===s&&(c=ut({},c));for(var w in a)c[w]===void 0&&(c[w]=a[w])}return c}function Bc(a){ts(a)}function Ns(a){console.error(a)}function js(a){ts(a)}function jr(a,s){try{var c=a.onUncaughtError;c(s.value,{componentStack:s.stack})}catch(g){setTimeout(function(){throw g})}}function kc(a,s,c){try{var g=a.onCaughtError;g(c.value,{componentStack:c.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(w){setTimeout(function(){throw w})}}function Zu(a,s,c){return c=ps(c),c.tag=3,c.payload={element:null},c.callback=function(){jr(a,s)},c}function Hu(a){return a=ps(a),a.tag=3,a}function Xu(a,s,c,g){var w=c.type.getDerivedStateFromError;if(typeof w=="function"){var M=g.value;a.payload=function(){return w(M)},a.callback=function(){kc(s,c,g)}}var L=c.stateNode;L!==null&&typeof L.componentDidCatch=="function"&&(a.callback=function(){kc(s,c,g),typeof w!="function"&&(sl===null?sl=new Set([this]):sl.add(this));var Z=g.stack;this.componentDidCatch(g.value,{componentStack:Z!==null?Z:""})})}function Ld(a,s,c,g,w){if(c.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){if(s=c.alternate,s!==null&&Qa(s,c,w,!0),c=at.current,c!==null){switch(c.tag){case 31:case 13:return lt===null?Gh():c.alternate===null&&Tn===0&&(Tn=3),c.flags&=-257,c.flags|=65536,c.lanes=w,g===tt?c.flags|=16384:(s=c.updateQueue,s===null?c.updateQueue=new Set([g]):s.add(g),sf(a,g,w)),!1;case 22:return c.flags|=65536,g===tt?c.flags|=16384:(s=c.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([g])},c.updateQueue=s):(c=s.retryQueue,c===null?s.retryQueue=new Set([g]):c.add(g)),sf(a,g,w)),!1}throw Error(Se(435,c.tag))}return sf(a,g,w),Gh(),!1}if($t)return s=at.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=w,g!==Wi&&(a=Error(Se(422),{cause:g}),Ds(Ta(a,c)))):(g!==Wi&&(s=Error(Se(423),{cause:g}),Ds(Ta(s,c))),a=a.current.alternate,a.flags|=65536,w&=-w,a.lanes|=w,g=Ta(g,c),w=Zu(a.stateNode,g,w),gi(a,w),Tn!==4&&(Tn=2)),!1;var M=Error(Se(520),{cause:g});if(M=Ta(M,c),Nh===null?Nh=[M]:Nh.push(M),Tn!==4&&(Tn=2),s===null)return!0;g=Ta(g,c),c=s;do{switch(c.tag){case 3:return c.flags|=65536,a=w&-w,c.lanes|=a,a=Zu(c.stateNode,g,a),gi(c,a),!1;case 1:if(s=c.type,M=c.stateNode,(c.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||M!==null&&typeof M.componentDidCatch=="function"&&(sl===null||!sl.has(M))))return c.flags|=65536,w&=-w,c.lanes|=w,w=Hu(w),Xu(w,a,c,g),gi(c,w),!1}c=c.return}while(c!==null);return!1}var Bd=Error(Se(461)),Gn=!1;function ta(a,s,c,g){s.child=a===null?bh(s,null,c,g):ds(s,a.child,c,g)}function qp(a,s,c,g,w){c=c.render;var M=s.ref;if("ref"in g){var L={};for(var Z in g)Z!=="ref"&&(L[Z]=g[Z])}else L=g;return Rs(s),g=Vl(a,s,c,L,M,w),Z=qu(),a!==null&&!Gn?(go(a,s,w),xo(a,s,w)):($t&&Z&&Go(s),s.flags|=1,ta(a,s,g,w),s.child)}function kd(a,s,c,g,w){if(a===null){var M=c.type;return typeof M=="function"&&!xc(M)&&M.defaultProps===void 0&&c.compare===null?(s.tag=15,s.type=M,jf(a,s,M,g,w)):(a=bc(c.type,null,g,s,s.mode,w),a.ref=s.ref,a.return=s,s.child=a)}if(M=a.child,!Eh(a,w)){var L=M.memoizedProps;if(c=c.compare,c=c!==null?c:so,c(L,g)&&a.ref===s.ref)return xo(a,s,w)}return s.flags|=1,a=$a(M,g),a.ref=s.ref,a.return=s,s.child=a}function jf(a,s,c,g,w){if(a!==null){var M=a.memoizedProps;if(so(M,g)&&a.ref===s.ref)if(Gn=!1,s.pendingProps=g=M,Eh(a,w))(a.flags&131072)!==0&&(Gn=!0);else return s.lanes=a.lanes,xo(a,s,w)}return Uf(a,s,c,g,w)}function Vf(a,s,c,g){var w=g.children,M=a!==null?a.memoizedState:null;if(a===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),g.mode==="hidden"){if((s.flags&128)!==0){if(M=M!==null?M.baseLanes|c:c,a!==null){for(g=s.child=a.child,w=0;g!==null;)w=w|g.lanes|g.childLanes,g=g.sibling;g=w&~M}else g=0,s.child=null;return Zp(a,s,M,c,g)}if((c&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},a!==null&&Ec(s,M!==null?M.cachePool:null),M!==null?Th(s,M):Ja(),ju(s);else return g=s.lanes=536870912,Zp(a,s,M!==null?M.baseLanes|c:c,c,g)}else M!==null?(Ec(s,M.cachePool),Th(s,M),mn(),s.memoizedState=null):(a!==null&&Ec(s,null),Ja(),mn());return ta(a,s,w,c),s.child}function vo(a,s){return a!==null&&a.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function Zp(a,s,c,g,w){var M=Ac();return M=M===null?null:{parent:pn._currentValue,pool:M},s.memoizedState={baseLanes:c,cachePool:M},a!==null&&Ec(s,null),Ja(),ju(s),a!==null&&Qa(a,s,g,!0),s.childLanes=w,null}function Jo(a,s){return s=Vd({mode:s.mode,children:s.children},a.mode),s.ref=a.ref,a.child=s,s.return=a,s}function Mh(a,s,c){return ds(s,a.child,null,c),a=Jo(s,s.pendingProps),a.flags|=2,Qi(s),s.memoizedState=null,a}function Od(a,s,c){var g=s.pendingProps,w=(s.flags&128)!==0;if(s.flags&=-129,a===null){if($t){if(g.mode==="hidden")return a=Jo(s,g),s.lanes=536870912,vo(null,a);if(jl(s),(a=Ci)?(a=eu(a,Wa),a=a!==null&&a.data==="&"?a:null,a!==null&&(s.memoizedState={dehydrated:a,treeContext:is!==null?{id:ns,overflow:za}:null,retryLane:536870912,hydrationErrors:null},c=wc(a),c.return=s,s.child=c,jn=s,Ci=null)):a=null,a===null)throw Da(s);return s.lanes=536870912,null}return Jo(s,g)}var M=a.memoizedState;if(M!==null){var L=M.dehydrated;if(jl(s),w)if(s.flags&256)s.flags&=-257,s=Mh(a,s,c);else if(s.memoizedState!==null)s.child=a.child,s.flags|=128,s=null;else throw Error(Se(558));else if(Gn||Qa(a,s,c,!1),w=(c&a.childLanes)!==0,Gn||w){if(g=Hi,g!==null&&(L=yl(g,c),L!==0&&L!==M.retryLane))throw M.retryLane=L,dr(a,L),Sr(g,a,L),Bd;Gh(),s=Mh(a,s,c)}else a=M.treeContext,Ci=Gr(L.nextSibling),jn=s,$t=!0,zs=null,Wa=!1,a!==null&&yh(s,a),s=Jo(s,g),s.flags|=4096;return s}return a=$a(a.child,{mode:g.mode,children:g.children}),a.ref=s.ref,s.child=a,a.return=s,a}function Fd(a,s){var c=s.ref;if(c===null)a!==null&&a.ref!==null&&(s.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(Se(284));(a===null||a.ref!==c)&&(s.flags|=4194816)}}function Uf(a,s,c,g,w){return Rs(s),c=Vl(a,s,c,g,void 0,w),g=qu(),a!==null&&!Gn?(go(a,s,w),xo(a,s,w)):($t&&g&&Go(s),s.flags|=1,ta(a,s,c,w),s.child)}function Hp(a,s,c,g,w,M){return Rs(s),s.updateQueue=null,c=Uu(s,g,c,w),Ul(a),g=qu(),a!==null&&!Gn?(go(a,s,M),xo(a,s,M)):($t&&g&&Go(s),s.flags|=1,ta(a,s,c,M),s.child)}function Xp(a,s,c,g,w){if(Rs(s),s.stateNode===null){var M=Ot,L=c.contextType;typeof L=="object"&&L!==null&&(M=bn(L)),M=new c(g,M),s.memoizedState=M.state!==null&&M.state!==void 0?M.state:null,M.updater=Lc,s.stateNode=M,M._reactInternals=s,M=s.stateNode,M.props=g,M.state=s.memoizedState,M.refs={},Pc(s),L=c.contextType,M.context=typeof L=="object"&&L!==null?bn(L):Ot,M.state=s.memoizedState,L=c.getDerivedStateFromProps,typeof L=="function"&&(Rc(s,c,L,g),M.state=s.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof M.getSnapshotBeforeUpdate=="function"||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(L=M.state,typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount(),L!==M.state&&Lc.enqueueReplaceState(M,M.state,null),mo(s,g,M,w),Bs(),M.state=s.memoizedState),typeof M.componentDidMount=="function"&&(s.flags|=4194308),g=!0}else if(a===null){M=s.stateNode;var Z=s.memoizedProps,le=yo(c,Z);M.props=le;var Ce=M.context,Fe=c.contextType;L=Ot,typeof Fe=="object"&&Fe!==null&&(L=bn(Fe));var Ze=c.getDerivedStateFromProps;Fe=typeof Ze=="function"||typeof M.getSnapshotBeforeUpdate=="function",Z=s.pendingProps!==Z,Fe||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(Z||Ce!==L)&&Rd(s,M,g,L),fs=!1;var ze=s.memoizedState;M.state=ze,mo(s,g,M,w),Bs(),Ce=s.memoizedState,Z||ze!==Ce||fs?(typeof Ze=="function"&&(Rc(s,c,Ze,g),Ce=s.memoizedState),(le=fs||_o(s,c,le,g,ze,Ce,L))?(Fe||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount()),typeof M.componentDidMount=="function"&&(s.flags|=4194308)):(typeof M.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=g,s.memoizedState=Ce),M.props=g,M.state=Ce,M.context=L,g=le):(typeof M.componentDidMount=="function"&&(s.flags|=4194308),g=!1)}else{M=s.stateNode,Ou(a,s),L=s.memoizedProps,Fe=yo(c,L),M.props=Fe,Ze=s.pendingProps,ze=M.context,Ce=c.contextType,le=Ot,typeof Ce=="object"&&Ce!==null&&(le=bn(Ce)),Z=c.getDerivedStateFromProps,(Ce=typeof Z=="function"||typeof M.getSnapshotBeforeUpdate=="function")||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(L!==Ze||ze!==le)&&Rd(s,M,g,le),fs=!1,ze=s.memoizedState,M.state=ze,mo(s,g,M,w),Bs();var Ie=s.memoizedState;L!==Ze||ze!==Ie||fs||a!==null&&a.dependencies!==null&&kl(a.dependencies)?(typeof Z=="function"&&(Rc(s,c,Z,g),Ie=s.memoizedState),(Fe=fs||_o(s,c,Fe,g,ze,Ie,le)||a!==null&&a.dependencies!==null&&kl(a.dependencies))?(Ce||typeof M.UNSAFE_componentWillUpdate!="function"&&typeof M.componentWillUpdate!="function"||(typeof M.componentWillUpdate=="function"&&M.componentWillUpdate(g,Ie,le),typeof M.UNSAFE_componentWillUpdate=="function"&&M.UNSAFE_componentWillUpdate(g,Ie,le)),typeof M.componentDidUpdate=="function"&&(s.flags|=4),typeof M.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof M.componentDidUpdate!="function"||L===a.memoizedProps&&ze===a.memoizedState||(s.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||L===a.memoizedProps&&ze===a.memoizedState||(s.flags|=1024),s.memoizedProps=g,s.memoizedState=Ie),M.props=g,M.state=Ie,M.context=le,g=Fe):(typeof M.componentDidUpdate!="function"||L===a.memoizedProps&&ze===a.memoizedState||(s.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||L===a.memoizedProps&&ze===a.memoizedState||(s.flags|=1024),g=!1)}return M=g,Fd(a,s),g=(s.flags&128)!==0,M||g?(M=s.stateNode,c=g&&typeof c.getDerivedStateFromError!="function"?null:M.render(),s.flags|=1,a!==null&&g?(s.child=ds(s,a.child,null,w),s.child=ds(s,null,c,w)):ta(a,s,c,w),s.memoizedState=M.state,a=s.child):a=xo(a,s,w),a}function Yp(a,s,c,g){return rs(),s.flags|=256,ta(a,s,c,g),s.child}var Nd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ah(a){return{baseLanes:a,cachePool:Id()}}function jd(a,s,c){return a=a!==null?a.childLanes&~c:0,s&&(a|=Sa),a}function Gf(a,s,c){var g=s.pendingProps,w=!1,M=(s.flags&128)!==0,L;if((L=M)||(L=a!==null&&a.memoizedState===null?!1:(on.current&2)!==0),L&&(w=!0,s.flags&=-129),L=(s.flags&32)!==0,s.flags&=-33,a===null){if($t){if(w?gr(s):mn(),(a=Ci)?(a=eu(a,Wa),a=a!==null&&a.data!=="&"?a:null,a!==null&&(s.memoizedState={dehydrated:a,treeContext:is!==null?{id:ns,overflow:za}:null,retryLane:536870912,hydrationErrors:null},c=wc(a),c.return=s,s.child=c,jn=s,Ci=null)):a=null,a===null)throw Da(s);return Cn(a)?s.lanes=32:s.lanes=536870912,null}var Z=g.children;return g=g.fallback,w?(mn(),w=s.mode,Z=Vd({mode:"hidden",children:Z},w),g=lo(g,w,c,null),Z.return=s,g.return=s,Z.sibling=g,s.child=Z,g=s.child,g.memoizedState=Ah(c),g.childLanes=jd(a,L,c),s.memoizedState=Nd,vo(null,g)):(gr(s),qf(s,Z))}var le=a.memoizedState;if(le!==null&&(Z=le.dehydrated,Z!==null)){if(M)s.flags&256?(gr(s),s.flags&=-257,s=Ud(a,s,c)):s.memoizedState!==null?(mn(),s.child=a.child,s.flags|=128,s=null):(mn(),Z=g.fallback,w=s.mode,g=Vd({mode:"visible",children:g.children},w),Z=lo(Z,w,c,null),Z.flags|=2,g.return=s,Z.return=s,g.sibling=Z,s.child=g,ds(s,a.child,null,c),g=s.child,g.memoizedState=Ah(c),g.childLanes=jd(a,L,c),s.memoizedState=Nd,s=vo(null,g));else if(gr(s),Cn(Z)){if(L=Z.nextSibling&&Z.nextSibling.dataset,L)var Ce=L.dgst;L=Ce,g=Error(Se(419)),g.stack="",g.digest=L,Ds({value:g,source:null,stack:null}),s=Ud(a,s,c)}else if(Gn||Qa(a,s,c,!1),L=(c&a.childLanes)!==0,Gn||L){if(L=Hi,L!==null&&(g=yl(L,c),g!==0&&g!==le.retryLane))throw le.retryLane=g,dr(a,g),Sr(L,a,g),Bd;ka(Z)||Gh(),s=Ud(a,s,c)}else ka(Z)?(s.flags|=192,s.child=a.child,s=null):(a=le.treeContext,Ci=Gr(Z.nextSibling),jn=s,$t=!0,zs=null,Wa=!1,a!==null&&yh(s,a),s=qf(s,g.children),s.flags|=4096);return s}return w?(mn(),Z=g.fallback,w=s.mode,le=a.child,Ce=le.sibling,g=$a(le,{mode:"hidden",children:g.children}),g.subtreeFlags=le.subtreeFlags&65011712,Ce!==null?Z=$a(Ce,Z):(Z=lo(Z,w,c,null),Z.flags|=2),Z.return=s,g.return=s,g.sibling=Z,s.child=g,vo(null,g),g=s.child,Z=a.child.memoizedState,Z===null?Z=Ah(c):(w=Z.cachePool,w!==null?(le=pn._currentValue,w=w.parent!==le?{parent:le,pool:le}:w):w=Id(),Z={baseLanes:Z.baseLanes|c,cachePool:w}),g.memoizedState=Z,g.childLanes=jd(a,L,c),s.memoizedState=Nd,vo(a.child,g)):(gr(s),c=a.child,a=c.sibling,c=$a(c,{mode:"visible",children:g.children}),c.return=s,c.sibling=null,a!==null&&(L=s.deletions,L===null?(s.deletions=[a],s.flags|=16):L.push(a)),s.child=c,s.memoizedState=null,c)}function qf(a,s){return s=Vd({mode:"visible",children:s},a.mode),s.return=a,a.child=s}function Vd(a,s){return a=Ya(22,a,null,s),a.lanes=0,a}function Ud(a,s,c){return ds(s,a.child,null,c),a=qf(s,s.pendingProps.children),a.flags|=2,s.memoizedState=null,a}function Zf(a,s,c){a.lanes|=s;var g=a.alternate;g!==null&&(g.lanes|=s),Tc(a.return,s,c)}function Hf(a,s,c,g,w,M){var L=a.memoizedState;L===null?a.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:g,tail:c,tailMode:w,treeForkCount:M}:(L.isBackwards=s,L.rendering=null,L.renderingStartTime=0,L.last=g,L.tail=c,L.tailMode=w,L.treeForkCount=M)}function Gd(a,s,c){var g=s.pendingProps,w=g.revealOrder,M=g.tail;g=g.children;var L=on.current,Z=(L&2)!==0;if(Z?(L=L&1|2,s.flags|=128):L&=1,st(on,L),ta(a,s,g,c),g=$t?fo:0,!Z&&a!==null&&(a.flags&128)!==0)e:for(a=s.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Zf(a,c,s);else if(a.tag===19)Zf(a,c,s);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break e;for(;a.sibling===null;){if(a.return===null||a.return===s)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(w){case"forwards":for(c=s.child,w=null;c!==null;)a=c.alternate,a!==null&&Vu(a)===null&&(w=c),c=c.sibling;c=w,c===null?(w=s.child,s.child=null):(w=c.sibling,c.sibling=null),Hf(s,!1,w,c,M,g);break;case"backwards":case"unstable_legacy-backwards":for(c=null,w=s.child,s.child=null;w!==null;){if(a=w.alternate,a!==null&&Vu(a)===null){s.child=w;break}a=w.sibling,w.sibling=c,c=w,w=a}Hf(s,!0,c,null,M,g);break;case"together":Hf(s,!1,null,null,void 0,g);break;default:s.memoizedState=null}return s.child}function xo(a,s,c){if(a!==null&&(s.dependencies=a.dependencies),rl|=s.lanes,(c&s.childLanes)===0)if(a!==null){if(Qa(a,s,c,!1),(c&s.childLanes)===0)return null}else return null;if(a!==null&&s.child!==a.child)throw Error(Se(153));if(s.child!==null){for(a=s.child,c=$a(a,a.pendingProps),s.child=c,c.return=s;a.sibling!==null;)a=a.sibling,c=c.sibling=$a(a,a.pendingProps),c.return=s;c.sibling=null}return s.child}function Eh(a,s){return(a.lanes&s)!==0?!0:(a=a.dependencies,!!(a!==null&&kl(a)))}function Ch(a,s,c){switch(s.tag){case 3:Mi(s,s.stateNode.containerInfo),Is(s,pn,a.memoizedState.cache),rs();break;case 27:case 5:ga(s);break;case 4:Mi(s,s.stateNode.containerInfo);break;case 10:Is(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,jl(s),null;break;case 13:var g=s.memoizedState;if(g!==null)return g.dehydrated!==null?(gr(s),s.flags|=128,null):(c&s.child.childLanes)!==0?Gf(a,s,c):(gr(s),a=xo(a,s,c),a!==null?a.sibling:null);gr(s);break;case 19:var w=(a.flags&128)!==0;if(g=(c&s.childLanes)!==0,g||(Qa(a,s,c,!1),g=(c&s.childLanes)!==0),w){if(g)return Gd(a,s,c);s.flags|=128}if(w=s.memoizedState,w!==null&&(w.rendering=null,w.tail=null,w.lastEffect=null),st(on,on.current),g)break;return null;case 22:return s.lanes=0,Vf(a,s,c,s.pendingProps);case 24:Is(s,pn,a.memoizedState.cache)}return xo(a,s,c)}function Ba(a,s,c){if(a!==null)if(a.memoizedProps!==s.pendingProps)Gn=!0;else{if(!Eh(a,c)&&(s.flags&128)===0)return Gn=!1,Ch(a,s,c);Gn=(a.flags&131072)!==0}else Gn=!1,$t&&(s.flags&1048576)!==0&&_h(s,fo,s.index);switch(s.lanes=0,s.tag){case 16:e:{var g=s.pendingProps;if(a=pr(s.elementType),s.type=a,typeof a=="function")xc(a)?(g=yo(a,g),s.tag=1,s=Xp(null,s,a,g,c)):(s.tag=0,s=Uf(null,s,a,g,c));else{if(a!=null){var w=a.$$typeof;if(w===Qn){s.tag=11,s=qp(null,s,a,g,c);break e}else if(w===It){s.tag=14,s=kd(null,s,a,g,c);break e}}throw s=Va(a)||a,Error(Se(306,s,""))}}return s;case 0:return Uf(a,s,s.type,s.pendingProps,c);case 1:return g=s.type,w=yo(g,s.pendingProps),Xp(a,s,g,w,c);case 3:e:{if(Mi(s,s.stateNode.containerInfo),a===null)throw Error(Se(387));g=s.pendingProps;var M=s.memoizedState;w=M.element,Ou(a,s),mo(s,g,null,c);var L=s.memoizedState;if(g=L.cache,Is(s,pn,g),g!==M.cache&&Sc(s,[pn],c,!0),Bs(),g=L.element,M.isDehydrated)if(M={element:g,isDehydrated:!1,cache:L.cache},s.updateQueue.baseState=M,s.memoizedState=M,s.flags&256){s=Yp(a,s,g,c);break e}else if(g!==w){w=Ta(Error(Se(424)),s),Ds(w),s=Yp(a,s,g,c);break e}else for(a=s.stateNode.containerInfo,a.nodeType===9?a=a.body:a=a.nodeName==="HTML"?a.ownerDocument.body:a,Ci=Gr(a.firstChild),jn=s,$t=!0,zs=null,Wa=!0,c=bh(s,null,g,c),s.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(rs(),g===w){s=xo(a,s,c);break e}ta(a,s,g,c)}s=s.child}return s;case 26:return Fd(a,s),a===null?(c=Ap(s.type,null,s.pendingProps,null))?s.memoizedState=c:$t||(c=s.type,a=s.pendingProps,g=$h(kt.current).createElement(c),g[Ri]=s,g[$e]=a,na(g,c,a),an(g),s.stateNode=g):s.memoizedState=Ap(s.type,a.memoizedProps,s.pendingProps,a.memoizedState),null;case 27:return ga(s),a===null&&$t&&(g=s.stateNode=Cm(s.type,s.pendingProps,kt.current),jn=s,Wa=!0,w=Ci,Jl(s.type)?(ar=w,Ci=Gr(g.firstChild)):Ci=w),ta(a,s,s.pendingProps.children,c),Fd(a,s),a===null&&(s.flags|=4194304),s.child;case 5:return a===null&&$t&&((w=g=Ci)&&(g=ha(g,s.type,s.pendingProps,Wa),g!==null?(s.stateNode=g,jn=s,Ci=Gr(g.firstChild),Wa=!1,w=!0):w=!1),w||Da(s)),ga(s),w=s.type,M=s.pendingProps,L=a!==null?a.memoizedProps:null,g=M.children,_f(w,M)?g=null:L!==null&&_f(w,L)&&(s.flags|=32),s.memoizedState!==null&&(w=Vl(a,s,Gu,null,null,c),eh._currentValue=w),Fd(a,s),ta(a,s,g,c),s.child;case 6:return a===null&&$t&&((a=c=Ci)&&(c=Zs(c,s.pendingProps,Wa),c!==null?(s.stateNode=c,jn=s,Ci=null,a=!0):a=!1),a||Da(s)),null;case 13:return Gf(a,s,c);case 4:return Mi(s,s.stateNode.containerInfo),g=s.pendingProps,a===null?s.child=ds(s,null,g,c):ta(a,s,g,c),s.child;case 11:return qp(a,s,s.type,s.pendingProps,c);case 7:return ta(a,s,s.pendingProps,c),s.child;case 8:return ta(a,s,s.pendingProps.children,c),s.child;case 12:return ta(a,s,s.pendingProps.children,c),s.child;case 10:return g=s.pendingProps,Is(s,s.type,g.value),ta(a,s,g.children,c),s.child;case 9:return w=s.type._context,g=s.pendingProps.children,Rs(s),w=bn(w),g=g(w),s.flags|=1,ta(a,s,g,c),s.child;case 14:return kd(a,s,s.type,s.pendingProps,c);case 15:return jf(a,s,s.type,s.pendingProps,c);case 19:return Gd(a,s,c);case 31:return Od(a,s,c);case 22:return Vf(a,s,c,s.pendingProps);case 24:return Rs(s),g=bn(pn),a===null?(w=Ac(),w===null&&(w=Hi,M=us(),w.pooledCache=M,M.refCount++,M!==null&&(w.pooledCacheLanes|=c),w=M),s.memoizedState={parent:g,cache:w},Pc(s),Is(s,pn,w)):((a.lanes&c)!==0&&(Ou(a,s),mo(s,null,null,c),Bs()),w=a.memoizedState,M=s.memoizedState,w.parent!==g?(w={parent:g,cache:g},s.memoizedState=w,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=w),Is(s,pn,g)):(g=M.cache,Is(s,pn,g),g!==w.cache&&Sc(s,[pn],c,!0))),ta(a,s,s.pendingProps.children,c),s.child;case 29:throw s.pendingProps}throw Error(Se(156,s.tag))}function bo(a){a.flags|=4}function zh(a,s,c,g,w){if((s=(a.mode&32)!==0)&&(s=!1),s){if(a.flags|=16777216,(w&335544128)===w)if(a.stateNode.complete)a.flags|=8192;else if(ap())a.flags|=8192;else throw Lr=tt,po}else a.flags&=-16777217}function $p(a,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!Jh(s))if(ap())a.flags|=8192;else throw Lr=tt,po}function Dh(a,s){s!==null&&(a.flags|=4),a.flags&16384&&(s=a.tag!==22?mi():536870912,a.lanes|=s,Ku|=s)}function Ph(a,s){if(!$t)switch(a.tailMode){case"hidden":s=a.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?a.tail=null:c.sibling=null;break;case"collapsed":c=a.tail;for(var g=null;c!==null;)c.alternate!==null&&(g=c),c=c.sibling;g===null?s||a.tail===null?a.tail=null:a.tail.sibling=null:g.sibling=null}}function cn(a){var s=a.alternate!==null&&a.alternate.child===a.child,c=0,g=0;if(s)for(var w=a.child;w!==null;)c|=w.lanes|w.childLanes,g|=w.subtreeFlags&65011712,g|=w.flags&65011712,w.return=a,w=w.sibling;else for(w=a.child;w!==null;)c|=w.lanes|w.childLanes,g|=w.subtreeFlags,g|=w.flags,w.return=a,w=w.sibling;return a.subtreeFlags|=g,a.childLanes=c,s}function Wp(a,s,c){var g=s.pendingProps;switch(Bl(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return cn(s),null;case 1:return cn(s),null;case 3:return c=s.stateNode,g=null,a!==null&&(g=a.memoizedState.cache),s.memoizedState.cache!==g&&(s.flags|=2048),ls(pn),Bi(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(a===null||a.child===null)&&(as(s)?bo(s):a===null||a.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,ss())),cn(s),null;case 26:var w=s.type,M=s.memoizedState;return a===null?(bo(s),M!==null?(cn(s),$p(s,M)):(cn(s),zh(s,w,null,g,c))):M?M!==a.memoizedState?(bo(s),cn(s),$p(s,M)):(cn(s),s.flags&=-16777217):(a=a.memoizedProps,a!==g&&bo(s),cn(s),zh(s,w,a,g,c)),null;case 27:if(Ys(s),c=kt.current,w=s.type,a!==null&&s.stateNode!=null)a.memoizedProps!==g&&bo(s);else{if(!g){if(s.stateNode===null)throw Error(Se(166));return cn(s),null}a=ht.current,as(s)?Pa(s):(a=Cm(w,g,c),s.stateNode=a,bo(s))}return cn(s),null;case 5:if(Ys(s),w=s.type,a!==null&&s.stateNode!=null)a.memoizedProps!==g&&bo(s);else{if(!g){if(s.stateNode===null)throw Error(Se(166));return cn(s),null}if(M=ht.current,as(s))Pa(s);else{var L=$h(kt.current);switch(M){case 1:M=L.createElementNS("http://www.w3.org/2000/svg",w);break;case 2:M=L.createElementNS("http://www.w3.org/1998/Math/MathML",w);break;default:switch(w){case"svg":M=L.createElementNS("http://www.w3.org/2000/svg",w);break;case"math":M=L.createElementNS("http://www.w3.org/1998/Math/MathML",w);break;case"script":M=L.createElement("div"),M.innerHTML="<script><\/script>",M=M.removeChild(M.firstChild);break;case"select":M=typeof g.is=="string"?L.createElement("select",{is:g.is}):L.createElement("select"),g.multiple?M.multiple=!0:g.size&&(M.size=g.size);break;default:M=typeof g.is=="string"?L.createElement(w,{is:g.is}):L.createElement(w)}}M[Ri]=s,M[$e]=g;e:for(L=s.child;L!==null;){if(L.tag===5||L.tag===6)M.appendChild(L.stateNode);else if(L.tag!==4&&L.tag!==27&&L.child!==null){L.child.return=L,L=L.child;continue}if(L===s)break e;for(;L.sibling===null;){if(L.return===null||L.return===s)break e;L=L.return}L.sibling.return=L.return,L=L.sibling}s.stateNode=M;e:switch(na(M,w,g),w){case"button":case"input":case"select":case"textarea":g=!!g.autoFocus;break e;case"img":g=!0;break e;default:g=!1}g&&bo(s)}}return cn(s),zh(s,s.type,a===null?null:a.memoizedProps,s.pendingProps,c),null;case 6:if(a&&s.stateNode!=null)a.memoizedProps!==g&&bo(s);else{if(typeof g!="string"&&s.stateNode===null)throw Error(Se(166));if(a=kt.current,as(s)){if(a=s.stateNode,c=s.memoizedProps,g=null,w=jn,w!==null)switch(w.tag){case 27:case 5:g=w.memoizedProps}a[Ri]=s,a=!!(a.nodeValue===c||g!==null&&g.suppressHydrationWarning===!0||gp(a.nodeValue,c)),a||Da(s,!0)}else a=$h(a).createTextNode(g),a[Ri]=s,s.stateNode=a}return cn(s),null;case 31:if(c=s.memoizedState,a===null||a.memoizedState!==null){if(g=as(s),c!==null){if(a===null){if(!g)throw Error(Se(318));if(a=s.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(Se(557));a[Ri]=s}else rs(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;cn(s),a=!1}else c=ss(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=c),a=!0;if(!a)return s.flags&256?(Qi(s),s):(Qi(s),null);if((s.flags&128)!==0)throw Error(Se(558))}return cn(s),null;case 13:if(g=s.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(w=as(s),g!==null&&g.dehydrated!==null){if(a===null){if(!w)throw Error(Se(318));if(w=s.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(Se(317));w[Ri]=s}else rs(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;cn(s),w=!1}else w=ss(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=w),w=!0;if(!w)return s.flags&256?(Qi(s),s):(Qi(s),null)}return Qi(s),(s.flags&128)!==0?(s.lanes=c,s):(c=g!==null,a=a!==null&&a.memoizedState!==null,c&&(g=s.child,w=null,g.alternate!==null&&g.alternate.memoizedState!==null&&g.alternate.memoizedState.cachePool!==null&&(w=g.alternate.memoizedState.cachePool.pool),M=null,g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(M=g.memoizedState.cachePool.pool),M!==w&&(g.flags|=2048)),c!==a&&c&&(s.child.flags|=8192),Dh(s,s.updateQueue),cn(s),null);case 4:return Bi(),a===null&&pp(s.stateNode.containerInfo),cn(s),null;case 10:return ls(s.type),cn(s),null;case 19:if(Ge(on),g=s.memoizedState,g===null)return cn(s),null;if(w=(s.flags&128)!==0,M=g.rendering,M===null)if(w)Ph(g,!1);else{if(Tn!==0||a!==null&&(a.flags&128)!==0)for(a=s.child;a!==null;){if(M=Vu(a),M!==null){for(s.flags|=128,Ph(g,!1),a=M.updateQueue,s.updateQueue=a,Dh(s,a),s.subtreeFlags=0,a=c,c=s.child;c!==null;)Dd(c,a),c=c.sibling;return st(on,on.current&1|2),$t&&Cs(s,g.treeForkCount),s.child}a=a.sibling}g.tail!==null&&Fn()>jh&&(s.flags|=128,w=!0,Ph(g,!1),s.lanes=4194304)}else{if(!w)if(a=Vu(M),a!==null){if(s.flags|=128,w=!0,a=a.updateQueue,s.updateQueue=a,Dh(s,a),Ph(g,!0),g.tail===null&&g.tailMode==="hidden"&&!M.alternate&&!$t)return cn(s),null}else 2*Fn()-g.renderingStartTime>jh&&c!==536870912&&(s.flags|=128,w=!0,Ph(g,!1),s.lanes=4194304);g.isBackwards?(M.sibling=s.child,s.child=M):(a=g.last,a!==null?a.sibling=M:s.child=M,g.last=M)}return g.tail!==null?(a=g.tail,g.rendering=a,g.tail=a.sibling,g.renderingStartTime=Fn(),a.sibling=null,c=on.current,st(on,w?c&1|2:c&1),$t&&Cs(s,g.treeForkCount),a):(cn(s),null);case 22:case 23:return Qi(s),Xo(),g=s.memoizedState!==null,a!==null?a.memoizedState!==null!==g&&(s.flags|=8192):g&&(s.flags|=8192),g?(c&536870912)!==0&&(s.flags&128)===0&&(cn(s),s.subtreeFlags&6&&(s.flags|=8192)):cn(s),c=s.updateQueue,c!==null&&Dh(s,c.retryQueue),c=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(c=a.memoizedState.cachePool.pool),g=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(g=s.memoizedState.cachePool.pool),g!==c&&(s.flags|=2048),a!==null&&Ge(Ir),null;case 24:return c=null,a!==null&&(c=a.memoizedState.cache),s.memoizedState.cache!==c&&(s.flags|=2048),ls(pn),cn(s),null;case 25:return null;case 30:return null}throw Error(Se(156,s.tag))}function Zm(a,s){switch(Bl(s),s.tag){case 1:return a=s.flags,a&65536?(s.flags=a&-65537|128,s):null;case 3:return ls(pn),Bi(),a=s.flags,(a&65536)!==0&&(a&128)===0?(s.flags=a&-65537|128,s):null;case 26:case 27:case 5:return Ys(s),null;case 31:if(s.memoizedState!==null){if(Qi(s),s.alternate===null)throw Error(Se(340));rs()}return a=s.flags,a&65536?(s.flags=a&-65537|128,s):null;case 13:if(Qi(s),a=s.memoizedState,a!==null&&a.dehydrated!==null){if(s.alternate===null)throw Error(Se(340));rs()}return a=s.flags,a&65536?(s.flags=a&-65537|128,s):null;case 19:return Ge(on),null;case 4:return Bi(),null;case 10:return ls(s.type),null;case 22:case 23:return Qi(s),Xo(),a!==null&&Ge(Ir),a=s.flags,a&65536?(s.flags=a&-65537|128,s):null;case 24:return ls(pn),null;case 25:return null;default:return null}}function qd(a,s){switch(Bl(s),s.tag){case 3:ls(pn),Bi();break;case 26:case 27:case 5:Ys(s);break;case 4:Bi();break;case 31:s.memoizedState!==null&&Qi(s);break;case 13:Qi(s);break;case 19:Ge(on);break;case 10:ls(s.type);break;case 22:case 23:Qi(s),Xo(),a!==null&&Ge(Ir);break;case 24:ls(pn)}}function Oc(a,s){try{var c=s.updateQueue,g=c!==null?c.lastEffect:null;if(g!==null){var w=g.next;c=w;do{if((c.tag&a)===a){g=void 0;var M=c.create,L=c.inst;g=M(),L.destroy=g}c=c.next}while(c!==w)}}catch(Z){Ii(s,s.return,Z)}}function el(a,s,c){try{var g=s.updateQueue,w=g!==null?g.lastEffect:null;if(w!==null){var M=w.next;g=M;do{if((g.tag&a)===a){var L=g.inst,Z=L.destroy;if(Z!==void 0){L.destroy=void 0,w=s;var le=c,Ce=Z;try{Ce()}catch(Fe){Ii(w,le,Fe)}}}g=g.next}while(g!==M)}}catch(Fe){Ii(s,s.return,Fe)}}function Qp(a){var s=a.updateQueue;if(s!==null){var c=a.stateNode;try{Ic(s,c)}catch(g){Ii(a,a.return,g)}}}function Kp(a,s,c){c.props=yo(a.type,a.memoizedProps),c.state=a.memoizedState;try{c.componentWillUnmount()}catch(g){Ii(a,s,g)}}function Ih(a,s){try{var c=a.ref;if(c!==null){switch(a.tag){case 26:case 27:case 5:var g=a.stateNode;break;case 30:g=a.stateNode;break;default:g=a.stateNode}typeof c=="function"?a.refCleanup=c(g):c.current=g}}catch(w){Ii(a,s,w)}}function Vr(a,s){var c=a.ref,g=a.refCleanup;if(c!==null)if(typeof g=="function")try{g()}catch(w){Ii(a,s,w)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(w){Ii(a,s,w)}else c.current=null}function Zd(a){var s=a.type,c=a.memoizedProps,g=a.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":c.autoFocus&&g.focus();break e;case"img":c.src?g.src=c.src:c.srcSet&&(g.srcset=c.srcSet)}}catch(w){Ii(a,a.return,w)}}function Hd(a,s,c){try{var g=a.stateNode;Am(g,a.type,c,s),g[$e]=s}catch(w){Ii(a,a.return,w)}}function Zl(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Jl(a.type)||a.tag===4}function Yu(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||Zl(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Jl(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Xf(a,s,c){var g=a.tag;if(g===5||g===6)a=a.stateNode,s?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(a,s):(s=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,s.appendChild(a),c=c._reactRootContainer,c!=null||s.onclick!==null||(s.onclick=Dr));else if(g!==4&&(g===27&&Jl(a.type)&&(c=a.stateNode,s=null),a=a.child,a!==null))for(Xf(a,s,c),a=a.sibling;a!==null;)Xf(a,s,c),a=a.sibling}function Xd(a,s,c){var g=a.tag;if(g===5||g===6)a=a.stateNode,s?c.insertBefore(a,s):c.appendChild(a);else if(g!==4&&(g===27&&Jl(a.type)&&(c=a.stateNode),a=a.child,a!==null))for(Xd(a,s,c),a=a.sibling;a!==null;)Xd(a,s,c),a=a.sibling}function Jp(a){var s=a.stateNode,c=a.memoizedProps;try{for(var g=a.type,w=s.attributes;w.length;)s.removeAttributeNode(w[0]);na(s,g,c),s[Ri]=a,s[$e]=c}catch(M){Ii(a,a.return,M)}}var tl=!1,qn=!1,Yf=!1,em=typeof WeakSet=="function"?WeakSet:Set,Zn=null;function Hm(a,s){if(a=a.containerInfo,Yh=ad,a=pc(a),Su(a)){if("selectionStart"in a)var c={start:a.selectionStart,end:a.selectionEnd};else e:{c=(c=a.ownerDocument)&&c.defaultView||window;var g=c.getSelection&&c.getSelection();if(g&&g.rangeCount!==0){c=g.anchorNode;var w=g.anchorOffset,M=g.focusNode;g=g.focusOffset;try{c.nodeType,M.nodeType}catch{c=null;break e}var L=0,Z=-1,le=-1,Ce=0,Fe=0,Ze=a,ze=null;t:for(;;){for(var Ie;Ze!==c||w!==0&&Ze.nodeType!==3||(Z=L+w),Ze!==M||g!==0&&Ze.nodeType!==3||(le=L+g),Ze.nodeType===3&&(L+=Ze.nodeValue.length),(Ie=Ze.firstChild)!==null;)ze=Ze,Ze=Ie;for(;;){if(Ze===a)break t;if(ze===c&&++Ce===w&&(Z=L),ze===M&&++Fe===g&&(le=L),(Ie=Ze.nextSibling)!==null)break;Ze=ze,ze=Ze.parentNode}Ze=Ie}c=Z===-1||le===-1?null:{start:Z,end:le}}else c=null}c=c||{start:0,end:0}}else c=null;for(_p={focusedElem:a,selectionRange:c},ad=!1,Zn=s;Zn!==null;)if(s=Zn,a=s.child,(s.subtreeFlags&1028)!==0&&a!==null)a.return=s,Zn=a;else for(;Zn!==null;){switch(s=Zn,M=s.alternate,a=s.flags,s.tag){case 0:if((a&4)!==0&&(a=s.updateQueue,a=a!==null?a.events:null,a!==null))for(c=0;c<a.length;c++)w=a[c],w.ref.impl=w.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&M!==null){a=void 0,c=s,w=M.memoizedProps,M=M.memoizedState,g=c.stateNode;try{var dt=yo(c.type,w);a=g.getSnapshotBeforeUpdate(dt,M),g.__reactInternalSnapshotBeforeUpdate=a}catch(Ct){Ii(c,c.return,Ct)}}break;case 3:if((a&1024)!==0){if(a=s.stateNode.containerInfo,c=a.nodeType,c===9)qs(a);else if(c===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":qs(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(Se(163))}if(a=s.sibling,a!==null){a.return=s.return,Zn=a;break}Zn=s.return}}function $f(a,s,c){var g=c.flags;switch(c.tag){case 0:case 11:case 15:br(a,c),g&4&&Oc(5,c);break;case 1:if(br(a,c),g&4)if(a=c.stateNode,s===null)try{a.componentDidMount()}catch(L){Ii(c,c.return,L)}else{var w=yo(c.type,s.memoizedProps);s=s.memoizedState;try{a.componentDidUpdate(w,s,a.__reactInternalSnapshotBeforeUpdate)}catch(L){Ii(c,c.return,L)}}g&64&&Qp(c),g&512&&Ih(c,c.return);break;case 3:if(br(a,c),g&64&&(a=c.updateQueue,a!==null)){if(s=null,c.child!==null)switch(c.child.tag){case 27:case 5:s=c.child.stateNode;break;case 1:s=c.child.stateNode}try{Ic(a,s)}catch(L){Ii(c,c.return,L)}}break;case 27:s===null&&g&4&&Jp(c);case 26:case 5:br(a,c),s===null&&g&4&&Zd(c),g&512&&Ih(c,c.return);break;case 12:br(a,c);break;case 31:br(a,c),g&4&&Rh(a,c);break;case 13:br(a,c),g&4&&Lh(a,c),g&64&&(a=c.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(c=sp.bind(null,c),Xn(a,c))));break;case 22:if(g=c.memoizedState!==null||tl,!g){s=s!==null&&s.memoizedState!==null||qn,w=tl;var M=qn;tl=g,(qn=s)&&!M?il(a,c,(c.subtreeFlags&8772)!==0):br(a,c),tl=w,qn=M}break;case 30:break;default:br(a,c)}}function Fc(a){var s=a.alternate;s!==null&&(a.alternate=null,Fc(s)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(s=a.stateNode,s!==null&&Eo(s)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var gn=null,si=!1;function xr(a,s,c){for(c=c.child;c!==null;)Wf(a,s,c),c=c.sibling}function Wf(a,s,c){if(ue&&typeof ue.onCommitFiberUnmount=="function")try{ue.onCommitFiberUnmount(fe,c)}catch{}switch(c.tag){case 26:qn||Vr(c,s),xr(a,s,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:qn||Vr(c,s);var g=gn,w=si;Jl(c.type)&&(gn=c.stateNode,si=!1),xr(a,s,c),Qc(c.stateNode),gn=g,si=w;break;case 5:qn||Vr(c,s);case 6:if(g=gn,w=si,gn=null,xr(a,s,c),gn=g,si=w,gn!==null)if(si)try{(gn.nodeType===9?gn.body:gn.nodeName==="HTML"?gn.ownerDocument.body:gn).removeChild(c.stateNode)}catch(M){Ii(c,s,M)}else try{gn.removeChild(c.stateNode)}catch(M){Ii(c,s,M)}break;case 18:gn!==null&&(si?(a=gn,Em(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,c.stateNode),ru(a)):Em(gn,c.stateNode));break;case 4:g=gn,w=si,gn=c.stateNode.containerInfo,si=!0,xr(a,s,c),gn=g,si=w;break;case 0:case 11:case 14:case 15:el(2,c,s),qn||el(4,c,s),xr(a,s,c);break;case 1:qn||(Vr(c,s),g=c.stateNode,typeof g.componentWillUnmount=="function"&&Kp(c,s,g)),xr(a,s,c);break;case 21:xr(a,s,c);break;case 22:qn=(g=qn)||c.memoizedState!==null,xr(a,s,c),qn=g;break;default:xr(a,s,c)}}function Rh(a,s){if(s.memoizedState===null&&(a=s.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{ru(a)}catch(c){Ii(s,s.return,c)}}}function Lh(a,s){if(s.memoizedState===null&&(a=s.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{ru(a)}catch(c){Ii(s,s.return,c)}}function Bh(a){switch(a.tag){case 31:case 13:case 19:var s=a.stateNode;return s===null&&(s=a.stateNode=new em),s;case 22:return a=a.stateNode,s=a._retryCache,s===null&&(s=a._retryCache=new em),s;default:throw Error(Se(435,a.tag))}}function kh(a,s){var c=Bh(a);s.forEach(function(g){if(!c.has(g)){c.add(g);var w=$m.bind(null,a,g);g.then(w,w)}})}function tr(a,s){var c=s.deletions;if(c!==null)for(var g=0;g<c.length;g++){var w=c[g],M=a,L=s,Z=L;e:for(;Z!==null;){switch(Z.tag){case 27:if(Jl(Z.type)){gn=Z.stateNode,si=!1;break e}break;case 5:gn=Z.stateNode,si=!1;break e;case 3:case 4:gn=Z.stateNode.containerInfo,si=!0;break e}Z=Z.return}if(gn===null)throw Error(Se(160));Wf(M,L,w),gn=null,si=!1,M=w.alternate,M!==null&&(M.return=null),w.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)Yd(s,a),s=s.sibling}var ir=null;function Yd(a,s){var c=a.alternate,g=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:tr(s,a),ia(a),g&4&&(el(3,a,a.return),Oc(3,a),el(5,a,a.return));break;case 1:tr(s,a),ia(a),g&512&&(qn||c===null||Vr(c,c.return)),g&64&&tl&&(a=a.updateQueue,a!==null&&(g=a.callbacks,g!==null&&(c=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=c===null?g:c.concat(g))));break;case 26:var w=ir;if(tr(s,a),ia(a),g&512&&(qn||c===null||Vr(c,c.return)),g&4){var M=c!==null?c.memoizedState:null;if(g=a.memoizedState,c===null)if(g===null)if(a.stateNode===null){e:{g=a.type,c=a.memoizedProps,w=w.ownerDocument||w;t:switch(g){case"title":M=w.getElementsByTagName("title")[0],(!M||M[Pt]||M[Ri]||M.namespaceURI==="http://www.w3.org/2000/svg"||M.hasAttribute("itemprop"))&&(M=w.createElement(g),w.head.insertBefore(M,w.querySelector("head > title"))),na(M,g,c),M[Ri]=a,an(M),g=M;break e;case"link":var L=Dp("link","href",w).get(g+(c.href||""));if(L){for(var Z=0;Z<L.length;Z++)if(M=L[Z],M.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&M.getAttribute("rel")===(c.rel==null?null:c.rel)&&M.getAttribute("title")===(c.title==null?null:c.title)&&M.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){L.splice(Z,1);break t}}M=w.createElement(g),na(M,g,c),w.head.appendChild(M);break;case"meta":if(L=Dp("meta","content",w).get(g+(c.content||""))){for(Z=0;Z<L.length;Z++)if(M=L[Z],M.getAttribute("content")===(c.content==null?null:""+c.content)&&M.getAttribute("name")===(c.name==null?null:c.name)&&M.getAttribute("property")===(c.property==null?null:c.property)&&M.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&M.getAttribute("charset")===(c.charSet==null?null:c.charSet)){L.splice(Z,1);break t}}M=w.createElement(g),na(M,g,c),w.head.appendChild(M);break;default:throw Error(Se(468,g))}M[Ri]=a,an(M),g=M}a.stateNode=g}else Kh(w,a.type,a.stateNode);else a.stateNode=zp(w,g,a.memoizedProps);else M!==g?(M===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):M.count--,g===null?Kh(w,a.type,a.stateNode):zp(w,g,a.memoizedProps)):g===null&&a.stateNode!==null&&Hd(a,a.memoizedProps,c.memoizedProps)}break;case 27:tr(s,a),ia(a),g&512&&(qn||c===null||Vr(c,c.return)),c!==null&&g&4&&Hd(a,a.memoizedProps,c.memoizedProps);break;case 5:if(tr(s,a),ia(a),g&512&&(qn||c===null||Vr(c,c.return)),a.flags&32){w=a.stateNode;try{As(w,"")}catch(dt){Ii(a,a.return,dt)}}g&4&&a.stateNode!=null&&(w=a.memoizedProps,Hd(a,w,c!==null?c.memoizedProps:w)),g&1024&&(Yf=!0);break;case 6:if(tr(s,a),ia(a),g&4){if(a.stateNode===null)throw Error(Se(162));g=a.memoizedProps,c=a.stateNode;try{c.nodeValue=g}catch(dt){Ii(a,a.return,dt)}}break;case 3:if(Tf=null,w=ir,ir=xf(s.containerInfo),tr(s,a),ir=w,ia(a),g&4&&c!==null&&c.memoizedState.isDehydrated)try{ru(s.containerInfo)}catch(dt){Ii(a,a.return,dt)}Yf&&(Yf=!1,Oh(a));break;case 4:g=ir,ir=xf(a.stateNode.containerInfo),tr(s,a),ia(a),ir=g;break;case 12:tr(s,a),ia(a);break;case 31:tr(s,a),ia(a),g&4&&(g=a.updateQueue,g!==null&&(a.updateQueue=null,kh(a,g)));break;case 13:tr(s,a),ia(a),a.child.flags&8192&&a.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(Qd=Fn()),g&4&&(g=a.updateQueue,g!==null&&(a.updateQueue=null,kh(a,g)));break;case 22:w=a.memoizedState!==null;var le=c!==null&&c.memoizedState!==null,Ce=tl,Fe=qn;if(tl=Ce||w,qn=Fe||le,tr(s,a),qn=Fe,tl=Ce,ia(a),g&8192)e:for(s=a.stateNode,s._visibility=w?s._visibility&-2:s._visibility|1,w&&(c===null||le||tl||qn||Vs(a)),c=null,s=a;;){if(s.tag===5||s.tag===26){if(c===null){le=c=s;try{if(M=le.stateNode,w)L=M.style,typeof L.setProperty=="function"?L.setProperty("display","none","important"):L.display="none";else{Z=le.stateNode;var Ze=le.memoizedProps.style,ze=Ze!=null&&Ze.hasOwnProperty("display")?Ze.display:null;Z.style.display=ze==null||typeof ze=="boolean"?"":(""+ze).trim()}}catch(dt){Ii(le,le.return,dt)}}}else if(s.tag===6){if(c===null){le=s;try{le.stateNode.nodeValue=w?"":le.memoizedProps}catch(dt){Ii(le,le.return,dt)}}}else if(s.tag===18){if(c===null){le=s;try{var Ie=le.stateNode;w?Gt(Ie,!0):Gt(le.stateNode,!1)}catch(dt){Ii(le,le.return,dt)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===a)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break e;for(;s.sibling===null;){if(s.return===null||s.return===a)break e;c===s&&(c=null),s=s.return}c===s&&(c=null),s.sibling.return=s.return,s=s.sibling}g&4&&(g=a.updateQueue,g!==null&&(c=g.retryQueue,c!==null&&(g.retryQueue=null,kh(a,c))));break;case 19:tr(s,a),ia(a),g&4&&(g=a.updateQueue,g!==null&&(a.updateQueue=null,kh(a,g)));break;case 30:break;case 21:break;default:tr(s,a),ia(a)}}function ia(a){var s=a.flags;if(s&2){try{for(var c,g=a.return;g!==null;){if(Zl(g)){c=g;break}g=g.return}if(c==null)throw Error(Se(160));switch(c.tag){case 27:var w=c.stateNode,M=Yu(a);Xd(a,M,w);break;case 5:var L=c.stateNode;c.flags&32&&(As(L,""),c.flags&=-33);var Z=Yu(a);Xd(a,Z,L);break;case 3:case 4:var le=c.stateNode.containerInfo,Ce=Yu(a);Xf(a,Ce,le);break;default:throw Error(Se(161))}}catch(Fe){Ii(a,a.return,Fe)}a.flags&=-3}s&4096&&(a.flags&=-4097)}function Oh(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var s=a;Oh(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),a=a.sibling}}function br(a,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)$f(a,s.alternate,s),s=s.sibling}function Vs(a){for(a=a.child;a!==null;){var s=a;switch(s.tag){case 0:case 11:case 14:case 15:el(4,s,s.return),Vs(s);break;case 1:Vr(s,s.return);var c=s.stateNode;typeof c.componentWillUnmount=="function"&&Kp(s,s.return,c),Vs(s);break;case 27:Qc(s.stateNode);case 26:case 5:Vr(s,s.return),Vs(s);break;case 22:s.memoizedState===null&&Vs(s);break;case 30:Vs(s);break;default:Vs(s)}a=a.sibling}}function il(a,s,c){for(c=c&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var g=s.alternate,w=a,M=s,L=M.flags;switch(M.tag){case 0:case 11:case 15:il(w,M,c),Oc(4,M);break;case 1:if(il(w,M,c),g=M,w=g.stateNode,typeof w.componentDidMount=="function")try{w.componentDidMount()}catch(Ce){Ii(g,g.return,Ce)}if(g=M,w=g.updateQueue,w!==null){var Z=g.stateNode;try{var le=w.shared.hiddenCallbacks;if(le!==null)for(w.shared.hiddenCallbacks=null,w=0;w<le.length;w++)Fu(le[w],Z)}catch(Ce){Ii(g,g.return,Ce)}}c&&L&64&&Qp(M),Ih(M,M.return);break;case 27:Jp(M);case 26:case 5:il(w,M,c),c&&g===null&&L&4&&Zd(M),Ih(M,M.return);break;case 12:il(w,M,c);break;case 31:il(w,M,c),c&&L&4&&Rh(w,M);break;case 13:il(w,M,c),c&&L&4&&Lh(w,M);break;case 22:M.memoizedState===null&&il(w,M,c),Ih(M,M.return);break;case 30:break;default:il(w,M,c)}s=s.sibling}}function $d(a,s){var c=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(c=a.memoizedState.cachePool.pool),a=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(a=s.memoizedState.cachePool.pool),a!==c&&(a!=null&&a.refCount++,c!=null&&Ol(c))}function nl(a,s){a=null,s.alternate!==null&&(a=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==a&&(s.refCount++,a!=null&&Ol(a))}function Us(a,s,c,g){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Qf(a,s,c,g),s=s.sibling}function Qf(a,s,c,g){var w=s.flags;switch(s.tag){case 0:case 11:case 15:Us(a,s,c,g),w&2048&&Oc(9,s);break;case 1:Us(a,s,c,g);break;case 3:Us(a,s,c,g),w&2048&&(a=null,s.alternate!==null&&(a=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==a&&(s.refCount++,a!=null&&Ol(a)));break;case 12:if(w&2048){Us(a,s,c,g),a=s.stateNode;try{var M=s.memoizedProps,L=M.id,Z=M.onPostCommit;typeof Z=="function"&&Z(L,s.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(le){Ii(s,s.return,le)}}else Us(a,s,c,g);break;case 31:Us(a,s,c,g);break;case 13:Us(a,s,c,g);break;case 23:break;case 22:M=s.stateNode,L=s.alternate,s.memoizedState!==null?M._visibility&2?Us(a,s,c,g):$u(a,s):M._visibility&2?Us(a,s,c,g):(M._visibility|=2,wo(a,s,c,g,(s.subtreeFlags&10256)!==0||!1)),w&2048&&$d(L,s);break;case 24:Us(a,s,c,g),w&2048&&nl(s.alternate,s);break;default:Us(a,s,c,g)}}function wo(a,s,c,g,w){for(w=w&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var M=a,L=s,Z=c,le=g,Ce=L.flags;switch(L.tag){case 0:case 11:case 15:wo(M,L,Z,le,w),Oc(8,L);break;case 23:break;case 22:var Fe=L.stateNode;L.memoizedState!==null?Fe._visibility&2?wo(M,L,Z,le,w):$u(M,L):(Fe._visibility|=2,wo(M,L,Z,le,w)),w&&Ce&2048&&$d(L.alternate,L);break;case 24:wo(M,L,Z,le,w),w&&Ce&2048&&nl(L.alternate,L);break;default:wo(M,L,Z,le,w)}s=s.sibling}}function $u(a,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var c=a,g=s,w=g.flags;switch(g.tag){case 22:$u(c,g),w&2048&&$d(g.alternate,g);break;case 24:$u(c,g),w&2048&&nl(g.alternate,g);break;default:$u(c,g)}s=s.sibling}}var Nc=8192;function Wu(a,s,c){if(a.subtreeFlags&Nc)for(a=a.child;a!==null;)tm(a,s,c),a=a.sibling}function tm(a,s,c){switch(a.tag){case 26:Wu(a,s,c),a.flags&Nc&&a.memoizedState!==null&&Pp(c,ir,a.memoizedState,a.memoizedProps);break;case 5:Wu(a,s,c);break;case 3:case 4:var g=ir;ir=xf(a.stateNode.containerInfo),Wu(a,s,c),ir=g;break;case 22:a.memoizedState===null&&(g=a.alternate,g!==null&&g.memoizedState!==null?(g=Nc,Nc=16777216,Wu(a,s,c),Nc=g):Wu(a,s,c));break;default:Wu(a,s,c)}}function im(a){var s=a.alternate;if(s!==null&&(a=s.child,a!==null)){s.child=null;do s=a.sibling,a.sibling=null,a=s;while(a!==null)}}function Fh(a){var s=a.deletions;if((a.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var g=s[c];Zn=g,jc(g,a)}im(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)nm(a),a=a.sibling}function nm(a){switch(a.tag){case 0:case 11:case 15:Fh(a),a.flags&2048&&el(9,a,a.return);break;case 3:Fh(a);break;case 12:Fh(a);break;case 22:var s=a.stateNode;a.memoizedState!==null&&s._visibility&2&&(a.return===null||a.return.tag!==13)?(s._visibility&=-3,Wd(a)):Fh(a);break;default:Fh(a)}}function Wd(a){var s=a.deletions;if((a.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var g=s[c];Zn=g,jc(g,a)}im(a)}for(a=a.child;a!==null;){switch(s=a,s.tag){case 0:case 11:case 15:el(8,s,s.return),Wd(s);break;case 22:c=s.stateNode,c._visibility&2&&(c._visibility&=-3,Wd(s));break;default:Wd(s)}a=a.sibling}}function jc(a,s){for(;Zn!==null;){var c=Zn;switch(c.tag){case 0:case 11:case 15:el(8,c,s);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var g=c.memoizedState.cachePool.pool;g!=null&&g.refCount++}break;case 24:Ol(c.memoizedState.cache)}if(g=c.child,g!==null)g.return=c,Zn=g;else e:for(c=a;Zn!==null;){g=Zn;var w=g.sibling,M=g.return;if(Fc(g),g===c){Zn=null;break e}if(w!==null){w.return=M,Zn=w;break e}Zn=M}}}var Xm={getCacheForType:function(a){var s=bn(pn),c=s.data.get(a);return c===void 0&&(c=a(),s.data.set(a,c)),c},cacheSignal:function(){return bn(pn).controller.signal}},am=typeof WeakMap=="function"?WeakMap:Map,Pi=0,Hi=null,ti=null,ii=0,ki=0,nr=null,ys=!1,Hl=!1,Kf=!1,al=0,Tn=0,rl=0,Qu=0,Jf=0,Sa=0,Ku=0,Nh=null,wr=null,ep=!1,Qd=0,rm=0,jh=1/0,Vc=null,sl=null,Hn=0,ol=null,Uc=null,vs=0,tp=0,Kd=null,sm=null,Vh=0,ip=null;function Tr(){return(Pi&2)!==0&&ii!==0?ii&-ii:Oe.T!==null?hp():sa()}function om(){if(Sa===0)if((ii&536870912)===0||$t){var a=ui;ui<<=1,(ui&3932160)===0&&(ui=262144),Sa=a}else Sa=536870912;return a=at.current,a!==null&&(a.flags|=32),Sa}function Sr(a,s,c){(a===Hi&&(ki===2||ki===9)||a.cancelPendingCommit!==null)&&(qc(a,0),Xl(a,ii,Sa,!1)),vi(a,c),((Pi&2)===0||a!==Hi)&&(a===Hi&&((Pi&2)===0&&(Qu|=c),Tn===4&&Xl(a,ii,Sa,!1)),Gs(a))}function kn(a,s,c){if((Pi&6)!==0)throw Error(Se(327));var g=!c&&(s&127)===0&&(s&a.expiredLanes)===0||yn(a,s),w=g?Zc(a,s):tf(a,s,!0),M=g;do{if(w===0){Hl&&!g&&Xl(a,s,0,!1);break}else{if(c=a.current.alternate,M&&!Ym(c)){w=tf(a,s,!1),M=!1;continue}if(w===2){if(M=s,a.errorRecoveryDisabledLanes&M)var L=0;else L=a.pendingLanes&-536870913,L=L!==0?L:L&536870912?536870912:0;if(L!==0){s=L;e:{var Z=a;w=Nh;var le=Z.current.memoizedState.isDehydrated;if(le&&(qc(Z,L).flags|=256),L=tf(Z,L,!1),L!==2){if(Kf&&!le){Z.errorRecoveryDisabledLanes|=M,Qu|=M,w=4;break e}M=wr,wr=w,M!==null&&(wr===null?wr=M:wr.push.apply(wr,M))}w=L}if(M=!1,w!==2)continue}}if(w===1){qc(a,0),Xl(a,s,0,!0);break}e:{switch(g=a,M=w,M){case 0:case 1:throw Error(Se(345));case 4:if((s&4194048)!==s)break;case 6:Xl(g,s,Sa,!ys);break e;case 2:wr=null;break;case 3:case 5:break;default:throw Error(Se(329))}if((s&62914560)===s&&(w=Qd+300-Fn(),10<w)){if(Xl(g,s,Sa,!ys),pi(g,0,!0)!==0)break e;vs=s,g.timeoutHandle=vf(Gc.bind(null,g,c,wr,Vc,ep,s,Sa,Qu,Ku,ys,M,"Throttled",-0,0),w);break e}Gc(g,c,wr,Vc,ep,s,Sa,Qu,Ku,ys,M,null,-0,0)}}break}while(!0);Gs(a)}function Gc(a,s,c,g,w,M,L,Z,le,Ce,Fe,Ze,ze,Ie){if(a.timeoutHandle=-1,Ze=s.subtreeFlags,Ze&8192||(Ze&16785408)===16785408){Ze={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Dr},tm(s,M,Ze);var dt=(M&62914560)===M?Qd-Fn():(M&4194048)===M?rm-Fn():0;if(dt=Ip(Ze,dt),dt!==null){vs=M,a.cancelPendingCommit=dt(dm.bind(null,a,s,M,c,g,w,L,Z,le,Fe,Ze,null,ze,Ie)),Xl(a,M,L,!Ce);return}}dm(a,s,M,c,g,w,L,Z,le)}function Ym(a){for(var s=a;;){var c=s.tag;if((c===0||c===11||c===15)&&s.flags&16384&&(c=s.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var g=0;g<c.length;g++){var w=c[g],M=w.getSnapshot;w=w.value;try{if(!Ca(M(),w))return!1}catch{return!1}}if(c=s.child,s.subtreeFlags&16384&&c!==null)c.return=s,s=c;else{if(s===a)break;for(;s.sibling===null;){if(s.return===null||s.return===a)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Xl(a,s,c,g){s&=~Jf,s&=~Qu,a.suspendedLanes|=s,a.pingedLanes&=~s,g&&(a.warmLanes|=s),g=a.expirationTimes;for(var w=s;0<w;){var M=31-Be(w),L=1<<M;g[M]=-1,w&=~L}c!==0&&Ai(a,c,s)}function Uh(){return(Pi&6)===0?(Ur(0),!1):!0}function Jd(){if(ti!==null){if(ki===0)var a=ti.return;else a=ti,os=fr=null,Fs(a),cs=null,Zo=0,a=ti;for(;a!==null;)qd(a.alternate,a),a=a.return;ti=null}}function qc(a,s){var c=a.timeoutHandle;c!==-1&&(a.timeoutHandle=-1,vp(c)),c=a.cancelPendingCommit,c!==null&&(a.cancelPendingCommit=null,c()),vs=0,Jd(),Hi=a,ti=c=$a(a.current,null),ii=s,ki=0,nr=null,ys=!1,Hl=yn(a,s),Kf=!1,Ku=Sa=Jf=Qu=rl=Tn=0,wr=Nh=null,ep=!1,(s&8)!==0&&(s|=s&32);var g=a.entangledLanes;if(g!==0)for(a=a.entanglements,g&=s;0<g;){var w=31-Be(g),M=1<<w;s|=a[w],g&=~M}return al=s,Vo(),c}function np(a,s){Vt=null,Oe.H=_i,s===Rr||s===Ia?(s=Nl(),ki=3):s===po?(s=Nl(),ki=4):ki=s===Bd?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,nr=s,ti===null&&(Tn=1,jr(a,Ta(s,a.current)))}function ap(){var a=at.current;return a===null?!0:(ii&4194048)===ii?lt===null:(ii&62914560)===ii||(ii&536870912)!==0?a===lt:!1}function Ju(){var a=Oe.H;return Oe.H=_i,a===null?_i:a}function ef(){var a=Oe.A;return Oe.A=Xm,a}function Gh(){Tn=4,ys||(ii&4194048)!==ii&&at.current!==null||(Hl=!0),(rl&134217727)===0&&(Qu&134217727)===0||Hi===null||Xl(Hi,ii,Sa,!1)}function tf(a,s,c){var g=Pi;Pi|=2;var w=Ju(),M=ef();(Hi!==a||ii!==s)&&(Vc=null,qc(a,s)),s=!1;var L=Tn;e:do try{if(ki!==0&&ti!==null){var Z=ti,le=nr;switch(ki){case 8:Jd(),L=6;break e;case 3:case 2:case 9:case 6:at.current===null&&(s=!0);var Ce=ki;if(ki=0,nr=null,Hc(a,Z,le,Ce),c&&Hl){L=0;break e}break;default:Ce=ki,ki=0,nr=null,Hc(a,Z,le,Ce)}}nf(),L=Tn;break}catch(Fe){np(a,Fe)}while(!0);return s&&a.shellSuspendCounter++,os=fr=null,Pi=g,Oe.H=w,Oe.A=M,ti===null&&(Hi=null,ii=0,Vo()),L}function nf(){for(;ti!==null;)um(ti)}function Zc(a,s){var c=Pi;Pi|=2;var g=Ju(),w=ef();Hi!==a||ii!==s?(Vc=null,jh=Fn()+500,qc(a,s)):Hl=yn(a,s);e:do try{if(ki!==0&&ti!==null){s=ti;var M=nr;t:switch(ki){case 1:ki=0,nr=null,Hc(a,s,M,1);break;case 2:case 9:if(Lu(M)){ki=0,nr=null,cm(s);break}s=function(){ki!==2&&ki!==9||Hi!==a||(ki=7),Gs(a)},M.then(s,s);break e;case 3:ki=7;break e;case 4:ki=5;break e;case 7:Lu(M)?(ki=0,nr=null,cm(s)):(ki=0,nr=null,Hc(a,s,M,7));break;case 5:var L=null;switch(ti.tag){case 26:L=ti.memoizedState;case 5:case 27:var Z=ti;if(L?Jh(L):Z.stateNode.complete){ki=0,nr=null;var le=Z.sibling;if(le!==null)ti=le;else{var Ce=Z.return;Ce!==null?(ti=Ce,af(Ce)):ti=null}break t}}ki=0,nr=null,Hc(a,s,M,5);break;case 6:ki=0,nr=null,Hc(a,s,M,6);break;case 8:Jd(),Tn=6;break e;default:throw Error(Se(462))}}lm();break}catch(Fe){np(a,Fe)}while(!0);return os=fr=null,Oe.H=g,Oe.A=w,Pi=c,ti!==null?0:(Hi=null,ii=0,Vo(),Tn)}function lm(){for(;ti!==null&&!Er();)um(ti)}function um(a){var s=Ba(a.alternate,a,al);a.memoizedProps=a.pendingProps,s===null?af(a):ti=s}function cm(a){var s=a,c=s.alternate;switch(s.tag){case 15:case 0:s=Hp(c,s,s.pendingProps,s.type,void 0,ii);break;case 11:s=Hp(c,s,s.pendingProps,s.type.render,s.ref,ii);break;case 5:Fs(s);default:qd(c,s),s=ti=Dd(s,al),s=Ba(c,s,al)}a.memoizedProps=a.pendingProps,s===null?af(a):ti=s}function Hc(a,s,c,g){os=fr=null,Fs(s),cs=null,Zo=0;var w=s.return;try{if(Ld(a,w,s,c,ii)){Tn=1,jr(a,Ta(c,a.current)),ti=null;return}}catch(M){if(w!==null)throw ti=w,M;Tn=1,jr(a,Ta(c,a.current)),ti=null;return}s.flags&32768?($t||g===1?a=!0:Hl||(ii&536870912)!==0?a=!1:(ys=a=!0,(g===2||g===9||g===3||g===6)&&(g=at.current,g!==null&&g.tag===13&&(g.flags|=16384))),hm(s,a)):af(s)}function af(a){var s=a;do{if((s.flags&32768)!==0){hm(s,ys);return}a=s.return;var c=Wp(s.alternate,s,al);if(c!==null){ti=c;return}if(s=s.sibling,s!==null){ti=s;return}ti=s=a}while(s!==null);Tn===0&&(Tn=5)}function hm(a,s){do{var c=Zm(a.alternate,a);if(c!==null){c.flags&=32767,ti=c;return}if(c=a.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!s&&(a=a.sibling,a!==null)){ti=a;return}ti=a=c}while(a!==null);Tn=6,ti=null}function dm(a,s,c,g,w,M,L,Z,le){a.cancelPendingCommit=null;do rf();while(Hn!==0);if((Pi&6)!==0)throw Error(Se(327));if(s!==null){if(s===a.current)throw Error(Se(177));if(M=s.lanes|s.childLanes,M|=jo,nn(a,c,M,L,Z,le),a===Hi&&(ti=Hi=null,ii=0),Uc=s,ol=a,vs=c,tp=M,Kd=w,sm=g,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,ym(j,function(){return _m(),null})):(a.callbackNode=null,a.callbackPriority=0),g=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||g){g=Oe.T,Oe.T=null,w=Ke.p,Ke.p=2,L=Pi,Pi|=4;try{Hm(a,s,c)}finally{Pi=L,Ke.p=w,Oe.T=g}}Hn=1,fm(),pm(),mm()}}function fm(){if(Hn===1){Hn=0;var a=ol,s=Uc,c=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||c){c=Oe.T,Oe.T=null;var g=Ke.p;Ke.p=2;var w=Pi;Pi|=4;try{Yd(s,a);var M=_p,L=pc(a.containerInfo),Z=M.focusedElem,le=M.selectionRange;if(L!==Z&&Z&&Z.ownerDocument&&fc(Z.ownerDocument.documentElement,Z)){if(le!==null&&Su(Z)){var Ce=le.start,Fe=le.end;if(Fe===void 0&&(Fe=Ce),"selectionStart"in Z)Z.selectionStart=Ce,Z.selectionEnd=Math.min(Fe,Z.value.length);else{var Ze=Z.ownerDocument||document,ze=Ze&&Ze.defaultView||window;if(ze.getSelection){var Ie=ze.getSelection(),dt=Z.textContent.length,Ct=Math.min(le.start,dt),Oi=le.end===void 0?Ct:Math.min(le.end,dt);!Ie.extend&&Ct>Oi&&(L=Oi,Oi=Ct,Ct=L);var pe=Tu(Z,Ct),he=Tu(Z,Oi);if(pe&&he&&(Ie.rangeCount!==1||Ie.anchorNode!==pe.node||Ie.anchorOffset!==pe.offset||Ie.focusNode!==he.node||Ie.focusOffset!==he.offset)){var Ae=Ze.createRange();Ae.setStart(pe.node,pe.offset),Ie.removeAllRanges(),Ct>Oi?(Ie.addRange(Ae),Ie.extend(he.node,he.offset)):(Ae.setEnd(he.node,he.offset),Ie.addRange(Ae))}}}}for(Ze=[],Ie=Z;Ie=Ie.parentNode;)Ie.nodeType===1&&Ze.push({element:Ie,left:Ie.scrollLeft,top:Ie.scrollTop});for(typeof Z.focus=="function"&&Z.focus(),Z=0;Z<Ze.length;Z++){var Ve=Ze[Z];Ve.element.scrollLeft=Ve.left,Ve.element.scrollTop=Ve.top}}ad=!!Yh,_p=Yh=null}finally{Pi=w,Ke.p=g,Oe.T=c}}a.current=s,Hn=2}}function pm(){if(Hn===2){Hn=0;var a=ol,s=Uc,c=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||c){c=Oe.T,Oe.T=null;var g=Ke.p;Ke.p=2;var w=Pi;Pi|=4;try{$f(a,s.alternate,s)}finally{Pi=w,Ke.p=g,Oe.T=c}}Hn=3}}function mm(){if(Hn===4||Hn===3){Hn=0,_l();var a=ol,s=Uc,c=vs,g=sm;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?Hn=5:(Hn=0,Uc=ol=null,gm(a,a.pendingLanes));var w=a.pendingLanes;if(w===0&&(sl=null),He(c),s=s.stateNode,ue&&typeof ue.onCommitFiberRoot=="function")try{ue.onCommitFiberRoot(fe,s,void 0,(s.current.flags&128)===128)}catch{}if(g!==null){s=Oe.T,w=Ke.p,Ke.p=2,Oe.T=null;try{for(var M=a.onRecoverableError,L=0;L<g.length;L++){var Z=g[L];M(Z.value,{componentStack:Z.stack})}}finally{Oe.T=s,Ke.p=w}}(vs&3)!==0&&rf(),Gs(a),w=a.pendingLanes,(c&261930)!==0&&(w&42)!==0?a===ip?Vh++:(Vh=0,ip=a):Vh=0,Ur(0)}}function gm(a,s){(a.pooledCacheLanes&=s)===0&&(s=a.pooledCache,s!=null&&(a.pooledCache=null,Ol(s)))}function rf(){return fm(),pm(),mm(),_m()}function _m(){if(Hn!==5)return!1;var a=ol,s=tp;tp=0;var c=He(vs),g=Oe.T,w=Ke.p;try{Ke.p=32>c?32:c,Oe.T=null,c=Kd,Kd=null;var M=ol,L=vs;if(Hn=0,Uc=ol=null,vs=0,(Pi&6)!==0)throw Error(Se(331));var Z=Pi;if(Pi|=4,nm(M.current),Qf(M,M.current,L,c),Pi=Z,Ur(0,!1),ue&&typeof ue.onPostCommitFiberRoot=="function")try{ue.onPostCommitFiberRoot(fe,M)}catch{}return!0}finally{Ke.p=w,Oe.T=g,gm(a,s)}}function rp(a,s,c){s=Ta(c,s),s=Zu(a.stateNode,s,2),a=Ls(a,s,2),a!==null&&(vi(a,2),Gs(a))}function Ii(a,s,c){if(a.tag===3)rp(a,a,c);else for(;s!==null;){if(s.tag===3){rp(s,a,c);break}else if(s.tag===1){var g=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(sl===null||!sl.has(g))){a=Ta(c,a),c=Hu(2),g=Ls(s,c,2),g!==null&&(Xu(c,g,s,a),vi(g,2),Gs(g));break}}s=s.return}}function sf(a,s,c){var g=a.pingCache;if(g===null){g=a.pingCache=new am;var w=new Set;g.set(s,w)}else w=g.get(s),w===void 0&&(w=new Set,g.set(s,w));w.has(c)||(Kf=!0,w.add(c),a=Yl.bind(null,a,s,c),s.then(a,a))}function Yl(a,s,c){var g=a.pingCache;g!==null&&g.delete(s),a.pingedLanes|=a.suspendedLanes&c,a.warmLanes&=~c,Hi===a&&(ii&c)===c&&(Tn===4||Tn===3&&(ii&62914560)===ii&&300>Fn()-Qd?(Pi&2)===0&&qc(a,0):Jf|=c,Ku===ii&&(Ku=0)),Gs(a)}function qh(a,s){s===0&&(s=mi()),a=dr(a,s),a!==null&&(vi(a,s),Gs(a))}function sp(a){var s=a.memoizedState,c=0;s!==null&&(c=s.retryLane),qh(a,c)}function $m(a,s){var c=0;switch(a.tag){case 31:case 13:var g=a.stateNode,w=a.memoizedState;w!==null&&(c=w.retryLane);break;case 19:g=a.stateNode;break;case 22:g=a.stateNode._retryCache;break;default:throw Error(Se(314))}g!==null&&g.delete(s),qh(a,c)}function ym(a,s){return $s(a,s)}var of=null,Xc=null,op=!1,lf=!1,lp=!1,ll=0;function Gs(a){a!==Xc&&a.next===null&&(Xc===null?of=Xc=a:Xc=Xc.next=a),lf=!0,op||(op=!0,cp())}function Ur(a,s){if(!lp&&lf){lp=!0;do for(var c=!1,g=of;g!==null;){if(a!==0){var w=g.pendingLanes;if(w===0)var M=0;else{var L=g.suspendedLanes,Z=g.pingedLanes;M=(1<<31-Be(42|a)+1)-1,M&=w&~(L&~Z),M=M&201326741?M&201326741|1:M?M|2:0}M!==0&&(c=!0,Zh(g,M))}else M=ii,M=pi(g,g===Hi?M:0,g.cancelPendingCommit!==null||g.timeoutHandle!==-1),(M&3)===0||yn(g,M)||(c=!0,Zh(g,M));g=g.next}while(c);lp=!1}}function $l(){up()}function up(){lf=op=!1;var a=0;ll!==0&&yf()&&(a=ll);for(var s=Fn(),c=null,g=of;g!==null;){var w=g.next,M=uf(g,s);M===0?(g.next=null,c===null?of=w:c.next=w,w===null&&(Xc=c)):(c=g,(a!==0||(M&3)!==0)&&(lf=!0)),g=w}Hn!==0&&Hn!==5||Ur(a),ll!==0&&(ll=0)}function uf(a,s){for(var c=a.suspendedLanes,g=a.pingedLanes,w=a.expirationTimes,M=a.pendingLanes&-62914561;0<M;){var L=31-Be(M),Z=1<<L,le=w[L];le===-1?((Z&c)===0||(Z&g)!==0)&&(w[L]=Dt(Z,s)):le<=s&&(a.expiredLanes|=Z),M&=~Z}if(s=Hi,c=ii,c=pi(a,a===s?c:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),g=a.callbackNode,c===0||a===s&&(ki===2||ki===9)||a.cancelPendingCommit!==null)return g!==null&&g!==null&&Hr(g),a.callbackNode=null,a.callbackPriority=0;if((c&3)===0||yn(a,c)){if(s=c&-c,s===a.callbackPriority)return s;switch(g!==null&&Hr(g),He(c)){case 2:case 8:c=V;break;case 32:c=j;break;case 268435456:c=re;break;default:c=j}return g=vm.bind(null,a),c=$s(c,g),a.callbackPriority=s,a.callbackNode=c,s}return g!==null&&g!==null&&Hr(g),a.callbackPriority=2,a.callbackNode=null,2}function vm(a,s){if(Hn!==0&&Hn!==5)return a.callbackNode=null,a.callbackPriority=0,null;var c=a.callbackNode;if(rf()&&a.callbackNode!==c)return null;var g=ii;return g=pi(a,a===Hi?g:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),g===0?null:(kn(a,g,s),uf(a,Fn()),a.callbackNode!=null&&a.callbackNode===c?vm.bind(null,a):null)}function Zh(a,s){if(rf())return null;kn(a,s,!0)}function cp(){bp(function(){(Pi&6)!==0?$s(me,$l):up()})}function hp(){if(ll===0){var a=qo;a===0&&(a=Et,Et<<=1,(Et&261888)===0&&(Et=256)),ll=a}return ll}function cf(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Ft(""+a)}function hf(a,s){var c=s.ownerDocument.createElement("input");return c.name=s.name,c.value=s.value,a.id&&c.setAttribute("form",a.id),s.parentNode.insertBefore(c,s),a=new FormData(a),c.parentNode.removeChild(c),a}function Yc(a,s,c,g,w){if(s==="submit"&&c&&c.stateNode===w){var M=cf((w[$e]||null).action),L=g.submitter;L&&(s=(s=L[$e]||null)?cf(s.formAction):L.getAttribute("formAction"),s!==null&&(M=s,L=null));var Z=new du("action","action",null,g,w);a.push({event:Z,listeners:[{instance:null,listener:function(){if(g.defaultPrevented){if(ll!==0){var le=L?hf(w,L):new FormData(w);ln(c,{pending:!0,data:le,method:w.method,action:M},null,le)}}else typeof M=="function"&&(Z.preventDefault(),le=L?hf(w,L):new FormData(w),ln(c,{pending:!0,data:le,method:w.method,action:M},M,le))},currentTarget:w}]})}}for(var df=0;df<yc.length;df++){var ff=yc[df],dp=ff.toLowerCase(),xm=ff[0].toUpperCase()+ff.slice(1);Xa(dp,"on"+xm)}Xa(Eu,"onAnimationEnd"),Xa(Cu,"onAnimationIteration"),Xa(_c,"onAnimationStart"),Xa("dblclick","onDoubleClick"),Xa("focusin","onFocus"),Xa("focusout","onBlur"),Xa(No,"onTransitionRun"),Xa(zu,"onTransitionStart"),Xa(Il,"onTransitionCancel"),Xa(Ha,"onTransitionEnd"),Ms("onMouseEnter",["mouseout","mouseover"]),Ms("onMouseLeave",["mouseout","mouseover"]),Ms("onPointerEnter",["pointerout","pointerover"]),Ms("onPointerLeave",["pointerout","pointerover"]),Kt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Kt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Kt("onBeforeInput",["compositionend","keypress","textInput","paste"]),Kt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Kt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Kt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Wl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),bm=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Wl));function wm(a,s){s=(s&4)!==0;for(var c=0;c<a.length;c++){var g=a[c],w=g.event;g=g.listeners;e:{var M=void 0;if(s)for(var L=g.length-1;0<=L;L--){var Z=g[L],le=Z.instance,Ce=Z.currentTarget;if(Z=Z.listener,le!==M&&w.isPropagationStopped())break e;M=Z,w.currentTarget=Ce;try{M(w)}catch(Fe){ts(Fe)}w.currentTarget=null,M=le}else for(L=0;L<g.length;L++){if(Z=g[L],le=Z.instance,Ce=Z.currentTarget,Z=Z.listener,le!==M&&w.isPropagationStopped())break e;M=Z,w.currentTarget=Ce;try{M(w)}catch(Fe){ts(Fe)}w.currentTarget=null,M=le}}}}function ni(a,s){var c=s[Nt];c===void 0&&(c=s[Nt]=new Set);var g=a+"__bubble";c.has(g)||(mf(s,a,2,!1),c.add(g))}function fp(a,s,c){var g=0;s&&(g|=4),mf(c,a,g,s)}var pf="_reactListening"+Math.random().toString(36).slice(2);function pp(a){if(!a[pf]){a[pf]=!0,vl.forEach(function(c){c!=="selectionchange"&&(bm.has(c)||fp(c,!1,a),fp(c,!0,a))});var s=a.nodeType===9?a:a.ownerDocument;s===null||s[pf]||(s[pf]=!0,fp("selectionchange",!1,s))}}function mf(a,s,c,g){switch(ic(s)){case 2:var w=rd;break;case 8:w=km;break;default:w=Lp}c=w.bind(null,s,c,a),w=void 0,!ya||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(w=!0),g?w!==void 0?a.addEventListener(s,c,{capture:!0,passive:w}):a.addEventListener(s,c,!0):w!==void 0?a.addEventListener(s,c,{passive:w}):a.addEventListener(s,c,!1)}function To(a,s,c,g,w){var M=g;if((s&1)===0&&(s&2)===0&&g!==null)e:for(;;){if(g===null)return;var L=g.tag;if(L===3||L===4){var Z=g.stateNode.containerInfo;if(Z===w)break;if(L===4)for(L=g.return;L!==null;){var le=L.tag;if((le===3||le===4)&&L.stateNode.containerInfo===w)return;L=L.return}for(;Z!==null;){if(L=Yr(Z),L===null)return;if(le=L.tag,le===5||le===6||le===26||le===27){g=M=L;continue e}Z=Z.parentNode}}g=g.return}Ei(function(){var Ce=M,Fe=hu(c),Ze=[];e:{var ze=ph.get(a);if(ze!==void 0){var Ie=du,dt=a;switch(a){case"keypress":if(Za(c)===0)break e;case"keydown":case"keyup":Ie=sn;break;case"focusin":dt="focus",Ie=to;break;case"focusout":dt="blur",Ie=to;break;case"beforeblur":case"afterblur":Ie=to;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ie=Lo;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ie=fu;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ie=Of;break;case Eu:case Cu:case _c:Ie=yd;break;case Ha:Ie=uc;break;case"scroll":case"scrollend":Ie=Ro;break;case"wheel":Ie=uh;break;case"copy":case"cut":case"paste":Ie=oh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ie=lc;break;case"toggle":case"beforetoggle":Ie=Al}var Ct=(s&4)!==0,Oi=!Ct&&(a==="scroll"||a==="scrollend"),pe=Ct?ze!==null?ze+"Capture":null:ze;Ct=[];for(var he=Ce,Ae;he!==null;){var Ve=he;if(Ae=Ve.stateNode,Ve=Ve.tag,Ve!==5&&Ve!==26&&Ve!==27||Ae===null||pe===null||(Ve=lr(he,pe),Ve!=null&&Ct.push($c(he,Ve,Ae))),Oi)break;he=he.return}0<Ct.length&&(ze=new Ie(ze,dt,null,c,Fe),Ze.push({event:ze,listeners:Ct}))}}if((s&7)===0){e:{if(ze=a==="mouseover"||a==="pointerover",Ie=a==="mouseout"||a==="pointerout",ze&&c!==sh&&(dt=c.relatedTarget||c.fromElement)&&(Yr(dt)||dt[Rt]))break e;if((Ie||ze)&&(ze=Fe.window===Fe?Fe:(ze=Fe.ownerDocument)?ze.defaultView||ze.parentWindow:window,Ie?(dt=c.relatedTarget||c.toElement,Ie=Ce,dt=dt?Yr(dt):null,dt!==null&&(Oi=mt(dt),Ct=dt.tag,dt!==Oi||Ct!==5&&Ct!==27&&Ct!==6)&&(dt=null)):(Ie=null,dt=Ce),Ie!==dt)){if(Ct=Lo,Ve="onMouseLeave",pe="onMouseEnter",he="mouse",(a==="pointerout"||a==="pointerover")&&(Ct=lc,Ve="onPointerLeave",pe="onPointerEnter",he="pointer"),Oi=Ie==null?ze:$r(Ie),Ae=dt==null?ze:$r(dt),ze=new Ct(Ve,he+"leave",Ie,c,Fe),ze.target=Oi,ze.relatedTarget=Ae,Ve=null,Yr(Fe)===Ce&&(Ct=new Ct(pe,he+"enter",dt,c,Fe),Ct.target=Ae,Ct.relatedTarget=Oi,Ve=Ct),Oi=Ve,Ie&&dt)t:{for(Ct=Tm,pe=Ie,he=dt,Ae=0,Ve=pe;Ve;Ve=Ct(Ve))Ae++;Ve=0;for(var Mt=he;Mt;Mt=Ct(Mt))Ve++;for(;0<Ae-Ve;)pe=Ct(pe),Ae--;for(;0<Ve-Ae;)he=Ct(he),Ve--;for(;Ae--;){if(pe===he||he!==null&&pe===he.alternate){Ct=pe;break t}pe=Ct(pe),he=Ct(he)}Ct=null}else Ct=null;Ie!==null&&mp(Ze,ze,Ie,Ct,!1),dt!==null&&Oi!==null&&mp(Ze,Oi,dt,Ct,!0)}}e:{if(ze=Ce?$r(Ce):window,Ie=ze.nodeName&&ze.nodeName.toLowerCase(),Ie==="select"||Ie==="input"&&ze.type==="file")var Ti=ao;else if(hc(ze))if(ch)Ti=Cd;else{Ti=Ed;var ft=Ff}else Ie=ze.nodeName,!Ie||Ie.toLowerCase()!=="input"||ze.type!=="checkbox"&&ze.type!=="radio"?Ce&&Do(Ce.elementType)&&(Ti=ao):Ti=wu;if(Ti&&(Ti=Ti(a,Ce))){dc(Ze,Ti,c,Fe);break e}ft&&ft(a,ze,Ce),a==="focusout"&&Ce&&ze.type==="number"&&Ce.memoizedProps.value!=null&&cu(ze,"number",ze.value)}switch(ft=Ce?$r(Ce):window,a){case"focusin":(hc(ft)||ft.contentEditable==="true")&&(hr=ft,Mu=Ce,Au=null);break;case"focusout":Au=Mu=hr=null;break;case"mousedown":gc=!0;break;case"contextmenu":case"mouseup":case"dragend":gc=!1,zd(Ze,c,Fe);break;case"selectionchange":if(mc)break;case"keydown":case"keyup":zd(Ze,c,Fe)}var vt;if(fn)e:{switch(a){case"compositionstart":var ei="onCompositionStart";break e;case"compositionend":ei="onCompositionEnd";break e;case"compositionupdate":ei="onCompositionUpdate";break e}ei=void 0}else Pr?yu(a,c)&&(ei="onCompositionEnd"):a==="keydown"&&c.keyCode===229&&(ei="onCompositionStart");ei&&(Dl&&c.locale!=="ko"&&(Pr||ei!=="onCompositionStart"?ei==="onCompositionEnd"&&Pr&&(vt=Js()):(qa=Fe,Kr="value"in qa?qa.value:qa.textContent,Pr=!0)),ft=Hh(Ce,ei),0<ft.length&&(ei=new lh(ei,a,null,c,Fe),Ze.push({event:ei,listeners:ft}),vt?ei.data=vt:(vt=wd(c),vt!==null&&(ei.data=vt)))),(vt=zl?cc(a,c):Td(a,c))&&(ei=Hh(Ce,"onBeforeInput"),0<ei.length&&(ft=new lh("onBeforeInput","beforeinput",null,c,Fe),Ze.push({event:ft,listeners:ei}),ft.data=vt)),Yc(Ze,a,Ce,c,Fe)}wm(Ze,s)})}function $c(a,s,c){return{instance:a,listener:s,currentTarget:c}}function Hh(a,s){for(var c=s+"Capture",g=[];a!==null;){var w=a,M=w.stateNode;if(w=w.tag,w!==5&&w!==26&&w!==27||M===null||(w=lr(a,c),w!=null&&g.unshift($c(a,w,M)),w=lr(a,s),w!=null&&g.push($c(a,w,M))),a.tag===3)return g;a=a.return}return[]}function Tm(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function mp(a,s,c,g,w){for(var M=s._reactName,L=[];c!==null&&c!==g;){var Z=c,le=Z.alternate,Ce=Z.stateNode;if(Z=Z.tag,le!==null&&le===g)break;Z!==5&&Z!==26&&Z!==27||Ce===null||(le=Ce,w?(Ce=lr(c,M),Ce!=null&&L.unshift($c(c,Ce,le))):w||(Ce=lr(c,M),Ce!=null&&L.push($c(c,Ce,le)))),c=c.return}L.length!==0&&a.push({event:s,listeners:L})}var Sm=/\r\n?/g,Mm=/\u0000|\uFFFD/g;function Xh(a){return(typeof a=="string"?a:""+a).replace(Sm,`
`).replace(Mm,"")}function gp(a,s){return s=Xh(s),Xh(a)===s}function wi(a,s,c,g,w,M){switch(c){case"children":typeof g=="string"?s==="body"||s==="textarea"&&g===""||As(a,g):(typeof g=="number"||typeof g=="bigint")&&s!=="body"&&As(a,""+g);break;case"className":Qr(a,"class",g);break;case"tabIndex":Qr(a,"tabindex",g);break;case"dir":case"role":case"viewBox":case"width":case"height":Qr(a,c,g);break;case"style":oc(a,g,M);break;case"data":if(s!=="object"){Qr(a,"data",g);break}case"src":case"href":if(g===""&&(s!=="a"||c!=="href")){a.removeAttribute(c);break}if(g==null||typeof g=="function"||typeof g=="symbol"||typeof g=="boolean"){a.removeAttribute(c);break}g=Ft(""+g),a.setAttribute(c,g);break;case"action":case"formAction":if(typeof g=="function"){a.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof M=="function"&&(c==="formAction"?(s!=="input"&&wi(a,s,"name",w.name,w,null),wi(a,s,"formEncType",w.formEncType,w,null),wi(a,s,"formMethod",w.formMethod,w,null),wi(a,s,"formTarget",w.formTarget,w,null)):(wi(a,s,"encType",w.encType,w,null),wi(a,s,"method",w.method,w,null),wi(a,s,"target",w.target,w,null)));if(g==null||typeof g=="symbol"||typeof g=="boolean"){a.removeAttribute(c);break}g=Ft(""+g),a.setAttribute(c,g);break;case"onClick":g!=null&&(a.onclick=Dr);break;case"onScroll":g!=null&&ni("scroll",a);break;case"onScrollEnd":g!=null&&ni("scrollend",a);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(Se(61));if(c=g.__html,c!=null){if(w.children!=null)throw Error(Se(60));a.innerHTML=c}}break;case"multiple":a.multiple=g&&typeof g!="function"&&typeof g!="symbol";break;case"muted":a.muted=g&&typeof g!="function"&&typeof g!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(g==null||typeof g=="function"||typeof g=="boolean"||typeof g=="symbol"){a.removeAttribute("xlink:href");break}c=Ft(""+g),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":g!=null&&typeof g!="function"&&typeof g!="symbol"?a.setAttribute(c,""+g):a.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":g&&typeof g!="function"&&typeof g!="symbol"?a.setAttribute(c,""):a.removeAttribute(c);break;case"capture":case"download":g===!0?a.setAttribute(c,""):g!==!1&&g!=null&&typeof g!="function"&&typeof g!="symbol"?a.setAttribute(c,g):a.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":g!=null&&typeof g!="function"&&typeof g!="symbol"&&!isNaN(g)&&1<=g?a.setAttribute(c,g):a.removeAttribute(c);break;case"rowSpan":case"start":g==null||typeof g=="function"||typeof g=="symbol"||isNaN(g)?a.removeAttribute(c):a.setAttribute(c,g);break;case"popover":ni("beforetoggle",a),ni("toggle",a),ou(a,"popover",g);break;case"xlinkActuate":or(a,"http://www.w3.org/1999/xlink","xlink:actuate",g);break;case"xlinkArcrole":or(a,"http://www.w3.org/1999/xlink","xlink:arcrole",g);break;case"xlinkRole":or(a,"http://www.w3.org/1999/xlink","xlink:role",g);break;case"xlinkShow":or(a,"http://www.w3.org/1999/xlink","xlink:show",g);break;case"xlinkTitle":or(a,"http://www.w3.org/1999/xlink","xlink:title",g);break;case"xlinkType":or(a,"http://www.w3.org/1999/xlink","xlink:type",g);break;case"xmlBase":or(a,"http://www.w3.org/XML/1998/namespace","xml:base",g);break;case"xmlLang":or(a,"http://www.w3.org/XML/1998/namespace","xml:lang",g);break;case"xmlSpace":or(a,"http://www.w3.org/XML/1998/namespace","xml:space",g);break;case"is":ou(a,"is",g);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=Ks.get(c)||c,ou(a,c,g))}}function gf(a,s,c,g,w,M){switch(c){case"style":oc(a,g,M);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(Se(61));if(c=g.__html,c!=null){if(w.children!=null)throw Error(Se(60));a.innerHTML=c}}break;case"children":typeof g=="string"?As(a,g):(typeof g=="number"||typeof g=="bigint")&&As(a,""+g);break;case"onScroll":g!=null&&ni("scroll",a);break;case"onScrollEnd":g!=null&&ni("scrollend",a);break;case"onClick":g!=null&&(a.onclick=Dr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!la.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(w=c.endsWith("Capture"),s=c.slice(2,w?c.length-7:void 0),M=a[$e]||null,M=M!=null?M[c]:null,typeof M=="function"&&a.removeEventListener(s,M,w),typeof g=="function")){typeof M!="function"&&M!==null&&(c in a?a[c]=null:a.hasAttribute(c)&&a.removeAttribute(c)),a.addEventListener(s,g,w);break e}c in a?a[c]=g:g===!0?a.setAttribute(c,""):ou(a,c,g)}}}function na(a,s,c){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ni("error",a),ni("load",a);var g=!1,w=!1,M;for(M in c)if(c.hasOwnProperty(M)){var L=c[M];if(L!=null)switch(M){case"src":g=!0;break;case"srcSet":w=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(Se(137,s));default:wi(a,s,M,L,c,null)}}w&&wi(a,s,"srcSet",c.srcSet,c,null),g&&wi(a,s,"src",c.src,c,null);return;case"input":ni("invalid",a);var Z=M=L=w=null,le=null,Ce=null;for(g in c)if(c.hasOwnProperty(g)){var Fe=c[g];if(Fe!=null)switch(g){case"name":w=Fe;break;case"type":L=Fe;break;case"checked":le=Fe;break;case"defaultChecked":Ce=Fe;break;case"value":M=Fe;break;case"defaultValue":Z=Fe;break;case"children":case"dangerouslySetInnerHTML":if(Fe!=null)throw Error(Se(137,s));break;default:wi(a,s,g,Fe,c,null)}}sc(a,M,Z,le,Ce,L,w,!1);return;case"select":ni("invalid",a),g=L=M=null;for(w in c)if(c.hasOwnProperty(w)&&(Z=c[w],Z!=null))switch(w){case"value":M=Z;break;case"defaultValue":L=Z;break;case"multiple":g=Z;default:wi(a,s,w,Z,c,null)}s=M,c=L,a.multiple=!!g,s!=null?Qs(a,!!g,s,!1):c!=null&&Qs(a,!!g,c,!0);return;case"textarea":ni("invalid",a),M=w=g=null;for(L in c)if(c.hasOwnProperty(L)&&(Z=c[L],Z!=null))switch(L){case"value":g=Z;break;case"defaultValue":w=Z;break;case"children":M=Z;break;case"dangerouslySetInnerHTML":if(Z!=null)throw Error(Se(91));break;default:wi(a,s,L,Z,c,null)}wl(a,g,w,M);return;case"option":for(le in c)c.hasOwnProperty(le)&&(g=c[le],g!=null)&&(le==="selected"?a.selected=g&&typeof g!="function"&&typeof g!="symbol":wi(a,s,le,g,c,null));return;case"dialog":ni("beforetoggle",a),ni("toggle",a),ni("cancel",a),ni("close",a);break;case"iframe":case"object":ni("load",a);break;case"video":case"audio":for(g=0;g<Wl.length;g++)ni(Wl[g],a);break;case"image":ni("error",a),ni("load",a);break;case"details":ni("toggle",a);break;case"embed":case"source":case"link":ni("error",a),ni("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ce in c)if(c.hasOwnProperty(Ce)&&(g=c[Ce],g!=null))switch(Ce){case"children":case"dangerouslySetInnerHTML":throw Error(Se(137,s));default:wi(a,s,Ce,g,c,null)}return;default:if(Do(s)){for(Fe in c)c.hasOwnProperty(Fe)&&(g=c[Fe],g!==void 0&&gf(a,s,Fe,g,c,void 0));return}}for(Z in c)c.hasOwnProperty(Z)&&(g=c[Z],g!=null&&wi(a,s,Z,g,c,null))}function Am(a,s,c,g){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var w=null,M=null,L=null,Z=null,le=null,Ce=null,Fe=null;for(Ie in c){var Ze=c[Ie];if(c.hasOwnProperty(Ie)&&Ze!=null)switch(Ie){case"checked":break;case"value":break;case"defaultValue":le=Ze;default:g.hasOwnProperty(Ie)||wi(a,s,Ie,null,g,Ze)}}for(var ze in g){var Ie=g[ze];if(Ze=c[ze],g.hasOwnProperty(ze)&&(Ie!=null||Ze!=null))switch(ze){case"type":M=Ie;break;case"name":w=Ie;break;case"checked":Ce=Ie;break;case"defaultChecked":Fe=Ie;break;case"value":L=Ie;break;case"defaultValue":Z=Ie;break;case"children":case"dangerouslySetInnerHTML":if(Ie!=null)throw Error(Se(137,s));break;default:Ie!==Ze&&wi(a,s,ze,Ie,g,Ze)}}uu(a,L,Z,le,Ce,Fe,M,w);return;case"select":Ie=L=Z=ze=null;for(M in c)if(le=c[M],c.hasOwnProperty(M)&&le!=null)switch(M){case"value":break;case"multiple":Ie=le;default:g.hasOwnProperty(M)||wi(a,s,M,null,g,le)}for(w in g)if(M=g[w],le=c[w],g.hasOwnProperty(w)&&(M!=null||le!=null))switch(w){case"value":ze=M;break;case"defaultValue":Z=M;break;case"multiple":L=M;default:M!==le&&wi(a,s,w,M,g,le)}s=Z,c=L,g=Ie,ze!=null?Qs(a,!!c,ze,!1):!!g!=!!c&&(s!=null?Qs(a,!!c,s,!0):Qs(a,!!c,c?[]:"",!1));return;case"textarea":Ie=ze=null;for(Z in c)if(w=c[Z],c.hasOwnProperty(Z)&&w!=null&&!g.hasOwnProperty(Z))switch(Z){case"value":break;case"children":break;default:wi(a,s,Z,null,g,w)}for(L in g)if(w=g[L],M=c[L],g.hasOwnProperty(L)&&(w!=null||M!=null))switch(L){case"value":ze=w;break;case"defaultValue":Ie=w;break;case"children":break;case"dangerouslySetInnerHTML":if(w!=null)throw Error(Se(91));break;default:w!==M&&wi(a,s,L,w,g,M)}gd(a,ze,Ie);return;case"option":for(var dt in c)ze=c[dt],c.hasOwnProperty(dt)&&ze!=null&&!g.hasOwnProperty(dt)&&(dt==="selected"?a.selected=!1:wi(a,s,dt,null,g,ze));for(le in g)ze=g[le],Ie=c[le],g.hasOwnProperty(le)&&ze!==Ie&&(ze!=null||Ie!=null)&&(le==="selected"?a.selected=ze&&typeof ze!="function"&&typeof ze!="symbol":wi(a,s,le,ze,g,Ie));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ct in c)ze=c[Ct],c.hasOwnProperty(Ct)&&ze!=null&&!g.hasOwnProperty(Ct)&&wi(a,s,Ct,null,g,ze);for(Ce in g)if(ze=g[Ce],Ie=c[Ce],g.hasOwnProperty(Ce)&&ze!==Ie&&(ze!=null||Ie!=null))switch(Ce){case"children":case"dangerouslySetInnerHTML":if(ze!=null)throw Error(Se(137,s));break;default:wi(a,s,Ce,ze,g,Ie)}return;default:if(Do(s)){for(var Oi in c)ze=c[Oi],c.hasOwnProperty(Oi)&&ze!==void 0&&!g.hasOwnProperty(Oi)&&gf(a,s,Oi,void 0,g,ze);for(Fe in g)ze=g[Fe],Ie=c[Fe],!g.hasOwnProperty(Fe)||ze===Ie||ze===void 0&&Ie===void 0||gf(a,s,Fe,ze,g,Ie);return}}for(var pe in c)ze=c[pe],c.hasOwnProperty(pe)&&ze!=null&&!g.hasOwnProperty(pe)&&wi(a,s,pe,null,g,ze);for(Ze in g)ze=g[Ze],Ie=c[Ze],!g.hasOwnProperty(Ze)||ze===Ie||ze==null&&Ie==null||wi(a,s,Ze,ze,g,Ie)}function Mr(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Wc(){if(typeof performance.getEntriesByType=="function"){for(var a=0,s=0,c=performance.getEntriesByType("resource"),g=0;g<c.length;g++){var w=c[g],M=w.transferSize,L=w.initiatorType,Z=w.duration;if(M&&Z&&Mr(L)){for(L=0,Z=w.responseEnd,g+=1;g<c.length;g++){var le=c[g],Ce=le.startTime;if(Ce>Z)break;var Fe=le.transferSize,Ze=le.initiatorType;Fe&&Mr(Ze)&&(le=le.responseEnd,L+=Fe*(le<Z?1:(Z-Ce)/(le-Ce)))}if(--g,s+=8*(M+L)/(w.duration/1e3),a++,10<a)break}}if(0<a)return s/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var Yh=null,_p=null;function $h(a){return a.nodeType===9?a:a.ownerDocument}function Ql(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function yp(a,s){if(a===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&s==="foreignObject"?0:a}function _f(a,s){return a==="textarea"||a==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var Kl=null;function yf(){var a=window.event;return a&&a.type==="popstate"?a===Kl?!1:(Kl=a,!0):(Kl=null,!1)}var vf=typeof setTimeout=="function"?setTimeout:void 0,vp=typeof clearTimeout=="function"?clearTimeout:void 0,xp=typeof Promise=="function"?Promise:void 0,bp=typeof queueMicrotask=="function"?queueMicrotask:typeof xp<"u"?function(a){return xp.resolve(null).then(a).catch(wp)}:vf;function wp(a){setTimeout(function(){throw a})}function Jl(a){return a==="head"}function Em(a,s){var c=s,g=0;do{var w=c.nextSibling;if(a.removeChild(c),w&&w.nodeType===8)if(c=w.data,c==="/$"||c==="/&"){if(g===0){a.removeChild(w),ru(s);return}g--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")g++;else if(c==="html")Qc(a.ownerDocument.documentElement);else if(c==="head"){c=a.ownerDocument.head,Qc(c);for(var M=c.firstChild;M;){var L=M.nextSibling,Z=M.nodeName;M[Pt]||Z==="SCRIPT"||Z==="STYLE"||Z==="LINK"&&M.rel.toLowerCase()==="stylesheet"||c.removeChild(M),M=L}}else c==="body"&&Qc(a.ownerDocument.body);c=w}while(c);ru(s)}function Gt(a,s){var c=a;a=0;do{var g=c.nextSibling;if(c.nodeType===1?s?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(s?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),g&&g.nodeType===8)if(c=g.data,c==="/$"){if(a===0)break;a--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||a++;c=g}while(c)}function qs(a){var s=a.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var c=s;switch(s=s.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":qs(c),Eo(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}a.removeChild(c)}}function ha(a,s,c,g){for(;a.nodeType===1;){var w=c;if(a.nodeName.toLowerCase()!==s.toLowerCase()){if(!g&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(g){if(!a[Pt])switch(s){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(M=a.getAttribute("rel"),M==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(M!==w.rel||a.getAttribute("href")!==(w.href==null||w.href===""?null:w.href)||a.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin)||a.getAttribute("title")!==(w.title==null?null:w.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(M=a.getAttribute("src"),(M!==(w.src==null?null:w.src)||a.getAttribute("type")!==(w.type==null?null:w.type)||a.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin))&&M&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(s==="input"&&a.type==="hidden"){var M=w.name==null?null:""+w.name;if(w.type==="hidden"&&a.getAttribute("name")===M)return a}else return a;if(a=Gr(a.nextSibling),a===null)break}return null}function Zs(a,s,c){if(s==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!c||(a=Gr(a.nextSibling),a===null))return null;return a}function eu(a,s){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!s||(a=Gr(a.nextSibling),a===null))return null;return a}function ka(a){return a.data==="$?"||a.data==="$~"}function Cn(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function Xn(a,s){var c=a.ownerDocument;if(a.data==="$~")a._reactRetry=s;else if(a.data!=="$?"||c.readyState!=="loading")s();else{var g=function(){s(),c.removeEventListener("DOMContentLoaded",g)};c.addEventListener("DOMContentLoaded",g),a._reactRetry=g}}function Gr(a){for(;a!=null;a=a.nextSibling){var s=a.nodeType;if(s===1||s===3)break;if(s===8){if(s=a.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return a}var ar=null;function Yn(a){a=a.nextSibling;for(var s=0;a;){if(a.nodeType===8){var c=a.data;if(c==="/$"||c==="/&"){if(s===0)return Gr(a.nextSibling);s--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||s++}a=a.nextSibling}return null}function Wh(a){a=a.previousSibling;for(var s=0;a;){if(a.nodeType===8){var c=a.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(s===0)return a;s--}else c!=="/$"&&c!=="/&"||s++}a=a.previousSibling}return null}function Cm(a,s,c){switch(s=$h(c),a){case"html":if(a=s.documentElement,!a)throw Error(Se(452));return a;case"head":if(a=s.head,!a)throw Error(Se(453));return a;case"body":if(a=s.body,!a)throw Error(Se(454));return a;default:throw Error(Se(451))}}function Qc(a){for(var s=a.attributes;s.length;)a.removeAttributeNode(s[0]);Eo(a)}var da=new Map,ec=new Set;function xf(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var So=Ke.d;Ke.d={f:zm,r:Dm,D:Sp,C:Oa,L:Hs,m:Fa,X:bf,S:iu,M:Mp};function zm(){var a=So.f(),s=Uh();return a||s}function Dm(a){var s=Ss(a);s!==null&&s.tag===5&&s.type==="form"?Un(s):So.r(a)}var tu=typeof document>"u"?null:document;function Tp(a,s,c){var g=tu;if(g&&typeof s=="string"&&s){var w=_a(s);w='link[rel="'+a+'"][href="'+w+'"]',typeof c=="string"&&(w+='[crossorigin="'+c+'"]'),ec.has(w)||(ec.add(w),a={rel:a,crossOrigin:c,href:s},g.querySelector(w)===null&&(s=g.createElement("link"),na(s,"link",a),an(s),g.head.appendChild(s)))}}function Sp(a){So.D(a),Tp("dns-prefetch",a,null)}function Oa(a,s){So.C(a,s),Tp("preconnect",a,s)}function Hs(a,s,c){So.L(a,s,c);var g=tu;if(g&&a&&s){var w='link[rel="preload"][as="'+_a(s)+'"]';s==="image"&&c&&c.imageSrcSet?(w+='[imagesrcset="'+_a(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(w+='[imagesizes="'+_a(c.imageSizes)+'"]')):w+='[href="'+_a(a)+'"]';var M=w;switch(s){case"style":M=tc(a);break;case"script":M=ul(a)}da.has(M)||(a=ut({rel:"preload",href:s==="image"&&c&&c.imageSrcSet?void 0:a,as:s},c),da.set(M,a),g.querySelector(w)!==null||s==="style"&&g.querySelector(Kc(M))||s==="script"&&g.querySelector(Jc(M))||(s=g.createElement("link"),na(s,"link",a),an(s),g.head.appendChild(s)))}}function Fa(a,s){So.m(a,s);var c=tu;if(c&&a){var g=s&&typeof s.as=="string"?s.as:"script",w='link[rel="modulepreload"][as="'+_a(g)+'"][href="'+_a(a)+'"]',M=w;switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":M=ul(a)}if(!da.has(M)&&(a=ut({rel:"modulepreload",href:a},s),da.set(M,a),c.querySelector(w)===null)){switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(Jc(M)))return}g=c.createElement("link"),na(g,"link",a),an(g),c.head.appendChild(g)}}}function iu(a,s,c){So.S(a,s,c);var g=tu;if(g&&a){var w=Wr(g).hoistableStyles,M=tc(a);s=s||"default";var L=w.get(M);if(!L){var Z={loading:0,preload:null};if(L=g.querySelector(Kc(M)))Z.loading=5;else{a=ut({rel:"stylesheet",href:a,"data-precedence":s},c),(c=da.get(M))&&Qh(a,c);var le=L=g.createElement("link");an(le),na(le,"link",a),le._p=new Promise(function(Ce,Fe){le.onload=Ce,le.onerror=Fe}),le.addEventListener("load",function(){Z.loading|=1}),le.addEventListener("error",function(){Z.loading|=2}),Z.loading|=4,cl(L,s,g)}L={type:"stylesheet",instance:L,count:1,state:Z},w.set(M,L)}}}function bf(a,s){So.X(a,s);var c=tu;if(c&&a){var g=Wr(c).hoistableScripts,w=ul(a),M=g.get(w);M||(M=c.querySelector(Jc(w)),M||(a=ut({src:a,async:!0},s),(s=da.get(w))&&wf(a,s),M=c.createElement("script"),an(M),na(M,"link",a),c.head.appendChild(M)),M={type:"script",instance:M,count:1,state:null},g.set(w,M))}}function Mp(a,s){So.M(a,s);var c=tu;if(c&&a){var g=Wr(c).hoistableScripts,w=ul(a),M=g.get(w);M||(M=c.querySelector(Jc(w)),M||(a=ut({src:a,async:!0,type:"module"},s),(s=da.get(w))&&wf(a,s),M=c.createElement("script"),an(M),na(M,"link",a),c.head.appendChild(M)),M={type:"script",instance:M,count:1,state:null},g.set(w,M))}}function Ap(a,s,c,g){var w=(w=kt.current)?xf(w):null;if(!w)throw Error(Se(446));switch(a){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(s=tc(c.href),c=Wr(w).hoistableStyles,g=c.get(s),g||(g={type:"style",instance:null,count:0,state:null},c.set(s,g)),g):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){a=tc(c.href);var M=Wr(w).hoistableStyles,L=M.get(a);if(L||(w=w.ownerDocument||w,L={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},M.set(a,L),(M=w.querySelector(Kc(a)))&&!M._p&&(L.instance=M,L.state.loading=5),da.has(a)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},da.set(a,c),M||Cp(w,a,c,L.state))),s&&g===null)throw Error(Se(528,""));return L}if(s&&g!==null)throw Error(Se(529,""));return null;case"script":return s=c.async,c=c.src,typeof c=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=ul(c),c=Wr(w).hoistableScripts,g=c.get(s),g||(g={type:"script",instance:null,count:0,state:null},c.set(s,g)),g):{type:"void",instance:null,count:0,state:null};default:throw Error(Se(444,a))}}function tc(a){return'href="'+_a(a)+'"'}function Kc(a){return'link[rel="stylesheet"]['+a+"]"}function Ep(a){return ut({},a,{"data-precedence":a.precedence,precedence:null})}function Cp(a,s,c,g){a.querySelector('link[rel="preload"][as="style"]['+s+"]")?g.loading=1:(s=a.createElement("link"),g.preload=s,s.addEventListener("load",function(){return g.loading|=1}),s.addEventListener("error",function(){return g.loading|=2}),na(s,"link",c),an(s),a.head.appendChild(s))}function ul(a){return'[src="'+_a(a)+'"]'}function Jc(a){return"script[async]"+a}function zp(a,s,c){if(s.count++,s.instance===null)switch(s.type){case"style":var g=a.querySelector('style[data-href~="'+_a(c.href)+'"]');if(g)return s.instance=g,an(g),g;var w=ut({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return g=(a.ownerDocument||a).createElement("style"),an(g),na(g,"style",w),cl(g,c.precedence,a),s.instance=g;case"stylesheet":w=tc(c.href);var M=a.querySelector(Kc(w));if(M)return s.state.loading|=4,s.instance=M,an(M),M;g=Ep(c),(w=da.get(w))&&Qh(g,w),M=(a.ownerDocument||a).createElement("link"),an(M);var L=M;return L._p=new Promise(function(Z,le){L.onload=Z,L.onerror=le}),na(M,"link",g),s.state.loading|=4,cl(M,c.precedence,a),s.instance=M;case"script":return M=ul(c.src),(w=a.querySelector(Jc(M)))?(s.instance=w,an(w),w):(g=c,(w=da.get(M))&&(g=ut({},c),wf(g,w)),a=a.ownerDocument||a,w=a.createElement("script"),an(w),na(w,"link",g),a.head.appendChild(w),s.instance=w);case"void":return null;default:throw Error(Se(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(g=s.instance,s.state.loading|=4,cl(g,c.precedence,a));return s.instance}function cl(a,s,c){for(var g=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),w=g.length?g[g.length-1]:null,M=w,L=0;L<g.length;L++){var Z=g[L];if(Z.dataset.precedence===s)M=Z;else if(M!==w)break}M?M.parentNode.insertBefore(a,M.nextSibling):(s=c.nodeType===9?c.head:c,s.insertBefore(a,s.firstChild))}function Qh(a,s){a.crossOrigin==null&&(a.crossOrigin=s.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=s.referrerPolicy),a.title==null&&(a.title=s.title)}function wf(a,s){a.crossOrigin==null&&(a.crossOrigin=s.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=s.referrerPolicy),a.integrity==null&&(a.integrity=s.integrity)}var Tf=null;function Dp(a,s,c){if(Tf===null){var g=new Map,w=Tf=new Map;w.set(c,g)}else w=Tf,g=w.get(c),g||(g=new Map,w.set(c,g));if(g.has(a))return g;for(g.set(a,null),c=c.getElementsByTagName(a),w=0;w<c.length;w++){var M=c[w];if(!(M[Pt]||M[Ri]||a==="link"&&M.getAttribute("rel")==="stylesheet")&&M.namespaceURI!=="http://www.w3.org/2000/svg"){var L=M.getAttribute(s)||"";L=a+L;var Z=g.get(L);Z?Z.push(M):g.set(L,[M])}}return g}function Kh(a,s,c){a=a.ownerDocument||a,a.head.insertBefore(c,s==="title"?a.querySelector("head > title"):null)}function Sf(a,s,c){if(c===1||s.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;return s.rel==="stylesheet"?(a=s.disabled,typeof s.precedence=="string"&&a==null):!0;case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function Jh(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function Pp(a,s,c,g){if(c.type==="stylesheet"&&(typeof g.media!="string"||matchMedia(g.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var w=tc(g.href),M=s.querySelector(Kc(w));if(M){s=M._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(a.count++,a=td.bind(a),s.then(a,a)),c.state.loading|=4,c.instance=M,an(M);return}M=s.ownerDocument||s,g=Ep(g),(w=da.get(w))&&Qh(g,w),M=M.createElement("link"),an(M);var L=M;L._p=new Promise(function(Z,le){L.onload=Z,L.onerror=le}),na(M,"link",g),c.instance=M}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(c,s),(s=c.state.preload)&&(c.state.loading&3)===0&&(a.count++,c=td.bind(a),s.addEventListener("load",c),s.addEventListener("error",c))}}var ed=0;function Ip(a,s){return a.stylesheets&&a.count===0&&nd(a,a.stylesheets),0<a.count||0<a.imgCount?function(c){var g=setTimeout(function(){if(a.stylesheets&&nd(a,a.stylesheets),a.unsuspend){var M=a.unsuspend;a.unsuspend=null,M()}},6e4+s);0<a.imgBytes&&ed===0&&(ed=62500*Wc());var w=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&nd(a,a.stylesheets),a.unsuspend)){var M=a.unsuspend;a.unsuspend=null,M()}},(a.imgBytes>ed?50:800)+s);return a.unsuspend=c,function(){a.unsuspend=null,clearTimeout(g),clearTimeout(w)}}:null}function td(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)nd(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var id=null;function nd(a,s){a.stylesheets=null,a.unsuspend!==null&&(a.count++,id=new Map,s.forEach(Pm,a),id=null,td.call(a))}function Pm(a,s){if(!(s.state.loading&4)){var c=id.get(a);if(c)var g=c.get(null);else{c=new Map,id.set(a,c);for(var w=a.querySelectorAll("link[data-precedence],style[data-precedence]"),M=0;M<w.length;M++){var L=w[M];(L.nodeName==="LINK"||L.getAttribute("media")!=="not all")&&(c.set(L.dataset.precedence,L),g=L)}g&&c.set(null,g)}w=s.instance,L=w.getAttribute("data-precedence"),M=c.get(L)||g,M===g&&c.set(null,w),c.set(L,w),this.count++,g=td.bind(this),w.addEventListener("load",g),w.addEventListener("error",g),M?M.parentNode.insertBefore(w,M.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(w,a.firstChild)),s.state.loading|=4}}var eh={$$typeof:qt,Provider:null,Consumer:null,_currentValue:St,_currentValue2:St,_threadCount:0};function Wm(a,s,c,g,w,M,L,Z,le){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Pn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Pn(0),this.hiddenUpdates=Pn(null),this.identifierPrefix=g,this.onUncaughtError=w,this.onCaughtError=M,this.onRecoverableError=L,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=le,this.incompleteTransitions=new Map}function Rp(a,s,c,g,w,M,L,Z,le,Ce,Fe,Ze){return a=new Wm(a,s,c,L,le,Ce,Fe,Ze,Z),s=1,M===!0&&(s|=24),M=Ya(3,null,null,s),a.current=M,M.stateNode=a,s=us(),s.refCount++,a.pooledCache=s,s.refCount++,M.memoizedState={element:g,isDehydrated:c,cache:s},Pc(M),a}function Im(a){return a?(a=Ot,a):Ot}function Rm(a,s,c,g,w,M){w=Im(w),g.context===null?g.context=w:g.pendingContext=w,g=ps(s),g.payload={element:c},M=M===void 0?null:M,M!==null&&(g.callback=M),c=Ls(a,g,s),c!==null&&(Sr(c,a,s),mr(c,a,s))}function Mf(a,s){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var c=a.retryLane;a.retryLane=c!==0&&c<s?c:s}}function Af(a,s){Mf(a,s),(a=a.alternate)&&Mf(a,s)}function Lm(a){if(a.tag===13||a.tag===31){var s=dr(a,67108864);s!==null&&Sr(s,a,67108864),Af(a,67108864)}}function Bm(a){if(a.tag===13||a.tag===31){var s=Tr();s=Ao(s);var c=dr(a,s);c!==null&&Sr(c,a,s),Af(a,s)}}var ad=!0;function rd(a,s,c,g){var w=Oe.T;Oe.T=null;var M=Ke.p;try{Ke.p=2,Lp(a,s,c,g)}finally{Ke.p=M,Oe.T=w}}function km(a,s,c,g){var w=Oe.T;Oe.T=null;var M=Ke.p;try{Ke.p=8,Lp(a,s,c,g)}finally{Ke.p=M,Oe.T=w}}function Lp(a,s,c,g){if(ad){var w=sd(g);if(w===null)To(a,s,g,th,c),Om(a,g);else if(Km(w,a,s,c,g))g.stopPropagation();else if(Om(a,g),s&4&&-1<Qm.indexOf(a)){for(;w!==null;){var M=Ss(w);if(M!==null)switch(M.tag){case 3:if(M=M.stateNode,M.current.memoizedState.isDehydrated){var L=ge(M.pendingLanes);if(L!==0){var Z=M;for(Z.pendingLanes|=2,Z.entangledLanes|=2;L;){var le=1<<31-Be(L);Z.entanglements[1]|=le,L&=~le}Gs(M),(Pi&6)===0&&(jh=Fn()+500,Ur(0))}}break;case 31:case 13:Z=dr(M,2),Z!==null&&Sr(Z,M,2),Uh(),Af(M,2)}if(M=sd(g),M===null&&To(a,s,g,th,c),M===w)break;w=M}w!==null&&g.stopPropagation()}else To(a,s,g,null,c)}}function sd(a){return a=hu(a),Ef(a)}var th=null;function Ef(a){if(th=null,a=Yr(a),a!==null){var s=mt(a);if(s===null)a=null;else{var c=s.tag;if(c===13){if(a=O(s),a!==null)return a;a=null}else if(c===31){if(a=f(s),a!==null)return a;a=null}else if(c===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;a=null}else s!==a&&(a=null)}}return th=a,null}function ic(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ea()){case me:return 2;case V:return 8;case j:case H:return 32;case re:return 268435456;default:return 32}default:return 32}}var Cf=!1,nu=null,xs=null,au=null,od=new Map,ih=new Map,hl=[],Qm="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Om(a,s){switch(a){case"focusin":case"focusout":nu=null;break;case"dragenter":case"dragleave":xs=null;break;case"mouseover":case"mouseout":au=null;break;case"pointerover":case"pointerout":od.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":ih.delete(s.pointerId)}}function ld(a,s,c,g,w,M){return a===null||a.nativeEvent!==M?(a={blockedOn:s,domEventName:c,eventSystemFlags:g,nativeEvent:M,targetContainers:[w]},s!==null&&(s=Ss(s),s!==null&&Lm(s)),a):(a.eventSystemFlags|=g,s=a.targetContainers,w!==null&&s.indexOf(w)===-1&&s.push(w),a)}function Km(a,s,c,g,w){switch(s){case"focusin":return nu=ld(nu,a,s,c,g,w),!0;case"dragenter":return xs=ld(xs,a,s,c,g,w),!0;case"mouseover":return au=ld(au,a,s,c,g,w),!0;case"pointerover":var M=w.pointerId;return od.set(M,ld(od.get(M)||null,a,s,c,g,w)),!0;case"gotpointercapture":return M=w.pointerId,ih.set(M,ld(ih.get(M)||null,a,s,c,g,w)),!0}return!1}function Fm(a){var s=Yr(a.target);if(s!==null){var c=mt(s);if(c!==null){if(s=c.tag,s===13){if(s=O(c),s!==null){a.blockedOn=s,oa(a.priority,function(){Bm(c)});return}}else if(s===31){if(s=f(c),s!==null){a.blockedOn=s,oa(a.priority,function(){Bm(c)});return}}else if(s===3&&c.stateNode.current.memoizedState.isDehydrated){a.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}a.blockedOn=null}function ud(a){if(a.blockedOn!==null)return!1;for(var s=a.targetContainers;0<s.length;){var c=sd(a.nativeEvent);if(c===null){c=a.nativeEvent;var g=new c.constructor(c.type,c);sh=g,c.target.dispatchEvent(g),sh=null}else return s=Ss(c),s!==null&&Lm(s),a.blockedOn=c,!1;s.shift()}return!0}function Nm(a,s,c){ud(a)&&c.delete(s)}function cd(){Cf=!1,nu!==null&&ud(nu)&&(nu=null),xs!==null&&ud(xs)&&(xs=null),au!==null&&ud(au)&&(au=null),od.forEach(Nm),ih.forEach(Nm)}function zf(a,s){a.blockedOn===s&&(a.blockedOn=null,Cf||(Cf=!0,et.unstable_scheduleCallback(et.unstable_NormalPriority,cd)))}var Df=null;function jm(a){Df!==a&&(Df=a,et.unstable_scheduleCallback(et.unstable_NormalPriority,function(){Df===a&&(Df=null);for(var s=0;s<a.length;s+=3){var c=a[s],g=a[s+1],w=a[s+2];if(typeof g!="function"){if(Ef(g||c)===null)continue;break}var M=Ss(c);M!==null&&(a.splice(s,3),s-=3,ln(M,{pending:!0,data:w,method:c.method,action:g},g,w))}}))}function ru(a){function s(le){return zf(le,a)}nu!==null&&zf(nu,a),xs!==null&&zf(xs,a),au!==null&&zf(au,a),od.forEach(s),ih.forEach(s);for(var c=0;c<hl.length;c++){var g=hl[c];g.blockedOn===a&&(g.blockedOn=null)}for(;0<hl.length&&(c=hl[0],c.blockedOn===null);)Fm(c),c.blockedOn===null&&hl.shift();if(c=(a.ownerDocument||a).$$reactFormReplay,c!=null)for(g=0;g<c.length;g+=3){var w=c[g],M=c[g+1],L=w[$e]||null;if(typeof M=="function")L||jm(c);else if(L){var Z=null;if(M&&M.hasAttribute("formAction")){if(w=M,L=M[$e]||null)Z=L.formAction;else if(Ef(w)!==null)continue}else Z=L.action;typeof Z=="function"?c[g+1]=Z:(c.splice(g,3),g-=3),jm(c)}}}function Bp(){function a(M){M.canIntercept&&M.info==="react-transition"&&M.intercept({handler:function(){return new Promise(function(L){return w=L})},focusReset:"manual",scroll:"manual"})}function s(){w!==null&&(w(),w=null),g||setTimeout(c,20)}function c(){if(!g&&!navigation.transition){var M=navigation.currentEntry;M&&M.url!=null&&navigation.navigate(M.url,{state:M.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var g=!1,w=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(c,100),function(){g=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),w!==null&&(w(),w=null)}}}function kp(a){this._internalRoot=a}Pf.prototype.render=kp.prototype.render=function(a){var s=this._internalRoot;if(s===null)throw Error(Se(409));var c=s.current,g=Tr();Rm(c,g,a,s,null,null)},Pf.prototype.unmount=kp.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var s=a.containerInfo;Rm(a.current,2,null,a,null,null),Uh(),s[Rt]=null}};function Pf(a){this._internalRoot=a}Pf.prototype.unstable_scheduleHydration=function(a){if(a){var s=sa();a={blockedOn:null,target:a,priority:s};for(var c=0;c<hl.length&&s!==0&&s<hl[c].priority;c++);hl.splice(c,0,a),c===0&&Fm(a)}};var Op=Wt.version;if(Op!=="19.2.3")throw Error(Se(527,Op,"19.2.3"));Ke.findDOMNode=function(a){var s=a._reactInternals;if(s===void 0)throw typeof a.render=="function"?Error(Se(188)):(a=Object.keys(a).join(","),Error(Se(268,a)));return a=qe(s),a=a!==null?xt(a):null,a=a===null?null:a.stateNode,a};var Vm={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:Oe,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var If=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!If.isDisabled&&If.supportsFiber)try{fe=If.inject(Vm),ue=If}catch{}}return Gp.createRoot=function(a,s){if(!yt(a))throw Error(Se(299));var c=!1,g="",w=Bc,M=Ns,L=js;return s!=null&&(s.unstable_strictMode===!0&&(c=!0),s.identifierPrefix!==void 0&&(g=s.identifierPrefix),s.onUncaughtError!==void 0&&(w=s.onUncaughtError),s.onCaughtError!==void 0&&(M=s.onCaughtError),s.onRecoverableError!==void 0&&(L=s.onRecoverableError)),s=Rp(a,1,!1,null,null,c,g,null,w,M,L,Bp),a[Rt]=s.current,pp(a),new kp(s)},Gp.hydrateRoot=function(a,s,c){if(!yt(a))throw Error(Se(299));var g=!1,w="",M=Bc,L=Ns,Z=js,le=null;return c!=null&&(c.unstable_strictMode===!0&&(g=!0),c.identifierPrefix!==void 0&&(w=c.identifierPrefix),c.onUncaughtError!==void 0&&(M=c.onUncaughtError),c.onCaughtError!==void 0&&(L=c.onCaughtError),c.onRecoverableError!==void 0&&(Z=c.onRecoverableError),c.formState!==void 0&&(le=c.formState)),s=Rp(a,1,!0,s,c??null,g,w,le,M,L,Z,Bp),s.context=Im(null),c=s.current,g=Tr(),g=Ao(g),w=ps(g),w.callback=null,Ls(c,w,g),c=g,s.current.lanes=c,vi(s,c),Gs(s),a[Rt]=s.current,pp(a),new Pf(s)},Gp.version="19.2.3",Gp}var Ng;function d_(){if(Ng)return cg.exports;Ng=1;function et(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(et)}catch(Wt){console.error(Wt)}}return et(),cg.exports=h_(),cg.exports}var Vg=d_();const f_=gg(Vg);var qm={exports:{}};var p_=qm.exports,jg;function m_(){return jg||(jg=1,(function(et,Wt){(function(Tt,Se){et.exports=Se()})(p_,(function(){var Tt={},Se={};function yt(O,f,De){if(Se[O]=De,O==="index"){var qe="var sharedModule = {}; ("+Se.shared+")(sharedModule); ("+Se.worker+")(sharedModule);",xt={};return Se.shared(xt),Se.index(Tt,xt),typeof window<"u"&&Tt.setWorkerUrl(window.URL.createObjectURL(new Blob([qe],{type:"text/javascript"}))),Tt}}yt("shared",["exports"],(function(O){function f(n,e,i,o){return new(i||(i=Promise))((function(u,d){function p(T){try{x(o.next(T))}catch(A){d(A)}}function y(T){try{x(o.throw(T))}catch(A){d(A)}}function x(T){var A;T.done?u(T.value):(A=T.value,A instanceof i?A:new i((function(C){C(A)}))).then(p,y)}x((o=o.apply(n,e||[])).next())}))}function De(n,e){this.x=n,this.y=e}function qe(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var xt,ut;typeof SuppressedError=="function"&&SuppressedError,De.prototype={clone(){return new De(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,e){return this.clone()._rotateAround(n,e)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){const e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult(n){const e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){const n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){const e=Math.cos(n),i=Math.sin(n),o=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=o,this},_rotateAround(n,e){const i=Math.cos(n),o=Math.sin(n),u=e.y+o*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-o*(this.y-e.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:De},De.convert=function(n){if(n instanceof De)return n;if(Array.isArray(n))return new De(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new De(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};var Bt=(function(){if(ut)return xt;function n(e,i,o,u){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=u}return ut=1,xt=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,u=0;u<8;u++){var d=this.sampleCurveX(o)-e;if(Math.abs(d)<i)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=d/p}var y=0,x=1;for(o=e,u=0;u<20&&(d=this.sampleCurveX(o),!(Math.abs(d-e)<i));u++)e>d?y=o:x=o,o=.5*(x-y)+y;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},xt})(),Xt=qe(Bt);let di,bt;function Te(){return di==null&&(di=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),di}function Yi(){if(bt==null&&(bt=!1,Te())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<25;o++){const u=4*o;e.fillStyle=`rgb(${u},${u+1},${u+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const i=e.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&i[o]!==o){bt=!0;break}}}return bt||!1}var fi=1e-6,qt=typeof Float32Array<"u"?Float32Array:Array;function Qn(){var n=new qt(9);return qt!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function ma(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function On(){var n=new qt(3);return qt!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function It(n){var e=n[0],i=n[1],o=n[2];return Math.sqrt(e*e+i*i+o*o)}function Dn(n,e,i){var o=new qt(3);return o[0]=n,o[1]=e,o[2]=i,o}function Kn(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function Ma(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function aa(n,e,i){var o=e[0],u=e[1],d=e[2],p=i[0],y=i[1],x=i[2];return n[0]=u*x-d*y,n[1]=d*p-o*x,n[2]=o*y-u*p,n}var en,ra=It;function Va(n,e,i){var o=e[0],u=e[1],d=e[2],p=e[3];return n[0]=i[0]*o+i[4]*u+i[8]*d+i[12]*p,n[1]=i[1]*o+i[5]*u+i[9]*d+i[13]*p,n[2]=i[2]*o+i[6]*u+i[10]*d+i[14]*p,n[3]=i[3]*o+i[7]*u+i[11]*d+i[15]*p,n}function Jn(){var n=new qt(4);return qt!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Oe(n,e,i,o){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",d=Math.PI/360;e*=d,o*=d,i*=d;var p=Math.sin(e),y=Math.cos(e),x=Math.sin(i),T=Math.cos(i),A=Math.sin(o),C=Math.cos(o);switch(u){case"xyz":n[0]=p*T*C+y*x*A,n[1]=y*x*C-p*T*A,n[2]=y*T*A+p*x*C,n[3]=y*T*C-p*x*A;break;case"xzy":n[0]=p*T*C-y*x*A,n[1]=y*x*C-p*T*A,n[2]=y*T*A+p*x*C,n[3]=y*T*C+p*x*A;break;case"yxz":n[0]=p*T*C+y*x*A,n[1]=y*x*C-p*T*A,n[2]=y*T*A-p*x*C,n[3]=y*T*C+p*x*A;break;case"yzx":n[0]=p*T*C+y*x*A,n[1]=y*x*C+p*T*A,n[2]=y*T*A-p*x*C,n[3]=y*T*C-p*x*A;break;case"zxy":n[0]=p*T*C-y*x*A,n[1]=y*x*C+p*T*A,n[2]=y*T*A+p*x*C,n[3]=y*T*C-p*x*A;break;case"zyx":n[0]=p*T*C-y*x*A,n[1]=y*x*C+p*T*A,n[2]=y*T*A-p*x*C,n[3]=y*T*C+p*x*A;break;default:throw new Error("Unknown angle order "+u)}return n}function Ke(){var n=new qt(2);return qt!=Float32Array&&(n[0]=0,n[1]=0),n}function St(n,e){var i=new qt(2);return i[0]=n,i[1]=e,i}On(),en=new qt(4),qt!=Float32Array&&(en[0]=0,en[1]=0,en[2]=0,en[3]=0),On(),Dn(1,0,0),Dn(0,1,0),Jn(),Jn(),Qn(),Ke();const gt=8192;function li(n,e,i){return e*(gt/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}function de(n,e){return(n%e+e)%e}function Ge(n,e,i){return n*(1-i)+e*i}function st(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function ht(n,e,i,o){const u=new Xt(n,e,i,o);return d=>u.solve(d)}const _t=ht(.25,.1,.25,1);function kt(n,e,i){return Math.min(i,Math.max(e,n))}function Yt(n,e,i){const o=i-e,u=((n-e)%o+o)%o+e;return u===e?i:u}function Mi(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}let Bi=1;function ga(n,e,i){const o={};for(const u in n)o[u]=e.call(this,n[u],u,n);return o}function Ys(n,e,i){const o={};for(const u in n)e.call(this,n[u],u,n)&&(o[u]=n[u]);return o}function Ua(n){return Array.isArray(n)?n.map(Ua):typeof n=="object"&&n?ga(n,Ua):n}const gl={};function $i(n){gl[n]||(typeof console<"u"&&console.warn(n),gl[n]=!0)}function Aa(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function sr(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let tn=null;function ws(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const Ts="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function $s(n,e,i,o,u){return f(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const d=new VideoFrame(n,{timestamp:0});try{const p=d?.format;if(!p||!p.startsWith("BGR")&&!p.startsWith("RGB"))throw new Error(`Unrecognized format ${p}`);const y=p.startsWith("BGR"),x=new Uint8ClampedArray(o*u*4);if(yield d.copyTo(x,(function(T,A,C,D,P){const B=4*Math.max(-A,0),k=(Math.max(0,C)-C)*D*4+B,N=4*D,G=Math.max(0,A),J=Math.max(0,C);return{rect:{x:G,y:J,width:Math.min(T.width,A+D)-G,height:Math.min(T.height,C+P)-J},layout:[{offset:k,stride:N}]}})(n,e,i,o,u)),y)for(let T=0;T<x.length;T+=4){const A=x[T];x[T]=x[T+2],x[T+2]=A}return x}finally{d.close()}}))}let Hr,Er;function _l(n,e,i,o){return n.addEventListener(e,i,o),{unsubscribe:()=>{n.removeEventListener(e,i,o)}}}function Fn(n){return n*Math.PI/180}function Ea(n){return n/Math.PI*180}const me={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},V={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},j="AbortError";class H extends Error{constructor(e=j){super(e instanceof Error?e.message:e),this.name=j,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function re(n){return n.name===j}const oe={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ve(n){return oe.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const fe="global-dispatcher";class ue extends Error{constructor(e,i,o,u){super(`AJAXError: ${i} (${e}): ${o}`),this.status=e,this.statusText=i,this.url=o,this.body=u}}const xe=()=>sr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Be=function(n,e){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const o=ve(n.url);if(o)return o(n,e);if(sr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:fe},e)}if(!(/^file:/.test(i=n.url)||/^file:/.test(xe())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(o,u){return f(this,void 0,void 0,(function*(){const d=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:xe(),signal:u.signal});let p,y;o.type!=="json"||d.headers.has("Accept")||d.headers.set("Accept","application/json");try{p=yield fetch(d)}catch(T){throw re(T)?T:new ue(0,T.message,o.url,new Blob)}if(!p.ok){const T=yield p.blob();throw new ue(p.status,p.statusText,o.url,T)}y=o.type==="arrayBuffer"||o.type==="image"?p.arrayBuffer():o.type==="json"?p.json():p.text();const x=yield y;return u.signal.throwIfAborted(),{data:x,cacheControl:p.headers.get("Cache-Control"),expires:p.headers.get("Expires")}}))})(n,e);if(sr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:fe},e)}var i;return(function(o,u){return new Promise(((d,p)=>{var y;const x=new XMLHttpRequest;x.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(x.responseType="arraybuffer");for(const T in o.headers)x.setRequestHeader(T,o.headers[T]);o.type==="json"&&(x.responseType="text",!((y=o.headers)===null||y===void 0)&&y.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=o.credentials==="include",x.onerror=()=>{p(new Error(x.statusText))},x.onload=()=>{if(!u.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let T=x.response;if(o.type==="json")try{T=JSON.parse(x.response)}catch(A){return void p(A)}d({data:T,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const T=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});p(new ue(x.status,x.statusText,o.url,T))}},u.signal.addEventListener("abort",(()=>{x.abort(),p(new H(u.signal.reason))})),x.send(o.body)}))})(n,e)};function ke(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const e=new URL(n),i=window.location;return e.protocol===i.protocol&&e.host===i.host}function nt(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function ct(n,e,i){if(i&&i[n]){const o=i[n].indexOf(e);o!==-1&&i[n].splice(o,1)}}class Et{constructor(e,i={}){Mi(this,i),this.type=e}}class ui extends Et{constructor(e,i={}){super("error",Mi({error:e},i))}}class Qt{on(e,i){return this._listeners=this._listeners||{},nt(e,i,this._listeners),{unsubscribe:()=>{this.off(e,i)}}}off(e,i){return ct(e,i,this._listeners),ct(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},nt(e,i,this._oneTimeListeners),this):new Promise((o=>this.once(e,o)))}fire(e,i){typeof e=="string"&&(e=new Et(e,i||{}));const o=e.type;if(this.listens(o)){e.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const y of u)y.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const y of d)ct(o,y,this._oneTimeListeners),y.call(this,e);const p=this._eventedParent;p&&(Mi(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof ui&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var ge={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const pi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function yn(n,e){const i={};for(const o in n)o!=="ref"&&(i[o]=n[o]);return pi.forEach((o=>{o in e&&(i[o]=e[o])})),i}function Dt(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!Dt(n[i],e[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!Dt(n[i],e[i]))return!1;return!0}return n===e}function mi(n,e){n.push(e)}function Pn(n,e,i){mi(i,{command:"addSource",args:[n,e[n]]})}function vi(n,e,i){mi(e,{command:"removeSource",args:[n]}),i[n]=!0}function nn(n,e,i,o){vi(n,i,o),Pn(n,e,i)}function Ai(n,e,i){let o;for(o in n[i])if(Object.prototype.hasOwnProperty.call(n[i],o)&&o!=="data"&&!Dt(n[i][o],e[i][o]))return!1;for(o in e[i])if(Object.prototype.hasOwnProperty.call(e[i],o)&&o!=="data"&&!Dt(n[i][o],e[i][o]))return!1;return!0}function vn(n,e,i,o,u,d){n=n||{},e=e||{};for(const p in n)Object.prototype.hasOwnProperty.call(n,p)&&(Dt(n[p],e[p])||i.push({command:d,args:[o,p,e[p],u]}));for(const p in e)Object.prototype.hasOwnProperty.call(e,p)&&!Object.prototype.hasOwnProperty.call(n,p)&&(Dt(n[p],e[p])||i.push({command:d,args:[o,p,e[p],u]}))}function yl(n){return n.id}function Ao(n,e){return n[e.id]=e,n}class He{constructor(e,i,o,u){this.message=(e?`${e}: `:"")+o,u&&(this.identifier=u),i!=null&&i.__line__&&(this.line=i.__line__)}}function sa(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}class oa extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Cr{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,u]of i)this.bindings[o]=u}concat(e){return new Cr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Ri={kind:"null"},$e={kind:"number"},Rt={kind:"string"},Nt={kind:"boolean"},Ga={kind:"color"},rc={kind:"projectionDefinition"},Xr={kind:"object"},Pt={kind:"value"},Eo={kind:"collator"},Yr={kind:"formatted"},Ss={kind:"padding"},$r={kind:"colorArray"},Wr={kind:"numberArray"},an={kind:"resolvedImage"},vl={kind:"variableAnchorOffsetCollection"};function la(n,e){return{kind:"array",itemType:n,N:e}}function Kt(n){if(n.kind==="array"){const e=Kt(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const Ms=[Ri,$e,Rt,Nt,Ga,rc,Yr,Xr,la(Pt),Ss,Wr,$r,an,vl];function xl(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!xl(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of Ms)if(!xl(i,e))return null}}return`Expected ${Kt(n)} but found ${Kt(e)} instead.`}function bl(n,e){return e.some((i=>i.kind===n.kind))}function Ws(n,e){return e.some((i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n))}function zr(n,e){return n.kind==="array"&&e.kind==="array"?n.itemType.kind===e.itemType.kind&&typeof n.N=="number":n.kind===e.kind}const ou=.96422,Qr=.82521,or=4/29,ai=6/29,ah=3*ai*ai,pd=ai*ai*ai,Co=Math.PI/180,rh=180/Math.PI;function lu(n){return(n%=360)<0&&(n+=360),n}function md([n,e,i,o]){let u,d;const p=uu((.2225045*(n=_a(n))+.7168786*(e=_a(e))+.0606169*(i=_a(i)))/1);n===e&&e===i?u=d=p:(u=uu((.4360747*n+.3850649*e+.1430804*i)/ou),d=uu((.0139322*n+.0971045*e+.7141733*i)/Qr));const y=116*p-16;return[y<0?0:y,500*(u-p),200*(p-d),o]}function _a(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function uu(n){return n>pd?Math.pow(n,1/3):n/ah+or}function sc([n,e,i,o]){let u=(n+16)/116,d=isNaN(e)?u:u+e/500,p=isNaN(i)?u:u-i/200;return u=1*Qs(u),d=ou*Qs(d),p=Qr*Qs(p),[cu(3.1338561*d-1.6168667*u-.4906146*p),cu(-.9787684*d+1.9161415*u+.033454*p),cu(.0719453*d-.2289914*u+1.4052427*p),o]}function cu(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function Qs(n){return n>ai?n*n*n:ah*(n-or)}const gd=Object.hasOwn||function(n,e){return Object.prototype.hasOwnProperty.call(n,e)};function wl(n,e){return gd(n,e)?n[e]:void 0}function As(n){return parseInt(n.padEnd(2,n),16)/255}function _d(n,e){return zo(e?n/100:n,0,1)}function zo(n,e,i){return Math.min(Math.max(e,n),i)}function oc(n){return!n.some(Number.isNaN)}const Do={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Ks(n,e,i){return n+i*(e-n)}function Tl(n,e,i){return n.map(((o,u)=>Ks(o,e[u],i)))}class Ft{constructor(e,i,o,u=1,d=!0){this.r=e,this.g=i,this.b=o,this.a=u,d||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[e,i,o,u]))}static parse(e){if(e instanceof Ft)return e;if(typeof e!="string")return;const i=(function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=wl(Do,o);if(u){const[p,y,x]=u;return[p/255,y/255,x/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const p=o.length<6?1:2;let y=1;return[As(o.slice(y,y+=p)),As(o.slice(y,y+=p)),As(o.slice(y,y+=p)),As(o.slice(y,y+p)||"ff")]}if(o.startsWith("rgb")){const p=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[y,x,T,A,C,D,P,B,k,N,G,J]=p,q=[A||" ",P||" ",N].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const X=[T,D,k].join(""),te=X==="%%%"?100:X===""?255:0;if(te){const ae=[zo(+x/te,0,1),zo(+C/te,0,1),zo(+B/te,0,1),G?_d(+G,J):1];if(oc(ae))return ae}}return}}const d=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(d){const[p,y,x,T,A,C,D,P,B]=d,k=[x||" ",A||" ",D].join("");if(k==="  "||k==="  /"||k===",,"||k===",,,"){const N=[+y,zo(+T,0,100),zo(+C,0,100),P?_d(+P,B):1];if(oc(N))return(function([G,J,q,X]){function te(ae){const ye=(ae+G/30)%12,Le=J*Math.min(q,1-q);return q-Le*Math.max(-1,Math.min(ye-3,9-ye,1))}return G=lu(G),J/=100,q/=100,[te(0),te(8),te(4),X]})(N)}}})(e);return i?new Ft(...i,!1):void 0}get rgb(){const{r:e,g:i,b:o,a:u}=this,d=u||1/0;return this.overwriteGetter("rgb",[e/d,i/d,o/d,u])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[i,o,u,d]=md(e),p=Math.sqrt(o*o+u*u);return[Math.round(1e4*p)?lu(Math.atan2(u,o)*rh):NaN,p,i,d]})(this.rgb))}get lab(){return this.overwriteGetter("lab",md(this.rgb))}overwriteGetter(e,i){return Object.defineProperty(this,e,{value:i}),i}toString(){const[e,i,o,u]=this.rgb;return`rgba(${[e,i,o].map((d=>Math.round(255*d))).join(",")},${u})`}static interpolate(e,i,o,u="rgb"){switch(u){case"rgb":{const[d,p,y,x]=Tl(e.rgb,i.rgb,o);return new Ft(d,p,y,x,!1)}case"hcl":{const[d,p,y,x]=e.hcl,[T,A,C,D]=i.hcl;let P,B;if(isNaN(d)||isNaN(T))isNaN(d)?isNaN(T)?P=NaN:(P=T,y!==1&&y!==0||(B=A)):(P=d,C!==1&&C!==0||(B=p));else{let q=T-d;T>d&&q>180?q-=360:T<d&&d-T>180&&(q+=360),P=d+o*q}const[k,N,G,J]=(function([q,X,te,ae]){return q=isNaN(q)?0:q*Co,sc([te,Math.cos(q)*X,Math.sin(q)*X,ae])})([P,B??Ks(p,A,o),Ks(y,C,o),Ks(x,D,o)]);return new Ft(k,N,G,J,!1)}case"lab":{const[d,p,y,x]=sc(Tl(e.lab,i.lab,o));return new Ft(d,p,y,x,!1)}}}}Ft.black=new Ft(0,0,0,1),Ft.white=new Ft(1,1,1,1),Ft.transparent=new Ft(0,0,0,0),Ft.red=new Ft(1,0,0,1);class Dr{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const sh=["bottom","center","top"];class hu{constructor(e,i,o,u,d,p){this.text=e,this.image=i,this.scale=o,this.fontStack=u,this.textColor=d,this.verticalAlign=p}}class In{constructor(e){this.sections=e}static fromString(e){return new In([new hu(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof In?e:In.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class xn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof xn)return e;if(typeof e=="number")return new xn([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const i of e)if(typeof i!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new xn(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){return new xn(Tl(e.values,i.values,o))}}class Vi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Vi)return e;if(typeof e=="number")return new Vi([e]);if(Array.isArray(e)){for(const i of e)if(typeof i!="number")return;return new Vi(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){return new Vi(Tl(e.values,i.values,o))}}class wt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof wt)return e;if(typeof e=="string"){const o=Ft.parse(e);return o?new wt([o]):void 0}if(!Array.isArray(e))return;const i=[];for(const o of e){if(typeof o!="string")return;const u=Ft.parse(o);if(!u)return;i.push(u)}return new wt(i)}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o,u="rgb"){const d=[];if(e.values.length!=i.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${i.values.length}), cannot interpolate.`);for(let p=0;p<e.values.length;p++)d.push(Ft.interpolate(e.values[p],i.values[p],o,u));return new wt(d)}}class Ei extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const lr=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class rn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof rn)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let i=0;i<e.length;i+=2){const o=e[i],u=e[i+1];if(typeof o!="string"||!lr.has(o)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new rn(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){const u=e.values,d=i.values;if(u.length!==d.length)throw new Ei(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${i.toString()}`);const p=[];for(let y=0;y<u.length;y+=2){if(u[y]!==d[y])throw new Ei(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${u[y]}, to[${y}]: ${d[y]}`);p.push(u[y]);const[x,T]=u[y+1],[A,C]=d[y+1];p.push([Ks(x,A,o),Ks(T,C,o)])}return new rn(p)}}class ya{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ya({name:e,available:!1}):null}}class Rn{constructor(e,i,o){this.from=e,this.to=i,this.transition=o}static interpolate(e,i,o){return new Rn(e,i,o)}static parse(e){return e instanceof Rn?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new Rn(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new Rn(e.from,e.to,e.transition):typeof e=="string"?new Rn(e,e,1):void 0}}function qa(n,e,i,o){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[n,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[n,e,i,o]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Kr(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Rn||n instanceof Ft||n instanceof Dr||n instanceof In||n instanceof xn||n instanceof Vi||n instanceof wt||n instanceof rn||n instanceof ya)return!0;if(Array.isArray(n)){for(const e of n)if(!Kr(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!Kr(n[e]))return!1;return!0}return!1}function Ui(n){if(n===null)return Ri;if(typeof n=="string")return Rt;if(typeof n=="boolean")return Nt;if(typeof n=="number")return $e;if(n instanceof Ft)return Ga;if(n instanceof Rn)return rc;if(n instanceof Dr)return Eo;if(n instanceof In)return Yr;if(n instanceof xn)return Ss;if(n instanceof Vi)return Wr;if(n instanceof wt)return $r;if(n instanceof rn)return vl;if(n instanceof ya)return an;if(Array.isArray(n)){const e=n.length;let i;for(const o of n){const u=Ui(o);if(i){if(i===u)continue;i=Pt;break}i=u}return la(i||Pt,e)}return Xr}function Js(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Ft||n instanceof Rn||n instanceof In||n instanceof xn||n instanceof Vi||n instanceof wt||n instanceof rn||n instanceof ya?n.toString():JSON.stringify(n)}class Za{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Kr(e[1]))return i.error("invalid value");const o=e[1];let u=Ui(o);const d=i.expectedType;return u.kind!=="array"||u.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(u=d),new Za(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Po={string:Rt,number:$e,boolean:Nt,object:Xr};class va{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,u=1;const d=e[0];if(d==="array"){let y,x;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in Po)||T==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=Po[T],u++}else y=Pt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);x=e[2],u++}o=la(y,x)}else{if(!Po[d])throw new Error(`Types doesn't contain name = ${d}`);o=Po[d]}const p=[];for(;u<e.length;u++){const y=i.parse(e[u],u,Pt);if(!y)return null;p.push(y)}return new va(o,p)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!xl(this.type,Ui(o)))return o;if(i===this.args.length-1)throw new Ei(`Expected value to be of type ${Kt(this.type)}, but found ${Kt(Ui(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const An={"to-boolean":Nt,"to-color":Ga,"to-number":$e,"to-string":Rt};class xa{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0];if(!An[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");const u=An[o],d=[];for(let p=1;p<e.length;p++){const y=i.parse(e[p],p,Pt);if(!y)return null;d.push(y)}return new xa(u,d)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let i,o;for(const u of this.args){if(i=u.evaluate(e),o=null,i instanceof Ft)return i;if(typeof i=="string"){const d=e.parseColor(i);if(d)return d}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rgba value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:qa(i[0],i[1],i[2],i[3]),!o))return new Ft(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Ei(o||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(const o of this.args){i=o.evaluate(e);const u=xn.parse(i);if(u)return u}throw new Ei(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"numberArray":{let i;for(const o of this.args){i=o.evaluate(e);const u=Vi.parse(i);if(u)return u}throw new Ei(`Could not parse numberArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"colorArray":{let i;for(const o of this.args){i=o.evaluate(e);const u=wt.parse(i);if(u)return u}throw new Ei(`Could not parse colorArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(const o of this.args){i=o.evaluate(e);const u=rn.parse(i);if(u)return u}throw new Ei(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const u=Number(i);if(!isNaN(u))return u}throw new Ei(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return In.fromString(Js(this.args[0].evaluate(e)));case"resolvedImage":return ya.fromString(Js(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return Js(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const du=["Unknown","Point","LineString","Polygon"];class Io{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?du[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let i=this._parseColorCache.get(e);return i||(i=Ft.parse(e),this._parseColorCache.set(e,i)),i}}class Ro{constructor(e,i,o=[],u,d=new Cr,p=[]){this.registry=e,this.path=o,this.key=o.map((y=>`[${y}]`)).join(""),this.scope=d,this.errors=p,this.expectedType=u,this._isConstant=i}parse(e,i,o,u,d={}){return i?this.concat(i,o,u)._parse(e,d):this._parse(e,d)}_parse(e,i){function o(u,d,p){return p==="assert"?new va(d,[u]):p==="coerce"?new xa(d,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[u];if(d){let p=d.parse(e,this);if(!p)return null;if(this.expectedType){const y=this.expectedType,x=p.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value"){if(y.kind==="projectionDefinition"&&["string","array"].includes(x.kind)||["color","formatted","resolvedImage"].includes(y.kind)&&["value","string"].includes(x.kind)||["padding","numberArray"].includes(y.kind)&&["value","number","array"].includes(x.kind)||y.kind==="colorArray"&&["value","string","array"].includes(x.kind)||y.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(x.kind))p=o(p,y,i.typeAnnotation||"coerce");else if(this.checkSubtype(y,x))return null}else p=o(p,y,i.typeAnnotation||"assert")}if(!(p instanceof Za)&&p.type.kind!=="resolvedImage"&&this._isConstant(p)){const y=new Io;try{p=new Za(p.type,p.evaluate(y))}catch(x){return this.error(x.message),null}}return p}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o){const u=typeof e=="number"?this.path.concat(e):this.path,d=o?this.scope.concat(o):this.scope;return new Ro(this.registry,this._isConstant,u,i||null,d,this.errors)}error(e,...i){const o=`${this.key}${i.map((u=>`[${u}]`)).join("")}`;this.errors.push(new oa(o,e))}checkSubtype(e,i){const o=xl(e,i);return o&&this.error(o),o}}class xi{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let d=1;d<e.length-1;d+=2){const p=e[d];if(typeof p!="string")return i.error(`Expected string, but found ${typeof p} instead.`,d);if(/[^a-zA-Z0-9_]/.test(p))return i.error("Variable names must contain only alphanumeric characters or '_'.",d);const y=i.parse(e[d+1],d+1);if(!y)return null;o.push([p,y])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return u?new xi(o,u):null}outputDefined(){return this.result.outputDefined()}}class eo{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new eo(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Ut{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,$e),u=i.parse(e[2],2,la(i.expectedType||Pt));return o&&u?new Ut(u.type.itemType,o,u):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new Ei(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new Ei(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new Ei(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Lt{constructor(e,i){this.type=Nt,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Pt),u=i.parse(e[2],2,Pt);return o&&u?bl(o.type,[Nt,Rt,$e,Ri,Pt])?new Lt(o,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Kt(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!Ws(i,["boolean","string","number","null"]))throw new Ei(`Expected first argument to be of type boolean, string, number or null, but found ${Kt(Ui(i))} instead.`);if(!Ws(o,["string","array"]))throw new Ei(`Expected second argument to be of type array or string, but found ${Kt(Ui(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Lo{constructor(e,i,o){this.type=$e,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Pt),u=i.parse(e[2],2,Pt);if(!o||!u)return null;if(!bl(o.type,[Nt,Rt,$e,Ri,Pt]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Kt(o.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,$e);return d?new Lo(o,u,d):null}return new Lo(o,u)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Ws(i,["boolean","string","number","null"]))throw new Ei(`Expected first argument to be of type boolean, string, number or null, but found ${Kt(Ui(i))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(e)),Ws(o,["string"])){const d=o.indexOf(i,u);return d===-1?-1:[...o.slice(0,d)].length}if(Ws(o,["array"]))return o.indexOf(i,u);throw new Ei(`Expected second argument to be of type array or string, but found ${Kt(Ui(o))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Jt{constructor(e,i,o,u,d,p){this.inputType=e,this.type=i,this.input=o,this.cases=u,this.outputs=d,this.otherwise=p}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);const d={},p=[];for(let T=2;T<e.length-1;T+=2){let A=e[T];const C=e[T+1];Array.isArray(A)||(A=[A]);const D=i.concat(T);if(A.length===0)return D.error("Expected at least one branch label.");for(const B of A){if(typeof B!="number"&&typeof B!="string")return D.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return D.error("Numeric branch labels must be integer values.");if(o){if(D.checkSubtype(o,Ui(B)))return null}else o=Ui(B);if(d[String(B)]!==void 0)return D.error("Branch labels must be unique.");d[String(B)]=p.length}const P=i.parse(C,T,u);if(!P)return null;u=u||P.type,p.push(P)}const y=i.parse(e[1],1,Pt);if(!y)return null;const x=i.parse(e[e.length-1],e.length-1,u);return x?y.type.kind!=="value"&&i.concat(1).checkSubtype(o,y.type)?null:new Jt(o,u,y,d,p,x):null}evaluate(e){const i=this.input.evaluate(e);return(Ui(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class fu{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const u=[];for(let p=1;p<e.length-1;p+=2){const y=i.parse(e[p],p,Nt);if(!y)return null;const x=i.parse(e[p+1],p+1,o);if(!x)return null;u.push([y,x]),o=o||x.type}const d=i.parse(e[e.length-1],e.length-1,o);if(!d)return null;if(!o)throw new Error("Can't infer output type");return new fu(o,u,d)}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every((([e,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}}class ur{constructor(e,i,o,u){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Pt),u=i.parse(e[2],2,$e);if(!o||!u)return null;if(!bl(o.type,[la(Pt),Rt,Pt]))return i.error(`Expected first argument to be of type array or string, but found ${Kt(o.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,$e);return d?new ur(o.type,o,u,d):null}return new ur(o.type,o,u)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);let u;if(this.endIndex&&(u=this.endIndex.evaluate(e)),Ws(i,["string"]))return[...i].slice(o,u).join("");if(Ws(i,["array"]))return i.slice(o,u);throw new Ei(`Expected first argument to be of type array or string, but found ${Kt(Ui(i))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function to(n,e){const i=n.length-1;let o,u,d=0,p=i,y=0;for(;d<=p;)if(y=Math.floor((d+p)/2),o=n[y],u=n[y+1],o<=e){if(y===i||e<u)return y;d=y+1}else{if(!(o>e))throw new Ei("Input is not a number.");p=y-1}return 0}class io{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,d]of o)this.labels.push(u),this.outputs.push(d)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,$e);if(!o)return null;const u=[];let d=null;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);for(let p=1;p<e.length;p+=2){const y=p===1?-1/0:e[p],x=e[p+1],T=p,A=p+1;if(typeof y!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(u.length&&u[u.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const C=i.parse(x,A,d);if(!C)return null;d=d||C.type,u.push([y,C])}return new io(d,o,u)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return o[0].evaluate(e);const d=i.length;return u>=i[d-1]?o[d-1].evaluate(e):o[to(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function yd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var pu,oh,kf=(function(){if(oh)return pu;function n(e,i,o,u){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=u}return oh=1,pu=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,u=0;u<8;u++){var d=this.sampleCurveX(o)-e;if(Math.abs(d)<i)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=d/p}var y=0,x=1;for(o=e,u=0;u<20&&(d=this.sampleCurveX(o),!(Math.abs(d-e)<i));u++)e>d?y=o:x=o,o=.5*(x-y)+y;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},pu})(),lh=yd(kf);class ba{constructor(e,i,o,u,d){this.type=e,this.operator=i,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[p,y]of d)this.labels.push(p),this.outputs.push(y)}static interpolationFactor(e,i,o,u){let d=0;if(e.name==="exponential")d=Jr(i,e.base,o,u);else if(e.name==="linear")d=Jr(i,1,o,u);else if(e.name==="cubic-bezier"){const p=e.controlPoints;d=new lh(p[0],p[1],p[2],p[3]).solve(Jr(i,1,o,u))}return d}static parse(e,i){let[o,u,d,...p]=e;if(!Array.isArray(u)||u.length===0)return i.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const T=u[1];if(typeof T!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:T}}else{if(u[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const T=u.slice(1);if(T.length!==4||T.some((A=>typeof A!="number"||A<0||A>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(d=i.parse(d,2,$e),!d)return null;const y=[];let x=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||i.expectedType==$r?i.expectedType&&i.expectedType.kind!=="value"&&(x=i.expectedType):x=Ga;for(let T=0;T<p.length;T+=2){const A=p[T],C=p[T+1],D=T+3,P=T+4;if(typeof A!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(y.length&&y[y.length-1][0]>=A)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const B=i.parse(C,P,x);if(!B)return null;x=x||B.type,y.push([A,B])}return zr(x,$e)||zr(x,rc)||zr(x,Ga)||zr(x,Ss)||zr(x,Wr)||zr(x,$r)||zr(x,vl)||zr(x,la($e))?new ba(x,o,u,d,y):i.error(`Type ${Kt(x)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return o[0].evaluate(e);const d=i.length;if(u>=i[d-1])return o[d-1].evaluate(e);const p=to(i,u),y=ba.interpolationFactor(this.interpolation,u,i[p],i[p+1]),x=o[p].evaluate(e),T=o[p+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Ks(x,T,y);case"color":return Ft.interpolate(x,T,y);case"padding":return xn.interpolate(x,T,y);case"colorArray":return wt.interpolate(x,T,y);case"numberArray":return Vi.interpolate(x,T,y);case"variableAnchorOffsetCollection":return rn.interpolate(x,T,y);case"array":return Tl(x,T,y);case"projectionDefinition":return Rn.interpolate(x,T,y)}case"interpolate-hcl":switch(this.type.kind){case"color":return Ft.interpolate(x,T,y,"hcl");case"colorArray":return wt.interpolate(x,T,y,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Ft.interpolate(x,T,y,"lab");case"colorArray":return wt.interpolate(x,T,y,"lab")}}}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function Jr(n,e,i,o){const u=o-i,d=n-i;return u===0?0:e===1?d/u:(Math.pow(e,d)-1)/(Math.pow(e,u)-1)}const Gi={color:Ft.interpolate,number:Ks,padding:xn.interpolate,numberArray:Vi.interpolate,colorArray:wt.interpolate,variableAnchorOffsetCollection:rn.interpolate,array:Tl};class Bo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o=null;const u=i.expectedType;u&&u.kind!=="value"&&(o=u);const d=[];for(const y of e.slice(1)){const x=i.parse(y,1+d.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,d.push(x)}if(!o)throw new Error("No output type");const p=u&&d.some((y=>xl(u,y.type)));return new Bo(p?Pt:o,d)}evaluate(e){let i,o=null,u=0;for(const d of this.args)if(u++,o=d.evaluate(e),o&&o instanceof ya&&!o.available&&(i||(i=o.name),o=null,u===this.args.length&&(o=i)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function mu(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function gu(n,e,i,o){return o.compare(e,i)===0}function sn(n,e,i){const o=n!=="=="&&n!=="!=";return class Ug{constructor(d,p,y){this.type=Nt,this.lhs=d,this.rhs=p,this.collator=y,this.hasUntypedArgument=d.type.kind==="value"||p.type.kind==="value"}static parse(d,p){if(d.length!==3&&d.length!==4)return p.error("Expected two or three arguments.");const y=d[0];let x=p.parse(d[1],1,Pt);if(!x)return null;if(!mu(y,x.type))return p.concat(1).error(`"${y}" comparisons are not supported for type '${Kt(x.type)}'.`);let T=p.parse(d[2],2,Pt);if(!T)return null;if(!mu(y,T.type))return p.concat(2).error(`"${y}" comparisons are not supported for type '${Kt(T.type)}'.`);if(x.type.kind!==T.type.kind&&x.type.kind!=="value"&&T.type.kind!=="value")return p.error(`Cannot compare types '${Kt(x.type)}' and '${Kt(T.type)}'.`);o&&(x.type.kind==="value"&&T.type.kind!=="value"?x=new va(T.type,[x]):x.type.kind!=="value"&&T.type.kind==="value"&&(T=new va(x.type,[T])));let A=null;if(d.length===4){if(x.type.kind!=="string"&&T.type.kind!=="string"&&x.type.kind!=="value"&&T.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(A=p.parse(d[3],3,Eo),!A)return null}return new Ug(x,T,A)}evaluate(d){const p=this.lhs.evaluate(d),y=this.rhs.evaluate(d);if(o&&this.hasUntypedArgument){const x=Ui(p),T=Ui(y);if(x.kind!==T.kind||x.kind!=="string"&&x.kind!=="number")throw new Ei(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${x.kind}, ${T.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=Ui(p),T=Ui(y);if(x.kind!=="string"||T.kind!=="string")return e(d,p,y)}return this.collator?i(d,p,y,this.collator.evaluate(d)):e(d,p,y)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}}}const vd=sn("==",(function(n,e,i){return e===i}),gu),lc=sn("!=",(function(n,e,i){return e!==i}),(function(n,e,i,o){return!gu(0,e,i,o)})),xd=sn("<",(function(n,e,i){return e<i}),(function(n,e,i,o){return o.compare(e,i)<0})),Of=sn(">",(function(n,e,i){return e>i}),(function(n,e,i,o){return o.compare(e,i)>0})),Sl=sn("<=",(function(n,e,i){return e<=i}),(function(n,e,i,o){return o.compare(e,i)<=0})),uc=sn(">=",(function(n,e,i){return e>=i}),(function(n,e,i,o){return o.compare(e,i)>=0}));class Ml{constructor(e,i,o){this.type=Eo,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const u=i.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Nt);if(!u)return null;const d=i.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Nt);if(!d)return null;let p=null;return o.locale&&(p=i.parse(o.locale,1,Rt),!p)?null:new Ml(u,d,p)}evaluate(e){return new Dr(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class uh{constructor(e,i,o,u,d){this.type=Rt,this.number=e,this.locale=i,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=d}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,$e);if(!o)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let d=null;if(u.locale&&(d=i.parse(u.locale,1,Rt),!d))return null;let p=null;if(u.currency&&(p=i.parse(u.currency,1,Rt),!p))return null;let y=null;if(u["min-fraction-digits"]&&(y=i.parse(u["min-fraction-digits"],1,$e),!y))return null;let x=null;return u["max-fraction-digits"]&&(x=i.parse(u["max-fraction-digits"],1,$e),!x)?null:new uh(o,d,p,y,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class _u{constructor(e){this.type=Yr,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const u=[];let d=!1;for(let p=1;p<=e.length-1;++p){const y=e[p];if(d&&typeof y=="object"&&!Array.isArray(y)){d=!1;let x=null;if(y["font-scale"]&&(x=i.parse(y["font-scale"],1,$e),!x))return null;let T=null;if(y["text-font"]&&(T=i.parse(y["text-font"],1,la(Rt)),!T))return null;let A=null;if(y["text-color"]&&(A=i.parse(y["text-color"],1,Ga),!A))return null;let C=null;if(y["vertical-align"]){if(typeof y["vertical-align"]=="string"&&!sh.includes(y["vertical-align"]))return i.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${y["vertical-align"]}' instead.`);if(C=i.parse(y["vertical-align"],1,Rt),!C)return null}const D=u[u.length-1];D.scale=x,D.font=T,D.textColor=A,D.verticalAlign=C}else{const x=i.parse(e[p],1,Pt);if(!x)return null;const T=x.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,u.push({content:x,scale:null,font:null,textColor:null,verticalAlign:null})}}return new _u(u)}evaluate(e){return new In(this.sections.map((i=>{const o=i.content.evaluate(e);return Ui(o)===an?new hu("",o,null,null,null,i.verticalAlign?i.verticalAlign.evaluate(e):null):new hu(Js(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null,i.verticalAlign?i.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor),i.verticalAlign&&e(i.verticalAlign)}outputDefined(){return!1}}class Al{constructor(e){this.type=an,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const o=i.parse(e[1],1,Rt);return o?new Al(o):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),o=ya.fromString(i);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(i)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class El{constructor(e){this.type=$e,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Kt(o.type)} instead.`):new El(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new Ei(`Expected value to be of type string or array, but found ${Kt(Ui(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const fn=8192;function Cl(n,e){const i=(180+n[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*fn),Math.round(o*u*fn)]}function zl(n,e){const i=Math.pow(2,e.z);return[(u=(n[0]/fn+e.x)/i,360*u-180),(o=(n[1]/fn+e.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,u}function Dl(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function no(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function bd(n,e,i){const o=n[0]-e[0],u=n[1]-e[1],d=n[0]-i[0],p=n[1]-i[1];return o*p-d*u==0&&o*d<=0&&u*p<=0}function yu(n,e,i,o){return(u=[o[0]-i[0],o[1]-i[1]])[0]*(d=[e[0]-n[0],e[1]-n[1]])[1]-u[1]*d[0]!=0&&!(!hc(n,e,i,o)||!hc(i,o,n,e));var u,d}function wd(n,e,i){for(const o of i)for(let u=0;u<o.length-1;++u)if(yu(n,e,o[u],o[u+1]))return!0;return!1}function Pr(n,e,i=!1){let o=!1;for(const y of e)for(let x=0;x<y.length-1;x++){if(bd(n,y[x],y[x+1]))return i;(d=y[x])[1]>(u=n)[1]!=(p=y[x+1])[1]>u[1]&&u[0]<(p[0]-d[0])*(u[1]-d[1])/(p[1]-d[1])+d[0]&&(o=!o)}var u,d,p;return o}function cc(n,e){for(const i of e)if(Pr(n,i))return!0;return!1}function Td(n,e){for(const i of n)if(!Pr(i,e))return!1;for(let i=0;i<n.length-1;++i)if(wd(n[i],n[i+1],e))return!1;return!0}function Sd(n,e){for(const i of e)if(Td(n,i))return!0;return!1}function hc(n,e,i,o){const u=o[0]-i[0],d=o[1]-i[1],p=(n[0]-i[0])*d-u*(n[1]-i[1]),y=(e[0]-i[0])*d-u*(e[1]-i[1]);return p>0&&y<0||p<0&&y>0}function dc(n,e,i){const o=[];for(let u=0;u<n.length;u++){const d=[];for(let p=0;p<n[u].length;p++){const y=Cl(n[u][p],i);Dl(e,y),d.push(y)}o.push(d)}return o}function ko(n,e,i){const o=[];for(let u=0;u<n.length;u++){const d=dc(n[u],e,i);o.push(d)}return o}function Pl(n,e,i,o){if(n[0]<i[0]||n[0]>i[2]){const u=.5*o;let d=n[0]-i[0]>u?-o:i[0]-n[0]>u?o:0;d===0&&(d=n[0]-i[2]>u?-o:i[2]-n[0]>u?o:0),n[0]+=d}Dl(e,n)}function Md(n,e,i,o){const u=Math.pow(2,o.z)*fn,d=[o.x*fn,o.y*fn],p=[];for(const y of n)for(const x of y){const T=[x.x+d[0],x.y+d[1]];Pl(T,e,i,u),p.push(T)}return p}function vu(n,e,i,o){const u=Math.pow(2,o.z)*fn,d=[o.x*fn,o.y*fn],p=[];for(const x of n){const T=[];for(const A of x){const C=[A.x+d[0],A.y+d[1]];Dl(e,C),T.push(C)}p.push(T)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of p)for(const T of x)Pl(T,e,i,u)}var y;return p}class ao{constructor(e,i){this.type=Nt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Kr(e[1])){const o=e[1];if(o.type==="FeatureCollection"){const u=[];for(const d of o.features){const{type:p,coordinates:y}=d.geometry;p==="Polygon"&&u.push(y),p==="MultiPolygon"&&u.push(...y)}if(u.length)return new ao(o,{type:"MultiPolygon",coordinates:u})}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new ao(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new ao(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,o){const u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(o.type==="Polygon"){const y=dc(o.coordinates,d,p),x=Md(i.geometry(),u,d,p);if(!no(u,d))return!1;for(const T of x)if(!Pr(T,y))return!1}if(o.type==="MultiPolygon"){const y=ko(o.coordinates,d,p),x=Md(i.geometry(),u,d,p);if(!no(u,d))return!1;for(const T of x)if(!cc(T,y))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,o){const u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(o.type==="Polygon"){const y=dc(o.coordinates,d,p),x=vu(i.geometry(),u,d,p);if(!no(u,d))return!1;for(const T of x)if(!Td(T,y))return!1}if(o.type==="MultiPolygon"){const y=ko(o.coordinates,d,p),x=vu(i.geometry(),u,d,p);if(!no(u,d))return!1;for(const T of x)if(!Sd(T,y))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ch=class{constructor(n=[],e=(i,o)=>i<o?-1:i>o?1:0){if(this.data=n,this.length=this.data.length,this.compare=e,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:e,compare:i}=this,o=e[n];for(;n>0;){const u=n-1>>1,d=e[u];if(i(o,d)>=0)break;e[n]=d,n=u}e[n]=o}_down(n){const{data:e,compare:i}=this,o=this.length>>1,u=e[n];for(;n<o;){let d=1+(n<<1);const p=d+1;if(p<this.length&&i(e[p],e[d])<0&&(d=p),i(e[d],u)>=0)break;e[n]=e[d],n=d}e[n]=u}};function xu(n,e,i=0,o=n.length-1,u=hh){for(;o>i;){if(o-i>600){const x=o-i+1,T=e-i+1,A=Math.log(x),C=.5*Math.exp(2*A/3),D=.5*Math.sqrt(A*C*(x-C)/x)*(T-x/2<0?-1:1);xu(n,e,Math.max(i,Math.floor(e-T*C/x+D)),Math.min(o,Math.floor(e+(x-T)*C/x+D)),u)}const d=n[e];let p=i,y=o;for(ro(n,i,e),u(n[o],d)>0&&ro(n,i,o);p<y;){for(ro(n,p,y),p++,y--;u(n[p],d)<0;)p++;for(;u(n[y],d)>0;)y--}u(n[i],d)===0?ro(n,i,y):(y++,ro(n,y,o)),y<=e&&(i=y+1),e<=y&&(o=y-1)}}function ro(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function hh(n,e){return n<e?-1:n>e?1:0}function bu(n,e){if(n.length<=1)return[n];const i=[];let o,u;for(const d of n){const p=Ff(d);p!==0&&(d.area=Math.abs(p),u===void 0&&(u=p<0),u===p<0?(o&&i.push(o),o=[d]):o.push(d))}if(o&&i.push(o),e>1)for(let d=0;d<i.length;d++)i[d].length<=e||(xu(i[d],e,1,i[d].length-1,Ad),i[d]=i[d].slice(0,e));return i}function Ad(n,e){return e.area-n.area}function Ff(n){let e=0;for(let i,o,u=0,d=n.length,p=d-1;u<d;p=u++)i=n[u],o=n[p],e+=(o.x-i.x)*(i.y+o.y);return e}const Ed=1/298.257223563,wu=Ed*(2-Ed),Cd=Math.PI/180;class dh{constructor(e){const i=6378.137*Cd*1e3,o=Math.cos(e*Cd),u=1/(1-wu*(1-o*o)),d=Math.sqrt(u);this.kx=i*d*o,this.ky=i*d*u*(1-wu)}distance(e,i){const o=this.wrap(e[0]-i[0])*this.kx,u=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+u*u)}pointOnLine(e,i){let o,u,d,p,y=1/0;for(let x=0;x<e.length-1;x++){let T=e[x][0],A=e[x][1],C=this.wrap(e[x+1][0]-T)*this.kx,D=(e[x+1][1]-A)*this.ky,P=0;C===0&&D===0||(P=(this.wrap(i[0]-T)*this.kx*C+(i[1]-A)*this.ky*D)/(C*C+D*D),P>1?(T=e[x+1][0],A=e[x+1][1]):P>0&&(T+=C/this.kx*P,A+=D/this.ky*P)),C=this.wrap(i[0]-T)*this.kx,D=(i[1]-A)*this.ky;const B=C*C+D*D;B<y&&(y=B,o=T,u=A,d=x,p=P)}return{point:[o,u],index:d,t:Math.max(0,Math.min(1,p))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function Ca(n,e){return e[0]-n[0]}function so(n){return n[1]-n[0]+1}function cr(n,e){return n[1]>=n[0]&&n[1]<e}function Tu(n,e){if(n[0]>n[1])return[null,null];const i=so(n);if(e){if(i===2)return[n,null];const u=Math.floor(i/2);return[[n[0],n[0]+u],[n[0]+u,n[1]]]}if(i===1)return[n,null];const o=Math.floor(i/2)-1;return[[n[0],n[0]+o],[n[0]+o+1,n[1]]]}function fc(n,e){if(!cr(e,n.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let o=e[0];o<=e[1];++o)Dl(i,n[o]);return i}function pc(n){const e=[1/0,1/0,-1/0,-1/0];for(const i of n)for(const o of i)Dl(e,o);return e}function Su(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function mc(n,e,i){if(!Su(n)||!Su(e))return NaN;let o=0,u=0;return n[2]<e[0]&&(o=e[0]-n[2]),n[0]>e[2]&&(o=n[0]-e[2]),n[1]>e[3]&&(u=n[1]-e[3]),n[3]<e[1]&&(u=e[1]-n[3]),i.distance([0,0],[o,u])}function hr(n,e,i){const o=i.pointOnLine(e,n);return i.distance(n,o.point)}function Mu(n,e,i,o,u){const d=Math.min(hr(n,[i,o],u),hr(e,[i,o],u)),p=Math.min(hr(i,[n,e],u),hr(o,[n,e],u));return Math.min(d,p)}function Au(n,e,i,o,u){if(!cr(e,n.length)||!cr(o,i.length))return 1/0;let d=1/0;for(let p=e[0];p<e[1];++p){const y=n[p],x=n[p+1];for(let T=o[0];T<o[1];++T){const A=i[T],C=i[T+1];if(yu(y,x,A,C))return 0;d=Math.min(d,Mu(y,x,A,C,u))}}return d}function gc(n,e,i,o,u){if(!cr(e,n.length)||!cr(o,i.length))return NaN;let d=1/0;for(let p=e[0];p<=e[1];++p)for(let y=o[0];y<=o[1];++y)if(d=Math.min(d,u.distance(n[p],i[y])),d===0)return d;return d}function zd(n,e,i){if(Pr(n,e,!0))return 0;let o=1/0;for(const u of e){const d=u[0],p=u[u.length-1];if(d!==p&&(o=Math.min(o,hr(n,[p,d],i)),o===0))return o;const y=i.pointOnLine(u,n);if(o=Math.min(o,i.distance(n,y.point)),o===0)return o}return o}function Oo(n,e,i,o){if(!cr(e,n.length))return NaN;for(let d=e[0];d<=e[1];++d)if(Pr(n[d],i,!0))return 0;let u=1/0;for(let d=e[0];d<e[1];++d){const p=n[d],y=n[d+1];for(const x of i)for(let T=0,A=x.length,C=A-1;T<A;C=T++){const D=x[C],P=x[T];if(yu(p,y,D,P))return 0;u=Math.min(u,Mu(p,y,D,P,o))}}return u}function Fo(n,e){for(const i of n)for(const o of i)if(Pr(o,e,!0))return!0;return!1}function fh(n,e,i,o=1/0){const u=pc(n),d=pc(e);if(o!==1/0&&mc(u,d,i)>=o)return o;if(no(u,d)){if(Fo(n,e))return 0}else if(Fo(e,n))return 0;let p=1/0;for(const y of n)for(let x=0,T=y.length,A=T-1;x<T;A=x++){const C=y[A],D=y[x];for(const P of e)for(let B=0,k=P.length,N=k-1;B<k;N=B++){const G=P[N],J=P[B];if(yu(C,D,G,J))return 0;p=Math.min(p,Mu(C,D,G,J,i))}}return p}function ri(n,e,i,o,u,d){if(!d)return;const p=mc(fc(o,d),u,i);p<e&&n.push([p,d,[0,0]])}function es(n,e,i,o,u,d,p){if(!d||!p)return;const y=mc(fc(o,d),fc(u,p),i);y<e&&n.push([y,d,p])}function Eu(n,e,i,o,u=1/0){let d=Math.min(o.distance(n[0],i[0][0]),u);if(d===0)return d;const p=new ch([[0,[0,n.length-1],[0,0]]],Ca),y=pc(i);for(;p.length>0;){const x=p.pop();if(x[0]>=d)continue;const T=x[1],A=e?50:100;if(so(T)<=A){if(!cr(T,n.length))return NaN;if(e){const C=Oo(n,T,i,o);if(isNaN(C)||C===0)return C;d=Math.min(d,C)}else for(let C=T[0];C<=T[1];++C){const D=zd(n[C],i,o);if(d=Math.min(d,D),d===0)return 0}}else{const C=Tu(T,e);ri(p,d,o,n,y,C[0]),ri(p,d,o,n,y,C[1])}}return d}function Cu(n,e,i,o,u,d=1/0){let p=Math.min(d,u.distance(n[0],i[0]));if(p===0)return p;const y=new ch([[0,[0,n.length-1],[0,i.length-1]]],Ca);for(;y.length>0;){const x=y.pop();if(x[0]>=p)continue;const T=x[1],A=x[2],C=e?50:100,D=o?50:100;if(so(T)<=C&&so(A)<=D){if(!cr(T,n.length)&&cr(A,i.length))return NaN;let P;if(e&&o)P=Au(n,T,i,A,u),p=Math.min(p,P);else if(e&&!o){const B=n.slice(T[0],T[1]+1);for(let k=A[0];k<=A[1];++k)if(P=hr(i[k],B,u),p=Math.min(p,P),p===0)return p}else if(!e&&o){const B=i.slice(A[0],A[1]+1);for(let k=T[0];k<=T[1];++k)if(P=hr(n[k],B,u),p=Math.min(p,P),p===0)return p}else P=gc(n,T,i,A,u),p=Math.min(p,P)}else{const P=Tu(T,e),B=Tu(A,o);es(y,p,u,n,i,P[0],B[0]),es(y,p,u,n,i,P[0],B[1]),es(y,p,u,n,i,P[1],B[0]),es(y,p,u,n,i,P[1],B[1])}}return p}function _c(n){return n.type==="MultiPolygon"?n.coordinates.map((e=>({type:"Polygon",coordinates:e}))):n.type==="MultiLineString"?n.coordinates.map((e=>({type:"LineString",coordinates:e}))):n.type==="MultiPoint"?n.coordinates.map((e=>({type:"Point",coordinates:e}))):[n]}class No{constructor(e,i){this.type=$e,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Kr(e[1])){const o=e[1];if(o.type==="FeatureCollection")return new No(o,o.features.map((u=>_c(u.geometry))).flat());if(o.type==="Feature")return new No(o,_c(o.geometry));if("type"in o&&"coordinates"in o)return new No(o,_c(o))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,o){const u=i.geometry(),d=u.flat().map((x=>zl([x.x,x.y],i.canonical)));if(u.length===0)return NaN;const p=new dh(d[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,Cu(d,!1,[x.coordinates],!1,p,y));break;case"LineString":y=Math.min(y,Cu(d,!1,x.coordinates,!0,p,y));break;case"Polygon":y=Math.min(y,Eu(d,!1,x.coordinates,p,y))}if(y===0)return y}return y})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,o){const u=i.geometry(),d=u.flat().map((x=>zl([x.x,x.y],i.canonical)));if(u.length===0)return NaN;const p=new dh(d[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,Cu(d,!0,[x.coordinates],!1,p,y));break;case"LineString":y=Math.min(y,Cu(d,!0,x.coordinates,!0,p,y));break;case"Polygon":y=Math.min(y,Eu(d,!0,x.coordinates,p,y))}if(y===0)return y}return y})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(i,o){const u=i.geometry();if(u.length===0||u[0].length===0)return NaN;const d=bu(u,0).map((x=>x.map((T=>T.map((A=>zl([A.x,A.y],i.canonical))))))),p=new dh(d[0][0][0][1]);let y=1/0;for(const x of o)for(const T of d){switch(x.type){case"Point":y=Math.min(y,Eu([x.coordinates],!1,T,p,y));break;case"LineString":y=Math.min(y,Eu(x.coordinates,!0,T,p,y));break;case"Polygon":y=Math.min(y,fh(T,x.coordinates,p,y))}if(y===0)return y}return y})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class zu{constructor(e){this.type=Pt,this.key=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=e[1];return o==null?i.error("Global state property must be defined."):typeof o!="string"?i.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new zu(o)}evaluate(e){var i;const o=(i=e.globals)===null||i===void 0?void 0:i.globalState;return o&&Object.keys(o).length!==0?wl(o,this.key):null}eachChild(){}outputDefined(){return!1}}const Il={"==":vd,"!=":lc,">":Of,"<":xd,">=":uc,"<=":Sl,array:va,at:Ut,boolean:va,case:fu,coalesce:Bo,collator:Ml,format:_u,image:Al,in:Lt,"index-of":Lo,interpolate:ba,"interpolate-hcl":ba,"interpolate-lab":ba,length:El,let:xi,literal:Za,match:Jt,number:va,"number-format":uh,object:va,slice:ur,step:io,string:va,"to-boolean":xa,"to-color":xa,"to-number":xa,"to-string":xa,var:eo,within:ao,distance:No,"global-state":zu};class Ha{constructor(e,i,o,u){this.name=e,this.type=i,this._evaluate=o,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,i){const o=e[0],u=Ha.definitions[o];if(!u)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(u)?u[0]:u.type,p=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=p.filter((([T])=>!Array.isArray(T)||T.length===e.length-1));let x=null;for(const[T,A]of y){x=new Ro(i.registry,wa,i.path,null,i.scope);const C=[];let D=!1;for(let P=1;P<e.length;P++){const B=e[P],k=Array.isArray(T)?T[P-1]:T.type,N=x.parse(B,1+C.length,k);if(!N){D=!0;break}C.push(N)}if(!D)if(Array.isArray(T)&&T.length!==C.length)x.error(`Expected ${T.length} arguments, but found ${C.length} instead.`);else{for(let P=0;P<C.length;P++){const B=Array.isArray(T)?T[P]:T.type,k=C[P];x.concat(P+1).checkSubtype(B,k.type)}if(x.errors.length===0)return new Ha(o,d,A,C)}}if(y.length===1)i.errors.push(...x.errors);else{const T=(y.length?y:p).map((([C])=>{return D=C,Array.isArray(D)?`(${D.map(Kt).join(", ")})`:`(${Kt(D.type)}...)`;var D})).join(" | "),A=[];for(let C=1;C<e.length;C++){const D=i.parse(e[C],1+A.length);if(!D)return null;A.push(Kt(D.type))}i.error(`Expected arguments of type ${T}, but found (${A.join(", ")}) instead.`)}return null}static register(e,i){Ha.definitions=i;for(const o in i)e[o]=Ha}}function ph(n,[e,i,o,u]){e=e.evaluate(n),i=i.evaluate(n),o=o.evaluate(n);const d=u?u.evaluate(n):1,p=qa(e,i,o,d);if(p)throw new Ei(p);return new Ft(e/255,i/255,o/255,d,!1)}function yc(n,e){return n in e}function Xa(n,e){const i=e[n];return i===void 0?null:i}function ts(n){return{type:n}}function wa(n){if(n instanceof eo)return wa(n.boundExpression);if(n instanceof Ha&&n.name==="error"||n instanceof Ml||n instanceof ao||n instanceof No||n instanceof zu)return!1;const e=n instanceof xa||n instanceof va;let i=!0;return n.eachChild((o=>{i=e?i&&wa(o):i&&o instanceof Za})),!!i&&Es(n)&&Vo(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Es(n){if(n instanceof Ha&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof ao||n instanceof No)return!1;let e=!0;return n.eachChild((i=>{e&&!Es(i)&&(e=!1)})),e}function jo(n){if(n instanceof Ha&&n.name==="feature-state")return!1;let e=!0;return n.eachChild((i=>{e&&!jo(i)&&(e=!1)})),e}function Vo(n,e){if(n instanceof Ha&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild((o=>{i&&!Vo(o,e)&&(i=!1)})),i}function Du(n){return{result:"success",value:n}}function oo(n){return{result:"error",value:n}}function dr(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function mh(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Rl(n){return!!n.expression&&n.expression.interpolated}function Ot(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function vc(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&Ui(n)===Xr}function Ya(n){return n}function xc(n,e){const i=n.stops&&typeof n.stops[0][0]=="object",o=i||!(i||n.property!==void 0),u=n.type||(Rl(e)?"exponential":"interval"),d=(function(A){switch(A.type){case"color":return Ft.parse;case"padding":return xn.parse;case"numberArray":return Vi.parse;case"colorArray":return wt.parse;default:return null}})(e);if(d&&((n=sa({},n)).stops&&(n.stops=n.stops.map((A=>[A[0],d(A[1])]))),n.default=d(n.default?n.default:e.default)),n.colorSpace&&(p=n.colorSpace)!=="rgb"&&p!=="hcl"&&p!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var p;const y=(function(A){switch(A){case"exponential":return lo;case"interval":return bc;case"categorical":return Dd;case"identity":return gh;default:throw new Error(`Unknown function type "${A}"`)}})(u);let x,T;if(u==="categorical"){x=Object.create(null);for(const A of n.stops)x[A[0]]=A[1];T=typeof n.stops[0][0]}if(i){const A={},C=[];for(let B=0;B<n.stops.length;B++){const k=n.stops[B],N=k[0].zoom;A[N]===void 0&&(A[N]={zoom:N,type:n.type,property:n.property,default:n.default,stops:[]},C.push(N)),A[N].stops.push([k[0].value,k[1]])}const D=[];for(const B of C)D.push([A[B].zoom,xc(A[B],e)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:ba.interpolationFactor.bind(void 0,P),zoomStops:D.map((B=>B[0])),evaluate:({zoom:B},k)=>lo({stops:D,base:n.base},e,B).evaluate(B,k)}}if(o){const A=u==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:ba.interpolationFactor.bind(void 0,A),zoomStops:n.stops.map((C=>C[0])),evaluate:({zoom:C})=>y(n,e,C,x,T)}}return{kind:"source",evaluate(A,C){const D=C&&C.properties?C.properties[n.property]:void 0;return D===void 0?$a(n.default,e.default):y(n,e,D,x,T)}}}function $a(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function Dd(n,e,i,o,u){return $a(typeof i===u?o[i]:void 0,n.default,e.default)}function bc(n,e,i){if(Ot(i)!=="number")return $a(n.default,e.default);const o=n.stops.length;if(o===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[o-1][0])return n.stops[o-1][1];const u=to(n.stops.map((d=>d[0])),i);return n.stops[u][1]}function lo(n,e,i){const o=n.base!==void 0?n.base:1;if(Ot(i)!=="number")return $a(n.default,e.default);const u=n.stops.length;if(u===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[u-1][0])return n.stops[u-1][1];const d=to(n.stops.map((A=>A[0])),i),p=(function(A,C,D,P){const B=P-D,k=A-D;return B===0?0:C===1?k/B:(Math.pow(C,k)-1)/(Math.pow(C,B)-1)})(i,o,n.stops[d][0],n.stops[d+1][0]),y=n.stops[d][1],x=n.stops[d+1][1],T=Gi[e.type]||Ya;return typeof y.evaluate=="function"?{evaluate(...A){const C=y.evaluate.apply(void 0,A),D=x.evaluate.apply(void 0,A);if(C!==void 0&&D!==void 0)return T(C,D,p,n.colorSpace)}}:T(y,x,p,n.colorSpace)}function gh(n,e,i){switch(e.type){case"color":i=Ft.parse(i);break;case"formatted":i=In.fromString(i.toString());break;case"resolvedImage":i=ya.fromString(i.toString());break;case"padding":i=xn.parse(i);break;case"colorArray":i=wt.parse(i);break;case"numberArray":i=Vi.parse(i);break;default:Ot(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0)}return $a(i,n.default,e.default)}Ha.register(Il,{error:[{kind:"error"},[Rt],(n,[e])=>{throw new Ei(e.evaluate(n))}],typeof:[Rt,[Pt],(n,[e])=>Kt(Ui(e.evaluate(n)))],"to-rgba":[la($e,4),[Ga],(n,[e])=>{const[i,o,u,d]=e.evaluate(n).rgb;return[255*i,255*o,255*u,d]}],rgb:[Ga,[$e,$e,$e],ph],rgba:[Ga,[$e,$e,$e,$e],ph],has:{type:Nt,overloads:[[[Rt],(n,[e])=>yc(e.evaluate(n),n.properties())],[[Rt,Xr],(n,[e,i])=>yc(e.evaluate(n),i.evaluate(n))]]},get:{type:Pt,overloads:[[[Rt],(n,[e])=>Xa(e.evaluate(n),n.properties())],[[Rt,Xr],(n,[e,i])=>Xa(e.evaluate(n),i.evaluate(n))]]},"feature-state":[Pt,[Rt],(n,[e])=>Xa(e.evaluate(n),n.featureState||{})],properties:[Xr,[],n=>n.properties()],"geometry-type":[Rt,[],n=>n.geometryType()],id:[Pt,[],n=>n.id()],zoom:[$e,[],n=>n.globals.zoom],"heatmap-density":[$e,[],n=>n.globals.heatmapDensity||0],elevation:[$e,[],n=>n.globals.elevation||0],"line-progress":[$e,[],n=>n.globals.lineProgress||0],accumulated:[Pt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[$e,ts($e),(n,e)=>{let i=0;for(const o of e)i+=o.evaluate(n);return i}],"*":[$e,ts($e),(n,e)=>{let i=1;for(const o of e)i*=o.evaluate(n);return i}],"-":{type:$e,overloads:[[[$e,$e],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[$e],(n,[e])=>-e.evaluate(n)]]},"/":[$e,[$e,$e],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[$e,[$e,$e],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[$e,[],()=>Math.LN2],pi:[$e,[],()=>Math.PI],e:[$e,[],()=>Math.E],"^":[$e,[$e,$e],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[$e,[$e],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[$e,[$e],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[$e,[$e],(n,[e])=>Math.log(e.evaluate(n))],log2:[$e,[$e],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[$e,[$e],(n,[e])=>Math.sin(e.evaluate(n))],cos:[$e,[$e],(n,[e])=>Math.cos(e.evaluate(n))],tan:[$e,[$e],(n,[e])=>Math.tan(e.evaluate(n))],asin:[$e,[$e],(n,[e])=>Math.asin(e.evaluate(n))],acos:[$e,[$e],(n,[e])=>Math.acos(e.evaluate(n))],atan:[$e,[$e],(n,[e])=>Math.atan(e.evaluate(n))],min:[$e,ts($e),(n,e)=>Math.min(...e.map((i=>i.evaluate(n))))],max:[$e,ts($e),(n,e)=>Math.max(...e.map((i=>i.evaluate(n))))],abs:[$e,[$e],(n,[e])=>Math.abs(e.evaluate(n))],round:[$e,[$e],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[$e,[$e],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[$e,[$e],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Nt,[Rt,Pt],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[Nt,[Pt],(n,[e])=>n.id()===e.value],"filter-type-==":[Nt,[Rt],(n,[e])=>n.geometryType()===e.value],"filter-<":[Nt,[Rt,Pt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o<u}],"filter-id-<":[Nt,[Pt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[Nt,[Rt,Pt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o>u}],"filter-id->":[Nt,[Pt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[Nt,[Rt,Pt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[Nt,[Pt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[Nt,[Rt,Pt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[Nt,[Pt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[Nt,[Pt],(n,[e])=>e.value in n.properties()],"filter-has-id":[Nt,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Nt,[la(Rt)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Nt,[la(Pt)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Nt,[Rt,la(Pt)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Nt,[Rt,la(Pt)],(n,[e,i])=>(function(o,u,d,p){for(;d<=p;){const y=d+p>>1;if(u[y]===o)return!0;u[y]>o?p=y-1:d=y+1}return!1})(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Nt,overloads:[[[Nt,Nt],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[ts(Nt),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Nt,overloads:[[[Nt,Nt],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[ts(Nt),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[Nt,[Nt],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Nt,[Rt],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[Rt,[Rt],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[Rt,[Rt],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[Rt,ts(Pt),(n,e)=>e.map((i=>Js(i.evaluate(n)))).join("")],"resolved-locale":[Rt,[Eo],(n,[e])=>e.evaluate(n).resolvedLocale()]});class wc{constructor(e,i,o){this.expression=e,this._warningHistory={},this._evaluator=new Io,this._defaultValue=i?(function(u){if(u.type==="color"&&vc(u.default))return new Ft(0,0,0,0);switch(u.type){case"color":return Ft.parse(u.default)||null;case"padding":return xn.parse(u.default)||null;case"numberArray":return Vi.parse(u.default)||null;case"colorArray":return wt.parse(u.default)||null;case"variableAnchorOffsetCollection":return rn.parse(u.default)||null;case"projectionDefinition":return Rn.parse(u.default)||null;default:return u.default===void 0?null:u.default}})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this._globalState=o}evaluateWithoutErrorHandling(e,i,o,u,d,p){return this._globalState&&(e=Nn(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,u,d,p){this._globalState&&(e=Nn(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new Ei(`Expected value to be one of ${Object.keys(this._enumValues).map((x=>JSON.stringify(x))).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function uo(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Il}function Ll(n,e,i){const o=new Ro(Il,wa,[],e?(function(d){const p={color:Ga,string:Rt,number:$e,enum:Rt,boolean:Nt,formatted:Yr,padding:Ss,numberArray:Wr,colorArray:$r,projectionDefinition:rc,resolvedImage:an,variableAnchorOffsetCollection:vl};return d.type==="array"?la(p[d.value]||Pt,d.length):p[d.type]})(e):void 0),u=o.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Du(new wc(u,e,i)):oo(o.errors)}class Ta{constructor(e,i,o){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!jo(i.expression),this.globalStateRefs=Ln(i.expression),this._globalState=o}evaluateWithoutErrorHandling(e,i,o,u,d,p){return this._globalState&&(e=Nn(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,i,o,u,d,p)}evaluate(e,i,o,u,d,p){return this._globalState&&(e=Nn(e,this._globalState)),this._styleExpression.evaluate(e,i,o,u,d,p)}}class co{constructor(e,i,o,u,d){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!jo(i.expression),this.globalStateRefs=Ln(i.expression),this.interpolationType=u,this._globalState=d}evaluateWithoutErrorHandling(e,i,o,u,d,p){return this._globalState&&(e=Nn(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,i,o,u,d,p)}evaluate(e,i,o,u,d,p){return this._globalState&&(e=Nn(e,this._globalState)),this._styleExpression.evaluate(e,i,o,u,d,p)}interpolationFactor(e,i,o){return this.interpolationType?ba.interpolationFactor(this.interpolationType,e,i,o):0}}function ho(n,e,i){const o=Ll(n,e,i);if(o.result==="error")return o;const u=o.value.expression,d=Es(u);if(!d&&!dr(e))return oo([new oa("","data expressions not supported")]);const p=Vo(u,["zoom"]);if(!p&&!mh(e))return oo([new oa("","zoom expressions not supported")]);const y=fo(u);return y||p?y instanceof oa?oo([y]):y instanceof ba&&!Rl(e)?oo([new oa("",'"interpolate" expressions cannot be used with this property')]):Du(y?new co(d?"camera":"composite",o.value,y.labels,y instanceof ba?y.interpolation:void 0,i):new Ta(d?"constant":"source",o.value,i)):oo([new oa("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Uo{constructor(e,i){this._parameters=e,this._specification=i,sa(this,xc(this._parameters,this._specification))}static deserialize(e){return new Uo(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function fo(n){let e=null;if(n instanceof xi)e=fo(n.result);else if(n instanceof Bo){for(const i of n.args)if(e=fo(i),e)break}else(n instanceof io||n instanceof ba)&&n.input instanceof Ha&&n.input.name==="zoom"&&(e=n);return e instanceof oa||n.eachChild((i=>{const o=fo(i);o instanceof oa?e=o:!e&&o?e=new oa("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new oa("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function Ln(n,e=new Set){return n instanceof zu&&e.add(n.key),n.eachChild((i=>{Ln(i,e)})),e}function Nn(n,e){const{zoom:i,heatmapDensity:o,elevation:u,lineProgress:d,isSupportedScript:p,accumulated:y}=n??{};return{zoom:i,heatmapDensity:o,elevation:u,lineProgress:d,isSupportedScript:p,accumulated:y,globalState:e}}function is(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!is(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const ns={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function za(n,e){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};is(n)||(n=Go(n));const i=Ll(n,ns,e);if(i.result==="error")throw new Error(i.value.map((o=>`${o.key}: ${o.message}`)).join(", "));return{filter:(o,u,d)=>i.value.evaluate(o,u,{},d),needGeometry:_h(n),getGlobalStateRefs:()=>Ln(i.value.expression)}}function Cs(n,e){return n<e?-1:n>e?1:0}function _h(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(_h(n[e]))return!0;return!1}function Go(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?Bl(n[1],n[2],"=="):e==="!="?Ci(Bl(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Bl(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(Go))):e==="all"?["all"].concat(n.slice(1).map(Go)):e==="none"?["all"].concat(n.slice(1).map(Go).map(Ci)):e==="in"?yh(n[1],n.slice(2)):e==="!in"?Ci(yh(n[1],n.slice(2))):e==="has"?jn(n[1]):e!=="!has"||Ci(jn(n[1]));var i}function Bl(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function yh(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((i=>typeof i!=typeof e[0]))?["filter-in-large",n,["literal",e.sort(Cs)]]:["filter-in-small",n,["literal",e]]}}function jn(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Ci(n){return["!",n]}function $t(n){const e=typeof n;if(e==="number"||e==="boolean"||e==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let u="[";for(const d of n)u+=`${$t(d)},`;return`${u}]`}const i=Object.keys(n).sort();let o="{";for(let u=0;u<i.length;u++)o+=`${JSON.stringify(i[u])}:${$t(n[i[u]])},`;return`${o}}`}function zs(n){let e="";for(const i of pi)e+=`/${$t(n[i])}`;return e}function Wa(n){const e=n.value;return e?[new He(n.key,e,"constants have been deprecated as of v8")]:[]}function Wi(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Da(n){if(Array.isArray(n))return n.map(Da);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=Da(n[i]);return e}return Wi(n)}function Pa(n){const e=n.key,i=n.value,o=n.valueSpec||{},u=n.objectElementValidators||{},d=n.style,p=n.styleSpec,y=n.validateSpec;let x=[];const T=Ot(i);if(T!=="object")return[new He(e,i,`object expected, ${T} found`)];for(const A in i){const C=A.split(".")[0],D=wl(o,C)||o["*"];let P;if(wl(u,C))P=u[C];else if(wl(o,C)){if(i[A]===void 0)continue;P=y}else if(u["*"])P=u["*"];else{if(!o["*"]){x.push(new He(e,i[A],`unknown property "${A}"`));continue}P=y}x=x.concat(P({key:(e&&`${e}.`)+A,value:i[A],valueSpec:D,style:d,styleSpec:p,object:i,objectKey:A,validateSpec:y},i))}for(const A in o)u[A]||o[A].required&&o[A].default===void 0&&i[A]===void 0&&x.push(new He(e,i,`missing required property "${A}"`));return x}function Pu(n){const e=n.value,i=n.valueSpec,o=n.style,u=n.styleSpec,d=n.key,p=n.arrayElementValidator||n.validateSpec;if(Ot(e)!=="array")return[new He(d,e,`array expected, ${Ot(e)} found`)];if(i.length&&e.length!==i.length)return[new He(d,e,`array length ${i.length} expected, length ${e.length} found`)];let y={type:i.value,values:i.values};u.$version<7&&(y.function=i.function),Ot(i.value)==="object"&&(y=i.value);let x=[];for(let T=0;T<e.length;T++)x=x.concat(p({array:e,arrayIndex:T,value:e[T],valueSpec:y,validateSpec:n.validateSpec,style:o,styleSpec:u,key:`${d}[${T}]`}));return x}function as(n){const e=n.key,i=n.value,o=n.valueSpec;let u=Ot(i);return u==="number"&&i!=i&&(u="NaN"),u!=="number"?[new He(e,i,`number expected, ${u} found`)]:"minimum"in o&&i<o.minimum?[new He(e,i,`${i} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&i>o.maximum?[new He(e,i,`${i} is greater than the maximum value ${o.maximum}`)]:[]}function rs(n){const e=n.valueSpec,i=Wi(n.value.type);let o,u,d,p={};const y=i!=="categorical"&&n.value.property===void 0,x=!y,T=Ot(n.value.stops)==="array"&&Ot(n.value.stops[0])==="array"&&Ot(n.value.stops[0][0])==="object",A=Pa({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(P){if(i==="identity")return[new He(P.key,P.value,'identity function may not have a "stops" property')];let B=[];const k=P.value;return B=B.concat(Pu({key:P.key,value:k,valueSpec:P.valueSpec,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec,arrayElementValidator:C})),Ot(k)==="array"&&k.length===0&&B.push(new He(P.key,k,"array must have at least one stop")),B},default:function(P){return P.validateSpec({key:P.key,value:P.value,valueSpec:e,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec})}}});return i==="identity"&&y&&A.push(new He(n.key,n.value,'missing required property "property"')),i==="identity"||n.value.stops||A.push(new He(n.key,n.value,'missing required property "stops"')),i==="exponential"&&n.valueSpec.expression&&!Rl(n.valueSpec)&&A.push(new He(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(x&&!dr(n.valueSpec)?A.push(new He(n.key,n.value,"property functions not supported")):y&&!mh(n.valueSpec)&&A.push(new He(n.key,n.value,"zoom functions not supported"))),i!=="categorical"&&!T||n.value.property!==void 0||A.push(new He(n.key,n.value,'"property" property is required')),A;function C(P){let B=[];const k=P.value,N=P.key;if(Ot(k)!=="array")return[new He(N,k,`array expected, ${Ot(k)} found`)];if(k.length!==2)return[new He(N,k,`array length 2 expected, length ${k.length} found`)];if(T){if(Ot(k[0])!=="object")return[new He(N,k,`object expected, ${Ot(k[0])} found`)];if(k[0].zoom===void 0)return[new He(N,k,"object stop key must have zoom")];if(k[0].value===void 0)return[new He(N,k,"object stop key must have value")];if(d&&d>Wi(k[0].zoom))return[new He(N,k[0].zoom,"stop zoom values must appear in ascending order")];Wi(k[0].zoom)!==d&&(d=Wi(k[0].zoom),u=void 0,p={}),B=B.concat(Pa({key:`${N}[0]`,value:k[0],valueSpec:{zoom:{}},validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec,objectElementValidators:{zoom:as,value:D}}))}else B=B.concat(D({key:`${N}[0]`,value:k[0],validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec},k));return uo(Da(k[1]))?B.concat([new He(`${N}[1]`,k[1],"expressions are not allowed in function stops.")]):B.concat(P.validateSpec({key:`${N}[1]`,value:k[1],valueSpec:e,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec}))}function D(P,B){const k=Ot(P.value),N=Wi(P.value),G=P.value!==null?P.value:B;if(o){if(k!==o)return[new He(P.key,G,`${k} stop domain type must match previous stop domain type ${o}`)]}else o=k;if(k!=="number"&&k!=="string"&&k!=="boolean")return[new He(P.key,G,"stop domain value must be a number, string, or boolean")];if(k!=="number"&&i!=="categorical"){let J=`number expected, ${k} found`;return dr(e)&&i===void 0&&(J+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new He(P.key,G,J)]}return i!=="categorical"||k!=="number"||isFinite(N)&&Math.floor(N)===N?i!=="categorical"&&k==="number"&&u!==void 0&&N<u?[new He(P.key,G,"stop domain values must appear in ascending order")]:(u=N,i==="categorical"&&N in p?[new He(P.key,G,"stop domain values must be unique")]:(p[N]=!0,[])):[new He(P.key,G,`integer expected, found ${N}`)]}}function ss(n){const e=(n.expressionContext==="property"?ho:Ll)(Da(n.value),n.valueSpec);if(e.result==="error")return e.value.map((o=>new He(`${n.key}${o.key}`,n.value,o.message)));const i=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!i.outputDefined())return[new He(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!jo(i))return[new He(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!jo(i))return[new He(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Vo(i,["zoom","feature-state"]))return[new He(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Es(i))return[new He(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ds(n){const e=n.key,i=n.value,o=Ot(i);return o!=="string"?[new He(e,i,`color expected, ${o} found`)]:Ft.parse(String(i))?[]:[new He(e,i,`color expected, "${i}" found`)]}function Ps(n){const e=n.key,i=n.value,o=n.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(Wi(i))===-1&&u.push(new He(e,i,`expected one of [${o.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(o.values).indexOf(Wi(i))===-1&&u.push(new He(e,i,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(i)} found`)),u}function fr(n){return is(Da(n.value))?ss(sa({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):os(n)}function os(n){const e=n.value,i=n.key;if(Ot(e)!=="array")return[new He(i,e,`array expected, ${Ot(e)} found`)];const o=n.styleSpec;let u,d=[];if(e.length<1)return[new He(i,e,"filter array must have at least 1 element")];switch(d=d.concat(Ps({key:`${i}[0]`,value:e[0],valueSpec:o.filter_operator,style:n.style,styleSpec:n.styleSpec})),Wi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Wi(e[1])==="$type"&&d.push(new He(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&d.push(new He(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=Ot(e[1]),u!=="string"&&d.push(new He(`${i}[1]`,e[1],`string expected, ${u} found`)));for(let p=2;p<e.length;p++)u=Ot(e[p]),Wi(e[1])==="$type"?d=d.concat(Ps({key:`${i}[${p}]`,value:e[p],valueSpec:o.geometry_type,style:n.style,styleSpec:n.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&d.push(new He(`${i}[${p}]`,e[p],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)d=d.concat(os({key:`${i}[${p}]`,value:e[p],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":u=Ot(e[1]),e.length!==2?d.push(new He(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&d.push(new He(`${i}[1]`,e[1],`string expected, ${u} found`))}return d}function Is(n,e){const i=n.key,o=n.validateSpec,u=n.style,d=n.styleSpec,p=n.value,y=n.objectKey,x=d[`${e}_${n.layerType}`];if(!x)return[];const T=y.match(/^(.*)-transition$/);if(e==="paint"&&T&&x[T[1]]&&x[T[1]].transition)return o({key:i,value:p,valueSpec:d.transition,style:u,styleSpec:d});const A=n.valueSpec||x[y];if(!A)return[new He(i,p,`unknown property "${y}"`)];let C;if(Ot(p)==="string"&&dr(A)&&!A.tokens&&(C=/^{([^}]+)}$/.exec(p)))return[new He(i,p,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(C[1])} }\`.`)];const D=[];return n.layerType==="symbol"&&y==="text-font"&&vc(Da(p))&&Wi(p.type)==="identity"&&D.push(new He(i,p,'"text-font" does not support identity functions')),D.concat(o({key:n.key,value:p,valueSpec:A,style:u,styleSpec:d,expressionContext:"property",propertyType:e,propertyKey:y}))}function ls(n){return Is(n,"paint")}function Tc(n){return Is(n,"layout")}function Sc(n){let e=[];const i=n.value,o=n.key,u=n.style,d=n.styleSpec;if(Ot(i)!=="object")return[new He(o,i,`object expected, ${Ot(i)} found`)];i.type||i.ref||e.push(new He(o,i,'either "type" or "ref" is required'));let p=Wi(i.type);const y=Wi(i.ref);if(i.id){const x=Wi(i.id);for(let T=0;T<n.arrayIndex;T++){const A=u.layers[T];Wi(A.id)===x&&e.push(new He(o,i.id,`duplicate layer id "${i.id}", previously used at line ${A.id.__line__}`))}}if("ref"in i){let x;["type","source","source-layer","filter","layout"].forEach((T=>{T in i&&e.push(new He(o,i[T],`"${T}" is prohibited for ref layers`))})),u.layers.forEach((T=>{Wi(T.id)===y&&(x=T)})),x?x.ref?e.push(new He(o,i.ref,"ref cannot reference another ref layer")):p=Wi(x.type):e.push(new He(o,i.ref,`ref layer "${y}" not found`))}else if(p!=="background")if(i.source){const x=u.sources&&u.sources[i.source],T=x&&Wi(x.type);x?T==="vector"&&p==="raster"?e.push(new He(o,i.source,`layer "${i.id}" requires a raster source`)):T!=="raster-dem"&&p==="hillshade"||T!=="raster-dem"&&p==="color-relief"?e.push(new He(o,i.source,`layer "${i.id}" requires a raster-dem source`)):T==="raster"&&p!=="raster"?e.push(new He(o,i.source,`layer "${i.id}" requires a vector source`)):T!=="vector"||i["source-layer"]?T==="raster-dem"&&p!=="hillshade"&&p!=="color-relief"?e.push(new He(o,i.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):p!=="line"||!i.paint||!i.paint["line-gradient"]||T==="geojson"&&x.lineMetrics||e.push(new He(o,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new He(o,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new He(o,i.source,`source "${i.source}" not found`))}else e.push(new He(o,i,'missing required property "source"'));return e=e.concat(Pa({key:o,value:i,valueSpec:d.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${o}.type`,value:i.type,valueSpec:d.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:i,objectKey:"type"}),filter:fr,layout:x=>Pa({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>Tc(sa({layerType:p},T))}}),paint:x=>Pa({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>ls(sa({layerType:p},T))}})}})),e}function Qa(n){const e=n.value,i=n.key,o=Ot(e);return o!=="string"?[new He(i,e,`string expected, ${o} found`)]:[]}const kl={promoteId:function({key:n,value:e}){if(Ot(e)==="string")return Qa({key:n,value:e});{const i=[];for(const o in e)i.push(...Qa({key:`${n}.${o}`,value:e[o]}));return i}}};function Rs(n){const e=n.value,i=n.key,o=n.styleSpec,u=n.style,d=n.validateSpec;if(!e.type)return[new He(i,e,'"type" is required')];const p=Wi(e.type);let y;switch(p){case"vector":case"raster":return y=Pa({key:i,value:e,valueSpec:o[`source_${p.replace("-","_")}`],style:n.style,styleSpec:o,objectElementValidators:kl,validateSpec:d}),y;case"raster-dem":return y=(function(x){var T;const A=(T=x.sourceName)!==null&&T!==void 0?T:"",C=x.value,D=x.styleSpec,P=D.source_raster_dem,B=x.style;let k=[];const N=Ot(C);if(C===void 0)return k;if(N!=="object")return k.push(new He("source_raster_dem",C,`object expected, ${N} found`)),k;const G=Wi(C.encoding)==="custom",J=["redFactor","greenFactor","blueFactor","baseShift"],q=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const X in C)!G&&J.includes(X)?k.push(new He(X,C[X],`In "${A}": "${X}" is only valid when "encoding" is set to "custom". ${q} encoding found`)):P[X]?k=k.concat(x.validateSpec({key:X,value:C[X],valueSpec:P[X],validateSpec:x.validateSpec,style:B,styleSpec:D})):k.push(new He(X,C[X],`unknown property "${X}"`));return k})({sourceName:i,value:e,style:n.style,styleSpec:o,validateSpec:d}),y;case"geojson":if(y=Pa({key:i,value:e,valueSpec:o.source_geojson,style:u,styleSpec:o,validateSpec:d,objectElementValidators:kl}),e.cluster)for(const x in e.clusterProperties){const[T,A]=e.clusterProperties[x],C=typeof T=="string"?[T,["accumulated"],["get",x]]:T;y.push(...ss({key:`${i}.${x}.map`,value:A,expressionContext:"cluster-map"})),y.push(...ss({key:`${i}.${x}.reduce`,value:C,expressionContext:"cluster-reduce"}))}return y;case"video":return Pa({key:i,value:e,valueSpec:o.source_video,style:u,validateSpec:d,styleSpec:o});case"image":return Pa({key:i,value:e,valueSpec:o.source_image,style:u,validateSpec:d,styleSpec:o});case"canvas":return[new He(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ps({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function bn(n){const e=n.value,i=n.styleSpec,o=i.light,u=n.style;let d=[];const p=Ot(e);if(e===void 0)return d;if(p!=="object")return d=d.concat([new He("light",e,`object expected, ${p} found`)]),d;for(const y in e){const x=y.match(/^(.*)-transition$/);d=d.concat(x&&o[x[1]]&&o[x[1]].transition?n.validateSpec({key:y,value:e[y],valueSpec:i.transition,validateSpec:n.validateSpec,style:u,styleSpec:i}):o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],validateSpec:n.validateSpec,style:u,styleSpec:i}):[new He(y,e[y],`unknown property "${y}"`)])}return d}function Iu(n){const e=n.value,i=n.styleSpec,o=i.sky,u=n.style,d=Ot(e);if(e===void 0)return[];if(d!=="object")return[new He("sky",e,`object expected, ${d} found`)];let p=[];for(const y in e)p=p.concat(o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],style:u,styleSpec:i}):[new He(y,e[y],`unknown property "${y}"`)]);return p}function Mc(n){const e=n.value,i=n.styleSpec,o=i.terrain,u=n.style;let d=[];const p=Ot(e);if(e===void 0)return d;if(p!=="object")return d=d.concat([new He("terrain",e,`object expected, ${p} found`)]),d;for(const y in e)d=d.concat(o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],validateSpec:n.validateSpec,style:u,styleSpec:i}):[new He(y,e[y],`unknown property "${y}"`)]);return d}function vh(n){let e=[];const i=n.value,o=n.key;if(Array.isArray(i)){const u=[],d=[];for(const p in i)i[p].id&&u.includes(i[p].id)&&e.push(new He(o,i,`all the sprites' ids must be unique, but ${i[p].id} is duplicated`)),u.push(i[p].id),i[p].url&&d.includes(i[p].url)&&e.push(new He(o,i,`all the sprites' URLs must be unique, but ${i[p].url} is duplicated`)),d.push(i[p].url),e=e.concat(Pa({key:`${o}[${p}]`,value:i[p],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return e}return Qa({key:o,value:i})}function Pd(n){return!!n&&n.constructor===Object}function xh(n){return Pd(n.value)?[]:[new He(n.key,n.value,`object expected, ${Ot(n.value)} found`)]}const pn={"*":()=>[],array:Pu,boolean:function(n){const e=n.value,i=n.key,o=Ot(e);return o!=="boolean"?[new He(i,e,`boolean expected, ${o} found`)]:[]},number:as,color:Ds,constants:Wa,enum:Ps,filter:fr,function:rs,layer:Sc,object:Pa,source:Rs,light:bn,sky:Iu,terrain:Mc,projection:function(n){const e=n.value,i=n.styleSpec,o=i.projection,u=n.style,d=Ot(e);if(e===void 0)return[];if(d!=="object")return[new He("projection",e,`object expected, ${d} found`)];let p=[];for(const y in e)p=p.concat(o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],style:u,styleSpec:i}):[new He(y,e[y],`unknown property "${y}"`)]);return p},projectionDefinition:function(n){const e=n.key;let i=n.value;i=i instanceof String?i.valueOf():i;const o=Ot(i);return o!=="array"||(function(u){return Array.isArray(u)&&u.length===3&&typeof u[0]=="string"&&typeof u[1]=="string"&&typeof u[2]=="number"})(i)||(function(u){return!!["interpolate","step","literal"].includes(u[0])})(i)?["array","string"].includes(o)?[]:[new He(e,i,`projection expected, invalid type "${o}" found`)]:[new He(e,i,`projection expected, invalid array ${JSON.stringify(i)} found`)]},string:Qa,formatted:function(n){return Qa(n).length===0?[]:ss(n)},resolvedImage:function(n){return Qa(n).length===0?[]:ss(n)},padding:function(n){const e=n.key,i=n.value;if(Ot(i)==="array"){if(i.length<1||i.length>4)return[new He(e,i,`padding requires 1 to 4 values; ${i.length} values found`)];const o={type:"number"};let u=[];for(let d=0;d<i.length;d++)u=u.concat(n.validateSpec({key:`${e}[${d}]`,value:i[d],validateSpec:n.validateSpec,valueSpec:o}));return u}return as({key:e,value:i,valueSpec:{}})},numberArray:function(n){const e=n.key,i=n.value;if(Ot(i)==="array"){const o={type:"number"};if(i.length<1)return[new He(e,i,"array length at least 1 expected, length 0 found")];let u=[];for(let d=0;d<i.length;d++)u=u.concat(n.validateSpec({key:`${e}[${d}]`,value:i[d],validateSpec:n.validateSpec,valueSpec:o}));return u}return as({key:e,value:i,valueSpec:{}})},colorArray:function(n){const e=n.key,i=n.value;if(Ot(i)==="array"){if(i.length<1)return[new He(e,i,"array length at least 1 expected, length 0 found")];let o=[];for(let u=0;u<i.length;u++)o=o.concat(Ds({key:`${e}[${u}]`,value:i[u]}));return o}return Ds({key:e,value:i})},variableAnchorOffsetCollection:function(n){const e=n.key,i=n.value,o=Ot(i),u=n.styleSpec;if(o!=="array"||i.length<1||i.length%2!=0)return[new He(e,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let d=[];for(let p=0;p<i.length;p+=2)d=d.concat(Ps({key:`${e}[${p}]`,value:i[p],valueSpec:u.layout_symbol["text-anchor"]})),d=d.concat(Pu({key:`${e}[${p+1}]`,value:i[p+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:u}));return d},sprite:vh,state:xh,fontFaces:function(n){const e=n.key,i=n.value,o=n.validateSpec,u=n.styleSpec,d=n.style;if(!Pd(i))return[new He(e,i,`object expected, ${Ot(i)} found`)];const p=[];for(const y in i){const x=i[y],T=Ot(x);if(T==="string")p.push(...Qa({key:`${e}.${y}`,value:x}));else if(T==="array"){const A={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[C,D]of x.entries())p.push(...Pa({key:`${e}.${y}[${C}]`,value:D,valueSpec:A,styleSpec:u,style:d,validateSpec:o}))}else p.push(new He(`${e}.${y}`,x,`string or array expected, ${T} found`))}return p}};function us(n){const e=n.value,i=n.valueSpec,o=n.styleSpec;return n.validateSpec=us,i.expression&&vc(Wi(e))?rs(n):i.expression&&uo(Da(e))?ss(n):i.type&&pn[i.type]?pn[i.type](n):Pa(sa({},n,{valueSpec:i.type?o[i.type]:i}))}function Ol(n){const e=n.value,i=n.key,o=Qa(n);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new He(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new He(i,e,'"glyphs" url must include a "{range}" token'))),o}function ua(n,e=ge){let i=[];return i=i.concat(us({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,validateSpec:us,objectElementValidators:{glyphs:Ol,"*":()=>[]}})),n.constants&&(i=i.concat(Wa({key:"constants",value:n.constants}))),qo(i)}function Ka(n){return function(e){return n(Object.assign({},e,{validateSpec:us}))}}function qo(n){return[].concat(n).sort(((e,i)=>e.line-i.line))}function ca(n){return function(...e){return qo(n.apply(this,e))}}ua.source=ca(Ka(Rs)),ua.sprite=ca(Ka(vh)),ua.glyphs=ca(Ka(Ol)),ua.light=ca(Ka(bn)),ua.sky=ca(Ka(Iu)),ua.terrain=ca(Ka(Mc)),ua.state=ca(Ka(xh)),ua.layer=ca(Ka(Sc)),ua.filter=ca(Ka(fr)),ua.paintProperty=ca(Ka(ls)),ua.layoutProperty=ca(Ka(Tc));const Nf={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class Fl{constructor(e,i){this._globalState=i,this.setValue(e)}evaluate(){var e;return(e=this._literalValue)!==null&&e!==void 0?e:this._compiledValue.evaluate({})}setValue(e){if(e==null||e==="visible"||e==="none")return this._literalValue=e==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const i=Ll(e,Nf,this._globalState);if(i.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(i.value.map((o=>`${o.key}: ${o.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=i.value,this._globalStateRefs=Ln(i.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const Ru=ge,Bn=ua,Ir=Bn.light,Ac=Bn.sky,Ec=Bn.paintProperty,Id=Bn.layoutProperty;function Rr(n,e){let i=!1;if(e&&e.length)for(const o of e)n.fire(new ui(new Error(o.message))),i=!0;return i}class po{constructor(e,i,o){const u=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const p=new Int32Array(this.arrayBuffer);e=p[0],this.d=(i=p[1])+2*(o=p[2]);for(let x=0;x<this.d*this.d;x++){const T=p[3+x],A=p[3+x+1];u.push(T===A?null:p.subarray(T,A))}const y=p[3+u.length+1];this.keys=p.subarray(p[3+u.length],y),this.bboxes=p.subarray(y),this.insert=this._insertReadonly}else{this.d=i+2*o;for(let p=0;p<this.d*this.d;p++)u.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=e,this.padding=o,this.scale=i/e,this.uid=0;const d=o/i*e;this.min=-d,this.max=e+d}insert(e,i,o,u,d){this._forEachCell(i,o,u,d,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(d)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,i,o,u,d,p){this.cells[d].push(p)}query(e,i,o,u,d){const p=this.min,y=this.max;if(e<=p&&i<=p&&y<=o&&y<=u&&!d)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(e,i,o,u,this._queryCell,x,{},d),x}}_queryCell(e,i,o,u,d,p,y,x){const T=this.cells[d];if(T!==null){const A=this.keys,C=this.bboxes;for(let D=0;D<T.length;D++){const P=T[D];if(y[P]===void 0){const B=4*P;(x?x(C[B+0],C[B+1],C[B+2],C[B+3]):e<=C[B+2]&&i<=C[B+3]&&o>=C[B+0]&&u>=C[B+1])?(y[P]=!0,p.push(A[P])):y[P]=!1}}}}_forEachCell(e,i,o,u,d,p,y,x){const T=this._convertToCellCoord(e),A=this._convertToCellCoord(i),C=this._convertToCellCoord(o),D=this._convertToCellCoord(u);for(let P=T;P<=C;P++)for(let B=A;B<=D;B++){const k=this.d*B+P;if((!x||x(this._convertFromCellCoord(P),this._convertFromCellCoord(B),this._convertFromCellCoord(P+1),this._convertFromCellCoord(B+1)))&&d.call(this,e,i,o,u,k,p,y,x))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,i=3+this.cells.length+1+1;let o=0;for(let p=0;p<this.cells.length;p++)o+=this.cells[p].length;const u=new Int32Array(i+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let d=i;for(let p=0;p<e.length;p++){const y=e[p];u[3+p]=d,u.set(y,d),d+=y.length}return u[3+e.length]=d,u.set(this.keys,d),d+=this.keys.length,u[3+e.length+1]=d,u.set(this.bboxes,d),d+=this.bboxes.length,u.buffer}static serialize(e,i){const o=e.toArrayBuffer();return i&&i.push(o),{buffer:o}}static deserialize(e){return new po(e.buffer)}}const Ia={};function tt(n,e,i={}){if(Ia[n])throw new Error(`${n} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:n,writeable:!1}),Ia[n]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}tt("Object",Object),tt("Set",Set),tt("TransferableGridIndex",po),tt("Color",Ft),tt("Error",Error),tt("AJAXError",ue),tt("ResolvedImage",ya),tt("StylePropertyFunction",Uo),tt("StyleExpression",wc,{omit:["_evaluator"]}),tt("ZoomDependentExpression",co),tt("ZoomConstantExpression",Ta),tt("CompoundExpression",Ha,{omit:["_evaluate"]});for(const n in Il)Il[n]._classRegistryKey||tt(`Expression_${n}`,Il[n]);function Lu(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Cc(n){return n.$name||n.constructor._classRegistryKey}function pr(n){return!(function(e){if(e===null||typeof e!="object")return!1;const i=Cc(e);return!(!i||i==="Object")})(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||Lu(n)||ws(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function Lr(n,e){if(pr(n))return(Lu(n)||ws(n))&&e&&e.push(n),ArrayBuffer.isView(n)&&e&&e.push(n.buffer),n instanceof ImageData&&e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const d=[];for(const p of n)d.push(Lr(p,e));return d}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const i=Cc(n);if(!i)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!Ia[i])throw new Error(`${i} is not registered.`);const{klass:o}=Ia[i],u=o.serialize?o.serialize(n,e):{};if(o.serialize){if(e&&u===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const d in n){if(!n.hasOwnProperty(d)||Ia[i].omit.indexOf(d)>=0)continue;const p=n[d];u[d]=Ia[i].shallow.indexOf(d)>=0?p:Lr(p,e)}n instanceof Error&&(u.message=n.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(u.$name=i),u}function Nl(n){if(pr(n))return n;if(Array.isArray(n))return n.map(Nl);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const e=Cc(n)||"Object";if(!Ia[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:i}=Ia[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(n);const o=Object.create(i.prototype);for(const u of Object.keys(n)){if(u==="$name")continue;const d=n[u];o[u]=Ia[e].shallow.indexOf(u)>=0?d:Nl(d)}return o}class zc{constructor(){this.first=!0}update(e,i){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}function cs(n){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))}function Zo(n){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))}function Bu(n){return/\s/u.test(String.fromCodePoint(n))}function hs(n){for(const e of n)if(Zo(e.codePointAt(0)))return!0;return!1}function Dc(n){for(const e of n)if(!bh(e.codePointAt(0)))return!1;return!0}function ku(n){const e=n.map((i=>{try{return new RegExp(`\\p{sc=${i}}`,"u").source}catch{return null}})).filter((i=>i));return new RegExp(e.join("|"),"u")}const ds=ku(["Arab","Dupl","Mong","Ougr","Syrc"]);function bh(n){return!ds.test(String.fromCodePoint(n))}function fs(n){return!(Zo(n)||(e=n,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const Pc=ku(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Ou(n){return Pc.test(String.fromCodePoint(n))}function ps(n,e){return!(!e&&Ou(n)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(n)))}function Ls(n){for(const e of n)if(Ou(e.codePointAt(0)))return!0;return!1}const mr=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(mr.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,e){return f(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;const i=n.pluginURL,o=new Promise((d=>{this.loadScriptResolve=d}));e(i);const u=new Promise((d=>setTimeout((()=>d()),this.TIMEOUT)));if(yield Promise.race([o,u]),this.isParsed()){const d={pluginStatus:"loaded",pluginURL:i};return this.setState(d),d}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${i}`)}))}};class gi{constructor(e,i){this.isSupportedScript=wh,this.zoom=e,i?(this.now=i.now||0,this.fadeDuration=i.fadeDuration||0,this.zoomHistory=i.zoomHistory||new zc,this.transition=i.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new zc,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*i}}}function wh(n){return(function(e,i){for(const o of e)if(!ps(o.codePointAt(0),i))return!1;return!0})(n,mr.getRTLTextPluginStatus()==="loaded")}const Bs="-transition";class mo{constructor(e,i,o){this.property=e,this.value=i,this.expression=(function(u,d,p){if(vc(u))return new Uo(u,d);if(uo(u)){const y=ho(u,d,p);if(y.result==="error")throw new Error(y.value.map((x=>`${x.key}: ${x.message}`)).join(", "));return y.value}{let y=u;return d.type==="color"&&typeof u=="string"?y=Ft.parse(u):d.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?d.type!=="numberArray"||typeof u!="number"&&!Array.isArray(u)?d.type!=="colorArray"||typeof u!="string"&&!Array.isArray(u)?d.type==="variableAnchorOffsetCollection"&&Array.isArray(u)?y=rn.parse(u):d.type==="projectionDefinition"&&typeof u=="string"&&(y=Rn.parse(u)):y=wt.parse(u):y=Vi.parse(u):y=xn.parse(u),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>y}}})(i===void 0?e.specification.default:i,e.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class Fu{constructor(e,i){this.property=e,this.value=new mo(e,void 0,i)}transitioned(e,i){return new Ho(this.property,this.value,i,Mi({},e.transition,this.transition),e.now)}untransitioned(){return new Ho(this.property,this.value,null,{},0)}}class Ic{constructor(e,i){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=i}getValue(e){return Ua(this._values[e].value.value)}setValue(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Fu(this._values[e].property,this._globalState)),this._values[e].value=new mo(this._values[e].property,i===null?void 0:Ua(i),this._globalState)}getTransition(e){return Ua(this._values[e].transition)}setTransition(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Fu(this._values[e].property,this._globalState)),this._values[e].transition=Ua(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const u=this.getTransition(i);u!==void 0&&(e[`${i}${Bs}`]=u)}return e}transitioned(e,i){const o=new Nu(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(e,i._values[u]);return o}untransitioned(){const e=new Nu(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Ho{constructor(e,i,o,u,d){this.property=e,this.value=i,this.begin=d+u.delay||0,this.end=this.begin+u.duration||0,e.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const u=e.now||0,d=this.value.possiblyEvaluate(e,i,o),p=this.prior;if(p){if(u>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(u<this.begin)return p.possiblyEvaluate(e,i,o);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,i,o),d,st(y))}}return d}}class Nu{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const u=new Xo(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,i,o);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Th{constructor(e,i){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=i}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Ua(this._values[e].value)}setValue(e,i){this._values[e]=new mo(this._values[e].property,i===null?void 0:Ua(i),this._globalState)}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const u=new Xo(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,i,o);return u}}class Ja{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,u){return this.property.evaluate(this.value,this.parameters,e,i,o,u)}}class Xo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class at{constructor(e){this.specification=e}possiblyEvaluate(e,i){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(i)}interpolate(e,i,o){const u=Gi[this.specification.type];return u?u(e,i,o):e}}class lt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,u){return new Ja(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,u)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Ja(this,{kind:"constant",value:void 0},e.parameters);const u=Gi[this.specification.type];if(u){const d=u(e.value.value,i.value.value,o);return new Ja(this,{kind:"constant",value:d},e.parameters)}return e}evaluate(e,i,o,u,d,p){return e.kind==="constant"?e.value:e.evaluate(i,o,u,d,p)}}class gr extends lt{possiblyEvaluate(e,i,o,u){if(e.value===void 0)return new Ja(this,{kind:"constant",value:void 0},i);if(e.expression.kind==="constant"){const d=e.expression.evaluate(i,null,{},o,u),p=e.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,y=this._calculate(p,p,p,i);return new Ja(this,{kind:"constant",value:y},i)}if(e.expression.kind==="camera"){const d=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new Ja(this,{kind:"constant",value:d},i)}return new Ja(this,e.expression,i)}evaluate(e,i,o,u,d,p){if(e.kind==="source"){const y=e.evaluate(i,o,u,d,p);return this._calculate(y,y,y,i)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},o,u),e.evaluate({zoom:Math.floor(i.zoom)},o,u),e.evaluate({zoom:Math.floor(i.zoom)+1},o,u),i):e.value}_calculate(e,i,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class jl{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,u){if(e.value!==void 0){if(e.expression.kind==="constant"){const d=e.expression.evaluate(i,null,{},o,u);return this._calculate(d,d,d,i)}return this._calculate(e.expression.evaluate(new gi(Math.floor(i.zoom-1),i)),e.expression.evaluate(new gi(Math.floor(i.zoom),i)),e.expression.evaluate(new gi(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class ju{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,u){return!!e.expression.evaluate(i,null,{},o,u)}interpolate(){return!1}}class mn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in e){const o=e[i];o.specification.overridable&&this.overridableProperties.push(i);const u=this.defaultPropertyValues[i]=new mo(o,void 0,void 0),d=this.defaultTransitionablePropertyValues[i]=new Fu(o,void 0);this.defaultTransitioningPropertyValues[i]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=u.possiblyEvaluate({})}}}tt("DataDrivenProperty",lt),tt("DataConstantProperty",at),tt("CrossFadedDataDrivenProperty",gr),tt("CrossFadedProperty",jl),tt("ColorRampProperty",ju);class Qi extends Qt{constructor(e,i,o){if(super(),this.id=e.id,this.type=e.type,this._globalState=o,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this._visibilityExpression=(function(u,d){return new Fl(u,d)})(this.visibility,o),e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=za(e.filter,o)),i.layout&&(this._unevaluatedLayout=new Th(i.layout,o)),i.paint)){this._transitionablePaint=new Ic(i.paint,o);for(const u in e.paint)this.setPaintProperty(u,e.paint[u],{validate:!1});for(const u in e.layout)this.setLayoutProperty(u,e.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Xo(i.paint)}}setFilter(e){this.filter=e,this._featureFilter=za(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;for(const i of this._visibilityExpression.getGlobalStateRefs())e.add(i);if(this._unevaluatedLayout)for(const i in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[i];for(const u of o.getGlobalStateRefs())e.add(u)}for(const i of this._featureFilter.getGlobalStateRefs())e.add(i);return e}getPaintAffectingGlobalStateRefs(){var e;const i=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const u=this._transitionablePaint._values[o].value;for(const d of u.getGlobalStateRefs()){const p=(e=i.get(d))!==null&&e!==void 0?e:[];p.push({name:o,value:u.value}),i.set(d,p)}}return i}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(e,i,o={}){if(i==null||!this._validate(Id,`layers.${this.id}.layout.${e}`,e,i,o))return e==="visibility"?(this.visibility=i,this._visibilityExpression.setValue(i),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(e,i)}getPaintProperty(e){return e.endsWith(Bs)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,o={}){if(i!=null&&this._validate(Ec,`layers.${this.id}.paint.${e}`,e,i,o))return!1;if(e.endsWith(Bs))return this._transitionablePaint.setTransition(e.slice(0,-11),i||void 0),!1;{const u=this._transitionablePaint._values[e],d=u.property.specification["property-type"]==="cross-faded-data-driven",p=u.value.isDataDriven(),y=u.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value;return x.isDataDriven()||p||d||this._handleOverridablePaintPropertyUpdate(e,y,x)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e=this.minzoom,i=!1){return!!(this.minzoom&&e<(i?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Ys(e,((i,o)=>!(i===void 0||o==="layout"&&!Object.keys(i).length||o==="paint"&&!Object.keys(i).length)))}_validate(e,i,o,u,d={}){return(!d||d.validate!==!1)&&Rr(this,e.call(Bn,{key:i,layerType:this.type,objectKey:o,value:u,styleSpec:ge,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Ja&&dr(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}let on;var Vu={get paint(){return on=on||new mn({"raster-opacity":new at(ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new at(ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new at(ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new at(ge.paint_raster["raster-brightness-max"]),"raster-saturation":new at(ge.paint_raster["raster-saturation"]),"raster-contrast":new at(ge.paint_raster["raster-contrast"]),"raster-resampling":new at(ge.paint_raster["raster-resampling"]),"raster-fade-duration":new at(ge.paint_raster["raster-fade-duration"])})}};class ks extends Qi{constructor(e,i){super(e,Vu,i)}}const Vt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ci{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class jt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function qi(n,e=1){let i=0,o=0;return{members:n.map((u=>{const d=Vt[u.type].BYTES_PER_ELEMENT,p=i=_r(i,Math.max(e,d)),y=u.components||1;return o=Math.max(o,d),i+=d*y,{name:u.name,type:u.type,components:y,offset:p}})),size:_r(i,Math.max(o,e)),alignment:e}}function _r(n,e){return Math.ceil(n/e)*e}class Br extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=o,e}}Br.prototype.bytesPerElement=4,tt("StructArrayLayout2i4",Br);class Yo extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const d=3*e;return this.int16[d+0]=i,this.int16[d+1]=o,this.int16[d+2]=u,e}}Yo.prototype.bytesPerElement=6,tt("StructArrayLayout3i6",Yo);class $o extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,u)}emplace(e,i,o,u,d){const p=4*e;return this.int16[p+0]=i,this.int16[p+1]=o,this.int16[p+2]=u,this.int16[p+3]=d,e}}$o.prototype.bytesPerElement=8,tt("StructArrayLayout4i8",$o);class Os extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,d,p)}emplace(e,i,o,u,d,p,y){const x=6*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=d,this.int16[x+4]=p,this.int16[x+5]=y,e}}Os.prototype.bytesPerElement=12,tt("StructArrayLayout2i4i12",Os);class Sh extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,d,p)}emplace(e,i,o,u,d,p,y){const x=4*e,T=8*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.uint8[T+4]=u,this.uint8[T+5]=d,this.uint8[T+6]=p,this.uint8[T+7]=y,e}}Sh.prototype.bytesPerElement=8,tt("StructArrayLayout2i4ub8",Sh);class Fi extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=o,e}}Fi.prototype.bytesPerElement=8,tt("StructArrayLayout2f8",Fi);class kr extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,d,p,y,x,T,A){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,o,u,d,p,y,x,T,A)}emplace(e,i,o,u,d,p,y,x,T,A,C){const D=10*e;return this.uint16[D+0]=i,this.uint16[D+1]=o,this.uint16[D+2]=u,this.uint16[D+3]=d,this.uint16[D+4]=p,this.uint16[D+5]=y,this.uint16[D+6]=x,this.uint16[D+7]=T,this.uint16[D+8]=A,this.uint16[D+9]=C,e}}kr.prototype.bytesPerElement=20,tt("StructArrayLayout10ui20",kr);class Vl extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,d,p,y,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,o,u,d,p,y,x)}emplace(e,i,o,u,d,p,y,x,T){const A=8*e;return this.uint16[A+0]=i,this.uint16[A+1]=o,this.uint16[A+2]=u,this.uint16[A+3]=d,this.uint16[A+4]=p,this.uint16[A+5]=y,this.uint16[A+6]=x,this.uint16[A+7]=T,e}}Vl.prototype.bytesPerElement=16,tt("StructArrayLayout8ui16",Vl);class Ul extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,d,p,y,x,T,A,C,D){const P=this.length;return this.resize(P+1),this.emplace(P,e,i,o,u,d,p,y,x,T,A,C,D)}emplace(e,i,o,u,d,p,y,x,T,A,C,D,P){const B=12*e;return this.int16[B+0]=i,this.int16[B+1]=o,this.int16[B+2]=u,this.int16[B+3]=d,this.uint16[B+4]=p,this.uint16[B+5]=y,this.uint16[B+6]=x,this.uint16[B+7]=T,this.int16[B+8]=A,this.int16[B+9]=C,this.int16[B+10]=D,this.int16[B+11]=P,e}}Ul.prototype.bytesPerElement=24,tt("StructArrayLayout4i4ui4i24",Ul);class Uu extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const d=3*e;return this.float32[d+0]=i,this.float32[d+1]=o,this.float32[d+2]=u,e}}Uu.prototype.bytesPerElement=12,tt("StructArrayLayout3f12",Uu);class Gu extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Gu.prototype.bytesPerElement=4,tt("StructArrayLayout1ul4",Gu);class qu extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,d,p,y,x,T){const A=this.length;return this.resize(A+1),this.emplace(A,e,i,o,u,d,p,y,x,T)}emplace(e,i,o,u,d,p,y,x,T,A){const C=10*e,D=5*e;return this.int16[C+0]=i,this.int16[C+1]=o,this.int16[C+2]=u,this.int16[C+3]=d,this.int16[C+4]=p,this.int16[C+5]=y,this.uint32[D+3]=x,this.uint16[C+8]=T,this.uint16[C+9]=A,e}}qu.prototype.bytesPerElement=20,tt("StructArrayLayout6i1ul2ui20",qu);class go extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,d,p)}emplace(e,i,o,u,d,p,y){const x=6*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=d,this.int16[x+4]=p,this.int16[x+5]=y,e}}go.prototype.bytesPerElement=12,tt("StructArrayLayout2i2i2i12",go);class Fs extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,o,u,d)}emplace(e,i,o,u,d,p){const y=4*e,x=8*e;return this.float32[y+0]=i,this.float32[y+1]=o,this.float32[y+2]=u,this.int16[x+6]=d,this.int16[x+7]=p,e}}Fs.prototype.bytesPerElement=16,tt("StructArrayLayout2f1f2i16",Fs);class ea extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,d,p)}emplace(e,i,o,u,d,p,y){const x=16*e,T=4*e,A=8*e;return this.uint8[x+0]=i,this.uint8[x+1]=o,this.float32[T+1]=u,this.float32[T+2]=d,this.int16[A+6]=p,this.int16[A+7]=y,e}}ea.prototype.bytesPerElement=16,tt("StructArrayLayout2ub2f2i16",ea);class Zi extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const d=3*e;return this.uint16[d+0]=i,this.uint16[d+1]=o,this.uint16[d+2]=u,e}}Zi.prototype.bytesPerElement=6,tt("StructArrayLayout3ui6",Zi);class ms extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,d,p,y,x,T,A,C,D,P,B,k,N,G){const J=this.length;return this.resize(J+1),this.emplace(J,e,i,o,u,d,p,y,x,T,A,C,D,P,B,k,N,G)}emplace(e,i,o,u,d,p,y,x,T,A,C,D,P,B,k,N,G,J){const q=24*e,X=12*e,te=48*e;return this.int16[q+0]=i,this.int16[q+1]=o,this.uint16[q+2]=u,this.uint16[q+3]=d,this.uint32[X+2]=p,this.uint32[X+3]=y,this.uint32[X+4]=x,this.uint16[q+10]=T,this.uint16[q+11]=A,this.uint16[q+12]=C,this.float32[X+7]=D,this.float32[X+8]=P,this.uint8[te+36]=B,this.uint8[te+37]=k,this.uint8[te+38]=N,this.uint32[X+10]=G,this.int16[q+22]=J,e}}ms.prototype.bytesPerElement=48,tt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ms);class Wo extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,d,p,y,x,T,A,C,D,P,B,k,N,G,J,q,X,te,ae,ye,Le,Pe,je,Qe,Ue){const Re=this.length;return this.resize(Re+1),this.emplace(Re,e,i,o,u,d,p,y,x,T,A,C,D,P,B,k,N,G,J,q,X,te,ae,ye,Le,Pe,je,Qe,Ue)}emplace(e,i,o,u,d,p,y,x,T,A,C,D,P,B,k,N,G,J,q,X,te,ae,ye,Le,Pe,je,Qe,Ue,Re){const Ee=32*e,rt=16*e;return this.int16[Ee+0]=i,this.int16[Ee+1]=o,this.int16[Ee+2]=u,this.int16[Ee+3]=d,this.int16[Ee+4]=p,this.int16[Ee+5]=y,this.int16[Ee+6]=x,this.int16[Ee+7]=T,this.uint16[Ee+8]=A,this.uint16[Ee+9]=C,this.uint16[Ee+10]=D,this.uint16[Ee+11]=P,this.uint16[Ee+12]=B,this.uint16[Ee+13]=k,this.uint16[Ee+14]=N,this.uint16[Ee+15]=G,this.uint16[Ee+16]=J,this.uint16[Ee+17]=q,this.uint16[Ee+18]=X,this.uint16[Ee+19]=te,this.uint16[Ee+20]=ae,this.uint16[Ee+21]=ye,this.uint16[Ee+22]=Le,this.uint32[rt+12]=Pe,this.float32[rt+13]=je,this.float32[rt+14]=Qe,this.uint16[Ee+30]=Ue,this.uint16[Ee+31]=Re,e}}Wo.prototype.bytesPerElement=64,tt("StructArrayLayout8i15ui1ul2f2ui64",Wo);class Qo extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Qo.prototype.bytesPerElement=4,tt("StructArrayLayout1f4",Qo);class Gl extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const d=3*e;return this.uint16[6*e+0]=i,this.float32[d+1]=o,this.float32[d+2]=u,e}}Gl.prototype.bytesPerElement=12,tt("StructArrayLayout1ui2f12",Gl);class Or extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const d=4*e;return this.uint32[2*e+0]=i,this.uint16[d+2]=o,this.uint16[d+3]=u,e}}Or.prototype.bytesPerElement=8,tt("StructArrayLayout1ul2ui8",Or);class m extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=o,e}}m.prototype.bytesPerElement=4,tt("StructArrayLayout2ui4",m);class t extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}t.prototype.bytesPerElement=2,tt("StructArrayLayout1ui2",t);class r extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,u)}emplace(e,i,o,u,d){const p=4*e;return this.float32[p+0]=i,this.float32[p+1]=o,this.float32[p+2]=u,this.float32[p+3]=d,e}}r.prototype.bytesPerElement=16,tt("StructArrayLayout4f16",r);class l extends ci{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new De(this.anchorPointX,this.anchorPointY)}}l.prototype.size=20;class h extends qu{get(e){return new l(this,e)}}tt("CollisionBoxArray",h);class _ extends ci{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}_.prototype.size=48;class v extends ms{get(e){return new _(this,e)}}tt("PlacedSymbolArray",v);class b extends ci{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}b.prototype.size=64;class S extends Wo{get(e){return new b(this,e)}}tt("SymbolInstanceArray",S);class E extends Qo{getoffsetX(e){return this.float32[1*e+0]}}tt("GlyphOffsetArray",E);class z extends Yo{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}tt("SymbolLineVertexArray",z);class R extends ci{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}R.prototype.size=12;class I extends Gl{get(e){return new R(this,e)}}tt("TextAnchorOffsetArray",I);class F extends ci{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}F.prototype.size=8;class U extends Or{get(e){return new F(this,e)}}tt("FeatureIndexArray",U);class Y extends Br{}class W extends Br{}class $ extends Br{}class K extends Os{}class ne extends Sh{}class Q extends Fi{}class ie extends kr{}class se extends Vl{}class ee extends Ul{}class ce extends Uu{}class Me extends Gu{}class _e extends go{}class be extends ea{}class we extends Zi{}class Xe extends m{}const Ye=qi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ne}=Ye;class We{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,i,o,u){const d=this.segments[this.segments.length-1];return e>We.MAX_VERTEX_ARRAY_LENGTH&&$i(`Max vertices per segment is ${We.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${We.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!d||d.vertexLength+e>We.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==u?this.createNewSegment(i,o,u):d}createNewSegment(e,i,o){const u={vertexOffset:e.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(u.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(u),u}getOrCreateLatestSegment(e,i,o){return this.prepareSegment(0,e,i,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,u){return new We([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function zt(n,e){return 256*(n=kt(Math.floor(n),0,255))+kt(Math.floor(e),0,255)}We.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,tt("SegmentVector",We);const hi=qi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Li=qi([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var zi,Ni,bi,Ki={exports:{}},ji={exports:{}},Vn={exports:{}},ln=(function(){if(bi)return Ki.exports;bi=1;var n=(zi||(zi=1,ji.exports=function(i,o){var u,d,p,y,x,T,A,C;for(d=i.length-(u=3&i.length),p=o,x=3432918353,T=461845907,C=0;C<d;)A=255&i.charCodeAt(C)|(255&i.charCodeAt(++C))<<8|(255&i.charCodeAt(++C))<<16|(255&i.charCodeAt(++C))<<24,++C,p=27492+(65535&(y=5*(65535&(p=(p^=A=(65535&(A=(A=(65535&A)*x+(((A>>>16)*x&65535)<<16)&4294967295)<<15|A>>>17))*T+(((A>>>16)*T&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(A=0,u){case 3:A^=(255&i.charCodeAt(C+2))<<16;case 2:A^=(255&i.charCodeAt(C+1))<<8;case 1:p^=A=(65535&(A=(A=(65535&(A^=255&i.charCodeAt(C)))*x+(((A>>>16)*x&65535)<<16)&4294967295)<<15|A>>>17))*T+(((A>>>16)*T&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}),ji.exports),e=(Ni||(Ni=1,Vn.exports=function(i,o){for(var u,d=i.length,p=o^d,y=0;d>=4;)u=1540483477*(65535&(u=255&i.charCodeAt(y)|(255&i.charCodeAt(++y))<<8|(255&i.charCodeAt(++y))<<16|(255&i.charCodeAt(++y))<<24))+((1540483477*(u>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),d-=4,++y;switch(d){case 3:p^=(255&i.charCodeAt(y+2))<<16;case 2:p^=(255&i.charCodeAt(y+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(y)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}),Vn.exports);return Ki.exports=n,Ki.exports.murmur3=n,Ki.exports.murmur2=e,Ki.exports})(),un=qe(ln);class Un{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,o,u){this.ids.push(gs(e)),this.positions.push(i,o,u)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const i=gs(e);let o=0,u=this.ids.length-1;for(;o<u;){const p=o+u>>1;this.ids[p]>=i?u=p:o=p+1}const d=[];for(;this.ids[o]===i;)d.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return d}static serialize(e,i){const o=new Float64Array(e.ids),u=new Uint32Array(e.positions);return _s(o,u,0,o.length-1),i&&i.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(e){const i=new Un;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function gs(n){const e=+n;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:un(String(n))}function _s(n,e,i,o){for(;i<o;){const u=n[i+o>>1];let d=i-1,p=o+1;for(;;){do d++;while(n[d]<u);do p--;while(n[p]>u);if(d>=p)break;Fr(n,d,p),Fr(e,3*d,3*p),Fr(e,3*d+1,3*p+1),Fr(e,3*d+2,3*p+2)}p-i<o-p?(_s(n,e,i,p),i=p+1):(_s(n,e,p+1,o),o=p)}}function Fr(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}tt("FeaturePositionMap",Un);class Ra{constructor(e,i){this.gl=e.gl,this.location=i}}class Ko extends Ra{constructor(e,i){super(e,i),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class ql extends Ra{constructor(e,i){super(e,i),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Nr extends Ra{constructor(e,i){super(e,i),this.current=Ft.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const La=new Float32Array(16);function er(n){return[zt(255*n.r,255*n.g),zt(255*n.b,255*n.a)]}class yr{constructor(e,i,o){this.value=e,this.uniformNames=i.map((u=>`u_${u}`)),this.type=o}setUniform(e,i,o){e.set(o.constantOr(this.value))}getBinding(e,i,o){return this.type==="color"?new Nr(e,i):new Ko(e,i)}}class vr{constructor(e,i){this.uniformNames=i.map((o=>`u_${o}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,i){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,i.y,i.height,i.width]}setUniform(e,i,o,u){let d=null;u==="u_pattern_to"?d=this.patternTo:u==="u_pattern_from"?d=this.patternFrom:u==="u_dasharray_to"?d=this.dashTo:u==="u_dasharray_from"?d=this.dashFrom:u==="u_pixel_ratio_to"?d=this.pixelRatioTo:u==="u_pixel_ratio_from"&&(d=this.pixelRatioFrom),d!==null&&e.set(d)}getBinding(e,i,o){return o.substr(0,9)==="u_pattern"||o.substr(0,12)==="u_dasharray_"?new ql(e,i):new Ko(e,i)}}class _i{constructor(e,i,o,u){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map((d=>({name:`a_${d}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new u}populatePaintArray(e,i,o){const u=this.paintVertexArray.length,d=this.expression.evaluate(new gi(0,o),i,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(u,e,d)}updatePaintArray(e,i,o,u,d){const p=this.expression.evaluate(new gi(0,d),o,u);this._setPaintValue(e,i,p)}_setPaintValue(e,i,o){if(this.type==="color"){const u=er(o);for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,u[0],u[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Di{constructor(e,i,o,u,d,p){this.expression=e,this.uniformNames=i.map((y=>`u_${y}_t`)),this.type=o,this.useIntegerZoom=u,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=i.map((y=>({name:`a_${y}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new p}populatePaintArray(e,i,o){const u=this.expression.evaluate(new gi(this.zoom,o),i,{},o.canonical,[],o.formattedSection),d=this.expression.evaluate(new gi(this.zoom+1,o),i,{},o.canonical,[],o.formattedSection),p=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(p,e,u,d)}updatePaintArray(e,i,o,u,d){const p=this.expression.evaluate(new gi(this.zoom,d),o,u),y=this.expression.evaluate(new gi(this.zoom+1,d),o,u);this._setPaintValue(e,i,p,y)}_setPaintValue(e,i,o,u){if(this.type==="color"){const d=er(o),p=er(u);for(let y=e;y<i;y++)this.paintVertexArray.emplace(y,d[0],d[1],p[0],p[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,u=kt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,i,o){return new Ko(e,i)}}class wn{constructor(e,i,o,u,d,p){this.expression=e,this.type=i,this.useIntegerZoom=o,this.zoom=u,this.layerId=p,this.zoomInPaintVertexArray=new d,this.zoomOutPaintVertexArray=new d}populatePaintArray(e,i,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,this.getPositionIds(i),o)}updatePaintArray(e,i,o,u,d){this._setPaintValues(e,i,this.getPositionIds(o),d)}_setPaintValues(e,i,o,u){const d=this.getPositions(u);if(!d||!o)return;const p=d[o.min],y=d[o.mid],x=d[o.max];if(p&&y&&x)for(let T=e;T<i;T++)this.emplace(this.zoomInPaintVertexArray,T,y,p),this.emplace(this.zoomOutPaintVertexArray,T,y,x)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const i=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,i,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,i,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class En extends wn{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return hi.members}emplace(e,i,o,u){e.emplace(i,o.tlbr[0],o.tlbr[1],o.tlbr[2],o.tlbr[3],u.tlbr[0],u.tlbr[1],u.tlbr[2],u.tlbr[3],o.pixelRatio,u.pixelRatio)}}class Rc extends wn{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return Li.members}emplace(e,i,o,u){e.emplace(i,0,o.y,o.height,o.width,0,u.y,u.height,u.width)}}class Lc{constructor(e,i,o){this.binders={},this._buffers=[];const u=[];for(const d in e.paint._values){if(!o(d))continue;const p=e.paint.get(d);if(!(p instanceof Ja&&dr(p.property.specification)))continue;const y=Rd(d,e.type),x=p.value,T=p.property.specification.type,A=p.property.useIntegerZoom,C=p.property.specification["property-type"],D=C==="cross-faded"||C==="cross-faded-data-driven";if(x.kind==="constant")this.binders[d]=D?new vr(x.value,y):new yr(x.value,y,T),u.push(`/u_${d}`);else if(x.kind==="source"||D){const P=yo(d,T,"source");this.binders[d]=D?d==="line-dasharray"?new Rc(x,T,A,i,P,e.id):new En(x,T,A,i,P,e.id):new _i(x,y,T,P),u.push(`/a_${d}`)}else{const P=yo(d,T,"composite");this.binders[d]=new Di(x,y,T,A,i,P),u.push(`/z_${d}`)}}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof _i||i instanceof Di?i.maxValue:0}populatePaintArrays(e,i,o){for(const u in this.binders){const d=this.binders[u];(d instanceof _i||d instanceof Di||d instanceof wn)&&d.populatePaintArray(e,i,o)}}setConstantPatternPositions(e,i){for(const o in this.binders){const u=this.binders[o];u instanceof vr&&u.setConstantPatternPositions(e,i)}}setConstantDashPositions(e,i){for(const o in this.binders){const u=this.binders[o];u instanceof vr&&u.setConstantDashPositions(e,i)}}updatePaintArrays(e,i,o,u,d){let p=!1;for(const y in e){const x=i.getPositions(y);for(const T of x){const A=o.feature(T.index);for(const C in this.binders){const D=this.binders[C];if((D instanceof _i||D instanceof Di||D instanceof wn)&&D.expression.isStateDependent===!0){const P=u.paint.get(C);D.expression=P.value,D.updatePaintArray(T.start,T.end,A,e[y],d),p=!0}}}}return p}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof yr||o instanceof vr)&&e.push(...o.uniformNames.map((u=>`#define HAS_UNIFORM_${u}`)))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof _i||o instanceof Di)for(let u=0;u<o.paintVertexAttributes.length;u++)e.push(o.paintVertexAttributes[u].name);else if(o instanceof wn){const u=o.getVertexAttributes();for(const d of u)e.push(d.name)}}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof yr||o instanceof vr||o instanceof Di)for(const u of o.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,i){const o=[];for(const u in this.binders){const d=this.binders[u];if(d instanceof yr||d instanceof vr||d instanceof Di){for(const p of d.uniformNames)if(i[p]){const y=d.getBinding(e,i[p],p);o.push({name:p,property:u,binding:y})}}}return o}setUniforms(e,i,o,u){for(const{name:d,property:p,binding:y}of i)this.binders[p].setUniform(y,u,o.get(p),d)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const o=this.binders[i];if(e&&o instanceof wn){const u=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof _i||o instanceof Di)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof _i||o instanceof Di||o instanceof wn)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof _i||i instanceof Di||i instanceof wn)&&i.destroy()}}}class _o{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Lc(u,i,o);this.needsUpload=!1,this._featureMap=new Un,this._bufferOffset=0}populatePaintArrays(e,i,o,u){for(const d in this.programConfigurations)this.programConfigurations[d].populatePaintArrays(e,i,u);i.id!==void 0&&this._featureMap.add(i.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,u){for(const d of o)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(e,this._featureMap,i,d,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Rd(n,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}function yo(n,e,i){const o={color:{source:Fi,composite:r},number:{source:Qo,composite:Fi}},u=(function(d){return{"line-pattern":{source:ie,composite:ie},"fill-pattern":{source:ie,composite:ie},"fill-extrusion-pattern":{source:ie,composite:ie},"line-dasharray":{source:se,composite:se}}[d]})(n);return u&&u[i]||o[e][i]}tt("ConstantBinder",yr),tt("CrossFadedConstantBinder",vr),tt("SourceExpressionBinder",_i),tt("CrossFadedPatternBinder",En),tt("CrossFadedDasharrayBinder",Rc),tt("CompositeExpressionBinder",Di),tt("ProgramConfiguration",Lc,{omit:["_buffers"]}),tt("ProgramConfigurationSet",_o);const Bc=Math.pow(2,14)-1,Ns=-Bc-1;function js(n){const e=gt/n.extent,i=n.loadGeometry();for(let o=0;o<i.length;o++){const u=i[o];for(let d=0;d<u.length;d++){const p=u[d],y=Math.round(p.x*e),x=Math.round(p.y*e);p.x=kt(y,Ns,Bc),p.y=kt(x,Ns,Bc),(y<p.x||y>p.x+1||x<p.y||x>p.y+1)&&$i("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function jr(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?js(n):[]}}const kc=-32768;function Zu(n,e,i,o,u){n.emplaceBack(kc+8*e+o,kc+8*i+u)}class Hu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new W,this.indexArray=new we,this.segments=new We,this.programConfigurations=new _o(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){const u=this.layers[0],d=[];let p=null,y=!1,x=u.type==="heatmap";if(u.type==="circle"){const A=u;p=A.layout.get("circle-sort-key"),y=!p.isConstant(),x=x||A.paint.get("circle-pitch-alignment")==="map"}const T=x?i.subdivisionGranularity.circle:1;for(const{feature:A,id:C,index:D,sourceLayerIndex:P}of e){const B=this.layers[0]._featureFilter.needGeometry,k=jr(A,B);if(!this.layers[0]._featureFilter.filter(new gi(this.zoom),k,o))continue;const N=y?p.evaluate(k,{},o):void 0,G={id:C,properties:A.properties,type:A.type,sourceLayerIndex:P,index:D,geometry:B?k.geometry:js(A),patterns:{},sortKey:N};d.push(G)}y&&d.sort(((A,C)=>A.sortKey-C.sortKey));for(const A of d){const{geometry:C,index:D,sourceLayerIndex:P}=A,B=e[D].feature;this.addFeature(A,C,D,o,T),i.featureIndex.insert(B,C,D,P,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ne),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,u,d=1){let p;switch(d){case 1:p=[0,7];break;case 3:p=[0,2,5,7];break;case 5:p=[0,1,3,4,6,7];break;case 7:p=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${d}; valid values are 1, 3, 5, 7.`)}const y=p.length;for(const x of i)for(const T of x){const A=T.x,C=T.y;if(A<0||A>=gt||C<0||C>=gt)continue;const D=this.segments.prepareSegment(y*y,this.layoutVertexArray,this.indexArray,e.sortKey),P=D.vertexLength;for(let B=0;B<y;B++)for(let k=0;k<y;k++)Zu(this.layoutVertexArray,A,C,p[k],p[B]);for(let B=0;B<y-1;B++)for(let k=0;k<y-1;k++){const N=P+B*y+k,G=P+(B+1)*y+k;this.indexArray.emplaceBack(N,G+1,N+1),this.indexArray.emplaceBack(N,G,G+1)}D.vertexLength+=y*y,D.primitiveLength+=(y-1)*(y-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:{},canonical:u})}}function Xu(n,e){for(let i=0;i<n.length;i++)if(vo(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(vo(n,e[i]))return!0;return!!ta(n,e)}function Ld(n,e,i){return!!vo(n,e)||!!kd(e,n,i)}function Bd(n,e){if(n.length===1)return Vf(e,n[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let u=0;u<o.length;u++)if(vo(n,o[u]))return!0}for(let i=0;i<n.length;i++)if(Vf(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(ta(n,e[i]))return!0;return!1}function Gn(n,e,i){if(n.length>1){if(ta(n,e))return!0;for(let o=0;o<e.length;o++)if(kd(e[o],n,i))return!0}for(let o=0;o<n.length;o++)if(kd(n[o],e,i))return!0;return!1}function ta(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const o=n[i],u=n[i+1];for(let d=0;d<e.length-1;d++)if(qp(o,u,e[d],e[d+1]))return!0}return!1}function qp(n,e,i,o){return Aa(n,i,o)!==Aa(e,i,o)&&Aa(n,e,i)!==Aa(n,e,o)}function kd(n,e,i){const o=i*i;if(e.length===1)return n.distSqr(e[0])<o;for(let u=1;u<e.length;u++)if(jf(n,e[u-1],e[u])<o)return!0;return!1}function jf(n,e,i){const o=e.distSqr(i);if(o===0)return n.distSqr(e);const u=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/o;return n.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function Vf(n,e){let i,o,u,d=!1;for(let p=0;p<n.length;p++){i=n[p];for(let y=0,x=i.length-1;y<i.length;x=y++)o=i[y],u=i[x],o.y>e.y!=u.y>e.y&&e.x<(u.x-o.x)*(e.y-o.y)/(u.y-o.y)+o.x&&(d=!d)}return d}function vo(n,e){let i=!1;for(let o=0,u=n.length-1;o<n.length;u=o++){const d=n[o],p=n[u];d.y>e.y!=p.y>e.y&&e.x<(p.x-d.x)*(e.y-d.y)/(p.y-d.y)+d.x&&(i=!i)}return i}function Zp(n,e,i){const o=i[0],u=i[2];if(n.x<o.x&&e.x<o.x||n.x>u.x&&e.x>u.x||n.y<o.y&&e.y<o.y||n.y>u.y&&e.y>u.y)return!1;const d=Aa(n,e,i[0]);return d!==Aa(n,e,i[1])||d!==Aa(n,e,i[2])||d!==Aa(n,e,i[3])}function Jo(n,e,i){const o=e.paint.get(n).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(n)}function Mh(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Od(n,e,i,o,u){if(!e[0]&&!e[1])return n;const d=De.convert(e)._mult(u);i==="viewport"&&d._rotate(-o);const p=[];for(let y=0;y<n.length;y++)p.push(n[y].sub(d));return p}function Fd(n){const e=[];for(let i=0;i<n.length;i++){const o=n[i],u=e.at(-1);(i===0||u&&!o.equals(u))&&e.push(o)}return e}function Uf({queryGeometry:n,size:e},i){return Ld(n,i,e)}function Hp({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u},d){return Ld(n,d,e*(i.projectTileCoordinates(d.x,d.y,o,u).signedDistanceFromCamera/i.cameraToCenterDistance))}function Xp({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u},d){const p=i.projectTileCoordinates(d.x,d.y,o,u).signedDistanceFromCamera,y=e*(i.cameraToCenterDistance/p);return Ld(n,Ah(d,i,o,u),y)}function Yp({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u},d){return Ld(n,Ah(d,i,o,u),e)}function Nd({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u,pitchAlignment:d="map",pitchScale:p="map"},y){const x=d==="map"?p==="map"?Uf:Hp:p==="map"?Xp:Yp,T={queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u};for(const A of y)for(const C of A)if(x(T,C))return!0;return!1}function Ah(n,e,i,o){const u=e.projectTileCoordinates(n.x,n.y,i,o).point;return new De((.5*u.x+.5)*e.width,(.5*-u.y+.5)*e.height)}let jd,Gf;tt("CircleBucket",Hu,{omit:["layers"]});var qf={get paint(){return Gf=Gf||new mn({"circle-radius":new lt(ge.paint_circle["circle-radius"]),"circle-color":new lt(ge.paint_circle["circle-color"]),"circle-blur":new lt(ge.paint_circle["circle-blur"]),"circle-opacity":new lt(ge.paint_circle["circle-opacity"]),"circle-translate":new at(ge.paint_circle["circle-translate"]),"circle-translate-anchor":new at(ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new at(ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new at(ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new lt(ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new lt(ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new lt(ge.paint_circle["circle-stroke-opacity"])})},get layout(){return jd=jd||new mn({"circle-sort-key":new lt(ge.layout_circle["circle-sort-key"])})}};class Vd extends Qi{constructor(e,i){super(e,qf,i)}createBucket(e){return new Hu(e)}queryRadius(e){const i=e;return Jo("circle-radius",this,i)+Jo("circle-stroke-width",this,i)+Mh(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:d,pixelsToTileUnits:p,unwrappedTileID:y,getElevation:x}){const T=Od(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-d.bearingInRadians,p),A=this.paint.get("circle-radius").evaluate(i,o)+this.paint.get("circle-stroke-width").evaluate(i,o),C=this.paint.get("circle-pitch-scale"),D=this.paint.get("circle-pitch-alignment");let P,B;return D==="map"?(P=T,B=A*p):(P=(function(k,N,G,J){return k.map((q=>Ah(q,N,G,J)))})(T,d,y,x),B=A),Nd({queryGeometry:P,size:B,transform:d,unwrappedTileID:y,getElevation:x,pitchAlignment:D,pitchScale:C},u)}}class Ud extends Hu{}let Zf;tt("HeatmapBucket",Ud,{omit:["layers"]});var Hf={get paint(){return Zf=Zf||new mn({"heatmap-radius":new lt(ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new lt(ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new at(ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ju(ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new at(ge.paint_heatmap["heatmap-opacity"])})}};function Gd(n,{width:e,height:i},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${e*i*o}`)}else u=new Uint8Array(e*i*o);return n.width=e,n.height=i,n.data=u,n}function xo(n,{width:e,height:i},o){if(e===n.width&&i===n.height)return;const u=Gd({},{width:e,height:i},o);Eh(n,u,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,e),height:Math.min(n.height,i)},o),n.width=e,n.height=i,n.data=u.data}function Eh(n,e,i,o,u,d){if(u.width===0||u.height===0)return e;if(u.width>n.width||u.height>n.height||i.x>n.width-u.width||i.y>n.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||o.x>e.width-u.width||o.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const p=n.data,y=e.data;if(p===y)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<u.height;x++){const T=((i.y+x)*n.width+i.x)*d,A=((o.y+x)*e.width+o.x)*d;for(let C=0;C<u.width*d;C++)y[A+C]=p[T+C]}return e}class Ch{constructor(e,i){Gd(this,e,1,i)}resize(e){xo(this,e,1)}clone(){return new Ch({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,u,d){Eh(e,i,o,u,d,1)}}class Ba{constructor(e,i){Gd(this,e,4,i)}resize(e){xo(this,e,4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ba({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,u,d){Eh(e,i,o,u,d,4)}setPixel(e,i,o){const u=4*(e*this.width+i);this.data[u+0]=Math.round(255*o.r/o.a),this.data[u+1]=Math.round(255*o.g/o.a),this.data[u+2]=Math.round(255*o.b/o.a),this.data[u+3]=Math.round(255*o.a)}}function bo(n){const e={},i=n.resolution||256,o=n.clips?n.clips.length:1,u=n.image||new Ba({width:i,height:o});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const d=(p,y,x)=>{e[n.evaluationKey]=x;const T=n.expression.evaluate(e);u.setPixel(p/4/i,y/4,T)};if(n.clips)for(let p=0,y=0;p<o;++p,y+=4*i)for(let x=0,T=0;x<i;x++,T+=4){const A=x/(i-1),{start:C,end:D}=n.clips[p];d(y,T,C*(1-A)+D*A)}else for(let p=0,y=0;p<i;p++,y+=4)d(0,y,p/(i-1));return u}tt("AlphaImage",Ch),tt("RGBAImage",Ba);const zh="big-fb";class $p extends Qi{createBucket(e){return new Ud(e)}constructor(e,i){super(e,Hf,i),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=bo({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(zh)&&this.heatmapFbos.delete(zh)}queryRadius(e){return Jo("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:d,pixelsToTileUnits:p,unwrappedTileID:y,getElevation:x}){return Nd({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(i,o)*p,transform:d,unwrappedTileID:y,getElevation:x},u)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let Dh;var Ph={get paint(){return Dh=Dh||new mn({"hillshade-illumination-direction":new at(ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new at(ge.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new at(ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new at(ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new at(ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new at(ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new at(ge.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new at(ge.paint_hillshade["hillshade-method"])})}};class cn extends Qi{constructor(e,i){super(e,Ph,i),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,i=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,u=this.paint.get("hillshade-shadow-color").values;const d=Math.max(e.length,i.length,o.length,u.length);e=e.concat(Array(d-e.length).fill(e.at(-1))),i=i.concat(Array(d-i.length).fill(i.at(-1))),o=o.concat(Array(d-o.length).fill(o.at(-1))),u=u.concat(Array(d-u.length).fill(u.at(-1)));const p=i.map(Fn);return{directionRadians:e.map(Fn),altitudeRadians:p,shadowColor:u,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let Wp;var Zm={get paint(){return Wp=Wp||new mn({"color-relief-opacity":new at(ge["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new ju(ge["paint_color-relief"]["color-relief-color"])})}};class qd{constructor(e,i,o,u){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(i,u)}update(e,i,o){const{width:u,height:d}=e,p=!(this.size&&this.size[0]===u&&this.size[1]===d||o),{context:y}=this,{gl:x}=y;if(this.useMipmap=!!(i&&i.useMipmap),x.bindTexture(x.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!i||i.premultiply!==!1)),p)this.size=[u,d],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ws(e)?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,this.format,u,d,0,this.format,x.UNSIGNED_BYTE,e.data);else{const{x:T,y:A}=o||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ws(e)?x.texSubImage2D(x.TEXTURE_2D,0,T,A,x.RGBA,x.UNSIGNED_BYTE,e):x.texSubImage2D(x.TEXTURE_2D,0,T,A,u,d,x.RGBA,x.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&x.generateMipmap(x.TEXTURE_2D),y.pixelStoreUnpackFlipY.setDefault(),y.pixelStoreUnpack.setDefault(),y.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,i,o){const{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),o!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=d.LINEAR),e!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,o||e),this.filter=e),i!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Oc{constructor(e,i,o,u=1,d=1,p=1,y=0){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void $i(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=i.height;const x=this.dim=i.height-2;switch(this.data=new Uint32Array(i.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=d,this.blueFactor=p,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let T=0;T<x;T++)this.data[this._idx(-1,T)]=this.data[this._idx(0,T)],this.data[this._idx(x,T)]=this.data[this._idx(x-1,T)],this.data[this._idx(T,-1)]=this.data[this._idx(T,0)],this.data[this._idx(T,x)]=this.data[this._idx(T,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let T=0;T<x;T++)for(let A=0;A<x;A++){const C=this.get(T,A);C>this.max&&(this.max=C),C<this.min&&(this.min=C)}}get(e,i){const o=new Uint8Array(this.data.buffer),u=4*this._idx(e,i);return this.unpack(o[u],o[u+1],o[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${e}, y: ${i}, dim: ${this.dim}`);return(i+1)*this.stride+(e+1)}unpack(e,i,o){return e*this.redFactor+i*this.greenFactor+o*this.blueFactor-this.baseShift}pack(e){return el(e,this.getUnpackVector())}getPixels(){return new Ba({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,d=i*this.dim+this.dim,p=o*this.dim,y=o*this.dim+this.dim;switch(i){case-1:u=d-1;break;case 1:d=u+1}switch(o){case-1:p=y-1;break;case 1:y=p+1}const x=-i*this.dim,T=-o*this.dim;for(let A=p;A<y;A++)for(let C=u;C<d;C++)this.data[this._idx(C,A)]=e.data[this._idx(C+x,A+T)]}}function el(n,e){const i=e[0],o=e[1],u=e[2],d=e[3],p=Math.min(i,o,u),y=Math.round((n+d)/p);return{r:Math.floor(y*p/i)%256,g:Math.floor(y*p/o)%256,b:Math.floor(y*p/u)%256}}tt("DEMData",Oc);class Qp extends Qi{constructor(e,i){super(e,Zm,i)}_createColorRamp(e){const i={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof Ta&&o._styleExpression.expression instanceof ba){this.colorRampExpression=o;const p=o._styleExpression.expression;i.elevationStops=p.labels,i.colorStops=[];for(const y of i.elevationStops)i.colorStops.push(p.evaluate({globals:{elevation:y}}))}if(i.elevationStops.length<1&&(i.elevationStops=[0],i.colorStops=[Ft.transparent]),i.elevationStops.length<2&&(i.elevationStops.push(i.elevationStops[0]+1),i.colorStops.push(i.colorStops[0])),i.elevationStops.length<=e)return i;const u={elevationStops:[],colorStops:[]},d=(i.elevationStops.length-1)/(e-1);for(let p=0;p<i.elevationStops.length-.5;p+=d)u.elevationStops.push(i.elevationStops[Math.round(p)]),u.colorStops.push(i.colorStops[Math.round(p)]);return $i(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${i.elevationStops.length}`),u}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,i,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const u=this._createColorRamp(i),d=new Ba({width:u.colorStops.length,height:1}),p=new Ba({width:u.colorStops.length,height:1});for(let y=0;y<u.elevationStops.length;y++){const x=el(u.elevationStops[y],o);p.setPixel(0,y,new Ft(x.r/255,x.g/255,x.b/255,1)),d.setPixel(0,y,u.colorStops[y])}return this.colorRampTextures={elevationTexture:new qd(e,p,e.gl.RGBA),colorTexture:new qd(e,d,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const Kp=qi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ih}=Kp;function Vr(n,e,i){const o=i.patternDependencies;let u=!1;for(const d of e){const p=d.paint.get(`${n}-pattern`);p.isConstant()||(u=!0);const y=p.constantOr(null);y&&(u=!0,o[y.to]=!0,o[y.from]=!0)}return u}function Zd(n,e,i,o,u){const{zoom:d}=o,p=u.patternDependencies;for(const y of e){const x=y.paint.get(`${n}-pattern`).value;if(x.kind!=="constant"){let T=x.evaluate({zoom:d-1},i,{},u.availableImages),A=x.evaluate({zoom:d},i,{},u.availableImages),C=x.evaluate({zoom:d+1},i,{},u.availableImages);T=T&&T.name?T.name:T,A=A&&A.name?A.name:A,C=C&&C.name?C.name:C,p[T]=!0,p[A]=!0,p[C]=!0,i.patterns[y.id]={min:T,mid:A,max:C}}}return i}function Hd(n,e,i,o,u){let d;if(u===(function(p,y,x,T){let A=0;for(let C=y,D=x-T;C<x;C+=T)A+=(p[D]-p[C])*(p[C+1]+p[D+1]),D=C;return A})(n,e,i,o)>0)for(let p=e;p<i;p+=o)d=tr(p/o|0,n[p],n[p+1],d);else for(let p=i-o;p>=e;p-=o)d=tr(p/o|0,n[p],n[p+1],d);return d&&xr(d,d.next)&&(ir(d),d=d.next),d}function Zl(n,e){if(!n)return n;e||(e=n);let i,o=n;do if(i=!1,o.steiner||!xr(o,o.next)&&si(o.prev,o,o.next)!==0)o=o.next;else{if(ir(o),o=e=o.prev,o===o.next)break;i=!0}while(i||o!==e);return e}function Yu(n,e,i,o,u,d,p){if(!n)return;!p&&d&&(function(x,T,A,C){let D=x;do D.z===0&&(D.z=Zn(D.x,D.y,T,A,C)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==x);D.prevZ.nextZ=null,D.prevZ=null,(function(P){let B,k=1;do{let N,G=P;P=null;let J=null;for(B=0;G;){B++;let q=G,X=0;for(let ae=0;ae<k&&(X++,q=q.nextZ,q);ae++);let te=k;for(;X>0||te>0&&q;)X!==0&&(te===0||!q||G.z<=q.z)?(N=G,G=G.nextZ,X--):(N=q,q=q.nextZ,te--),J?J.nextZ=N:P=N,N.prevZ=J,J=N;G=q}J.nextZ=null,k*=2}while(B>1)})(D)})(n,o,u,d);let y=n;for(;n.prev!==n.next;){const x=n.prev,T=n.next;if(d?Xd(n,o,u,d):Xf(n))e.push(x.i,n.i,T.i),ir(n),n=T.next,y=T.next;else if((n=T)===y){p?p===1?Yu(n=Jp(Zl(n),e),e,i,o,u,d,2):p===2&&tl(n,e,i,o,u,d):Yu(Zl(n),e,i,o,u,d,1);break}}}function Xf(n){const e=n.prev,i=n,o=n.next;if(si(e,i,o)>=0)return!1;const u=e.x,d=i.x,p=o.x,y=e.y,x=i.y,T=o.y,A=Math.min(u,d,p),C=Math.min(y,x,T),D=Math.max(u,d,p),P=Math.max(y,x,T);let B=o.next;for(;B!==e;){if(B.x>=A&&B.x<=D&&B.y>=C&&B.y<=P&&Fc(u,y,d,x,p,T,B.x,B.y)&&si(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function Xd(n,e,i,o){const u=n.prev,d=n,p=n.next;if(si(u,d,p)>=0)return!1;const y=u.x,x=d.x,T=p.x,A=u.y,C=d.y,D=p.y,P=Math.min(y,x,T),B=Math.min(A,C,D),k=Math.max(y,x,T),N=Math.max(A,C,D),G=Zn(P,B,e,i,o),J=Zn(k,N,e,i,o);let q=n.prevZ,X=n.nextZ;for(;q&&q.z>=G&&X&&X.z<=J;){if(q.x>=P&&q.x<=k&&q.y>=B&&q.y<=N&&q!==u&&q!==p&&Fc(y,A,x,C,T,D,q.x,q.y)&&si(q.prev,q,q.next)>=0||(q=q.prevZ,X.x>=P&&X.x<=k&&X.y>=B&&X.y<=N&&X!==u&&X!==p&&Fc(y,A,x,C,T,D,X.x,X.y)&&si(X.prev,X,X.next)>=0))return!1;X=X.nextZ}for(;q&&q.z>=G;){if(q.x>=P&&q.x<=k&&q.y>=B&&q.y<=N&&q!==u&&q!==p&&Fc(y,A,x,C,T,D,q.x,q.y)&&si(q.prev,q,q.next)>=0)return!1;q=q.prevZ}for(;X&&X.z<=J;){if(X.x>=P&&X.x<=k&&X.y>=B&&X.y<=N&&X!==u&&X!==p&&Fc(y,A,x,C,T,D,X.x,X.y)&&si(X.prev,X,X.next)>=0)return!1;X=X.nextZ}return!0}function Jp(n,e){let i=n;do{const o=i.prev,u=i.next.next;!xr(o,u)&&Wf(o,i,i.next,u)&&Bh(o,u)&&Bh(u,o)&&(e.push(o.i,i.i,u.i),ir(i),ir(i.next),i=n=u),i=i.next}while(i!==n);return Zl(i)}function tl(n,e,i,o,u,d){let p=n;do{let y=p.next.next;for(;y!==p.prev;){if(p.i!==y.i&&gn(p,y)){let x=kh(p,y);return p=Zl(p,p.next),x=Zl(x,x.next),Yu(p,e,i,o,u,d,0),void Yu(x,e,i,o,u,d,0)}y=y.next}p=p.next}while(p!==n)}function qn(n,e){let i=n.x-e.x;return i===0&&(i=n.y-e.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function Yf(n,e){const i=(function(u,d){let p=d;const y=u.x,x=u.y;let T,A=-1/0;if(xr(u,p))return p;do{if(xr(u,p.next))return p.next;if(x<=p.y&&x>=p.next.y&&p.next.y!==p.y){const k=p.x+(x-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(k<=y&&k>A&&(A=k,T=p.x<p.next.x?p:p.next,k===y))return T}p=p.next}while(p!==d);if(!T)return null;const C=T,D=T.x,P=T.y;let B=1/0;p=T;do{if(y>=p.x&&p.x>=D&&y!==p.x&&$f(x<P?y:A,x,D,P,x<P?A:y,x,p.x,p.y)){const k=Math.abs(x-p.y)/(y-p.x);Bh(p,u)&&(k<B||k===B&&(p.x>T.x||p.x===T.x&&em(T,p)))&&(T=p,B=k)}p=p.next}while(p!==C);return T})(n,e);if(!i)return e;const o=kh(i,n);return Zl(o,o.next),Zl(i,i.next)}function em(n,e){return si(n.prev,n,e.prev)<0&&si(e.next,n,n.next)<0}function Zn(n,e,i,o,u){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*u|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Hm(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function $f(n,e,i,o,u,d,p,y){return(u-p)*(e-y)>=(n-p)*(d-y)&&(n-p)*(o-y)>=(i-p)*(e-y)&&(i-p)*(d-y)>=(u-p)*(o-y)}function Fc(n,e,i,o,u,d,p,y){return!(n===p&&e===y)&&$f(n,e,i,o,u,d,p,y)}function gn(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!(function(i,o){let u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==o.i&&u.next.i!==o.i&&Wf(u,u.next,i,o))return!0;u=u.next}while(u!==i);return!1})(n,e)&&(Bh(n,e)&&Bh(e,n)&&(function(i,o){let u=i,d=!1;const p=(i.x+o.x)/2,y=(i.y+o.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&p<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(d=!d),u=u.next;while(u!==i);return d})(n,e)&&(si(n.prev,n,e.prev)||si(n,e.prev,e))||xr(n,e)&&si(n.prev,n,n.next)>0&&si(e.prev,e,e.next)>0)}function si(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function xr(n,e){return n.x===e.x&&n.y===e.y}function Wf(n,e,i,o){const u=Lh(si(n,e,i)),d=Lh(si(n,e,o)),p=Lh(si(i,o,n)),y=Lh(si(i,o,e));return u!==d&&p!==y||!(u!==0||!Rh(n,i,e))||!(d!==0||!Rh(n,o,e))||!(p!==0||!Rh(i,n,o))||!(y!==0||!Rh(i,e,o))}function Rh(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function Lh(n){return n>0?1:n<0?-1:0}function Bh(n,e){return si(n.prev,n,n.next)<0?si(n,e,n.next)>=0&&si(n,n.prev,e)>=0:si(n,e,n.prev)<0||si(n,n.next,e)<0}function kh(n,e){const i=Yd(n.i,n.x,n.y),o=Yd(e.i,e.x,e.y),u=n.next,d=e.prev;return n.next=e,e.prev=n,i.next=u,u.prev=i,o.next=i,i.prev=o,d.next=o,o.prev=d,o}function tr(n,e,i,o){const u=Yd(n,e,i);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function ir(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Yd(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class ia{constructor(e,i){if(i>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=i}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class Oh{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}Oh.noSubdivision=new Oh({fill:new ia(0,0),line:new ia(0,0),tile:new ia(0,0),stencil:new ia(0,0),circle:1}),tt("SubdivisionGranularityExpression",ia),tt("SubdivisionGranularitySetting",Oh);const br=-32768,Vs=32767;class il{constructor(e,i){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=gt/e,this._canonical=i}_getKey(e,i){return(e+=32768)<<16|i+32768}_vertexToIndex(e,i){if(e<-32768||i<-32768||e>32767||i>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(e),u=0|Math.round(i),d=this._getKey(o,u);if(this._vertexDictionary.has(d))return this._vertexDictionary.get(d);const p=this._vertexBuffer.length/2;return this._vertexDictionary.set(d,p),this._vertexBuffer.push(o,u),p}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(u,d){const p=[];for(let y=0;y<d.length;y+=3){const x=d[y],T=d[y+1],A=d[y+2],C=u[2*x],D=u[2*x+1];(u[2*T]-C)*(u[2*A+1]-D)-(u[2*T+1]-D)*(u[2*A]-C)>0?(p.push(x),p.push(A),p.push(T)):(p.push(x),p.push(T),p.push(A))}return p})(this._vertexBuffer,e);const i=[],o=e.length;for(let u=0;u<o;u+=3){const d=[e[u+0],e[u+1],e[u+2]],p=[this._vertexBuffer[2*e[u+0]+0],this._vertexBuffer[2*e[u+0]+1],this._vertexBuffer[2*e[u+1]+0],this._vertexBuffer[2*e[u+1]+1],this._vertexBuffer[2*e[u+2]+0],this._vertexBuffer[2*e[u+2]+1]];let y=1/0,x=1/0,T=-1/0,A=-1/0;for(let k=0;k<3;k++){const N=p[2*k],G=p[2*k+1];y=Math.min(y,N),T=Math.max(T,N),x=Math.min(x,G),A=Math.max(A,G)}if(y===T||x===A)continue;const C=Math.floor(y/this._granularityCellSize),D=Math.ceil(T/this._granularityCellSize),P=Math.floor(x/this._granularityCellSize),B=Math.ceil(A/this._granularityCellSize);if(C!==D||P!==B)for(let k=P;k<B;k++){const N=this._scanlineGenerateVertexRingForCellRow(k,p,d);Us(this._vertexBuffer,N,i)}else i.push(...d)}return i}_scanlineGenerateVertexRingForCellRow(e,i,o){const u=e*this._granularityCellSize,d=u+this._granularityCellSize,p=[];for(let y=0;y<3;y++){const x=i[2*y],T=i[2*y+1],A=i[2*(y+1)%6],C=i[(2*(y+1)+1)%6],D=i[2*(y+2)%6],P=i[(2*(y+2)+1)%6],B=A-x,k=C-T,N=B===0,G=k===0,J=(u-T)/k,q=(d-T)/k,X=Math.min(J,q),te=Math.max(J,q);if(!G&&(X>=1||te<=0)||G&&(T<u||T>d)){C>=u&&C<=d&&p.push(o[(y+1)%3]);continue}!G&&X>0&&p.push(this._vertexToIndex(x+B*X,T+k*X));const ae=x+B*Math.max(X,0),ye=x+B*Math.min(te,1);N||this._generateIntraEdgeVertices(p,x,T,A,C,ae,ye),!G&&te<1&&p.push(this._vertexToIndex(x+B*te,T+k*te)),(G||C>=u&&C<=d)&&p.push(o[(y+1)%3]),!G&&(C<=u||C>=d)&&this._generateInterEdgeVertices(p,x,T,A,C,D,P,ye,u,d)}return p}_generateIntraEdgeVertices(e,i,o,u,d,p,y){const x=u-i,T=d-o,A=T===0,C=A?Math.min(i,u):Math.min(p,y),D=A?Math.max(i,u):Math.max(p,y),P=Math.floor(C/this._granularityCellSize)+1,B=Math.ceil(D/this._granularityCellSize)-1;if(A?i<u:p<y)for(let k=P;k<=B;k++){const N=k*this._granularityCellSize;e.push(this._vertexToIndex(N,o+T*(N-i)/x))}else for(let k=B;k>=P;k--){const N=k*this._granularityCellSize;e.push(this._vertexToIndex(N,o+T*(N-i)/x))}}_generateInterEdgeVertices(e,i,o,u,d,p,y,x,T,A){const C=d-o,D=p-u,P=y-d,B=(T-d)/P,k=(A-d)/P,N=Math.min(B,k),G=Math.max(B,k),J=u+D*N;let q=Math.floor(Math.min(J,x)/this._granularityCellSize)+1,X=Math.ceil(Math.max(J,x)/this._granularityCellSize)-1,te=x<J;const ae=P===0;if(ae&&(y===T||y===A))return;if(ae||N>=1||G<=0){const Le=o-y,Pe=p+(i-p)*Math.min((T-y)/Le,(A-y)/Le);q=Math.floor(Math.min(Pe,x)/this._granularityCellSize)+1,X=Math.ceil(Math.max(Pe,x)/this._granularityCellSize)-1,te=x<Pe}const ye=C>0?A:T;if(te)for(let Le=q;Le<=X;Le++)e.push(this._vertexToIndex(Le*this._granularityCellSize,ye));else for(let Le=X;Le>=q;Le--)e.push(this._vertexToIndex(Le*this._granularityCellSize,ye))}_generateOutline(e){const i=[];for(const o of e){const u=nl(o,this._granularity,!0),d=this._pointArrayToIndices(u),p=[];for(let y=1;y<d.length;y++)p.push(d[y-1]),p.push(d[y]);i.push(p)}return i}_handlePoles(e){let i=!1,o=!1;this._canonical&&(this._canonical.y===0&&(i=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(i||o)&&this._fillPoles(e,i,o)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let i=0;i<e.length;i+=2){const o=e[i+1];o===br&&(e[i+1]=-32767),o===Vs&&(e[i+1]=32766)}}_generatePoleQuad(e,i,o,u,d,p){u>d!=(p===br)?(e.push(i),e.push(o),e.push(this._vertexToIndex(u,p)),e.push(o),e.push(this._vertexToIndex(d,p)),e.push(this._vertexToIndex(u,p))):(e.push(o),e.push(i),e.push(this._vertexToIndex(u,p)),e.push(this._vertexToIndex(d,p)),e.push(o),e.push(this._vertexToIndex(u,p)))}_fillPoles(e,i,o){const u=this._vertexBuffer,d=gt,p=e.length;for(let y=2;y<p;y+=3){const x=e[y-2],T=e[y-1],A=e[y],C=u[2*x],D=u[2*x+1],P=u[2*T],B=u[2*T+1],k=u[2*A],N=u[2*A+1];i&&(D===0&&B===0&&this._generatePoleQuad(e,x,T,C,P,br),B===0&&N===0&&this._generatePoleQuad(e,T,A,P,k,br),N===0&&D===0&&this._generatePoleQuad(e,A,x,k,C,br)),o&&(D===d&&B===d&&this._generatePoleQuad(e,x,T,C,P,Vs),B===d&&N===d&&this._generatePoleQuad(e,T,A,P,k,Vs),N===d&&D===d&&this._generatePoleQuad(e,A,x,k,C,Vs))}}_initializeVertices(e){for(let i=0;i<e.length;i+=2)this._vertexToIndex(e[i],e[i+1])}subdividePolygonInternal(e,i){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:u}=(function(y){const x=[],T=[];for(const A of y)if(A.length!==0){A!==y[0]&&x.push(T.length/2);for(let C=0;C<A.length;C++)T.push(A[C].x),T.push(A[C].y)}return{flattened:T,holeIndices:x}})(e);let d;this._initializeVertices(o);try{const y=(function(T,A,C=2){const D=A&&A.length,P=D?A[0]*C:T.length;let B=Hd(T,0,P,C,!0);const k=[];if(!B||B.next===B.prev)return k;let N,G,J;if(D&&(B=(function(q,X,te,ae){const ye=[];for(let Le=0,Pe=X.length;Le<Pe;Le++){const je=Hd(q,X[Le]*ae,Le<Pe-1?X[Le+1]*ae:q.length,ae,!1);je===je.next&&(je.steiner=!0),ye.push(Hm(je))}ye.sort(qn);for(let Le=0;Le<ye.length;Le++)te=Yf(ye[Le],te);return te})(T,A,B,C)),T.length>80*C){N=T[0],G=T[1];let q=N,X=G;for(let te=C;te<P;te+=C){const ae=T[te],ye=T[te+1];ae<N&&(N=ae),ye<G&&(G=ye),ae>q&&(q=ae),ye>X&&(X=ye)}J=Math.max(q-N,X-G),J=J!==0?32767/J:0}return Yu(B,k,C,N,G,J,0),k})(o,u),x=this._convertIndices(o,y);d=this._subdivideTrianglesScanline(x)}catch(y){console.error(y)}let p=[];return i&&(p=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(d),{verticesFlattened:this._vertexBuffer,indicesTriangles:d,indicesLineList:p}}_convertIndices(e,i){const o=[];for(let u=0;u<i.length;u++)o.push(this._vertexToIndex(e[2*i[u]],e[2*i[u]+1]));return o}_pointArrayToIndices(e){const i=[];for(let o=0;o<e.length;o++){const u=e[o];i.push(this._vertexToIndex(u.x,u.y))}return i}}function $d(n,e,i,o=!0){return new il(i,e).subdividePolygonInternal(n,o)}function nl(n,e,i=!1){if(!n||n.length<1)return[];if(n.length<2)return[];const o=n[0],u=n[n.length-1],d=i&&(o.x!==u.x||o.y!==u.y);if(e<2)return d?[...n,n[0]]:[...n];const p=Math.floor(gt/e),y=[];y.push(new De(n[0].x,n[0].y));const x=n.length,T=d?x:x-1;for(let A=0;A<T;A++){const C=n[A],D=A<x-1?n[A+1]:n[0],P=C.x,B=C.y,k=D.x,N=D.y,G=P!==k,J=B!==N;if(!G&&!J)continue;const q=k-P,X=N-B,te=Math.abs(q),ae=Math.abs(X);let ye=P,Le=B;for(;;){const je=q>0?(Math.floor(ye/p)+1)*p:(Math.ceil(ye/p)-1)*p,Qe=X>0?(Math.floor(Le/p)+1)*p:(Math.ceil(Le/p)-1)*p,Ue=Math.abs(ye-je),Re=Math.abs(Le-Qe),Ee=Math.abs(ye-k),rt=Math.abs(Le-N),it=G?Ue/te:Number.POSITIVE_INFINITY,ot=J?Re/ae:Number.POSITIVE_INFINITY;if((Ee<=Ue||!G)&&(rt<=Re||!J))break;if(it<ot&&G||!J){ye=je,Le+=X*it;const Je=new De(ye,Math.round(Le));y[y.length-1].x===Je.x&&y[y.length-1].y===Je.y||y.push(Je)}else{ye+=q*ot,Le=Qe;const Je=new De(Math.round(ye),Le);y[y.length-1].x===Je.x&&y[y.length-1].y===Je.y||y.push(Je)}}const Pe=new De(k,N);y[y.length-1].x===Pe.x&&y[y.length-1].y===Pe.y||y.push(Pe)}return y}function Us(n,e,i){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,u=n[2*e[0]];for(let x=1;x<e.length;x++){const T=n[2*e[x]];T<u&&(u=T,o=x)}const d=e.length;let p=o,y=(p+1)%d;for(;;){const x=p-1>=0?p-1:d-1,T=(y+1)%d,A=n[2*e[x]],C=n[2*e[T]],D=n[2*e[p]],P=n[2*e[p]+1],B=n[2*e[y]+1];let k=!1;if(A<C)k=!0;else if(A>C)k=!1;else{const N=B-P,G=-(n[2*e[y]]-D),J=P<B?1:-1;((A-D)*N+(n[2*e[x]+1]-P)*G)*J>((C-D)*N+(n[2*e[T]+1]-P)*G)*J&&(k=!0)}if(k){const N=e[x],G=e[p],J=e[y];N!==G&&N!==J&&G!==J&&i.push(J,G,N),p--,p<0&&(p=d-1)}else{const N=e[T],G=e[p],J=e[y];N!==G&&N!==J&&G!==J&&i.push(J,G,N),y++,y>=d&&(y=0)}if(x===T)break}}function Qf(n,e,i,o,u,d,p,y,x){const T=u.length/2,A=p&&y&&x;if(T<We.MAX_VERTEX_ARRAY_LENGTH){const C=e.prepareSegment(T,i,o),D=C.vertexLength;for(let k=0;k<d.length;k+=3)o.emplaceBack(D+d[k],D+d[k+1],D+d[k+2]);let P,B;C.vertexLength+=T,C.primitiveLength+=d.length/3,A&&(B=p.prepareSegment(T,i,y),P=B.vertexLength,B.vertexLength+=T);for(let k=0;k<u.length;k+=2)n(u[k],u[k+1]);if(A)for(let k=0;k<x.length;k++){const N=x[k];for(let G=1;G<N.length;G+=2)y.emplaceBack(P+N[G-1],P+N[G]);B.primitiveLength+=N.length/2}}else(function(C,D,P,B,k,N){const G=[];for(let ae=0;ae<B.length/2;ae++)G.push(-1);const J={count:0};let q=0,X=C.getOrCreateLatestSegment(D,P),te=X.vertexLength;for(let ae=2;ae<k.length;ae+=3){const ye=k[ae-2],Le=k[ae-1],Pe=k[ae];let je=G[ye]<q,Qe=G[Le]<q,Ue=G[Pe]<q;X.vertexLength+((je?1:0)+(Qe?1:0)+(Ue?1:0))>We.MAX_VERTEX_ARRAY_LENGTH&&(X=C.createNewSegment(D,P),q=J.count,je=!0,Qe=!0,Ue=!0,te=0);const Re=wo(G,B,N,J,ye,je,X),Ee=wo(G,B,N,J,Le,Qe,X),rt=wo(G,B,N,J,Pe,Ue,X);P.emplaceBack(te+Re-q,te+Ee-q,te+rt-q),X.primitiveLength++}})(e,i,o,u,d,n),A&&(function(C,D,P,B,k,N){const G=[];for(let ae=0;ae<B.length/2;ae++)G.push(-1);const J={count:0};let q=0,X=C.getOrCreateLatestSegment(D,P),te=X.vertexLength;for(let ae=0;ae<k.length;ae++){const ye=k[ae];for(let Le=1;Le<k[ae].length;Le+=2){const Pe=ye[Le-1],je=ye[Le];let Qe=G[Pe]<q,Ue=G[je]<q;X.vertexLength+((Qe?1:0)+(Ue?1:0))>We.MAX_VERTEX_ARRAY_LENGTH&&(X=C.createNewSegment(D,P),q=J.count,Qe=!0,Ue=!0,te=0);const Re=wo(G,B,N,J,Pe,Qe,X),Ee=wo(G,B,N,J,je,Ue,X);P.emplaceBack(te+Re-q,te+Ee-q),X.primitiveLength++}}})(p,i,y,u,x,n),e.forceNewSegmentOnNextPrepare(),p?.forceNewSegmentOnNextPrepare()}function wo(n,e,i,o,u,d,p){if(d){const y=o.count;return i(e[2*u],e[2*u+1]),n[u]=o.count,o.count++,p.vertexLength++,y}return n[u]}class $u{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new $,this.indexArray=new we,this.indexArray2=new Xe,this.programConfigurations=new _o(e.layers,e.zoom),this.segments=new We,this.segments2=new We,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.hasDependencies=Vr("fill",this.layers,i);const u=this.layers[0].layout.get("fill-sort-key"),d=!u.isConstant(),p=[];for(const{feature:y,id:x,index:T,sourceLayerIndex:A}of e){const C=this.layers[0]._featureFilter.needGeometry,D=jr(y,C);if(!this.layers[0]._featureFilter.filter(new gi(this.zoom),D,o))continue;const P=d?u.evaluate(D,{},o,i.availableImages):void 0,B={id:x,properties:y.properties,type:y.type,sourceLayerIndex:A,index:T,geometry:C?D.geometry:js(y),patterns:{},sortKey:P};p.push(B)}d&&p.sort(((y,x)=>y.sortKey-x.sortKey));for(const y of p){const{geometry:x,index:T,sourceLayerIndex:A}=y;if(this.hasDependencies){const C=Zd("fill",this.layers,y,{zoom:this.zoom},i);this.patternFeatures.push(C)}else this.addFeature(y,x,T,o,{},i.subdivisionGranularity);i.featureIndex.insert(e[T].feature,x,T,A,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}addFeatures(e,i,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,i,o,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ih),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,u,d,p){for(const y of bu(i,500)){const x=$d(y,u,p.fill.getGranularityForZoomLevel(u.z)),T=this.layoutVertexArray;Qf(((A,C)=>{T.emplaceBack(A,C)}),this.segments,this.layoutVertexArray,this.indexArray,x.verticesFlattened,x.indicesTriangles,this.segments2,this.indexArray2,x.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:d,canonical:u})}}let Nc,Wu;tt("FillBucket",$u,{omit:["layers","patternFeatures"]});var tm={get paint(){return Wu=Wu||new mn({"fill-antialias":new at(ge.paint_fill["fill-antialias"]),"fill-opacity":new lt(ge.paint_fill["fill-opacity"]),"fill-color":new lt(ge.paint_fill["fill-color"]),"fill-outline-color":new lt(ge.paint_fill["fill-outline-color"]),"fill-translate":new at(ge.paint_fill["fill-translate"]),"fill-translate-anchor":new at(ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new gr(ge.paint_fill["fill-pattern"])})},get layout(){return Nc=Nc||new mn({"fill-sort-key":new lt(ge.layout_fill["fill-sort-key"])})}};class im extends Qi{constructor(e,i){super(e,tm,i)}recalculate(e,i){super.recalculate(e,i);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new $u(e)}queryRadius(){return Mh(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:i,transform:o,pixelsToTileUnits:u}){return Bd(Od(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,u),i)}isTileClipped(){return!0}}const Fh=qi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),nm=qi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Wd}=Fh;class jc{constructor(e,i,o,u,d){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=u,this._values=d,e.readFields(Xm,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,o=[];let u,d=1,p=0,y=0,x=0;for(;e.pos<i;){if(p<=0){const T=e.readVarint();d=7&T,p=T>>3}if(p--,d===1||d===2)y+=e.readSVarint(),x+=e.readSVarint(),d===1&&(u&&o.push(u),u=[]),u&&u.push(new De(y,x));else{if(d!==7)throw new Error(`unknown command ${d}`);u&&u.push(u[0].clone())}}return u&&o.push(u),o}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let o=1,u=0,d=0,p=0,y=1/0,x=-1/0,T=1/0,A=-1/0;for(;e.pos<i;){if(u<=0){const C=e.readVarint();o=7&C,u=C>>3}if(u--,o===1||o===2)d+=e.readSVarint(),p+=e.readSVarint(),d<y&&(y=d),d>x&&(x=d),p<T&&(T=p),p>A&&(A=p);else if(o!==7)throw new Error(`unknown command ${o}`)}return[y,T,x,A]}toGeoJSON(e,i,o){const u=this.extent*Math.pow(2,o),d=this.extent*e,p=this.extent*i,y=this.loadGeometry();function x(D){return[360*(D.x+d)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(D.y+p)/u)*Math.PI))-90]}function T(D){return D.map(x)}let A;if(this.type===1){const D=[];for(const B of y)D.push(B[0]);const P=T(D);A=D.length===1?{type:"Point",coordinates:P[0]}:{type:"MultiPoint",coordinates:P}}else if(this.type===2){const D=y.map(T);A=D.length===1?{type:"LineString",coordinates:D[0]}:{type:"MultiLineString",coordinates:D}}else{if(this.type!==3)throw new Error("unknown feature type");{const D=am(y),P=[];for(const B of D)P.push(B.map(T));A=P.length===1?{type:"Polygon",coordinates:P[0]}:{type:"MultiPolygon",coordinates:P}}}const C={type:"Feature",geometry:A,properties:this.properties};return this.id!=null&&(C.id=this.id),C}}function Xm(n,e,i){n===1?e.id=i.readVarint():n===2?(function(o,u){const d=o.readVarint()+o.pos;for(;o.pos<d;){const p=u._keys[o.readVarint()],y=u._values[o.readVarint()];u.properties[p]=y}})(i,e):n===3?e.type=i.readVarint():n===4&&(e._geometry=i.pos)}function am(n){const e=n.length;if(e<=1)return[n];const i=[];let o,u;for(let d=0;d<e;d++){const p=Pi(n[d]);p!==0&&(u===void 0&&(u=p<0),u===p<0?(o&&i.push(o),o=[n[d]]):o&&o.push(n[d]))}return o&&i.push(o),i}function Pi(n){let e=0;for(let i,o,u=0,d=n.length,p=d-1;u<d;p=u++)i=n[u],o=n[p],e+=(o.x-i.x)*(i.y+o.y);return e}jc.types=["Unknown","Point","LineString","Polygon"];class Hi{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(ti,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new jc(this._pbf,i,this.extent,this._keys,this._values)}}function ti(n,e,i){n===15?e.version=i.readVarint():n===1?e.name=i.readString():n===5?e.extent=i.readVarint():n===2?e._features.push(i.pos):n===3?e._keys.push(i.readString()):n===4&&e._values.push((function(o){let u=null;const d=o.readVarint()+o.pos;for(;o.pos<d;){const p=o.readVarint()>>3;u=p===1?o.readString():p===2?o.readFloat():p===3?o.readDouble():p===4?o.readVarint64():p===5?o.readVarint():p===6?o.readSVarint():p===7?o.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u})(i))}class ii{constructor(e,i){this.layers=e.readFields(ki,{},i)}}function ki(n,e,i){if(n===3){const o=new Hi(i,i.readVarint()+i.pos);o.length&&(e[o.name]=o)}}const nr=Math.pow(2,13);function ys(n,e,i,o,u,d,p,y){n.emplaceBack(e,i,2*Math.floor(o*nr)+p,u*nr*2,d*nr*2,Math.round(y))}class Hl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new K,this.centroidVertexArray=new Y,this.indexArray=new we,this.programConfigurations=new _o(e.layers,e.zoom),this.segments=new We,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.features=[],this.hasDependencies=Vr("fill-extrusion",this.layers,i);for(const{feature:u,id:d,index:p,sourceLayerIndex:y}of e){const x=this.layers[0]._featureFilter.needGeometry,T=jr(u,x);if(!this.layers[0]._featureFilter.filter(new gi(this.zoom),T,o))continue;const A={id:d,sourceLayerIndex:y,index:p,geometry:x?T.geometry:js(u),properties:u.properties,type:u.type,patterns:{}};this.hasDependencies?this.features.push(Zd("fill-extrusion",this.layers,A,{zoom:this.zoom},i)):this.addFeature(A,A.geometry,p,o,{},i.subdivisionGranularity),i.featureIndex.insert(u,A.geometry,p,y,this.index,!0)}}addFeatures(e,i,o){for(const u of this.features){const{geometry:d}=u;this.addFeature(u,d,u.index,i,o,e.subdivisionGranularity)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wd),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,nm.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,i,o,u,d,p){for(const y of bu(i,500)){const x={x:0,y:0,sampleCount:0},T=this.layoutVertexArray.length;this.processPolygon(x,u,e,y,p);const A=this.layoutVertexArray.length-T,C=Math.floor(x.x/x.sampleCount),D=Math.floor(x.y/x.sampleCount);for(let P=0;P<A;P++)this.centroidVertexArray.emplaceBack(C,D)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:d,canonical:u})}processPolygon(e,i,o,u,d){if(u.length<1||Tn(u[0]))return;for(const C of u)C.length!==0&&Kf(e,C);const p={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},y=d.fill.getGranularityForZoomLevel(i.z),x=jc.types[o.type]==="Polygon";for(const C of u){if(C.length===0||Tn(C))continue;const D=nl(C,y,x);this._generateSideFaces(D,p)}if(!x)return;const T=$d(u,i,y,!1),A=this.layoutVertexArray;Qf(((C,D)=>{ys(A,C,D,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles)}_generateSideFaces(e,i){let o=0;for(let u=1;u<e.length;u++){const d=e[u],p=e[u-1];if(al(d,p))continue;i.segment.vertexLength+4>We.MAX_VERTEX_ARRAY_LENGTH&&(i.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const y=d.sub(p)._perp()._unit(),x=p.dist(d);o+x>32768&&(o=0),ys(this.layoutVertexArray,d.x,d.y,y.x,y.y,0,0,o),ys(this.layoutVertexArray,d.x,d.y,y.x,y.y,0,1,o),o+=x,ys(this.layoutVertexArray,p.x,p.y,y.x,y.y,0,0,o),ys(this.layoutVertexArray,p.x,p.y,y.x,y.y,0,1,o);const T=i.segment.vertexLength;this.indexArray.emplaceBack(T,T+2,T+1),this.indexArray.emplaceBack(T+1,T+2,T+3),i.segment.vertexLength+=4,i.segment.primitiveLength+=2}}}function Kf(n,e){for(let i=0;i<e.length;i++){const o=e[i];i===e.length-1&&e[0].x===o.x&&e[0].y===o.y||(n.x+=o.x,n.y+=o.y,n.sampleCount++)}}function al(n,e){return n.x===e.x&&(n.x<0||n.x>gt)||n.y===e.y&&(n.y<0||n.y>gt)}function Tn(n){return n.every((e=>e.x<0))||n.every((e=>e.x>gt))||n.every((e=>e.y<0))||n.every((e=>e.y>gt))}let rl;tt("FillExtrusionBucket",Hl,{omit:["layers","features"]});var Qu={get paint(){return rl=rl||new mn({"fill-extrusion-opacity":new at(ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new lt(ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new at(ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new at(ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new gr(ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new lt(ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new lt(ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new at(ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Jf extends Qi{constructor(e,i){super(e,Qu,i)}createBucket(e){return new Hl(e)}queryRadius(){return Mh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:d,pixelsToTileUnits:p,pixelPosMatrix:y}){const x=Od(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-d.bearingInRadians,p),T=this.paint.get("fill-extrusion-height").evaluate(i,o),A=this.paint.get("fill-extrusion-base").evaluate(i,o),C=(function(P,B){const k=[];for(const N of P){const G=[N.x,N.y,0,1];Va(G,G,B),k.push(new De(G[0]/G[3],G[1]/G[3]))}return k})(x,y),D=(function(P,B,k,N){const G=[],J=[],q=N[8]*B,X=N[9]*B,te=N[10]*B,ae=N[11]*B,ye=N[8]*k,Le=N[9]*k,Pe=N[10]*k,je=N[11]*k;for(const Qe of P){const Ue=[],Re=[];for(const Ee of Qe){const rt=Ee.x,it=Ee.y,ot=N[0]*rt+N[4]*it+N[12],Je=N[1]*rt+N[5]*it+N[13],pt=N[2]*rt+N[6]*it+N[14],oi=N[3]*rt+N[7]*it+N[15],Ht=pt+te,hn=oi+ae,Na=ot+ye,$n=Je+Le,dn=pt+Pe,Ji=oi+je,Si=new De((ot+q)/hn,(Je+X)/hn);Si.z=Ht/hn,Ue.push(Si);const Sn=new De(Na/Ji,$n/Ji);Sn.z=dn/Ji,Re.push(Sn)}G.push(Ue),J.push(Re)}return[G,J]})(u,A,T,y);return(function(P,B,k){let N=1/0;Bd(k,B)&&(N=Ku(k,B[0]));for(let G=0;G<B.length;G++){const J=B[G],q=P[G];for(let X=0;X<J.length-1;X++){const te=J[X],ae=[te,J[X+1],q[X+1],q[X],te];Xu(k,ae)&&(N=Math.min(N,Ku(k,ae)))}}return N!==1/0&&N})(D[0],D[1],C)}}function Sa(n,e){return n.x*e.x+n.y*e.y}function Ku(n,e){if(n.length===1){let i=0;const o=e[i++];let u;for(;!u||o.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const d=e[i],p=n[0],y=u.sub(o),x=d.sub(o),T=p.sub(o),A=Sa(y,y),C=Sa(y,x),D=Sa(x,x),P=Sa(T,y),B=Sa(T,x),k=A*D-C*C,N=(D*P-C*B)/k,G=(A*B-C*P)/k,J=o.z*(1-N-G)+u.z*N+d.z*G;if(isFinite(J))return J}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}const Nh=qi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:wr}=Nh,ep=qi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Qd}=ep,rm=Math.cos(Math.PI/180*37.5),jh=Math.pow(2,14)/.5;class Vc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new ne,this.layoutVertexArray2=new Q,this.indexArray=new we,this.programConfigurations=new _o(e.layers,e.zoom),this.segments=new We,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.hasDependencies=Vr("line",this.layers,i)||this.hasLineDasharray(this.layers);const u=this.layers[0].layout.get("line-sort-key"),d=!u.isConstant(),p=[];for(const{feature:y,id:x,index:T,sourceLayerIndex:A}of e){const C=this.layers[0]._featureFilter.needGeometry,D=jr(y,C);if(!this.layers[0]._featureFilter.filter(new gi(this.zoom),D,o))continue;const P=d?u.evaluate(D,{},o):void 0,B={id:x,properties:y.properties,type:y.type,sourceLayerIndex:A,index:T,geometry:C?D.geometry:js(y),patterns:{},dashes:{},sortKey:P};p.push(B)}d&&p.sort(((y,x)=>y.sortKey-x.sortKey));for(const y of p){const{geometry:x,index:T,sourceLayerIndex:A}=y;this.hasDependencies?(Vr("line",this.layers,i)?Zd("line",this.layers,y,{zoom:this.zoom},i):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,y,this.zoom,i),this.patternFeatures.push(y)):this.addFeature(y,x,T,o,{},{},i.subdivisionGranularity),i.featureIndex.insert(e[T].feature,x,T,A,this.index)}}update(e,i,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o,dashPositions:u})}addFeatures(e,i,o,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,i,o,u,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Qd)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wr),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,u,d,p,y){const x=this.layers[0].layout,T=x.get("line-join").evaluate(e,{}),A=x.get("line-cap"),C=x.get("line-miter-limit"),D=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const P of i)this.addLine(P,e,T,A,C,D,u,y);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:d,dashPositions:p,canonical:u})}addLine(e,i,o,u,d,p,y,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=nl(e,y?x.line.getGranularityForZoomLevel(y.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let q=0;q<e.length-1;q++)this.totalDistance+=e[q].dist(e[q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=jc.types[i.type]==="Polygon";let A=e.length;for(;A>=2&&e[A-1].equals(e[A-2]);)A--;let C=0;for(;C<A-1&&e[C].equals(e[C+1]);)C++;if(A<(T?3:2))return;o==="bevel"&&(d=1.05);const D=this.overscaling<=16?122880/(512*this.overscaling):0,P=this.segments.prepareSegment(10*A,this.layoutVertexArray,this.indexArray);let B,k,N,G,J;this.e1=this.e2=-1,T&&(B=e[A-2],J=e[C].sub(B)._unit()._perp());for(let q=C;q<A;q++){if(N=q===A-1?T?e[C+1]:void 0:e[q+1],N&&e[q].equals(N))continue;J&&(G=J),B&&(k=B),B=e[q],J=N?N.sub(B)._unit()._perp():G,G=G||J;let X=G.add(J);X.x===0&&X.y===0||X._unit();const te=G.x*J.x+G.y*J.y,ae=X.x*J.x+X.y*J.y,ye=ae!==0?1/ae:1/0,Le=2*Math.sqrt(2-2*ae),Pe=ae<rm&&k&&N,je=G.x*J.y-G.y*J.x>0;if(Pe&&q>C){const Re=B.dist(k);if(Re>2*D){const Ee=B.sub(B.sub(k)._mult(D/Re)._round());this.updateDistance(k,Ee),this.addCurrentVertex(Ee,G,0,0,P),k=Ee}}const Qe=k&&N;let Ue=Qe?o:T?"butt":u;if(Qe&&Ue==="round"&&(ye<p?Ue="miter":ye<=2&&(Ue="fakeround")),Ue==="miter"&&ye>d&&(Ue="bevel"),Ue==="bevel"&&(ye>2&&(Ue="flipbevel"),ye<d&&(Ue="miter")),k&&this.updateDistance(k,B),Ue==="miter")X._mult(ye),this.addCurrentVertex(B,X,0,0,P);else if(Ue==="flipbevel"){if(ye>100)X=J.mult(-1);else{const Re=ye*G.add(J).mag()/G.sub(J).mag();X._perp()._mult(Re*(je?-1:1))}this.addCurrentVertex(B,X,0,0,P),this.addCurrentVertex(B,X.mult(-1),0,0,P)}else if(Ue==="bevel"||Ue==="fakeround"){const Re=-Math.sqrt(ye*ye-1),Ee=je?Re:0,rt=je?0:Re;if(k&&this.addCurrentVertex(B,G,Ee,rt,P),Ue==="fakeround"){const it=Math.round(180*Le/Math.PI/20);for(let ot=1;ot<it;ot++){let Je=ot/it;if(Je!==.5){const oi=Je-.5;Je+=Je*oi*(Je-1)*((1.0904+te*(te*(3.55645-1.43519*te)-3.2452))*oi*oi+(.848013+te*(.215638*te-1.06021)))}const pt=J.sub(G)._mult(Je)._add(G)._unit()._mult(je?-1:1);this.addHalfVertex(B,pt.x,pt.y,!1,je,0,P)}}N&&this.addCurrentVertex(B,J,-Ee,-rt,P)}else if(Ue==="butt")this.addCurrentVertex(B,X,0,0,P);else if(Ue==="square"){const Re=k?1:-1;this.addCurrentVertex(B,X,Re,Re,P)}else Ue==="round"&&(k&&(this.addCurrentVertex(B,G,0,0,P),this.addCurrentVertex(B,G,1,1,P,!0)),N&&(this.addCurrentVertex(B,J,-1,-1,P,!0),this.addCurrentVertex(B,J,0,0,P)));if(Pe&&q<A-1){const Re=B.dist(N);if(Re>2*D){const Ee=B.add(N.sub(B)._mult(D/Re)._round());this.updateDistance(B,Ee),this.addCurrentVertex(Ee,J,0,0,P),B=Ee}}}}addCurrentVertex(e,i,o,u,d,p=!1){const y=i.y*u-i.x,x=-i.y-i.x*u;this.addHalfVertex(e,i.x+i.y*o,i.y-i.x*o,p,!1,o,d),this.addHalfVertex(e,y,x,p,!0,-u,d),this.distance>jh/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,i,o,u,d,p))}addHalfVertex({x:e,y:i},o,u,d,p,y,x){const T=.5*(this.lineClips?this.scaledDistance*(jh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(i<<1)+(p?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1)|(63&T)<<2,T>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const A=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,A,this.e2),x.primitiveLength++),p?this.e2=A:this.e1=A}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}hasLineDasharray(e){for(const i of e){const o=i.paint.get("line-dasharray");if(o&&!o.isConstant())return!0}return!1}addLineDashDependencies(e,i,o,u){for(const d of e){const p=d.paint.get("line-dasharray");if(!p||p.value.kind==="constant")continue;const y=d.layout.get("line-cap")==="round",x={dasharray:p.value.evaluate({zoom:o-1},i,{}),round:y},T={dasharray:p.value.evaluate({zoom:o},i,{}),round:y},A={dasharray:p.value.evaluate({zoom:o+1},i,{}),round:y},C=`${x.dasharray.join(",")},${x.round}`,D=`${T.dasharray.join(",")},${T.round}`,P=`${A.dasharray.join(",")},${A.round}`;u.dashDependencies[C]=x,u.dashDependencies[D]=T,u.dashDependencies[P]=A,i.dashes[d.id]={min:C,mid:D,max:P}}}}let sl,Hn;tt("LineBucket",Vc,{omit:["layers","patternFeatures"]});var ol={get paint(){return Hn=Hn||new mn({"line-opacity":new lt(ge.paint_line["line-opacity"]),"line-color":new lt(ge.paint_line["line-color"]),"line-translate":new at(ge.paint_line["line-translate"]),"line-translate-anchor":new at(ge.paint_line["line-translate-anchor"]),"line-width":new lt(ge.paint_line["line-width"]),"line-gap-width":new lt(ge.paint_line["line-gap-width"]),"line-offset":new lt(ge.paint_line["line-offset"]),"line-blur":new lt(ge.paint_line["line-blur"]),"line-dasharray":new gr(ge.paint_line["line-dasharray"]),"line-pattern":new gr(ge.paint_line["line-pattern"]),"line-gradient":new ju(ge.paint_line["line-gradient"])})},get layout(){return sl=sl||new mn({"line-cap":new at(ge.layout_line["line-cap"]),"line-join":new lt(ge.layout_line["line-join"]),"line-miter-limit":new at(ge.layout_line["line-miter-limit"]),"line-round-limit":new at(ge.layout_line["line-round-limit"]),"line-sort-key":new lt(ge.layout_line["line-sort-key"])})}};class Uc extends lt{possiblyEvaluate(e,i){return i=new gi(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,u){return i=Mi({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,u)}}let vs;class tp extends Qi{constructor(e,i){super(e,ol,i),this.gradientVersion=0,vs||(vs=new Uc(ol.paint.properties["line-width"].specification),vs.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const i=this.gradientExpression();this.stepInterpolant=!!(function(o){return o._styleExpression!==void 0})(i)&&i._styleExpression.expression instanceof io,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,i){super.recalculate(e,i),this.paint._values["line-floorwidth"]=vs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Vc(e)}queryRadius(e){const i=e,o=Kd(Jo("line-width",this,i),Jo("line-gap-width",this,i)),u=Jo("line-offset",this,i);return o/2+Math.abs(u)+Mh(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:d,pixelsToTileUnits:p}){const y=Od(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-d.bearingInRadians,p),x=p/2*Kd(this.paint.get("line-width").evaluate(i,o),this.paint.get("line-gap-width").evaluate(i,o)),T=this.paint.get("line-offset").evaluate(i,o);return T&&(u=(function(A,C){const D=[];for(let P=0;P<A.length;P++){const B=Fd(A[P]),k=[];for(let N=0;N<B.length;N++){const G=B[N],J=B[N-1],q=B[N+1],X=N===0?new De(0,0):G.sub(J)._unit()._perp(),te=N===B.length-1?new De(0,0):q.sub(G)._unit()._perp(),ae=X._add(te)._unit(),ye=ae.x*te.x+ae.y*te.y;ye!==0&&ae._mult(1/ye),k.push(ae._mult(C)._add(G))}D.push(k)}return D})(u,T*p)),(function(A,C,D){for(let P=0;P<C.length;P++){const B=C[P];if(A.length>=3){for(let k=0;k<B.length;k++)if(vo(A,B[k]))return!0}if(Gn(A,B,D))return!0}return!1})(y,u,x)}isTileClipped(){return!0}}function Kd(n,e){return e>0?e+2*n:n}const sm=qi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Vh=qi([{name:"a_projected_pos",components:3,type:"Float32"}],4);qi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ip=qi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);qi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Tr=qi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),om=qi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Sr(n,e,i){return n.sections.forEach((o=>{o.text=(function(u,d,p){const y=d.layout.get("text-transform").evaluate(p,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),mr.applyArabicShaping&&(u=mr.applyArabicShaping(u)),u})(o.text,e,i)})),n}qi([{name:"triangle",components:3,type:"Uint16"}]),qi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),qi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),qi([{type:"Float32",name:"offsetX"}]),qi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),qi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var kn=24;const Gc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},Ym={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Xl={40:!0};function Uh(n,e,i,o,u,d){if("fontStack"in e){const p=i[e.fontStack],y=p&&p[n];return y?y.metrics.advance*e.scale+u:0}{const p=o[e.imageName];return p?p.displaySize[0]*e.scale*kn/d+u:0}}function Jd(n,e,i,o){const u=Math.pow(n-e,2);return o?n<e?u/2:2*u:u+Math.abs(i)*i}function qc(n,e,i){let o=0;return n===10&&(o-=1e4),i&&(o+=150),n!==40&&n!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function np(n,e,i,o,u,d){let p=null,y=Jd(e,i,u,d);for(const x of o){const T=Jd(e-x.x,i,u,d)+x.badness;T<=y&&(p=x,y=T)}return{index:n,x:e,priorBreak:p,badness:y}}function ap(n){return n?ap(n.priorBreak).concat(n.index):[]}class Ju{constructor(e="",i=[],o=[]){this.text=e,this.sections=i,this.sectionIndex=o,this.imageSectionID=null}static fromFeature(e,i){const o=new Ju;for(let u=0;u<e.sections.length;u++){const d=e.sections[u];d.image?o.addImageSection(d):o.addTextSection(d,i)}return o}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let i="",o={premature:!0,value:void 0};const u=e[Symbol.iterator]();let d=u.next();const p=e[Symbol.iterator]();p.next();let y=p.next();for(;!d.done;)i+=!y.done&&fs(y.value.codePointAt(0))&&!Gc[y.value]||!o.premature&&fs(o.value.codePointAt(0))&&!Gc[o.value]||!Gc[d.value]?d.value:Gc[d.value],o={value:d.value,premature:!1},d=u.next(),y=p.next();return i})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),i=e?e[0].length:0,o=this.text.match(/\S\s*$/),u=o?o[0].length-1:0;this.text=this.text.substring(i,this.text.length-u),this.sectionIndex=this.sectionIndex.slice(i,this.sectionIndex.length-u)}substring(e,i){const o=[...this.text].slice(e,i).join(""),u=this.sectionIndex.slice(e,i);return new Ju(o,this.sections,u)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,i)=>Math.max(e,this.sections[i].scale)),0)}getMaxImageSize(e){let i=0,o=0;for(let u=0;u<this.length();u++){const d=this.getSection(u);if("imageName"in d){const p=e[d.imageName];if(!p)continue;const y=p.displaySize;i=Math.max(i,y[0]),o=Math.max(o,y[1])}}return{maxImageWidth:i,maxImageHeight:o}}addTextSection(e,i){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||i});const o=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>o)))}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void $i("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:i}),this.sectionIndex.push(this.sections.length-1)):$i("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,i,o,u,d){const p=[],y=this.determineAverageLineWidth(e,i,o,u,d),x=this.hasZeroWidthSpaces();let T=0,A=0;const C=this.text[Symbol.iterator]();let D=C.next();const P=this.text[Symbol.iterator]();P.next();let B=P.next();const k=this.text[Symbol.iterator]();k.next(),k.next();let N=k.next();for(;!D.done;){const G=this.getSection(A),J=D.value.codePointAt(0);if(Bu(J)||(T+=Uh(J,G,o,u,e,d)),!B.done){const q=cs(J),X=B.value.codePointAt(0);(Ym[J]||q||"imageName"in G||!N.done&&Xl[X])&&p.push(np(A+1,T,y,p,qc(J,X,q&&x),!1))}A++,D=C.next(),B=P.next(),N=k.next()}return ap(np(this.length(),T,y,p,0,!0))}determineAverageLineWidth(e,i,o,u,d){let p=0,y=0;for(const x of this.text){const T=this.getSection(y);p+=Uh(x.codePointAt(0),T,o,u,e,d),y++}return p/Math.max(1,Math.ceil(p/i))}}const ef=4294967296,Gh=1/ef,tf=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class nf{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,i,o=this.length){for(;this.pos<o;){const u=this.readVarint(),d=u>>3,p=this.pos;this.type=7&u,e(d,i,this),this.pos===p&&this.skip(u)}return i}readMessage(e,i){return this.readFields(e,i,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*ef;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*ef;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const i=this.buf;let o,u;return u=i[this.pos++],o=127&u,u<128?o:(u=i[this.pos++],o|=(127&u)<<7,u<128?o:(u=i[this.pos++],o|=(127&u)<<14,u<128?o:(u=i[this.pos++],o|=(127&u)<<21,u<128?o:(u=i[this.pos],o|=(15&u)<<28,(function(d,p,y){const x=y.buf;let T,A;if(A=x[y.pos++],T=(112&A)>>4,A<128||(A=x[y.pos++],T|=(127&A)<<3,A<128)||(A=x[y.pos++],T|=(127&A)<<10,A<128)||(A=x[y.pos++],T|=(127&A)<<17,A<128)||(A=x[y.pos++],T|=(127&A)<<24,A<128)||(A=x[y.pos++],T|=(1&A)<<31,A<128))return Zc(d,T,p);throw new Error("Expected varint not more than 10 bytes")})(o,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,i=this.pos;return this.pos=e,e-i>=12&&tf?tf.decode(this.buf.subarray(i,e)):(function(o,u,d){let p="",y=u;for(;y<d;){const x=o[y];let T,A,C,D=null,P=x>239?4:x>223?3:x>191?2:1;if(y+P>d)break;P===1?x<128&&(D=x):P===2?(T=o[y+1],(192&T)==128&&(D=(31&x)<<6|63&T,D<=127&&(D=null))):P===3?(T=o[y+1],A=o[y+2],(192&T)==128&&(192&A)==128&&(D=(15&x)<<12|(63&T)<<6|63&A,(D<=2047||D>=55296&&D<=57343)&&(D=null))):P===4&&(T=o[y+1],A=o[y+2],C=o[y+3],(192&T)==128&&(192&A)==128&&(192&C)==128&&(D=(15&x)<<18|(63&T)<<12|(63&A)<<6|63&C,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,P=1):D>65535&&(D-=65536,p+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),p+=String.fromCharCode(D),y+=P}return p})(this.buf,i,e)}readBytes(){const e=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,e);return this.pos=e,i}readPackedVarint(e=[],i){const o=this.readPackedEnd();for(;this.pos<o;)e.push(this.readVarint(i));return e}readPackedSVarint(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const i=7&e;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(e,i){this.writeVarint(e<<3|i)}realloc(e){let i=this.length||16;for(;i<this.pos+e;)i*=2;if(i!==this.length){const o=new Uint8Array(i);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Gh),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Gh),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(i,o){let u,d;if(i>=0?(u=i%4294967296|0,d=i/4294967296|0):(u=~(-i%4294967296),d=~(-i/4294967296),4294967295^u?u=u+1|0:(u=0,d=d+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(p,y,x){x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,x.buf[x.pos]=127&(p>>>=7)})(u,0,o),(function(p,y){const x=(7&p)<<4;y.buf[y.pos++]|=x|((p>>>=3)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p)))))})(d,o)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const i=this.pos;this.pos=(function(u,d,p){for(let y,x,T=0;T<d.length;T++){if(y=d.charCodeAt(T),y>55295&&y<57344){if(!x){y>56319||T+1===d.length?(u[p++]=239,u[p++]=191,u[p++]=189):x=y;continue}if(y<56320){u[p++]=239,u[p++]=191,u[p++]=189,x=y;continue}y=x-55296<<10|y-56320|65536,x=null}else x&&(u[p++]=239,u[p++]=191,u[p++]=189,x=null);y<128?u[p++]=y:(y<2048?u[p++]=y>>6|192:(y<65536?u[p++]=y>>12|224:(u[p++]=y>>18|240,u[p++]=y>>12&63|128),u[p++]=y>>6&63|128),u[p++]=63&y|128)}return p})(this.buf,e,this.pos);const o=this.pos-i;o>=128&&lm(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const i=e.length;this.writeVarint(i),this.realloc(i);for(let o=0;o<i;o++)this.buf[this.pos++]=e[o]}writeRawMessage(e,i){this.pos++;const o=this.pos;e(i,this);const u=this.pos-o;u>=128&&lm(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u}writeMessage(e,i,o){this.writeTag(e,2),this.writeRawMessage(i,o)}writePackedVarint(e,i){i.length&&this.writeMessage(e,um,i)}writePackedSVarint(e,i){i.length&&this.writeMessage(e,cm,i)}writePackedBoolean(e,i){i.length&&this.writeMessage(e,hm,i)}writePackedFloat(e,i){i.length&&this.writeMessage(e,Hc,i)}writePackedDouble(e,i){i.length&&this.writeMessage(e,af,i)}writePackedFixed32(e,i){i.length&&this.writeMessage(e,dm,i)}writePackedSFixed32(e,i){i.length&&this.writeMessage(e,fm,i)}writePackedFixed64(e,i){i.length&&this.writeMessage(e,pm,i)}writePackedSFixed64(e,i){i.length&&this.writeMessage(e,mm,i)}writeBytesField(e,i){this.writeTag(e,2),this.writeBytes(i)}writeFixed32Field(e,i){this.writeTag(e,5),this.writeFixed32(i)}writeSFixed32Field(e,i){this.writeTag(e,5),this.writeSFixed32(i)}writeFixed64Field(e,i){this.writeTag(e,1),this.writeFixed64(i)}writeSFixed64Field(e,i){this.writeTag(e,1),this.writeSFixed64(i)}writeVarintField(e,i){this.writeTag(e,0),this.writeVarint(i)}writeSVarintField(e,i){this.writeTag(e,0),this.writeSVarint(i)}writeStringField(e,i){this.writeTag(e,2),this.writeString(i)}writeFloatField(e,i){this.writeTag(e,5),this.writeFloat(i)}writeDoubleField(e,i){this.writeTag(e,1),this.writeDouble(i)}writeBooleanField(e,i){this.writeVarintField(e,+i)}}function Zc(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function lm(n,e,i){const o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(o);for(let u=i.pos-1;u>=n;u--)i.buf[u+o]=i.buf[u]}function um(n,e){for(let i=0;i<n.length;i++)e.writeVarint(n[i])}function cm(n,e){for(let i=0;i<n.length;i++)e.writeSVarint(n[i])}function Hc(n,e){for(let i=0;i<n.length;i++)e.writeFloat(n[i])}function af(n,e){for(let i=0;i<n.length;i++)e.writeDouble(n[i])}function hm(n,e){for(let i=0;i<n.length;i++)e.writeBoolean(n[i])}function dm(n,e){for(let i=0;i<n.length;i++)e.writeFixed32(n[i])}function fm(n,e){for(let i=0;i<n.length;i++)e.writeSFixed32(n[i])}function pm(n,e){for(let i=0;i<n.length;i++)e.writeFixed64(n[i])}function mm(n,e){for(let i=0;i<n.length;i++)e.writeSFixed64(n[i])}function gm(n,e,i){n===1&&i.readMessage(rf,e)}function rf(n,e,i){if(n===3){const{id:o,bitmap:u,width:d,height:p,left:y,top:x,advance:T}=i.readMessage(_m,{});e.push({id:o,bitmap:new Ch({width:d+6,height:p+6},u),metrics:{width:d,height:p,left:y,top:x,advance:T}})}}function _m(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}function rp(n){let e=0,i=0;for(const p of n)e+=p.w*p.h,i=Math.max(i,p.w);n.sort(((p,y)=>y.h-p.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,d=0;for(const p of n)for(let y=o.length-1;y>=0;y--){const x=o[y];if(!(p.w>x.w||p.h>x.h)){if(p.x=x.x,p.y=x.y,d=Math.max(d,p.y+p.h),u=Math.max(u,p.x+p.w),p.w===x.w&&p.h===x.h){const T=o.pop();T&&y<o.length&&(o[y]=T)}else p.h===x.h?(x.x+=p.w,x.w-=p.w):p.w===x.w?(x.y+=p.h,x.h-=p.h):(o.push({x:x.x+p.w,y:x.y,w:x.w-p.w,h:p.h}),x.y+=p.h,x.h-=p.h);break}}return{w:u,h:d,fill:e/(u*d)||0}}class Ii{constructor(e,{pixelRatio:i,version:o,stretchX:u,stretchY:d,content:p,textFitWidth:y,textFitHeight:x}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=u,this.stretchY=d,this.content=p,this.version=o,this.textFitWidth=y,this.textFitHeight=x}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class sf{constructor(e,i){const o={},u={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,o,d),this.addImages(i,u,d);const{w:p,h:y}=rp(d),x=new Ba({width:p||1,height:y||1});for(const T in e){const A=e[T],C=o[T].paddedRect;Ba.copy(A.data,x,{x:0,y:0},{x:C.x+1,y:C.y+1},A.data)}for(const T in i){const A=i[T],C=u[T].paddedRect,D=C.x+1,P=C.y+1,B=A.data.width,k=A.data.height;Ba.copy(A.data,x,{x:0,y:0},{x:D,y:P},A.data),Ba.copy(A.data,x,{x:0,y:k-1},{x:D,y:P-1},{width:B,height:1}),Ba.copy(A.data,x,{x:0,y:0},{x:D,y:P+k},{width:B,height:1}),Ba.copy(A.data,x,{x:B-1,y:0},{x:D-1,y:P},{width:1,height:k}),Ba.copy(A.data,x,{x:0,y:0},{x:D+B,y:P},{width:1,height:k})}this.image=x,this.iconPositions=o,this.patternPositions=u}addImages(e,i,o){for(const u in e){const d=e[u],p={x:0,y:0,w:d.data.width+2,h:d.data.height+2};o.push(p),i[u]=new Ii(p,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,i){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),i),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),i)}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[u,d]=e.tl;o.update(i.data,void 0,{x:u,y:d})}}var Yl;function qh(n,e,i,o,u,d,p,y,x,T,A,C,D,P,B){const k=Ju.fromFeature(n,u);let N;C===O.az.vertical&&k.verticalizePunctuation();let G=k.determineLineBreaks(T,d,e,o,P);const{processBidirectionalText:J,processStyledBidirectionalText:q}=mr;if(J&&k.sections.length===1){N=[],G=G.map((ye=>k.toCodeUnitIndex(ye)));const ae=J(k.toString(),G);for(const ye of ae){const Le=[...ye].map((()=>0));N.push(new Ju(ye,k.sections,Le))}}else if(q){N=[],G=G.map((Pe=>k.toCodeUnitIndex(Pe)));let ae=0;const ye=[];for(const Pe of k.text)ye.push(...Array(Pe.length).fill(k.sectionIndex[ae])),ae++;const Le=q(k.text,ye,G);for(const Pe of Le){const je=[];let Qe="";for(const Ue of Pe[0])je.push(Pe[1][Qe.length]),Qe+=Ue;N.push(new Ju(Pe[0],k.sections,je))}}else N=(function(ae,ye){const Le=[];let Pe=0;for(const je of ye)Le.push(ae.substring(Pe,je)),Pe=je;return Pe<ae.length()&&Le.push(ae.substring(Pe,ae.length())),Le})(k,G);const X=[],te={positionedLines:X,text:k.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:C,iconsInText:!1,verticalizable:!1};return(function(ae,ye,Le,Pe,je,Qe,Ue,Re,Ee,rt,it,ot){let Je=0,pt=0,oi=0,Ht=0;const hn=Re==="right"?1:Re==="left"?0:.5,Na=kn/ot;let $n=0;for(const Si of je){Si.trim();const Sn=Si.getMaxScale(),zn={positionedGlyphs:[],lineOffset:0};ae.positionedLines[$n]=zn;const Xi=zn.positionedGlyphs;let qr=0;if(!Si.length()){pt+=Qe,++$n;continue}const ja=$m(Pe,Si,Na);let Zr=0;for(const fa of Si.text){const _n=Si.getSection(Zr),Wn=fa.codePointAt(0),Mn=of(Ee,it,Wn),pa={glyph:Wn,imageName:null,x:Je,y:pt+-17,vertical:Mn,scale:1,fontStack:"",sectionIndex:Si.getSectionIndex(Zr),metrics:null,rect:null};let nc;if("fontStack"in _n){if(nc=Xc(_n,Wn,Mn,ja,ye,Le),!nc)continue;pa.fontStack=_n.fontStack}else{if(ae.iconsInText=!0,_n.scale*=Na,nc=op(_n,Mn,Sn,ja,Pe),!nc)continue;qr=Math.max(qr,nc.imageOffset),pa.imageName=_n.imageName}const{rect:fl,metrics:Vp,baselineOffset:nh}=nc;pa.y+=nh,pa.scale=_n.scale,pa.metrics=Vp,pa.rect=fl,Xi.push(pa),Mn?(ae.verticalizable=!0,Je+=("imageName"in _n?Vp.advance:kn)*_n.scale+rt):Je+=Vp.advance*_n.scale+rt,Zr++}Xi.length!==0&&(oi=Math.max(Je-rt,oi),lf(Xi,0,Xi.length-1,hn)),Je=0,zn.lineOffset=Math.max(qr,(Sn-1)*kn);const Mo=Qe*Sn+qr;pt+=Mo,Ht=Math.max(Mo,Ht),++$n}const{horizontalAlign:dn,verticalAlign:Ji}=sp(Ue);(function(Si,Sn,zn,Xi,qr,ja,Zr,Mo,fa){const _n=(Sn-zn)*qr;let Wn=0;Wn=ja!==Zr?-Mo*Xi- -17:-Xi*fa*Zr+.5*Zr;for(const Mn of Si)for(const pa of Mn.positionedGlyphs)pa.x+=_n,pa.y+=Wn})(ae.positionedLines,hn,dn,Ji,oi,Ht,Qe,pt,je.length),ae.top+=-Ji*pt,ae.bottom=ae.top+pt,ae.left+=-dn*oi,ae.right=ae.left+oi})(te,e,i,o,N,p,y,x,C,T,D,B),!(function(ae){for(const ye of ae)if(ye.positionedGlyphs.length!==0)return!1;return!0})(X)&&te}function sp(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function $m(n,e,i){const o=e.getMaxScale()*kn,{maxImageWidth:u,maxImageHeight:d}=e.getMaxImageSize(n),p=Math.max(o,d*i);return{verticalLineContentWidth:Math.max(o,u*i),horizontalLineContentHeight:p}}function ym(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function of(n,e,i){return!(n===O.az.horizontal||!e&&!Zo(i)||e&&(Bu(i)||(o=i,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function Xc(n,e,i,o,u,d){const p=d[n.fontStack],y=(function(T,A,C,D){if(T&&T.rect)return T;const P=A[C.fontStack],B=P&&P[D];return B?{rect:null,metrics:B.metrics}:null})(p&&p[e],u,n,e);if(y===null)return null;let x;if(i)x=o.verticalLineContentWidth-n.scale*kn;else{const T=ym(n.verticalAlign);x=(o.horizontalLineContentHeight-n.scale*kn)*T}return{rect:y.rect,metrics:y.metrics,baselineOffset:x}}function op(n,e,i,o,u){const d=u[n.imageName];if(!d)return null;const p=d.paddedRect,y=d.displaySize,x={width:y[0],height:y[1],left:1,top:-3,advance:e?y[1]:y[0]};let T;if(e)T=o.verticalLineContentWidth-y[1]*n.scale;else{const A=ym(n.verticalAlign);T=(o.horizontalLineContentHeight-y[1]*n.scale)*A}return{rect:p,metrics:x,baselineOffset:T,imageOffset:(e?y[0]:y[1])*n.scale-kn*i}}function lf(n,e,i,o){if(o===0)return;const u=n[i],d=(n[i].x+u.metrics.advance*u.scale)*o;for(let p=e;p<=i;p++)n[p].x-=d}function lp(n,e,i){const{horizontalAlign:o,verticalAlign:u}=sp(i),d=e[0]-n.displaySize[0]*o,p=e[1]-n.displaySize[1]*u;return{image:n,top:p,bottom:p+n.displaySize[1],left:d,right:d+n.displaySize[0]}}function ll(n){var e,i;let o=n.left,u=n.top,d=n.right-o,p=n.bottom-u;const y=(e=n.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",x=(i=n.image.textFitHeight)!==null&&i!==void 0?i:"stretchOrShrink",T=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(x==="proportional"){if(y==="stretchOnly"&&d/p<T||y==="proportional"){const A=Math.ceil(p*T);o*=A/d,d=A}}else if(y==="proportional"&&x==="stretchOnly"&&T!==0&&d/p>T){const A=Math.ceil(d/T);u*=A/p,p=A}return{x1:o,y1:u,x2:o+d,y2:u+p}}function Gs(n,e,i,o,u,d){const p=n.image;let y;if(p.content){const N=p.content,G=p.pixelRatio||1;y=[N[0]/G,N[1]/G,p.displaySize[0]-N[2]/G,p.displaySize[1]-N[3]/G]}const x=e.left*d,T=e.right*d;let A,C,D,P;i==="width"||i==="both"?(P=u[0]+x-o[3],C=u[0]+T+o[1]):(P=u[0]+(x+T-p.displaySize[0])/2,C=P+p.displaySize[0]);const B=e.top*d,k=e.bottom*d;return i==="height"||i==="both"?(A=u[1]+B-o[0],D=u[1]+k+o[2]):(A=u[1]+(B+k-p.displaySize[1])/2,D=A+p.displaySize[1]),{image:p,top:A,right:C,bottom:D,left:P,collisionPadding:y}}tt("ImagePosition",Ii),tt("ImageAtlas",sf),O.az=void 0,(Yl=O.az||(O.az={}))[Yl.none=0]="none",Yl[Yl.horizontal=1]="horizontal",Yl[Yl.vertical=2]="vertical",Yl[Yl.horizontalOnly=3]="horizontalOnly";const Ur=128,$l=32640;function up(n,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new gi(n+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=i;let d=0;for(;d<o.length&&o[d]<=n;)d++;d=Math.max(0,d-1);let p=d;for(;p<o.length&&o[p]<n+1;)p++;p=Math.min(o.length-1,p);const y=o[d],x=o[p];return i.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:x,minSize:i.evaluate(new gi(y)),maxSize:i.evaluate(new gi(x)),interpolationType:u}}}function uf(n,e,i){let o="never";const u=n.get(e);return u?o=u:n.get(i)&&(o="always"),o}const vm=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Zh(n,e,i,o,u,d,p,y,x,T,A,C,D){const P=y?Math.min($l,Math.round(y[0])):0,B=y?Math.min($l,Math.round(y[1])):0;n.emplaceBack(e,i,Math.round(32*o),Math.round(32*u),d,p,(P<<1)+(x?1:0),B,16*T,16*A,256*C,256*D)}function cp(n,e,i){n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i)}function hp(n){for(const e of n.sections)if(Ls(e.text))return!0;return!1}class cf{constructor(e){this.layoutVertexArray=new ee,this.indexArray=new we,this.programConfigurations=e,this.segments=new We,this.dynamicLayoutVertexArray=new ce,this.opacityVertexArray=new Me,this.hasVisibleVertices=!1,this.placedSymbolArray=new v}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Vh.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,vm,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}tt("SymbolBuffers",cf);class hf{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new We,this.collisionVertexArray=new be}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,ip.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}tt("CollisionBuffers",hf);class Yc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((p=>p.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=up(this.zoom,i["text-size"]),this.iconSizeData=up(this.zoom,i["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),d=o.get("symbol-z-order");this.canOverlap=uf(o,"text-overlap","text-allow-overlap")!=="never"||uf(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map((p=>O.az[p]))),this.stateDependentLayerIds=this.layers.filter((p=>p.isStateDependent())).map((p=>p.id)),this.sourceID=e.sourceID}createArrays(){this.text=new cf(new _o(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new cf(new _o(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new E,this.lineVertexArray=new z,this.symbolInstances=new S,this.textAnchorOffsets=new I}calculateGlyphDependencies(e,i,o,u,d){for(const p of e)if(i[p.codePointAt(0)]=!0,(o||u)&&d){const y=Gc[p];y&&(i[y.codePointAt(0)]=!0)}}populate(e,i,o){const u=this.layers[0],d=u.layout,p=d.get("text-font"),y=d.get("text-field"),x=d.get("icon-image"),T=(y.value.kind!=="constant"||y.value.value instanceof In&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),A=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,C=d.get("symbol-sort-key");if(this.features=[],!T&&!A)return;const D=i.iconDependencies,P=i.glyphDependencies,B=i.availableImages,k=new gi(this.zoom);for(const{feature:N,id:G,index:J,sourceLayerIndex:q}of e){const X=u._featureFilter.needGeometry,te=jr(N,X);if(!u._featureFilter.filter(k,te,o))continue;let ae,ye;if(X||(te.geometry=js(N)),T){const Pe=u.getValueAndResolveTokens("text-field",te,o,B),je=In.factory(Pe),Qe=this.hasRTLText=this.hasRTLText||hp(je);(!Qe||mr.getRTLTextPluginStatus()==="unavailable"||Qe&&mr.isParsed())&&(ae=Sr(je,u,te))}if(A){const Pe=u.getValueAndResolveTokens("icon-image",te,o,B);ye=Pe instanceof ya?Pe:ya.fromString(Pe)}if(!ae&&!ye)continue;const Le=this.sortFeaturesByKey?C.evaluate(te,{},o):void 0;if(this.features.push({id:G,text:ae,icon:ye,index:J,sourceLayerIndex:q,geometry:te.geometry,properties:N.properties,type:jc.types[N.type],sortKey:Le}),ye&&(D[ye.name]=!0),ae){const Pe=p.evaluate(te,{},o).join(","),je=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(O.az.vertical)>=0;for(const Qe of ae.sections)if(Qe.image)D[Qe.image.name]=!0;else{const Ue=hs(ae.toString()),Re=Qe.fontStack||Pe,Ee=P[Re]=P[Re]||{};this.calculateGlyphDependencies(Qe.text,Ee,je,this.allowVerticalPlacement,Ue)}}}d.get("symbol-placement")==="line"&&(this.features=(function(N){const G={},J={},q=[];let X=0;function te(Pe){q.push(N[Pe]),X++}function ae(Pe,je,Qe){const Ue=J[Pe];return delete J[Pe],J[je]=Ue,q[Ue].geometry[0].pop(),q[Ue].geometry[0]=q[Ue].geometry[0].concat(Qe[0]),Ue}function ye(Pe,je,Qe){const Ue=G[je];return delete G[je],G[Pe]=Ue,q[Ue].geometry[0].shift(),q[Ue].geometry[0]=Qe[0].concat(q[Ue].geometry[0]),Ue}function Le(Pe,je,Qe){const Ue=Qe?je[0][je[0].length-1]:je[0][0];return`${Pe}:${Ue.x}:${Ue.y}`}for(let Pe=0;Pe<N.length;Pe++){const je=N[Pe],Qe=je.geometry,Ue=je.text?je.text.toString():null;if(!Ue){te(Pe);continue}const Re=Le(Ue,Qe),Ee=Le(Ue,Qe,!0);if(Re in J&&Ee in G&&J[Re]!==G[Ee]){const rt=ye(Re,Ee,Qe),it=ae(Re,Ee,q[rt].geometry);delete G[Re],delete J[Ee],J[Le(Ue,q[it].geometry,!0)]=it,q[rt].geometry=null}else Re in J?ae(Re,Ee,Qe):Ee in G?ye(Re,Ee,Qe):(te(Pe),G[Re]=X-1,J[Ee]=X-1)}return q.filter((Pe=>Pe.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((N,G)=>N.sortKey-G.sortKey))}update(e,i,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,{imagePositions:o}),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,{imagePositions:o}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0){let u=e.dist(i[e.segment+1]),d=e.dist(i[e.segment]);const p={};for(let y=e.segment+1;y<i.length;y++)p[y]={x:i[y].x,y:i[y].y,tileUnitDistanceFromAnchor:u},y<i.length-1&&(u+=i[y+1].dist(i[y]));for(let y=e.segment||0;y>=0;y--)p[y]={x:i[y].x,y:i[y].y,tileUnitDistanceFromAnchor:d},y>0&&(d+=i[y-1].dist(i[y]));for(let y=0;y<i.length;y++){const x=p[y];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,u,d,p,y,x,T,A,C,D){const P=e.indexArray,B=e.layoutVertexArray,k=e.segments.prepareSegment(4*i.length,B,P,this.canOverlap?p.sortKey:void 0),N=this.glyphOffsetArray.length,G=k.vertexLength,J=this.allowVerticalPlacement&&y===O.az.vertical?Math.PI/2:0,q=p.text&&p.text.sections;for(let X=0;X<i.length;X++){const{tl:te,tr:ae,bl:ye,br:Le,tex:Pe,pixelOffsetTL:je,pixelOffsetBR:Qe,minFontScaleX:Ue,minFontScaleY:Re,glyphOffset:Ee,isSDF:rt,sectionIndex:it}=i[X],ot=k.vertexLength,Je=Ee[1];Zh(B,x.x,x.y,te.x,Je+te.y,Pe.x,Pe.y,o,rt,je.x,je.y,Ue,Re),Zh(B,x.x,x.y,ae.x,Je+ae.y,Pe.x+Pe.w,Pe.y,o,rt,Qe.x,je.y,Ue,Re),Zh(B,x.x,x.y,ye.x,Je+ye.y,Pe.x,Pe.y+Pe.h,o,rt,je.x,Qe.y,Ue,Re),Zh(B,x.x,x.y,Le.x,Je+Le.y,Pe.x+Pe.w,Pe.y+Pe.h,o,rt,Qe.x,Qe.y,Ue,Re),cp(e.dynamicLayoutVertexArray,x,J),P.emplaceBack(ot,ot+2,ot+1),P.emplaceBack(ot+1,ot+2,ot+3),k.vertexLength+=4,k.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ee[0]),X!==i.length-1&&it===i[X+1].sectionIndex||e.programConfigurations.populatePaintArrays(B.length,p,p.index,{imagePositions:{},canonical:D,formattedSection:q&&q[it]})}e.placedSymbolArray.emplaceBack(x.x,x.y,N,this.glyphOffsetArray.length-N,G,T,A,x.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],y,0,!1,0,C)}_addCollisionDebugVertex(e,i,o,u,d,p){return i.emplaceBack(0,0),e.emplaceBack(o.x,o.y,u,d,Math.round(p.x),Math.round(p.y))}addCollisionDebugVertices(e,i,o,u,d,p,y){const x=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),T=x.vertexLength,A=d.layoutVertexArray,C=d.collisionVertexArray,D=y.anchorX,P=y.anchorY;this._addCollisionDebugVertex(A,C,p,D,P,new De(e,i)),this._addCollisionDebugVertex(A,C,p,D,P,new De(o,i)),this._addCollisionDebugVertex(A,C,p,D,P,new De(o,u)),this._addCollisionDebugVertex(A,C,p,D,P,new De(e,u)),x.vertexLength+=4;const B=d.indexArray;B.emplaceBack(T,T+1),B.emplaceBack(T+1,T+2),B.emplaceBack(T+2,T+3),B.emplaceBack(T+3,T),x.primitiveLength+=4}addDebugCollisionBoxes(e,i,o,u){for(let d=e;d<i;d++){const p=this.collisionBoxArray.get(d);this.addCollisionDebugVertices(p.x1,p.y1,p.x2,p.y2,u?this.textCollisionBox:this.iconCollisionBox,p.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new hf(_e,Tr.members,Xe),this.iconCollisionBox=new hf(_e,Tr.members,Xe);for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(e,i,o,u,d,p,y,x,T){const A={};for(let C=i;C<o;C++){const D=e.get(C);A.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.textFeatureIndex=D.featureIndex;break}for(let C=u;C<d;C++){const D=e.get(C);A.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.verticalTextFeatureIndex=D.featureIndex;break}for(let C=p;C<y;C++){const D=e.get(C);A.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.iconFeatureIndex=D.featureIndex;break}for(let C=x;C<T;C++){const D=e.get(C);A.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.verticalIconFeatureIndex=D.featureIndex;break}return A}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),u=o.vertexStartIndex+4*o.numGlyphs;for(let d=o.vertexStartIndex;d<u;d+=4)e.indexArray.emplaceBack(d,d+2,d+1),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),u=[],d=[],p=[];for(let y=0;y<this.symbolInstances.length;++y){p.push(y);const x=this.symbolInstances.get(y);u.push(0|Math.round(i*x.anchorX+o*x.anchorY)),d.push(x.featureIndex)}return p.sort(((y,x)=>u[y]-u[x]||d[x]-d[y])),p}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(((u,d,p)=>{u>=0&&p.indexOf(u)===d&&this.addIndicesForPlacedSymbol(this.text,u)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let df,ff;tt("SymbolBucket",Yc,{omit:["layers","collisionBoxArray","features","compareText"]}),Yc.MAX_GLYPHS=65535,Yc.addDynamicAttributes=cp;var dp={get paint(){return ff=ff||new mn({"icon-opacity":new lt(ge.paint_symbol["icon-opacity"]),"icon-color":new lt(ge.paint_symbol["icon-color"]),"icon-halo-color":new lt(ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new lt(ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new lt(ge.paint_symbol["icon-halo-blur"]),"icon-translate":new at(ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new at(ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new lt(ge.paint_symbol["text-opacity"]),"text-color":new lt(ge.paint_symbol["text-color"],{runtimeType:Ga,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new lt(ge.paint_symbol["text-halo-color"]),"text-halo-width":new lt(ge.paint_symbol["text-halo-width"]),"text-halo-blur":new lt(ge.paint_symbol["text-halo-blur"]),"text-translate":new at(ge.paint_symbol["text-translate"]),"text-translate-anchor":new at(ge.paint_symbol["text-translate-anchor"])})},get layout(){return df=df||new mn({"symbol-placement":new at(ge.layout_symbol["symbol-placement"]),"symbol-spacing":new at(ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new at(ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new lt(ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new at(ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new at(ge.layout_symbol["icon-allow-overlap"]),"icon-overlap":new at(ge.layout_symbol["icon-overlap"]),"icon-ignore-placement":new at(ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new at(ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new at(ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new lt(ge.layout_symbol["icon-size"]),"icon-text-fit":new at(ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new at(ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new lt(ge.layout_symbol["icon-image"]),"icon-rotate":new lt(ge.layout_symbol["icon-rotate"]),"icon-padding":new lt(ge.layout_symbol["icon-padding"]),"icon-keep-upright":new at(ge.layout_symbol["icon-keep-upright"]),"icon-offset":new lt(ge.layout_symbol["icon-offset"]),"icon-anchor":new lt(ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new at(ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new at(ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new at(ge.layout_symbol["text-rotation-alignment"]),"text-field":new lt(ge.layout_symbol["text-field"]),"text-font":new lt(ge.layout_symbol["text-font"]),"text-size":new lt(ge.layout_symbol["text-size"]),"text-max-width":new lt(ge.layout_symbol["text-max-width"]),"text-line-height":new at(ge.layout_symbol["text-line-height"]),"text-letter-spacing":new lt(ge.layout_symbol["text-letter-spacing"]),"text-justify":new lt(ge.layout_symbol["text-justify"]),"text-radial-offset":new lt(ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new at(ge.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new lt(ge.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new lt(ge.layout_symbol["text-anchor"]),"text-max-angle":new at(ge.layout_symbol["text-max-angle"]),"text-writing-mode":new at(ge.layout_symbol["text-writing-mode"]),"text-rotate":new lt(ge.layout_symbol["text-rotate"]),"text-padding":new at(ge.layout_symbol["text-padding"]),"text-keep-upright":new at(ge.layout_symbol["text-keep-upright"]),"text-transform":new lt(ge.layout_symbol["text-transform"]),"text-offset":new lt(ge.layout_symbol["text-offset"]),"text-allow-overlap":new at(ge.layout_symbol["text-allow-overlap"]),"text-overlap":new at(ge.layout_symbol["text-overlap"]),"text-ignore-placement":new at(ge.layout_symbol["text-ignore-placement"]),"text-optional":new at(ge.layout_symbol["text-optional"])})}};class xm{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Ri,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}tt("FormatSectionOverride",xm,{omit:["defaultValue"]});class Wl extends Qi{constructor(e,i){super(e,dp,i)}recalculate(e,i){if(super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const d of o)u.indexOf(d)<0&&u.push(d);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,i,o,u){const d=this.layout.get(e).evaluate(i,{},o,u),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||uo(p.value)||!d?d:(function(y,x){return x.replace(/{([^{}]+)}/g,((T,A)=>y&&A in y?String(y[A]):""))})(i.properties,d)}createBucket(e){return new Yc(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of dp.paint.overridableProperties){if(!Wl.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new xm(i),u=new wc(o,i.property.specification);let d=null;d=i.value.kind==="constant"||i.value.kind==="source"?new Ta("source",u):new co("composite",u,i.value.zoomStops),this.paint._values[e]=new Ja(i.property,d,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&Wl.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),u=dp.paint.properties[i];let d=!1;const p=y=>{for(const x of y)if(u.overrides&&u.overrides.hasOverride(x))return void(d=!0)};if(o.value.kind==="constant"&&o.value.value instanceof In)p(o.value.value.sections);else if(o.value.kind==="source"||o.value.kind==="composite"){const y=T=>{d||(T instanceof Za&&Ui(T.value)===Yr?p(T.value.sections):T instanceof _u?p(T.sections):T.eachChild(y))},x=o.value;x._styleExpression&&y(x._styleExpression.expression)}return d}}let bm;var wm={get paint(){return bm=bm||new mn({"background-color":new at(ge.paint_background["background-color"]),"background-pattern":new jl(ge.paint_background["background-pattern"]),"background-opacity":new at(ge.paint_background["background-opacity"])})}};class ni extends Qi{constructor(e,i){super(e,wm,i)}}class fp extends Qi{constructor(e,i){super(e,{},i),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class pf{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const pp={once:!0},mf=63710088e-1;class To{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new To(Yt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,u=e.lat*i,d=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return mf*Math.acos(Math.min(d,1))}static convert(e){if(e instanceof To)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new To(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new To(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const $c=2*Math.PI*mf;function Hh(n){return $c*Math.cos(n*Math.PI/180)}function Tm(n){return(180+n)/360}function mp(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Sm(n,e){return n/Hh(e)}function Mm(n){return 360*n-180}function Xh(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function gp(n,e){return n*Hh(Xh(e))}class wi{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=To.convert(e);return new wi(Tm(o.lng),mp(o.lat),Sm(i,o.lat))}toLngLat(){return new To(Mm(this.x),Xh(this.y))}toAltitude(){return gp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/$c*(e=Xh(this.y),1/Math.cos(e*Math.PI/180));var e}}function gf(n,e,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[n*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class na{constructor(e,i,o){if(!(function(u,d,p){return!(u<0||u>25||p<0||p>=Math.pow(2,u)||d<0||d>=Math.pow(2,u))})(e,i,o))throw new Error(`x=${i}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=i,this.y=o,this.key=Wc(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i,o){const u=(function(p,y,x){var T=gf(256*p,256*(y=Math.pow(2,x)-y-1),x),A=gf(256*(p+1),256*(y+1),x);return T[0]+","+T[1]+","+A[0]+","+A[1]})(this.x,this.y,this.z),d=(function(p,y,x){let T,A="";for(let C=p;C>0;C--)T=1<<C-1,A+=(y&T?1:0)+(x&T?2:0);return A})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,d).replace(/{bbox-epsg-3857}/g,u)}isChildOf(e){const i=this.z-e.z;return i>0&&e.x===this.x>>i&&e.y===this.y>>i}getTilePoint(e){const i=Math.pow(2,this.z);return new De((e.x*i-this.x)*gt,(e.y*i-this.y)*gt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Am{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Wc(e,i.z,i.z,i.x,i.y)}}class Mr{constructor(e,i,o,u,d){if(this.terrainRttPosMatrix32f=null,e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=i,this.canonical=new na(o,+u,+d),this.key=Wc(i,e,o,u,d)}clone(){return new Mr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-e;return e>this.canonical.z?new Mr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Mr(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,i){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?Wc(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y):Wc(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const i=this.canonical.z-e.canonical.z;return!(i<0)&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Mr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new Mr(i,this.wrap,i,o,u),new Mr(i,this.wrap,i,o+1,u),new Mr(i,this.wrap,i,o,u+1),new Mr(i,this.wrap,i,o+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Mr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Mr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Am(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new wi(e.x-this.wrap,e.y))}}function Wc(n,e,i,o,u){(n*=2)<0&&(n=-1*n-1);const d=1<<i;return(d*d*n+d*u+o).toString(36)+i.toString(36)+e.toString(36)}function Yh(n,e){return e?n.properties[e]:n.id}function _p(n,e){const i={id:n.id};if(e.removeAllProperties&&(delete n.removeProperties,delete n.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const o of e.removeProperties){const u=n.addOrUpdateProperties.findIndex((d=>d.key===o));u>-1&&n.addOrUpdateProperties.splice(u,1)}return(n.removeAllProperties||e.removeAllProperties)&&(i.removeAllProperties=!0),(n.removeProperties||e.removeProperties)&&(i.removeProperties=[...n.removeProperties||[],...e.removeProperties||[]]),(n.addOrUpdateProperties||e.addOrUpdateProperties)&&(i.addOrUpdateProperties=[...n.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(n.newGeometry||e.newGeometry)&&(i.newGeometry=e.newGeometry||n.newGeometry),i}function $h(n){var e,i;if(!n)return{};const o={};return o.removeAll=n.removeAll,o.remove=new Set(n.remove||[]),o.add=new Map((e=n.add)===null||e===void 0?void 0:e.map((u=>[u.id,u]))),o.update=new Map((i=n.update)===null||i===void 0?void 0:i.map((u=>[u.id,u]))),o}tt("CanonicalTileID",na),tt("OverscaledTileID",Mr,{omit:["terrainRttPosMatrix32f"]});class Ql{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const i=new Ql;return i.extend(e(new De(this.minX,this.minY))),i.extend(e(new De(this.maxX,this.minY))),i.extend(e(new De(this.minX,this.maxY))),i.extend(e(new De(this.maxX,this.maxY))),i}static fromPoints(e){const i=new Ql;for(const o of e)i.extend(o);return i}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class yp{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class _f{constructor(e,i,o,u,d){this.type="Feature",this._vectorTileFeature=e,this._x=o,this._y=u,this._z=i,this.properties=e.properties,this.id=d}projectPoint(e,i,o,u){return[360*(e.x+i)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+o)/u)*Math.PI))-90]}projectLine(e,i,o,u){return e.map((d=>this.projectPoint(d,i,o,u)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,i=e.extent*Math.pow(2,this._z),o=e.extent*this._x,u=e.extent*this._y,d=e.loadGeometry();switch(e.type){case 1:{const p=[];for(const x of d)p.push(x[0]);const y=this.projectLine(p,o,u,i);this._geometry=p.length===1?{type:"Point",coordinates:y[0]}:{type:"MultiPoint",coordinates:y};break}case 2:{const p=d.map((y=>this.projectLine(y,o,u,i)));this._geometry=p.length===1?{type:"LineString",coordinates:p[0]}:{type:"MultiLineString",coordinates:p};break}case 3:{const p=am(d),y=[];for(const x of p)y.push(x.map((T=>this.projectLine(T,o,u,i))));this._geometry=y.length===1?{type:"Polygon",coordinates:y[0]}:{type:"MultiPolygon",coordinates:y};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&i!=="_x"&&i!=="_y"&&i!=="_z"&&(e[i]=this[i]);return e}}class Kl{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,i,o){this._name=e,this.dataBuffer=i,typeof o=="number"?this._size=o:(this.nullabilityBuffer=o,this._size=o.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class yf extends Kl{}class vf extends yf{getValueFromBuffer(e){return this.dataBuffer[e]}}class vp extends yf{getValueFromBuffer(e){return this.dataBuffer[e]}}class xp extends Kl{delta;constructor(e,i,o,u){super(e,i,u),this.delta=o}}class bp extends xp{constructor(e,i,o,u){super(e,Int32Array.of(i),o,u)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class wp extends Kl{constructor(e,i,o){super(e,Int32Array.of(i),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}class Jl{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,i,o,u,d=4096){this._name=e,this._geometryVector=i,this._idVector=o,this._propertyVectors=u,this._extent=d}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((i=>[i.name,i])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let i=0;for(;i<this.numFeatures;){let o;this.idVector&&(o=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(i)):this.idVector.getValue(i));const u=e?.next().value,d={};for(const p of this.propertyVectors){if(!p)continue;const y=p.name,x=p.getValue(i);x!==null&&(d[y]=x)}i++,yield{id:o,geometry:u,properties:d}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],i=this.geometryVector.getGeometries();for(let o=0;o<this.numFeatures;o++){let u;this.idVector&&(u=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(o)):this.idVector.getValue(o));const d={coordinates:i[o],type:this.geometryVector.geometryType(o)},p={};for(const y of this.propertyVectors){if(!y)continue;const x=y.name,T=y.getValue(o);T!==null&&(p[x]=T)}e.push({id:u,geometry:d,properties:p})}return e}containsMaxSaveIntegerValues(e){return e instanceof vf||e instanceof wp&&e instanceof bp||e instanceof vp}}class Em{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var Gt,qs,ha,Zs,eu,ka,Cn,Xn,Gr,ar;function Yn(n,e,i){const o=new Int32Array(i);let u=0,d=e.get();for(let p=0;p<o.length;p++){let y=n[d++],x=127&y;y<128||(y=n[d++],x|=(127&y)<<7,y<128||(y=n[d++],x|=(127&y)<<14,y<128||(y=n[d++],x|=(127&y)<<21,y<128||(y=n[d++],x|=(15&y)<<28)))),o[u++]=x}return e.set(d),o}function Wh(n,e,i){const o=new BigInt64Array(i);for(let u=0;u<o.length;u++)o[u]=xf(n,e);return o}function Cm(n,e){let i,o;return o=n[e.get()],e.increment(),i=127&o,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<7,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<14,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<21,o<128?i:(o=n[e.get()],i|=(15&o)<<28,(function(u,d,p){let y,x;if(x=d[p.get()],p.increment(),y=(112&x)>>4,x<128||(x=d[p.get()],p.increment(),y|=(127&x)<<3,x<128)||(x=d[p.get()],p.increment(),y|=(127&x)<<10,x<128)||(x=d[p.get()],p.increment(),y|=(127&x)<<17,x<128)||(x=d[p.get()],p.increment(),y|=(127&x)<<24,x<128)||(x=d[p.get()],p.increment(),y|=(1&x)<<31,x<128))return 4294967296*y+(u>>>0);throw new Error("Expected varint not more than 10 bytes")})(i,n,e)))))}function Qc(n,e,i,o){throw new Error("FastPFor is not implemented yet.")}function da(n){return n>>>1^-(1&n)}function ec(n){return n>>1n^-(1n&n)}function xf(n,e){let i=0n,o=0,u=e.get();for(;u<n.length;){const d=n[u++];if(i|=BigInt(127&d)<<BigInt(o),!(128&d))break;if(o+=7,o>=64)throw new Error("Varint too long")}return e.set(u),i}function So(n,e,i){const o=new Int32Array(i);let u=0;for(let d=0;d<e;d++){const p=n[d];o.fill(n[d+e],u,u+p),u+=p}return o}function zm(n,e,i){const o=new BigInt64Array(i);let u=0;for(let d=0;d<e;d++){const p=Number(n[d]);o.fill(n[d+e],u,u+p),u+=p}return o}function Dm(n,e,i){const o=new Float64Array(i);let u=0;for(let d=0;d<e;d++){const p=n[d];o.fill(n[d+e],u,u+p),u+=p}return o}function tu(n){const e=n.length/4*4;let i=1;if(e>=4)for(let o=n[0];i<e-4;i+=4)o=n[i]+=o,o=n[i+1]+=o,o=n[i+2]+=o,o=n[i+3]+=o;for(;i!=n.length;)n[i]+=n[i-1],++i}function Tp(n){n[0]=n[0]>>>1^-(1&n[0]),n[1]=n[1]>>>1^-(1&n[1]);const e=n.length/4*4;let i=2;if(e>=4)for(;i<e-4;i+=4){const o=n[i],u=n[i+1],d=n[i+2],p=n[i+3];n[i]=(o>>>1^-(1&o))+n[i-2],n[i+1]=(u>>>1^-(1&u))+n[i-1],n[i+2]=(d>>>1^-(1&d))+n[i],n[i+3]=(p>>>1^-(1&p))+n[i+1]}for(;i!=n.length;i+=2)n[i]=(n[i]>>>1^-(1&n[i]))+n[i-2],n[i+1]=(n[i+1]>>>1^-(1&n[i+1]))+n[i-1]}(function(n){n.NONE="NONE",n.DELTA="DELTA",n.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",n.RLE="RLE",n.MORTON="MORTON",n.PDE="PDE"})(Gt||(Gt={})),(function(n){n.NONE="NONE",n.FAST_PFOR="FAST_PFOR",n.VARINT="VARINT",n.ALP="ALP"})(qs||(qs={})),(function(n){n.PRESENT="PRESENT",n.DATA="DATA",n.OFFSET="OFFSET",n.LENGTH="LENGTH"})(ha||(ha={}));class Sp{_dictionaryType;_offsetType;_lengthType;constructor(e,i,o){this._dictionaryType=e,this._offsetType=i,this._lengthType=o}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Oa(n,e){const i=(function(o,u){const d=o[u.get()],p=Object.values(ha)[d>>4];let y=null;switch(p){case ha.DATA:y=new Sp(Object.values(Zs)[15&d]);break;case ha.OFFSET:y=new Sp(null,Object.values(eu)[15&d]);break;case ha.LENGTH:y=new Sp(null,null,Object.values(ka)[15&d])}u.increment();const x=o[u.get()],T=Object.values(Gt)[x>>5],A=Object.values(Gt)[x>>2&7],C=Object.values(qs)[3&x];u.increment();const D=Yn(o,u,2),P=D[0];return{physicalStreamType:p,logicalStreamType:y,logicalLevelTechnique1:T,logicalLevelTechnique2:A,physicalLevelTechnique:C,numValues:P,byteLength:D[1],decompressedCount:P}})(n,e);return i.logicalLevelTechnique1===Gt.MORTON?(function(o,u,d){const p=Yn(u,d,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:o.decompressedCount,numBits:p[0],coordinateShift:p[1]}})(i,n,e):Gt.RLE!==i.logicalLevelTechnique1&&Gt.RLE!==i.logicalLevelTechnique2||qs.NONE===i.physicalLevelTechnique?i:(function(o,u,d){const p=Yn(u,d,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:p[1],runs:p[0],numRleValues:p[1]}})(i,n,e)}(function(n){n.NONE="NONE",n.SINGLE="SINGLE",n.SHARED="SHARED",n.VERTEX="VERTEX",n.MORTON="MORTON",n.FSST="FSST"})(Zs||(Zs={})),(function(n){n.VERTEX="VERTEX",n.INDEX="INDEX",n.STRING="STRING",n.KEY="KEY"})(eu||(eu={})),(function(n){n.VAR_BINARY="VAR_BINARY",n.GEOMETRIES="GEOMETRIES",n.PARTS="PARTS",n.RINGS="RINGS",n.TRIANGLES="TRIANGLES",n.SYMBOL="SYMBOL",n.DICTIONARY="DICTIONARY"})(ka||(ka={})),(function(n){n[n.FLAT=0]="FLAT",n[n.CONST=1]="CONST",n[n.SEQUENCE=2]="SEQUENCE",n[n.DICTIONARY=3]="DICTIONARY",n[n.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(Cn||(Cn={}));class Hs{values;_size;constructor(e,i){this.values=e,this._size=i}get(e){const i=Math.floor(e/8);return(this.values[i]>>e%8&1)==1}set(e,i){const o=Math.floor(e/8);this.values[o]=this.values[o]|(i?1:0)<<e%8}getInt(e){const i=Math.floor(e/8);return this.values[i]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function Fa(n,e,i,o,u){return(function(d,p,y){switch(p.logicalLevelTechnique1){case Gt.DELTA:return p.logicalLevelTechnique2===Gt.RLE?(function(x,T,A){const C=new Int32Array(A);let D=0,P=0;for(let B=0;B<T;B++){const k=x[B],N=da(x[B+T]);for(let G=0;G<k;G++)P+=N,C[D++]=P}return C})(d,p.runs,p.numRleValues):((function(x){x[0]=x[0]>>>1^-(1&x[0]);const T=x.length/4*4;let A=1;if(T>=4)for(;A<T-4;A+=4){const C=x[A],D=x[A+1],P=x[A+2],B=x[A+3];x[A]=(C>>>1^-(1&C))+x[A-1],x[A+1]=(D>>>1^-(1&D))+x[A],x[A+2]=(P>>>1^-(1&P))+x[A+1],x[A+3]=(B>>>1^-(1&B))+x[A+2]}for(;A!=x.length;++A)x[A]=(x[A]>>>1^-(1&x[A]))+x[A-1]})(d),d);case Gt.RLE:return(function(x,T,A){return A?(function(C,D,P){const B=new Int32Array(P);let k=0;for(let N=0;N<D;N++){const G=C[N];let J=C[N+D];J=J>>>1^-(1&J),B.fill(J,k,k+G),k+=G}return B})(x,T.runs,T.numRleValues):So(x,T.runs,T.numRleValues)})(d,p,y);case Gt.MORTON:return tu(d),d;case Gt.COMPONENTWISE_DELTA:return Tp(d),d;case Gt.NONE:return y&&(function(x){for(let T=0;T<x.length;T++){const A=x[T];x[T]=A>>>1^-(1&A)}})(d),d;default:throw new Error(`The specified Logical level technique is not supported: ${p.logicalLevelTechnique1}`)}})(bf(n,e,i),i,o)}function iu(n,e,i){return(function(o,u){if(u.logicalLevelTechnique1===Gt.DELTA&&u.logicalLevelTechnique2===Gt.NONE)return(function(p){const y=new Int32Array(p.length+1);y[0]=0,y[1]=da(p[0]);let x=y[1],T=2;for(;T!=y.length;++T){const A=p[T-1];x+=A>>>1^-(1&A),y[T]=y[T-1]+x}return y})(o);if(u.logicalLevelTechnique1===Gt.RLE&&u.logicalLevelTechnique2===Gt.NONE)return(function(p,y,x){const T=new Int32Array(x+1);T[0]=0;let A=1,C=T[0];for(let D=0;D<y;D++){const P=p[D],B=p[D+y];for(let k=A;k<A+P;k++)T[k]=B+C,C=T[k];A+=P}return T})(o,u.runs,u.numRleValues);if(u.logicalLevelTechnique1===Gt.NONE&&u.logicalLevelTechnique2===Gt.NONE){(function(p){let y=0;for(let x=0;x<p.length;x++)p[x]+=y,y=p[x]})(o);const d=new Int32Array(u.numValues+1);return d[0]=0,d.set(o,1),d}if(u.logicalLevelTechnique1===Gt.DELTA&&u.logicalLevelTechnique2===Gt.RLE){const d=(function(p,y,x){const T=new Int32Array(x+1);T[0]=0;let A=1,C=T[0];for(let D=0;D<y;D++){const P=p[D];let B=p[D+y];B=B>>>1^-(1&B);for(let k=A;k<A+P;k++)T[k]=B+C,C=T[k];A+=P}return T})(o,u.runs,u.numRleValues);return tu(d),d}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(bf(n,e,i),i)}function bf(n,e,i){const o=i.physicalLevelTechnique;if(o===qs.FAST_PFOR)return Qc();if(o===qs.VARINT)return Yn(n,e,i.numValues);if(o===qs.NONE){const u=e.get();e.add(i.byteLength);const d=n.subarray(u,e.get());return new Int32Array(d)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function Mp(n,e,i,o){const u=bf(n,e,i);if(u.length===1){const d=u[0];return o?da(d):d}return o?(function(d){return da(d[1])})(u):(function(d){return d[1]})(u)}function Ap(n,e,i){return(function(o){if(o.length==2){const u=da(o[1]);return[u,u]}return[da(o[2]),da(o[3])]})(bf(n,e,i))}function tc(n,e,i){return(function(o){if(o.length==2){const u=ec(o[1]);return[u,u]}return[ec(o[2]),ec(o[3])]})(Wh(n,e,i.numValues))}function Kc(n,e,i,o){return(function(u,d,p){switch(d.logicalLevelTechnique1){case Gt.DELTA:return d.logicalLevelTechnique2===Gt.RLE?(function(y,x,T){const A=new BigInt64Array(T);let C=0,D=0n;for(let P=0;P<x;P++){const B=Number(y[P]),k=ec(y[P+x]);for(let N=0;N<B;N++)D+=k,A[C++]=D}return A})(u,d.runs,d.numRleValues):((function(y){y[0]=y[0]>>1n^-(1n&y[0]);const x=y.length/4*4;let T=1;if(x>=4)for(;T<x-4;T+=4){const A=y[T],C=y[T+1],D=y[T+2],P=y[T+3];y[T]=(A>>1n^-(1n&A))+y[T-1],y[T+1]=(C>>1n^-(1n&C))+y[T],y[T+2]=(D>>1n^-(1n&D))+y[T+1],y[T+3]=(P>>1n^-(1n&P))+y[T+2]}for(;T!=y.length;++T)y[T]=(y[T]>>1n^-(1n&y[T]))+y[T-1]})(u),u);case Gt.RLE:return(function(y,x,T){return T?(function(A,C,D){const P=new BigInt64Array(D);let B=0;for(let k=0;k<C;k++){const N=Number(A[k]);let G=A[k+C];G=G>>1n^-(1n&G),P.fill(G,B,B+N),B+=N}return P})(y,x.runs,x.numRleValues):zm(y,x.runs,x.numRleValues)})(u,d,p);case Gt.NONE:return p&&(function(y){for(let x=0;x<y.length;x++){const T=y[x];y[x]=T>>1n^-(1n&T)}})(u),u;default:throw new Error(`The specified Logical level technique is not supported: ${d.logicalLevelTechnique1}`)}})(Wh(n,e,i.numValues),i,o)}function Ep(n,e,i,o){const u=Wh(n,e,i.numValues);if(u.length===1){const d=u[0];return o?ec(d):d}return o?(function(d){return ec(d[1])})(u):(function(d){return d[1]})(u)}function Cp(n,e,i,o,u){return(function(d,p,y,x){switch(p.logicalLevelTechnique1){case Gt.DELTA:return p.logicalLevelTechnique2===Gt.RLE&&(d=So(d,p.runs,p.numRleValues)),(function(T,A){const C=new Int32Array(T.size());let D=0;T.get(0)?(C[0]=T.get(0)?A[0]>>>1^-(1&A[0]):0,D=1):C[0]=0;let P=1;for(;P!=C.length;++P)C[P]=T.get(P)?C[P-1]+(A[D]>>>1^-(1&A[D++])):C[P-1];return C})(x,d);case Gt.RLE:return(function(T,A,C,D){const P=A;return C?(function(B,k,N){const G=new Int32Array(B.size());let J=0;for(let q=0;q<N;q++){const X=k[q];let te=k[q+N];te=te>>>1^-(1&te);for(let ae=J;ae<J+X;ae++)B.get(ae)?G[ae]=te:(G[ae]=0,J++);J+=X}return G})(D,T,P.runs):(function(B,k,N){const G=new Int32Array(B.size());let J=0;for(let q=0;q<N;q++){const X=k[q],te=k[q+N];for(let ae=J;ae<J+X;ae++)B.get(ae)?G[ae]=te:(G[ae]=0,J++);J+=X}return G})(D,T,P.runs)})(d,p,y,x);case Gt.MORTON:return tu(d),d;case Gt.COMPONENTWISE_DELTA:return Tp(d),d;case Gt.NONE:return d=y?(function(T,A){const C=new Int32Array(T.size());let D=0,P=0;for(;P!=C.length;++P)if(T.get(P)){const B=A[D++];C[P]=B>>>1^-(1&B)}else C[P]=0;return C})(x,d):(function(T,A){const C=new Int32Array(T.size());let D=0,P=0;for(;P!=C.length;++P)C[P]=T.get(P)?A[D++]:0;return C})(x,d),d;default:throw new Error("The specified Logical level technique is not supported")}})(i.physicalLevelTechnique===qs.FAST_PFOR?Qc():Yn(n,e,i.numValues),i,o,u)}function ul(n,e,i,o){const u=n.logicalLevelTechnique1;if(u===Gt.RLE)return n.runs===1?Cn.CONST:Cn.FLAT;const d=e instanceof Hs?e.size():e;if(u===Gt.DELTA&&n.logicalLevelTechnique2===Gt.RLE){const p=n.runs,y=2;if(n.numRleValues!==d)return Cn.FLAT;if(p===1)return Cn.SEQUENCE;if(p===2){const x=o.get();let T;if(n.physicalLevelTechnique===qs.VARINT)T=Yn(i,o,4);else{const A=o.get();T=new Int32Array(i.buffer,i.byteOffset+A,4)}if(o.set(x),T[2]===y&&T[3]===y)return Cn.SEQUENCE}}return n.numValues===1?Cn.CONST:Cn.FLAT}class Jc extends yf{getValueFromBuffer(e){return this.dataBuffer[e]}}class zp extends xp{constructor(e,i,o,u){super(e,BigInt64Array.of(i),o,u)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class cl{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,i,o){this._geometryOffsets=e,this._partOffsets=i,this._ringOffsets=o}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function Qh(n,e,i){return{x:wf(n,e)-i,y:wf(n>>1,e)-i}}function wf(n,e){let i=0;for(let o=0;o<e;o++)i|=(n&1<<2*o)>>o;return i}(function(n){n[n.POINT=0]="POINT",n[n.LINESTRING=1]="LINESTRING",n[n.POLYGON=2]="POLYGON",n[n.MULTIPOINT=3]="MULTIPOINT",n[n.MULTILINESTRING=4]="MULTILINESTRING",n[n.MULTIPOLYGON=5]="MULTIPOLYGON"})(Xn||(Xn={})),(function(n){n[n.POINT=0]="POINT",n[n.LINESTRING=1]="LINESTRING",n[n.POLYGON=2]="POLYGON"})(Gr||(Gr={})),(function(n){n[n.MORTON=0]="MORTON",n[n.VEC_2=1]="VEC_2",n[n.VEC_3=2]="VEC_3"})(ar||(ar={}));class Tf{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((i=>[i]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,i){return[e].concat(i)}createMultiPolygon(e){return e.flat()}}function Dp(n){const e=new Array(n.numGeometries);let i=1,o=1,u=1,d=0;const p=new Tf;let y=0,x=0;const T=n.mortonSettings,A=n.topologyVector,C=A.geometryOffsets,D=A.partOffsets,P=A.ringOffsets,B=n.vertexOffsets,k=n.containsPolygonGeometry(),N=n.vertexBuffer;for(let G=0;G<n.numGeometries;G++){const J=n.geometryType(G);if(J===Xn.POINT){if(B&&B.length!==0)if(n.vertexBufferType===ar.VEC_2){const q=2*B[x++],X=new De(N[q],N[q+1]);e[d++]=p.createPoint(X)}else{const q=Qh(N[B[x++]],T.numBits,T.coordinateShift),X=new De(q.x,q.y);e[d++]=p.createPoint(X)}else{const q=new De(N[y++],N[y++]);e[d++]=p.createPoint(q)}C&&u++,D&&i++,P&&o++}else if(J===Xn.MULTIPOINT){const q=C[u]-C[u-1];u++;const X=new Array(q);if(B&&B.length!==0){for(let te=0;te<q;te++){const ae=2*B[x++];X[te]=new De(N[ae],N[ae+1])}e[d++]=p.createMultiPoint(X)}else{for(let te=0;te<q;te++){const ae=N[y++],ye=N[y++];X[te]=new De(ae,ye)}e[d++]=p.createMultiPoint(X)}}else if(J===Xn.LINESTRING){let q,X=0;k?(X=P[o]-P[o-1],o++):X=D[i]-D[i-1],i++,B&&B.length!==0?(q=n.vertexBufferType===ar.VEC_2?ed(N,B,x,X,!1):Ip(N,B,x,X,!1,T),x+=X):(q=Pp(N,y,X,!1),y+=2*X),e[d++]=p.createLineString(q),C&&u++}else if(J===Xn.POLYGON){const q=D[i]-D[i-1];i++;const X=new Array(q-1);let te=P[o]-P[o-1];if(o++,B&&B.length!==0){const ae=n.vertexBufferType===ar.VEC_2?Sf(N,B,x,te):Jh(N,B,x,te,0,T);x+=te;for(let ye=0;ye<X.length;ye++)te=P[o]-P[o-1],o++,X[ye]=n.vertexBufferType===ar.VEC_2?Sf(N,B,x,te):Jh(N,B,x,te,0,T),x+=te;e[d++]=p.createPolygon(ae,X)}else{const ae=Kh(N,y,te);y+=2*te;for(let ye=0;ye<X.length;ye++)te=P[o]-P[o-1],o++,X[ye]=Kh(N,y,te),y+=2*te;e[d++]=p.createPolygon(ae,X)}C&&u++}else if(J===Xn.MULTILINESTRING){const q=C[u]-C[u-1];u++;const X=new Array(q);if(B&&B.length!==0){for(let te=0;te<q;te++){let ae=0;k?(ae=P[o]-P[o-1],o++):ae=D[i]-D[i-1],i++;const ye=n.vertexBufferType===ar.VEC_2?ed(N,B,x,ae,!1):Ip(N,B,x,ae,!1,T);X[te]=ye,x+=ae}e[d++]=p.createMultiLineString(X)}else{for(let te=0;te<q;te++){let ae=0;k?(ae=P[o]-P[o-1],o++):ae=D[i]-D[i-1],i++,X[te]=Pp(N,y,ae,!1),y+=2*ae}e[d++]=p.createMultiLineString(X)}}else{if(J!==Xn.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const q=C[u]-C[u-1];u++;const X=new Array(q);let te=0;if(B&&B.length!==0){for(let ae=0;ae<q;ae++){const ye=D[i]-D[i-1];i++;const Le=new Array(ye-1);te=P[o]-P[o-1],o++;const Pe=n.vertexBufferType===ar.VEC_2?Sf(N,B,x,te):Jh(N,B,x,te,0,T);x+=te;for(let je=0;je<Le.length;je++)te=P[o]-P[o-1],o++,Le[je]=n.vertexBufferType===ar.VEC_2?Sf(N,B,x,te):Jh(N,B,x,te,0,T),x+=te;X[ae]=p.createPolygon(Pe,Le)}e[d++]=p.createMultiPolygon(X)}else{for(let ae=0;ae<q;ae++){const ye=D[i]-D[i-1];i++;const Le=new Array(ye-1);te=P[o]-P[o-1],o++;const Pe=Kh(N,y,te);y+=2*te;for(let je=0;je<Le.length;je++){const Qe=P[o]-P[o-1];o++,Le[je]=Kh(N,y,Qe),y+=2*Qe}X[ae]=p.createPolygon(Pe,Le)}e[d++]=p.createMultiPolygon(X)}}}}return e}function Kh(n,e,i){return Pp(n,e,i,!0)}function Sf(n,e,i,o){return ed(n,e,i,o,!0)}function Jh(n,e,i,o,u,d){return Ip(n,e,i,o,!0,d)}function Pp(n,e,i,o){const u=new Array(o?i+1:i);for(let d=0;d<2*i;d+=2)u[d/2]=new De(n[e+d],n[e+d+1]);return o&&(u[u.length-1]=u[0]),u}function ed(n,e,i,o,u){const d=new Array(u?o+1:o);for(let p=0;p<2*o;p+=2){const y=2*e[i+p/2];d[p/2]=new De(n[y],n[y+1])}return u&&(d[d.length-1]=d[0]),d}function Ip(n,e,i,o,u,d){const p=new Array(u?o+1:o);for(let y=0;y<o;y++){const x=Qh(n[e[i+y]],d.numBits,d.coordinateShift);p[y]=new De(x.x,x.y)}return u&&(p[p.length-1]=p[0]),p}class td{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,i,o,u,d){this._vertexBufferType=e,this._topologyVector=i,this._vertexOffsets=o,this._vertexBuffer=u,this._mortonSettings=d}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=Dp(this);let i=0;for(;i<this.numGeometries;)yield{coordinates:e[i],type:this.geometryType(i)},i++}getSimpleEncodedVertex(e){const i=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const o=Qh(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[o.x,o.y]}const i=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getGeometries(){return Dp(this)}get mortonSettings(){return this._mortonSettings}}class id extends td{_numGeometries;_geometryType;constructor(e,i,o,u,d,p,y){super(o,u,d,p,y),this._numGeometries=e,this._geometryType=i}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===Xn.POLYGON||this._geometryType===Xn.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class nd extends td{_geometryTypes;constructor(e,i,o,u,d,p){super(e,o,u,d,p),this._geometryTypes=i}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===Xn.POLYGON||this.geometryType(e)===Xn.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class Pm{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,i,o,u){this._triangleOffsets=e,this._indexBuffer=i,this._vertexBuffer=o,this._topologyVector=u}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),i=this._topologyVector,o=i.partOffsets,u=i.ringOffsets,d=i.geometryOffsets;let p=0,y=1,x=1,T=1;for(let A=0;A<this.numGeometries;A++)switch(this.geometryType(A)){case Xn.POLYGON:{const C=o[y]-o[y-1];y++;const D=[];for(let P=0;P<C;P++){const B=u[x]-u[x-1];x++;const k=[];for(let N=0;N<B;N++){const G=this._vertexBuffer[p++],J=this._vertexBuffer[p++];k.push(new De(G,J))}k.length>0&&k.push(k[0]),D.push(k)}e[A]=D,d&&T++}break;case Xn.MULTIPOLYGON:{const C=d[T]-d[T-1];T++;const D=[];for(let P=0;P<C;P++){const B=o[y]-o[y-1];y++;for(let k=0;k<B;k++){const N=u[x]-u[x-1];x++;const G=[];for(let J=0;J<N;J++){const q=this._vertexBuffer[p++],X=this._vertexBuffer[p++];G.push(new De(q,X))}G.length>0&&G.push(G[0]),D.push(G)}}e[A]=D}}return e}[Symbol.iterator](){return null}}function eh(n,e,i,o,u,d){return new Wm(n,e,i,o,u,d)}class Wm extends Pm{_numGeometries;_geometryType;constructor(e,i,o,u,d,p){super(o,u,d,p),this._numGeometries=e,this._geometryType=i}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function Rp(n,e,i,o,u){return new Im(n,e,i,o,u)}class Im extends Pm{_geometryTypes;constructor(e,i,o,u,d){super(i,o,u,d),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function Rm(n,e,i,o,u){const d=Oa(n,i);let p=null,y=null,x=null,T=null,A=null,C=null,D=null,P=null;if(ul(d,o,n,i)===Cn.CONST){const k=Mp(n,i,d,!1);for(let N=0;N<e-1;N++){const G=Oa(n,i);switch(G.physicalStreamType){case ha.LENGTH:switch(G.logicalStreamType.lengthType){case ka.GEOMETRIES:p=iu(n,i,G);break;case ka.PARTS:y=iu(n,i,G);break;case ka.RINGS:x=iu(n,i,G);break;case ka.TRIANGLES:D=iu(n,i,G)}break;case ha.OFFSET:switch(G.logicalStreamType.offsetType){case eu.VERTEX:T=Fa(n,i,G,!1);break;case eu.INDEX:P=Fa(n,i,G,!1)}break;case ha.DATA:Zs.VERTEX===G.logicalStreamType.dictionaryType?A=Fa(n,i,G,!0):(C={numBits:G.numBits,coordinateShift:G.coordinateShift},A=Fa(n,i,G,!1))}}return P!==null?p!=null||y!=null?eh(o,k,D,P,A,new cl(p,y,x)):eh(o,k,D,P,A):C===null?(function(N,G,J,q,X){return new id(N,G,ar.VEC_2,J,q,X)})(o,k,new cl(p,y,x),T,A):(function(N,G,J,q,X,te){return new id(N,G,ar.MORTON,J,q,X,te)})(o,k,new cl(p,y,x),T,A,C)}const B=Fa(n,i,d,!1);for(let k=0;k<e-1;k++){const N=Oa(n,i);switch(N.physicalStreamType){case ha.LENGTH:switch(N.logicalStreamType.lengthType){case ka.GEOMETRIES:p=Fa(n,i,N,!1);break;case ka.PARTS:y=Fa(n,i,N,!1);break;case ka.RINGS:x=Fa(n,i,N,!1);break;case ka.TRIANGLES:D=iu(n,i,N)}break;case ha.OFFSET:switch(N.logicalStreamType.offsetType){case eu.VERTEX:T=Fa(n,i,N,!1);break;case eu.INDEX:P=Fa(n,i,N,!1)}break;case ha.DATA:Zs.VERTEX===N.logicalStreamType.dictionaryType?A=Fa(n,i,N,!0):(C={numBits:N.numBits,coordinateShift:N.coordinateShift},A=Fa(n,i,N,!1))}}return P!==null&&y===null?Rp(B,D,P,A):(p!==null?(p=Mf(B,p,2),y!==null&&x!==null?(y=Af(B,p,y,!1),x=(function(k,N,G,J){const q=new Int32Array(G[G.length-1]+1);let X=0;q[0]=X;let te=1,ae=1,ye=0;for(let Le=0;Le<k.length;Le++){const Pe=k[Le],je=N[Le+1]-N[Le];if(Pe!==0&&Pe!==3)for(let Qe=0;Qe<je;Qe++){const Ue=G[te]-G[te-1];te++;for(let Re=0;Re<Ue;Re++)X=q[ae++]=X+J[ye++]}else for(let Qe=0;Qe<je;Qe++)q[ae++]=++X,te++}return q})(B,p,y,x)):y!==null&&(y=(function(k,N,G){const J=new Int32Array(N[N.length-1]+1);let q=0;J[0]=q;let X=1,te=0;for(let ae=0;ae<k.length;ae++){const ye=k[ae],Le=N[ae+1]-N[ae];if(ye===4||ye===1)for(let Pe=0;Pe<Le;Pe++)q=J[X++]=q+G[te++];else for(let Pe=0;Pe<Le;Pe++)J[X++]=++q}return J})(B,p,y))):y!==null&&x!==null?(y=Mf(B,y,1),x=Af(B,y,x,!0)):y!==null&&(y=Mf(B,y,0)),P!==null?Rp(B,D,P,A,new cl(p,y,x)):C===null?(function(k,N,G,J){return new nd(ar.VEC_2,k,N,G,J)})(B,new cl(p,y,x),T,A):(function(k,N,G,J,q){return new nd(ar.MORTON,k,N,G,J,q)})(B,new cl(p,y,x),T,A,C))}function Mf(n,e,i){const o=new Int32Array(n.length+1);let u=0;o[0]=u;let d=0;for(let p=0;p<n.length;p++)u=o[p+1]=u+(n[p]>i?e[d++]:1);return o}function Af(n,e,i,o){const u=new Int32Array(e[e.length-1]+1);let d=0;u[0]=d;let p=1,y=0;for(let x=0;x<n.length;x++){const T=n[x],A=e[x+1]-e[x];if(T===5||T===2||o&&(T===4||T===1))for(let C=0;C<A;C++)d=u[p++]=d+i[y++];else for(let C=0;C<A;C++)u[p++]=++d}return u}class Lm extends Kl{dataVector;constructor(e,i,o){super(e,i.getBuffer(),o),this.dataVector=i}getValueFromBuffer(e){return this.dataVector.get(e)}}class Bm extends yf{getValueFromBuffer(e){return this.dataBuffer[e]}}class ad extends Kl{constructor(e,i,o){super(e,BigInt64Array.of(i),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}function rd(n,e,i){return km(n,Math.ceil(e/8),i)}function km(n,e,i){const o=new Uint8Array(e);let u=0;for(;u<e;){const d=n[i.increment()];if(d<=127){const p=d+3,y=n[i.increment()],x=u+p;o.fill(y,u,x),u=x}else{const p=256-d;for(let y=0;y<p;y++)o[u++]=n[i.increment()]}}return o}const Lp=new TextDecoder;function sd(n,e,i){return i-e>=12?Lp.decode(n.subarray(e,i)):(function(o,u,d){let p="",y=u;for(;y<d;){const x=o[y];let T,A,C,D=null,P=x>239?4:x>223?3:x>191?2:1;if(y+P>d)break;P===1?x<128&&(D=x):P===2?(T=o[y+1],(192&T)==128&&(D=(31&x)<<6|63&T,D<=127&&(D=null))):P===3?(T=o[y+1],A=o[y+2],(192&T)==128&&(192&A)==128&&(D=(15&x)<<12|(63&T)<<6|63&A,(D<=2047||D>=55296&&D<=57343)&&(D=null))):P===4&&(T=o[y+1],A=o[y+2],C=o[y+3],(192&T)==128&&(192&A)==128&&(192&C)==128&&(D=(15&x)<<18|(63&T)<<12|(63&A)<<6|63&C,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,P=1):D>65535&&(D-=65536,p+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),p+=String.fromCharCode(D),y+=P}return p})(n,e,i)}class th extends Kl{offsetBuffer;constructor(e,i,o,u){super(e,o,u),this.offsetBuffer=i}}class Ef extends th{textEncoder;constructor(e,i,o,u){super(e,i,o,u??i.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return sd(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class ic extends th{indexBuffer;textEncoder;constructor(e,i,o,u,d){super(e,o,u,d??i.length),this.indexBuffer=i,this.indexBuffer=i,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const i=this.indexBuffer[e];return sd(this.dataBuffer,this.offsetBuffer[i],this.offsetBuffer[i+1])}}class Cf extends th{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,i,o,u,d,p,y){super(e,o,u,y),this.indexBuffer=i,this.symbolOffsetBuffer=d,this.symbolTableBuffer=p,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(o,u,d){const p=[],y=new Array(u.length).fill(0);for(let x=1;x<u.length;x++)y[x]=y[x-1]+u[x-1];for(let x=0;x<d.length;x++)if(d[x]===255)p.push(d[++x]);else{const T=u[d[x]],A=y[d[x]];for(let C=0;C<T;C++)p.push(o[A+C])}return new Uint8Array(p)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const i=this.indexBuffer[e];return sd(this.decodedDictionary,this.offsetBuffer[i],this.offsetBuffer[i+1])}offsetToLengthBuffer(e){const i=new Uint32Array(e.length-1);let o=e[0];for(let u=1;u<e.length;u++){const d=e[u];i[u-1]=d-o,o=d}return i}}function nu(n,e,i,o,u,d){return i.type==="scalarType"?(function(p,y,x,T,A,C){let D=null,P=0;if(p===0)return null;if(C.nullable){const k=Oa(y,x);P=k.numValues;const N=x.get(),G=rd(y,P,x);x.set(N+k.byteLength),D=new Hs(G,k.numValues)}const B=D??T;switch(A.physicalType){case 4:case 3:return(function(k,N,G,J,q){const X=Oa(k,N),te=ul(X,q,k,N),ae=J.physicalType===3;if(te===Cn.FLAT){const ye=xs(q)?Cp(k,N,X,ae,q):Fa(k,N,X,ae);return new vf(G.name,ye,q)}if(te===Cn.SEQUENCE){const ye=Ap(k,N,X);return new bp(G.name,ye[0],ye[1],X.numRleValues)}{const ye=Mp(k,N,X,ae);return new wp(G.name,ye,q)}})(y,x,C,A,B);case 9:return(function(k,N,G,J,q){let X=null,te=null,ae=null,ye=null,Le=null,Pe=null,je=null,Qe=null;for(let Ue=0;Ue<J;Ue++){const Re=Oa(N,G);if(Re.byteLength!==0)switch(Re.physicalStreamType){case ha.PRESENT:{const Ee=rd(N,Re.numValues,G);Pe=new Hs(Ee,Re.numValues);break}case ha.OFFSET:te=q!=null||Pe!=null?Cp(N,G,Re,!1,q??Pe):Fa(N,G,Re,!1);break;case ha.LENGTH:{const Ee=iu(N,G,Re);ka.DICTIONARY===Re.logicalStreamType.lengthType?X=Ee:ka.SYMBOL===Re.logicalStreamType.lengthType?ye=Ee:je=Ee;break}case ha.DATA:{const Ee=N.subarray(G.get(),G.get()+Re.byteLength);G.add(Re.byteLength);const rt=Re.logicalStreamType.dictionaryType;Zs.FSST===rt?Le=Ee:Zs.SINGLE===rt||Zs.SHARED===rt?ae=Ee:Zs.NONE===rt&&(Qe=Ee);break}}}return(function(Ue,Re,Ee,rt,it,ot,Je){return Re?new Cf(Ue,Ee,rt,it,ot,Re,Je):null})(k,Le,te,X,ae,ye,q??Pe)??(function(Ue,Re,Ee,rt,it){return Re?it?new ic(Ue,Ee,rt,Re,it):new ic(Ue,Ee,rt,Re):null})(k,ae,te,X,q??Pe)??(function(Ue,Re,Ee,rt,it){if(!Re||!Ee)return null;if(rt)return it?new ic(Ue,rt,Re,Ee,it):new ic(Ue,rt,Re,Ee);if(it&&it.size()!==Re.length-1){const ot=new Int32Array(it.size());let Je=0;for(let pt=0;pt<it.size();pt++)ot[pt]=it.get(pt)?Je++:0;return new ic(Ue,ot,Re,Ee,it)}return it?new Ef(Ue,Re,Ee,it):new Ef(Ue,Re,Ee)})(k,je,Qe,te,q??Pe)})(C.name,y,x,C.nullable?p-1:p,D);case 0:return(function(k,N,G,J,q){const X=Oa(k,N),te=X.numValues,ae=N.get(),ye=xs(q)?(function(Pe,je,Qe,Ue){const Re=km(Pe,Math.ceil(je/8),Qe),Ee=new Hs(Re,je),rt=Ue.size(),it=new Hs(new Uint8Array(rt),rt);let ot=0;for(let Je=0;Je<Ue.size();Je++){const pt=!!Ue.get(Je)&&Ee.get(ot++);it.set(Je,pt)}return it.getBuffer()})(k,te,N,q):rd(k,te,N);N.set(ae+X.byteLength);const Le=new Hs(ye,te);return new Lm(G.name,Le,q)})(y,x,C,0,B);case 6:case 5:return(function(k,N,G,J,q){const X=Oa(k,N),te=ul(X,J,k,N),ae=q.physicalType===5;if(te===Cn.FLAT){const ye=xs(J)?(function(Le,Pe,je,Qe,Ue){return(function(Re,Ee,rt,it){switch(Ee.logicalLevelTechnique1){case Gt.DELTA:return Ee.logicalLevelTechnique2===Gt.RLE&&(Re=zm(Re,Ee.runs,Ee.numRleValues)),(function(ot,Je){const pt=new BigInt64Array(ot.size());let oi=0;ot.get(0)?(pt[0]=ot.get(0)?Je[0]>>1n^-(1n&Je[0]):0n,oi=1):pt[0]=0n;let Ht=1;for(;Ht!=pt.length;++Ht)pt[Ht]=ot.get(Ht)?pt[Ht-1]+(Je[oi]>>1n^-(1n&Je[oi++])):pt[Ht-1];return pt})(it,Re);case Gt.RLE:return(function(ot,Je,pt,oi){const Ht=Je;return pt?(function(hn,Na,$n){const dn=new BigInt64Array(hn.size());let Ji=0;for(let Si=0;Si<$n;Si++){const Sn=Number(Na[Si]);let zn=Na[Si+$n];zn=zn>>1n^-(1n&zn);for(let Xi=Ji;Xi<Ji+Sn;Xi++)hn.get(Xi)?dn[Xi]=zn:(dn[Xi]=0n,Ji++);Ji+=Sn}return dn})(oi,ot,Ht.runs):(function(hn,Na,$n){const dn=new BigInt64Array(hn.size());let Ji=0;for(let Si=0;Si<$n;Si++){const Sn=Number(Na[Si]),zn=Na[Si+$n];for(let Xi=Ji;Xi<Ji+Sn;Xi++)hn.get(Xi)?dn[Xi]=zn:(dn[Xi]=0n,Ji++);Ji+=Sn}return dn})(oi,ot,Ht.runs)})(Re,Ee,rt,it);case Gt.NONE:return Re=rt?(function(ot,Je){const pt=new BigInt64Array(ot.size());let oi=0,Ht=0;for(;Ht!=pt.length;++Ht)if(ot.get(Ht)){const hn=Je[oi++];pt[Ht]=hn>>1n^-(1n&hn)}else pt[Ht]=0n;return pt})(it,Re):(function(ot,Je){const pt=new BigInt64Array(ot.size());let oi=0,Ht=0;for(;Ht!=pt.length;++Ht)pt[Ht]=ot.get(Ht)?Je[oi++]:0n;return pt})(it,Re),Re;default:throw new Error("The specified Logical level technique is not supported")}})(Wh(Le,Pe,je.numValues),je,Qe,Ue)})(k,N,X,ae,J):Kc(k,N,X,ae);return new Jc(G.name,ye,J)}if(te===Cn.SEQUENCE){const ye=tc(k,N,X);return new zp(G.name,ye[0],ye[1],X.numRleValues)}{const ye=Ep(k,N,X,ae);return new ad(G.name,ye,J)}})(y,x,C,B,A);case 7:return(function(k,N,G,J){const q=Oa(k,N),X=xs(J)?(function(te,ae,ye,Le){const Pe=ae.get(),je=Pe+Le*Float32Array.BYTES_PER_ELEMENT,Qe=new Uint8Array(te.subarray(Pe,je)).buffer,Ue=new Float32Array(Qe);ae.set(je);const Re=ye.size(),Ee=new Float32Array(Re);let rt=0;for(let it=0;it<Re;it++)Ee[it]=ye.get(it)?Ue[rt++]:0;return Ee})(k,N,J,q.numValues):(function(te,ae,ye){const Le=ae.get(),Pe=Le+ye*Float32Array.BYTES_PER_ELEMENT,je=new Uint8Array(te.subarray(Le,Pe)).buffer,Qe=new Float32Array(je);return ae.set(Pe),Qe})(k,N,q.numValues);return new Bm(G.name,X,J)})(y,x,C,B);case 8:return(function(k,N,G,J){const q=Oa(k,N),X=xs(J)?(function(te,ae,ye,Le){const Pe=ae.get(),je=Pe+Le*Float64Array.BYTES_PER_ELEMENT,Qe=new Uint8Array(te.subarray(Pe,je)).buffer,Ue=new Float64Array(Qe);ae.set(je);const Re=ye.size(),Ee=new Float64Array(Re);let rt=0;for(let it=0;it<Re;it++)Ee[it]=ye.get(it)?Ue[rt++]:0;return Ee})(k,N,J,q.numValues):(function(te,ae,ye){const Le=ae.get(),Pe=Le+ye*Float64Array.BYTES_PER_ELEMENT,je=new Uint8Array(te.subarray(Le,Pe)).buffer,Qe=new Float64Array(je);return ae.set(Pe),Qe})(k,N,q.numValues);return new vp(G.name,X,J)})(y,x,C,B);default:throw new Error(`The specified data type for the field is currently not supported: ${A}`)}})(o,n,e,u,i.scalarType,i):o!=1?null:(function(p,y,x,T){let A=null,C=null,D=null,P=null,B=!1;for(;!B;){const J=Oa(p,y);switch(J.physicalStreamType){case ha.LENGTH:ka.DICTIONARY===J.logicalStreamType.lengthType?A=iu(p,y,J):D=iu(p,y,J);break;case ha.DATA:Zs.SINGLE===J.logicalStreamType.dictionaryType||Zs.SHARED===J.logicalStreamType.dictionaryType?(C=p.subarray(y.get(),y.get()+J.byteLength),B=!0):P=p.subarray(y.get(),y.get()+J.byteLength),y.add(J.byteLength)}}const k=x.complexType.children,N=[];let G=0;for(const J of k){const q=Yn(p,y,1)[0];if(q==0)continue;const X=`${x.name}${J.name==="default"?"":":"+J.name}`;if(q!==2||J.type!=="scalarField"||J.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const te=Oa(p,y),ae=rd(p,te.numValues,y),ye=Oa(p,y),Le=ye.decompressedCount!==T?Cp(p,y,ye,!1,new Hs(ae,te.numValues)):Fa(p,y,ye,!1);N[G++]=P?new Cf(X,Le,A,C,D,P,new Hs(ae,te.numValues)):new ic(X,Le,A,C,new Hs(ae,te.numValues))}return N})(n,e,i,u)}function xs(n){return n instanceof Hs}function au(n){if(n.name==="id")return!1;if(n.type==="scalarType"){const e=n.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(n.type==="complexType"){const e=n.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",n),!1}const od=new TextDecoder;function ih(n,e){const i=Yn(n,e,1)[0];if(i===0)return"";const o=e.get(),u=n.subarray(o,o+i);return e.add(i),od.decode(u)}function hl(n,e){const i=Yn(n,e,1)[0]>>>0,o=!!(4&i),u=!!(2&i),d=Yn(n,e,1)[0]>>>0,p={};if(1&i&&(p.nullable=!0),u){const y={};if(o?(y.type="logicalType",y.logicalType=d):(y.type="physicalType",y.physicalType=d),8&i){const x=Yn(n,e,1)[0]>>>0;y.children=new Array(x);for(let T=0;T<x;T++)y.children[T]=hl(n,e)}p.type="complexField",p.complexField=y}else{const y={};o?(y.type="logicalType",y.logicalType=d):(y.type="physicalType",y.physicalType=d),p.type="scalarField",p.scalarField=y}return p}function Qm(n,e){const i=Yn(n,e,1)[0]>>>0,o=(function(u){switch(u){case 0:case 1:case 2:case 3:{const d={};d.nullable=!!(1&u),d.columnScope=0;const p={};return p.physicalType=u>1?6:4,p.type="physicalType",d.scalarType=p,d.type="scalarType",d}case 4:{const d={nullable:!1,columnScope:0},p={type:"physicalType",physicalType:0};return d.type="complexType",d.complexType=p,d}case 30:{const d={nullable:!1,columnScope:0},p={type:"physicalType",physicalType:1};return d.type="complexType",d.complexType=p,d}default:return(function(d){let p=null;switch(d){case 10:case 11:p=0;break;case 12:case 13:p=1;break;case 14:case 15:p=2;break;case 16:case 17:p=3;break;case 18:case 19:p=4;break;case 20:case 21:p=5;break;case 22:case 23:p=6;break;case 24:case 25:p=7;break;case 26:case 27:p=8;break;case 28:case 29:p=9;break;default:return null}const y={};y.nullable=!!(1&d),y.columnScope=0;const x={type:"physicalType"};return x.physicalType=p,y.type="scalarType",y.scalarType=x,y})(u)}})(i);if(!o)throw new Error(`Unsupported column type code: ${i}`);if((function(u){return u>=10})(i)?o.name=ih(n,e):i>=0&&i<=3?o.name="id":i===4&&(o.name="geometry"),(function(u){return u===30})(i)){const u=Yn(n,e,1)[0]>>>0,d=o.complexType;d.children=new Array(u);for(let p=0;p<u;p++)d.children[p]=hl(n,e)}return o}function Om(n,e){const i={featureTables:[]},o={};o.name=ih(n,e);const u=Yn(n,e,1)[0]>>>0,d=Yn(n,e,1)[0]>>>0;o.columns=new Array(d);for(let p=0;p<d;p++)o.columns[p]=Qm(n,e);return i.featureTables.push(o),[i,u]}function ld(n,e,i,o,u,d,p=!1){const y=e.scalarType.physicalType,x=ul(u,d,n,i);if(y===4)switch(x){case Cn.FLAT:{const T=Fa(n,i,u,!1);return new vf(o,T,d)}case Cn.SEQUENCE:{const T=Ap(n,i,u);return new bp(o,T[0],T[1],u.numRleValues)}case Cn.CONST:{const T=Mp(n,i,u,!1);return new wp(o,T,d)}}else switch(x){case Cn.FLAT:{if(p){const A=(function(C,D,P,B){const k=(function(N,G,J){const q=new Float64Array(G);for(let X=0;X<G;X++)q[X]=Cm(N,J);return q})(C,P.numValues,D);return(function(N,G,J){switch(G.logicalLevelTechnique1){case Gt.DELTA:return G.logicalLevelTechnique2===Gt.RLE&&(N=Dm(N,G.runs,G.numRleValues)),(function(q){q[0]=q[0]%2==1?(q[0]+1)/-2:q[0]/2;const X=q.length/4*4;let te=1;if(X>=4)for(;te<X-4;te+=4){const ae=q[te],ye=q[te+1],Le=q[te+2],Pe=q[te+3];q[te]=(ae%2==1?(ae+1)/-2:ae/2)+q[te-1],q[te+1]=(ye%2==1?(ye+1)/-2:ye/2)+q[te],q[te+2]=(Le%2==1?(Le+1)/-2:Le/2)+q[te+1],q[te+3]=(Pe%2==1?(Pe+1)/-2:Pe/2)+q[te+2]}for(;te!=q.length;++te)q[te]=(q[te]%2==1?(q[te]+1)/-2:q[te]/2)+q[te-1]})(N),N;case Gt.RLE:return(function(q,X,te){return Dm(q,X.runs,X.numRleValues)})(N,G);case Gt.NONE:return N;default:throw new Error(`The specified Logical level technique is not supported: ${G.logicalLevelTechnique1}`)}})(k,P)})(n,i,u);return new vp(o,A,d)}const T=Kc(n,i,u,!1);return new Jc(o,T,d)}case Cn.SEQUENCE:{const T=tc(n,i,u);return new zp(o,T[0],T[1],u.numRleValues)}case Cn.CONST:{const T=Ep(n,i,u,!1);return new ad(o,T,d)}}throw new Error("Vector type not supported for id column.")}class Km{constructor(e,i){var o;switch(this._featureData=e,this.properties=this._featureData.properties||{},(o=this._featureData.geometry)===null||o===void 0?void 0:o.type){case Xn.POINT:case Xn.MULTIPOINT:this.type=1;break;case Xn.LINESTRING:case Xn.MULTILINESTRING:this.type=2;break;case Xn.POLYGON:case Xn.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=i,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const i of this._featureData.geometry.coordinates){const o=[];for(const u of i)o.push(new De(u.x,u.y));e.push(o)}return e}}class Fm{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new Km(this.features[e],this.extent)}}class ud{constructor(e){this.layers={};const i=(function(o,u,d=!0){const p=new Em(0),y=[];for(;p.get()<o.length;){const x=Yn(o,p,1)[0]>>>0,T=p.get()+x;if(T>o.length)throw new Error(`Block overruns tile: ${T} > ${o.length}`);if(Yn(o,p,1)[0]>>>0!=1){p.set(T);continue}const A=Om(o,p),C=A[1],D=A[0].featureTables[0];let P=null,B=null;const k=[];let N=0;for(const J of D.columns){const q=J.name;if(q==="id"){let X=null;if(J.nullable){const ae=Oa(o,p),ye=p.get(),Le=rd(o,ae.numValues,p);p.set(ye+ae.byteLength),X=new Hs(Le,ae.numValues)}const te=Oa(o,p);N=te.decompressedCount,P=ld(o,J,p,q,te,X??N,d)}else if(q==="geometry"){const X=Yn(o,p,1)[0];if(N===0){const te=p.get();N=Oa(o,p).decompressedCount,p.set(te)}B=Rm(o,X,p,N)}else{const X=au(J)?Yn(o,p,1)[0]:1;if(X===0&&J.type==="scalarType")continue;const te=nu(o,p,J,X,N);if(te)if(Array.isArray(te))for(const ae of te)k.push(ae);else k.push(te)}}const G=new Jl(D.name,B,P,k,C);y.push(G),p.set(T)}return y})(new Uint8Array(e));this.layers=i.reduce(((o,u)=>Object.assign(Object.assign({},o),{[u.name]:new Fm(u)})),{})}}class Nm{constructor(e,i){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=i,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],i=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const o of i){const u=[];for(const d of o)u.push(new De(d[0],d[1]));e.push(u)}return e}}const cd="_geojsonTileLayer";function zf(n,e){e.writeVarintField(15,n.version||1),e.writeStringField(1,n.name||""),e.writeVarintField(5,n.extent||4096);const i={keys:[],values:[],keycache:{},valuecache:{}};for(let d=0;d<n.length;d++)i.feature=n.feature(d),e.writeMessage(2,Df,i);const o=i.keys;for(const d of o)e.writeStringField(3,d);const u=i.values;for(const d of u)e.writeMessage(4,Pf,d)}function Df(n,e){if(!n.feature)return;const i=n.feature;i.id!==void 0&&e.writeVarintField(1,i.id),e.writeMessage(2,jm,n),e.writeVarintField(3,i.type),e.writeMessage(4,kp,i)}function jm(n,e){for(const i in n.feature?.properties){let o=n.feature.properties[i],u=n.keycache[i];if(o==null)continue;u===void 0&&(n.keys.push(i),u=n.keys.length-1,n.keycache[i]=u),e.writeVarint(u),typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"&&(o=JSON.stringify(o));const d=typeof o+":"+o;let p=n.valuecache[d];p===void 0&&(n.values.push(o),p=n.values.length-1,n.valuecache[d]=p),e.writeVarint(p)}}function ru(n,e){return(e<<3)+(7&n)}function Bp(n){return n<<1^n>>31}function kp(n,e){const i=n.loadGeometry(),o=n.type;let u=0,d=0;for(const p of i){let y=1;o===1&&(y=p.length),e.writeVarint(ru(1,y));const x=o===3?p.length-1:p.length;for(let T=0;T<x;T++){T===1&&o!==1&&e.writeVarint(ru(2,x-1));const A=p[T].x-u,C=p[T].y-d;e.writeVarint(Bp(A)),e.writeVarint(Bp(C)),u+=A,d+=C}n.type===3&&e.writeVarint(ru(7,1))}}function Pf(n,e){const i=typeof n;i==="string"?e.writeStringField(1,n):i==="boolean"?e.writeBooleanField(7,n):i==="number"&&(n%1!=0?e.writeDoubleField(3,n):n<0?e.writeSVarintField(6,n):e.writeVarintField(5,n))}class Op{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new po(gt,16,0),this.grid3D=new po(gt,16,0),this.featureIndexArray=new U,this.promoteId=i}insert(e,i,o,u,d,p){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,d);const x=p?this.grid3D:this.grid;for(let T=0;T<i.length;T++){const A=i[T],C=[1/0,1/0,-1/0,-1/0];for(let D=0;D<A.length;D++){const P=A[D];C[0]=Math.min(C[0],P.x),C[1]=Math.min(C[1],P.y),C[2]=Math.max(C[2],P.x),C[3]=Math.max(C[3],P.y)}C[0]<gt&&C[1]<gt&&C[2]>=0&&C[3]>=0&&x.insert(y,C[0],C[1],C[2],C[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new ii(new nf(this.rawTileData)).layers:new ud(this.rawTileData).layers,this.sourceLayerCoder=new yp(this.vtLayers?Object.keys(this.vtLayers).sort():[cd])),this.vtLayers}query(e,i,o,u){this.loadVTLayers();const d=e.params,p=gt/e.tileSize/e.scale,y=za(d.filter,d.globalState),x=e.queryGeometry,T=e.queryPadding*p,A=Ql.fromPoints(x),C=this.grid.query(A.minX-T,A.minY-T,A.maxX+T,A.maxY+T),D=Ql.fromPoints(e.cameraQueryGeometry).expandBy(T),P=this.grid3D.query(D.minX,D.minY,D.maxX,D.maxY,((N,G,J,q)=>(function(X,te,ae,ye,Le){for(const je of X)if(te<=je.x&&ae<=je.y&&ye>=je.x&&Le>=je.y)return!0;const Pe=[new De(te,ae),new De(te,Le),new De(ye,Le),new De(ye,ae)];if(X.length>2){for(const je of Pe)if(vo(X,je))return!0}for(let je=0;je<X.length-1;je++)if(Zp(X[je],X[je+1],Pe))return!0;return!1})(e.cameraQueryGeometry,N-T,G-T,J+T,q+T)));for(const N of P)C.push(N);C.sort(If);const B={};let k;for(let N=0;N<C.length;N++){const G=C[N];if(G===k)continue;k=G;const J=this.featureIndexArray.get(G);let q=null;this.loadMatchingFeature(B,J.bucketIndex,J.sourceLayerIndex,J.featureIndex,y,d.layers,d.availableImages,i,o,u,((X,te,ae)=>(q||(q=js(X)),te.queryIntersectsFeature({queryGeometry:x,feature:X,featureState:ae,geometry:q,zoom:this.z,transform:e.transform,pixelsToTileUnits:p,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return B}loadMatchingFeature(e,i,o,u,d,p,y,x,T,A,C){const D=this.bucketLayerIDs[i];if(p&&!D.some((N=>p.has(N))))return;const P=this.sourceLayerCoder.decode(o),B=this.vtLayers[P].feature(u);if(d.needGeometry){const N=jr(B,!0);if(!d.filter(new gi(this.tileID.overscaledZ),N,this.tileID.canonical))return}else if(!d.filter(new gi(this.tileID.overscaledZ),B))return;const k=this.getId(B,P);for(let N=0;N<D.length;N++){const G=D[N];if(p&&!p.has(G))continue;const J=x[G];if(!J)continue;let q={};k&&A&&(q=A.getState(J.sourceLayer||cd,k));const X=Mi({},T[G]);X.paint=Vm(X.paint,J.paint,B,q,y),X.layout=Vm(X.layout,J.layout,B,q,y);const te=!C||C(B,J,q);if(!te)continue;const ae=new _f(B,this.z,this.x,this.y,k);ae.layer=X;let ye=e[G];ye===void 0&&(ye=e[G]=[]),ye.push({featureIndex:u,feature:ae,intersectionZ:te})}}lookupSymbolFeatures(e,i,o,u,d,p,y,x){const T={};this.loadVTLayers();const A=za(d.filterSpec,d.globalState);for(const C of e)this.loadMatchingFeature(T,o,u,C,A,p,y,x,i);return T}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){var o;let u=e.id;return this.promoteId&&(u=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof u=="boolean"&&(u=Number(u)),u===void 0&&(!((o=e.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(u=Number(e.properties.cluster_id))),u}}function Vm(n,e,i,o,u){return ga(n,((d,p)=>{const y=e instanceof Xo?e.get(p):null;return y&&y.evaluate?y.evaluate(i,o,u):y}))}function If(n,e){return e-n}function a(n,e,i,o,u){const d=[];for(let p=0;p<n.length;p++){const y=n[p];let x;for(let T=0;T<y.length-1;T++){let A=y[T],C=y[T+1];A.x<e&&C.x<e||(A.x<e?A=new De(e,A.y+(e-A.x)/(C.x-A.x)*(C.y-A.y))._round():C.x<e&&(C=new De(e,A.y+(e-A.x)/(C.x-A.x)*(C.y-A.y))._round()),A.y<i&&C.y<i||(A.y<i?A=new De(A.x+(i-A.y)/(C.y-A.y)*(C.x-A.x),i)._round():C.y<i&&(C=new De(A.x+(i-A.y)/(C.y-A.y)*(C.x-A.x),i)._round()),A.x>=o&&C.x>=o||(A.x>=o?A=new De(o,A.y+(o-A.x)/(C.x-A.x)*(C.y-A.y))._round():C.x>=o&&(C=new De(o,A.y+(o-A.x)/(C.x-A.x)*(C.y-A.y))._round()),A.y>=u&&C.y>=u||(A.y>=u?A=new De(A.x+(u-A.y)/(C.y-A.y)*(C.x-A.x),u)._round():C.y>=u&&(C=new De(A.x+(u-A.y)/(C.y-A.y)*(C.x-A.x),u)._round()),x&&A.equals(x[x.length-1])||(x=[A],d.push(x)),x.push(C)))))}}return d}function s(n,e,i,o,u){switch(e){case 1:return(function(d,p,y,x){const T=[];for(const A of d)for(const C of A){const D=x===0?C.x:C.y;D>=p&&D<=y&&T.push([C])}return T})(n,i,o,u);case 2:return g(n,i,o,u,!1);case 3:return g(n,i,o,u,!0)}return[]}function c(n,e,i,o,u){const d=o===0?w:M;let p=[];const y=[];for(let A=0;A<n.length-1;A++){const C=n[A],D=n[A+1],P=o===0?C.x:C.y,B=o===0?D.x:D.y;let k=!1;P<e?B>e&&p.push(d(C,D,e)):P>i?B<i&&p.push(d(C,D,i)):p.push(C),B<e&&P>=e&&(p.push(d(C,D,e)),k=!0),B>i&&P<=i&&(p.push(d(C,D,i)),k=!0),!u&&k&&(y.push(p),p=[])}const x=n.length-1,T=o===0?n[x].x:n[x].y;return T>=e&&T<=i&&p.push(n[x]),u&&p.length>0&&!p[0].equals(p[p.length-1])&&p.push(new De(p[0].x,p[0].y)),p.length>0&&y.push(p),y}function g(n,e,i,o,u){const d=[];for(const p of n){const y=c(p,e,i,o,u);y.length>0&&d.push(...y)}return d}function w(n,e,i){return new De(i,n.y+(i-n.x)/(e.x-n.x)*(e.y-n.y))}function M(n,e,i){return new De(n.x+(i-n.y)/(e.y-n.y)*(e.x-n.x),i)}tt("FeatureIndex",Op,{omit:["rawTileData","sourceLayerCoder"]});class L extends De{constructor(e,i,o,u){super(e,i),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new L(this.x,this.y,this.angle,this.segment)}}function Z(n,e,i,o,u){if(e.segment===void 0||i===0)return!0;let d=e,p=e.segment+1,y=0;for(;y>-i/2;){if(p--,p<0)return!1;y-=n[p].dist(d),d=n[p]}y+=n[p].dist(n[p+1]),p++;const x=[];let T=0;for(;y<i/2;){const A=n[p],C=n[p+1];if(!C)return!1;let D=n[p-1].angleTo(A)-A.angleTo(C);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:D}),T+=D;y-x[0].distance>o;)T-=x.shift().angleDelta;if(T>u)return!1;p++,y+=A.dist(C)}return!0}function le(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function Ce(n,e,i){return n?.6*e*i:0}function Fe(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function Ze(n,e,i,o,u,d){const p=Ce(i,u,d),y=Fe(i,o)*d;let x=0;const T=le(n)/2;for(let A=0;A<n.length-1;A++){const C=n[A],D=n[A+1],P=C.dist(D);if(x+P>T){const B=(T-x)/P,k=Gi.number(C.x,D.x,B),N=Gi.number(C.y,D.y,B),G=new L(k,N,D.angleTo(C),A);return G._round(),!p||Z(n,G,y,p,e)?G:void 0}x+=P}}function ze(n,e,i,o,u,d,p,y,x){const T=Ce(o,d,p),A=Fe(o,u),C=A*p,D=n[0].x===0||n[0].x===x||n[0].y===0||n[0].y===x;return e-C<e/4&&(e=C+e/4),Ie(n,D?e/2*y%e:(A/2+2*d)*p*y%e,e,T,i,C,D,!1,x)}function Ie(n,e,i,o,u,d,p,y,x){const T=d/2,A=le(n);let C=0,D=e-i,P=[];for(let B=0;B<n.length-1;B++){const k=n[B],N=n[B+1],G=k.dist(N),J=N.angleTo(k);for(;D+i<C+G;){D+=i;const q=(D-C)/G,X=Gi.number(k.x,N.x,q),te=Gi.number(k.y,N.y,q);if(X>=0&&X<x&&te>=0&&te<x&&D-T>=0&&D+T<=A){const ae=new L(X,te,J,B);ae._round(),o&&!Z(n,ae,d,o,u)||P.push(ae)}}C+=G}return y||P.length||p||(P=Ie(n,C/2,i,o,u,d,p,!0,x)),P}function dt(n,e,i,o){const u=[],d=n.image,p=d.pixelRatio,y=d.paddedRect.w-2,x=d.paddedRect.h-2;let T={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const A=d.stretchX||[[0,y]],C=d.stretchY||[[0,x]],D=(Ee,rt)=>Ee+rt[1]-rt[0],P=A.reduce(D,0),B=C.reduce(D,0),k=y-P,N=x-B;let G=0,J=P,q=0,X=B,te=0,ae=k,ye=0,Le=N;if(d.content&&o){const Ee=d.content,rt=Ee[2]-Ee[0],it=Ee[3]-Ee[1];(d.textFitWidth||d.textFitHeight)&&(T=ll(n)),G=Ct(A,0,Ee[0]),q=Ct(C,0,Ee[1]),J=Ct(A,Ee[0],Ee[2]),X=Ct(C,Ee[1],Ee[3]),te=Ee[0]-G,ye=Ee[1]-q,ae=rt-J,Le=it-X}const Pe=T.x1,je=T.y1,Qe=T.x2-Pe,Ue=T.y2-je,Re=(Ee,rt,it,ot)=>{const Je=pe(Ee.stretch-G,J,Qe,Pe),pt=he(Ee.fixed-te,ae,Ee.stretch,P),oi=pe(rt.stretch-q,X,Ue,je),Ht=he(rt.fixed-ye,Le,rt.stretch,B),hn=pe(it.stretch-G,J,Qe,Pe),Na=he(it.fixed-te,ae,it.stretch,P),$n=pe(ot.stretch-q,X,Ue,je),dn=he(ot.fixed-ye,Le,ot.stretch,B),Ji=new De(Je,oi),Si=new De(hn,oi),Sn=new De(hn,$n),zn=new De(Je,$n),Xi=new De(pt/p,Ht/p),qr=new De(Na/p,dn/p),ja=e*Math.PI/180;if(ja){const fa=Math.sin(ja),_n=Math.cos(ja),Wn=[_n,-fa,fa,_n];Ji._matMult(Wn),Si._matMult(Wn),zn._matMult(Wn),Sn._matMult(Wn)}const Zr=Ee.stretch+Ee.fixed,Mo=rt.stretch+rt.fixed;return{tl:Ji,tr:Si,bl:zn,br:Sn,tex:{x:d.paddedRect.x+1+Zr,y:d.paddedRect.y+1+Mo,w:it.stretch+it.fixed-Zr,h:ot.stretch+ot.fixed-Mo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Xi,pixelOffsetBR:qr,minFontScaleX:ae/p/Qe,minFontScaleY:Le/p/Ue,isSDF:i}};if(o&&(d.stretchX||d.stretchY)){const Ee=Oi(A,k,P),rt=Oi(C,N,B);for(let it=0;it<Ee.length-1;it++){const ot=Ee[it],Je=Ee[it+1];for(let pt=0;pt<rt.length-1;pt++)u.push(Re(ot,rt[pt],Je,rt[pt+1]))}}else u.push(Re({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return u}function Ct(n,e,i){let o=0;for(const u of n)o+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return o}function Oi(n,e,i){const o=[{fixed:-1,stretch:0}];for(const[u,d]of n){const p=o[o.length-1];o.push({fixed:u-p.stretch,stretch:p.stretch}),o.push({fixed:u-p.stretch,stretch:p.stretch+(d-u)})}return o.push({fixed:e+1,stretch:i}),o}function pe(n,e,i,o){return n/e*i+o}function he(n,e,i,o){return n-e*i/o}tt("Anchor",L);class Ae{constructor(e,i,o,u,d,p,y,x,T,A){var C;if(this.boxStartIndex=e.length,T){let D=p.top,P=p.bottom;const B=p.collisionPadding;B&&(D-=B[1],P+=B[3]);let k=P-D;k>0&&(k=Math.max(10,k),this.circleDiameter=k)}else{const D=!((C=p.image)===null||C===void 0)&&C.content&&(p.image.textFitWidth||p.image.textFitHeight)?ll(p):{x1:p.left,y1:p.top,x2:p.right,y2:p.bottom};D.y1=D.y1*y-x[0],D.y2=D.y2*y+x[2],D.x1=D.x1*y-x[3],D.x2=D.x2*y+x[1];const P=p.collisionPadding;if(P&&(D.x1-=P[0]*y,D.y1-=P[1]*y,D.x2+=P[2]*y,D.y2+=P[3]*y),A){const B=new De(D.x1,D.y1),k=new De(D.x2,D.y1),N=new De(D.x1,D.y2),G=new De(D.x2,D.y2),J=A*Math.PI/180;B._rotate(J),k._rotate(J),N._rotate(J),G._rotate(J),D.x1=Math.min(B.x,k.x,N.x,G.x),D.x2=Math.max(B.x,k.x,N.x,G.x),D.y1=Math.min(B.y,k.y,N.y,G.y),D.y2=Math.max(B.y,k.y,N.y,G.y)}e.emplaceBack(i.x,i.y,D.x1,D.y1,D.x2,D.y2,o,u,d)}this.boxEndIndex=e.length}}class Ve{constructor(e=[],i=(o,u)=>o<u?-1:o>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,u=i[e];for(;e>0;){const d=e-1>>1,p=i[d];if(o(u,p)>=0)break;i[e]=p,e=d}i[e]=u}_down(e){const{data:i,compare:o}=this,u=this.length>>1,d=i[e];for(;e<u;){let p=1+(e<<1);const y=p+1;if(y<this.length&&o(i[y],i[p])<0&&(p=y),o(i[p],d)>=0)break;i[e]=i[p],e=p}i[e]=d}}function Mt(n,e=1,i=!1){const o=Ql.fromPoints(n[0]),u=Math.min(o.width(),o.height());let d=u/2;const p=new Ve([],Ti),{minX:y,minY:x,maxX:T,maxY:A}=o;if(u===0)return new De(y,x);for(let P=y;P<T;P+=u)for(let B=x;B<A;B+=u)p.push(new ft(P+d,B+d,d,n));let C=(function(P){let B=0,k=0,N=0;const G=P[0];for(let J=0,q=G.length,X=q-1;J<q;X=J++){const te=G[J],ae=G[X],ye=te.x*ae.y-ae.x*te.y;k+=(te.x+ae.x)*ye,N+=(te.y+ae.y)*ye,B+=3*ye}return new ft(k/B,N/B,0,P)})(n),D=p.length;for(;p.length;){const P=p.pop();(P.d>C.d||!C.d)&&(C=P,i&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,D)),P.max-C.d<=e||(d=P.h/2,p.push(new ft(P.p.x-d,P.p.y-d,d,n)),p.push(new ft(P.p.x+d,P.p.y-d,d,n)),p.push(new ft(P.p.x-d,P.p.y+d,d,n)),p.push(new ft(P.p.x+d,P.p.y+d,d,n)),D+=4)}return i&&(console.log(`num probes: ${D}`),console.log(`best distance: ${C.d}`)),C.p}function Ti(n,e){return e.max-n.max}function ft(n,e,i,o){this.p=new De(n,e),this.h=i,this.d=(function(u,d){let p=!1,y=1/0;for(let x=0;x<d.length;x++){const T=d[x];for(let A=0,C=T.length,D=C-1;A<C;D=A++){const P=T[A],B=T[D];P.y>u.y!=B.y>u.y&&u.x<(B.x-P.x)*(u.y-P.y)/(B.y-P.y)+P.x&&(p=!p),y=Math.min(y,jf(u,P,B))}}return(p?1:-1)*Math.sqrt(y)})(this.p,o),this.max=this.d+this.h*Math.SQRT2}var vt;O.aP=void 0,(vt=O.aP||(O.aP={}))[vt.center=1]="center",vt[vt.left=2]="left",vt[vt.right=3]="right",vt[vt.top=4]="top",vt[vt.bottom=5]="bottom",vt[vt["top-left"]=6]="top-left",vt[vt["top-right"]=7]="top-right",vt[vt["bottom-left"]=8]="bottom-left",vt[vt["bottom-right"]=9]="bottom-right";const ei=Number.POSITIVE_INFINITY;function yi(n,e){return e[1]!==ei?(function(i,o,u){let d=0,p=0;switch(o=Math.abs(o),u=Math.abs(u),i){case"top-right":case"top-left":case"top":p=u-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-u}switch(i){case"top-right":case"bottom-right":case"right":d=-o;break;case"top-left":case"bottom-left":case"left":d=o}return[d,p]})(n,e[0],e[1]):(function(i,o){let u=0,d=0;o<0&&(o=0);const p=o/Math.SQRT2;switch(i){case"top-right":case"top-left":d=p-7;break;case"bottom-right":case"bottom-left":d=7-p;break;case"bottom":d=7-o;break;case"top":d=o-7}switch(i){case"top-right":case"bottom-right":u=-p;break;case"top-left":case"bottom-left":u=p;break;case"left":u=o;break;case"right":u=-o}return[u,d]})(n,e[0])}function dl(n,e,i){var o;const u=n.layout,d=(o=u.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},i);if(d){const y=d.values,x=[];for(let T=0;T<y.length;T+=2){const A=x[T]=y[T],C=y[T+1].map((D=>D*kn));A.startsWith("top")?C[1]-=7:A.startsWith("bottom")&&(C[1]+=7),x[T+1]=C}return new rn(x)}const p=u.get("text-variable-anchor");if(p){let y;y=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(e,{},i)*kn,ei]:u.get("text-offset").evaluate(e,{},i).map((T=>T*kn));const x=[];for(const T of p)x.push(T,yi(T,y));return new rn(x)}return null}function Fp(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Gg(n,e,i,o,u,d,p,y,x,T,A,C){let D=d.textMaxSize.evaluate(e,{});D===void 0&&(D=p);const P=n.layers[0].layout,B=P.get("icon-offset").evaluate(e,{},A),k=vg(i.horizontal),N=p/24,G=n.tilePixelRatio*N,J=n.tilePixelRatio*D/24,q=n.tilePixelRatio*y,X=n.tilePixelRatio*P.get("symbol-spacing"),te=P.get("text-padding")*n.tilePixelRatio,ae=(function(it,ot,Je,pt=1){const oi=it.get("icon-padding").evaluate(ot,{},Je),Ht=oi&&oi.values;return[Ht[0]*pt,Ht[1]*pt,Ht[2]*pt,Ht[3]*pt]})(P,e,A,n.tilePixelRatio),ye=P.get("text-max-angle")/180*Math.PI,Le=P.get("text-rotation-alignment")!=="viewport"&&P.get("symbol-placement")!=="point",Pe=P.get("icon-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",je=P.get("symbol-placement"),Qe=X/2,Ue=P.get("icon-text-fit");let Re;o&&Ue!=="none"&&(n.allowVerticalPlacement&&i.vertical&&(Re=Gs(o,i.vertical,Ue,P.get("icon-text-fit-padding"),B,N)),k&&(o=Gs(o,k,Ue,P.get("icon-text-fit-padding"),B,N)));const Ee=A?C.line.getGranularityForZoomLevel(A.z):1,rt=(it,ot)=>{ot.x<0||ot.x>=gt||ot.y<0||ot.y>=gt||(function(Je,pt,oi,Ht,hn,Na,$n,dn,Ji,Si,Sn,zn,Xi,qr,ja,Zr,Mo,fa,_n,Wn,Mn,pa,nc,fl,Vp){const nh=Je.addToLineVertexArray(pt,oi);let hd,Rf,Lf,Bf,Tg=0,Sg=0,Mg=0,Ag=0,sg=-1,og=-1;const ac={};let Eg=un("");if(Je.allowVerticalPlacement&&Ht.vertical){const rr=dn.layout.get("text-rotate").evaluate(Mn,{},fl)+90;Lf=new Ae(Ji,pt,Si,Sn,zn,Ht.vertical,Xi,qr,ja,rr),$n&&(Bf=new Ae(Ji,pt,Si,Sn,zn,$n,Mo,fa,ja,rr))}if(hn){const rr=dn.layout.get("icon-rotate").evaluate(Mn,{}),Xs=dn.layout.get("icon-text-fit")!=="none",dd=dt(hn,rr,nc,Xs),ml=$n?dt($n,rr,nc,Xs):void 0;Rf=new Ae(Ji,pt,Si,Sn,zn,hn,Mo,fa,!1,rr),Tg=4*dd.length;const fd=Je.iconSizeData;let su=null;fd.kind==="source"?(su=[Ur*dn.layout.get("icon-size").evaluate(Mn,{})],su[0]>$l&&$i(`${Je.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):fd.kind==="composite"&&(su=[Ur*pa.compositeIconSizes[0].evaluate(Mn,{},fl),Ur*pa.compositeIconSizes[1].evaluate(Mn,{},fl)],(su[0]>$l||su[1]>$l)&&$i(`${Je.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Je.addSymbols(Je.icon,dd,su,Wn,_n,Mn,O.az.none,pt,nh.lineStartIndex,nh.lineLength,-1,fl),sg=Je.icon.placedSymbolArray.length-1,ml&&(Sg=4*ml.length,Je.addSymbols(Je.icon,ml,su,Wn,_n,Mn,O.az.vertical,pt,nh.lineStartIndex,nh.lineLength,-1,fl),og=Je.icon.placedSymbolArray.length-1)}const Cg=Object.keys(Ht.horizontal);for(const rr of Cg){const Xs=Ht.horizontal[rr];if(!hd){Eg=un(Xs.text);const ml=dn.layout.get("text-rotate").evaluate(Mn,{},fl);hd=new Ae(Ji,pt,Si,Sn,zn,Xs,Xi,qr,ja,ml)}const dd=Xs.positionedLines.length===1;if(Mg+=yg(Je,pt,Xs,Na,dn,ja,Mn,Zr,nh,Ht.vertical?O.az.horizontal:O.az.horizontalOnly,dd?Cg:[rr],ac,sg,pa,fl),dd)break}Ht.vertical&&(Ag+=yg(Je,pt,Ht.vertical,Na,dn,ja,Mn,Zr,nh,O.az.vertical,["vertical"],ac,og,pa,fl));const Hg=hd?hd.boxStartIndex:Je.collisionBoxArray.length,Xg=hd?hd.boxEndIndex:Je.collisionBoxArray.length,Yg=Lf?Lf.boxStartIndex:Je.collisionBoxArray.length,$g=Lf?Lf.boxEndIndex:Je.collisionBoxArray.length,Wg=Rf?Rf.boxStartIndex:Je.collisionBoxArray.length,Qg=Rf?Rf.boxEndIndex:Je.collisionBoxArray.length,Kg=Bf?Bf.boxStartIndex:Je.collisionBoxArray.length,Jg=Bf?Bf.boxEndIndex:Je.collisionBoxArray.length;let pl=-1;const Gm=(rr,Xs)=>rr&&rr.circleDiameter?Math.max(rr.circleDiameter,Xs):Xs;pl=Gm(hd,pl),pl=Gm(Lf,pl),pl=Gm(Rf,pl),pl=Gm(Bf,pl);const zg=pl>-1?1:0;zg&&(pl*=Vp/kn),Je.glyphOffsetArray.length>=Yc.MAX_GLYPHS&&$i("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Mn.sortKey!==void 0&&Je.addToSortKeyRanges(Je.symbolInstances.length,Mn.sortKey);const e_=dl(dn,Mn,fl),[t_,i_]=(function(rr,Xs){const dd=rr.length,ml=Xs?.values;if(ml?.length>0)for(let fd=0;fd<ml.length;fd+=2){const su=ml[fd+1];rr.emplaceBack(O.aP[ml[fd]],su[0],su[1])}return[dd,rr.length]})(Je.textAnchorOffsets,e_);Je.symbolInstances.emplaceBack(pt.x,pt.y,ac.right>=0?ac.right:-1,ac.center>=0?ac.center:-1,ac.left>=0?ac.left:-1,ac.vertical||-1,sg,og,Eg,Hg,Xg,Yg,$g,Wg,Qg,Kg,Jg,Si,Mg,Ag,Tg,Sg,zg,0,Xi,pl,t_,i_)})(n,ot,it,i,o,u,Re,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,G,[te,te,te,te],Le,x,q,ae,Pe,B,e,d,T,A,p)};if(je==="line")for(const it of a(e.geometry,0,0,gt,gt)){const ot=nl(it,Ee),Je=ze(ot,X,ye,i.vertical||k,o,24,J,n.overscaling,gt);for(const pt of Je)k&&qg(n,k.text,Qe,pt)||rt(ot,pt)}else if(je==="line-center"){for(const it of e.geometry)if(it.length>1){const ot=nl(it,Ee),Je=Ze(ot,ye,i.vertical||k,o,24,J);Je&&rt(ot,Je)}}else if(e.type==="Polygon")for(const it of bu(e.geometry,0)){const ot=Mt(it,16);rt(nl(it[0],Ee,!0),new L(ot.x,ot.y,0))}else if(e.type==="LineString")for(const it of e.geometry){const ot=nl(it,Ee);rt(ot,new L(ot[0].x,ot[0].y,0))}else if(e.type==="Point")for(const it of e.geometry)for(const ot of it)rt([ot],new L(ot.x,ot.y,0))}function yg(n,e,i,o,u,d,p,y,x,T,A,C,D,P,B){const k=(function(J,q,X,te,ae,ye,Le,Pe){const je=te.layout.get("text-rotate").evaluate(ye,{})*Math.PI/180,Qe=[];for(const Ue of q.positionedLines)for(const Re of Ue.positionedGlyphs){if(!Re.rect)continue;const Ee=Re.rect||{};let rt=4,it=!0,ot=1,Je=0;const pt=(ae||Pe)&&Re.vertical,oi=Re.metrics.advance*Re.scale/2;if(Pe&&q.verticalizable&&(Je=Ue.lineOffset/2-(Re.imageName?-(kn-Re.metrics.width*Re.scale)/2:(Re.scale-1)*kn)),Re.imageName){const fa=Le[Re.imageName];it=fa.sdf,ot=fa.pixelRatio,rt=1/ot}const Ht=ae?[Re.x+oi,Re.y]:[0,0];let hn=ae?[0,0]:[Re.x+oi+X[0],Re.y+X[1]-Je],Na=[0,0];pt&&(Na=hn,hn=[0,0]);const $n=Re.metrics.isDoubleResolution?2:1,dn=(Re.metrics.left-rt)*Re.scale-oi+hn[0],Ji=(-Re.metrics.top-rt)*Re.scale+hn[1],Si=dn+Ee.w/$n*Re.scale/ot,Sn=Ji+Ee.h/$n*Re.scale/ot,zn=new De(dn,Ji),Xi=new De(Si,Ji),qr=new De(dn,Sn),ja=new De(Si,Sn);if(pt){const fa=new De(-oi,oi- -17),_n=-Math.PI/2,Wn=12-oi,Mn=new De(22-Wn,-(Re.imageName?Wn:0)),pa=new De(...Na);zn._rotateAround(_n,fa)._add(Mn)._add(pa),Xi._rotateAround(_n,fa)._add(Mn)._add(pa),qr._rotateAround(_n,fa)._add(Mn)._add(pa),ja._rotateAround(_n,fa)._add(Mn)._add(pa)}if(je){const fa=Math.sin(je),_n=Math.cos(je),Wn=[_n,-fa,fa,_n];zn._matMult(Wn),Xi._matMult(Wn),qr._matMult(Wn),ja._matMult(Wn)}const Zr=new De(0,0),Mo=new De(0,0);Qe.push({tl:zn,tr:Xi,bl:qr,br:ja,tex:Ee,writingMode:q.writingMode,glyphOffset:Ht,sectionIndex:Re.sectionIndex,isSDF:it,pixelOffsetTL:Zr,pixelOffsetBR:Mo,minFontScaleX:0,minFontScaleY:0})}return Qe})(0,i,y,u,d,p,o,n.allowVerticalPlacement),N=n.textSizeData;let G=null;N.kind==="source"?(G=[Ur*u.layout.get("text-size").evaluate(p,{})],G[0]>$l&&$i(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):N.kind==="composite"&&(G=[Ur*P.compositeTextSizes[0].evaluate(p,{},B),Ur*P.compositeTextSizes[1].evaluate(p,{},B)],(G[0]>$l||G[1]>$l)&&$i(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,k,G,y,d,p,T,e,x.lineStartIndex,x.lineLength,D,B);for(const J of A)C[J]=n.text.placedSymbolArray.length-1;return 4*k.length}function vg(n){for(const e in n)return n[e];return null}function qg(n,e,i,o){const u=n.compareText;if(e in u){const d=u[e];for(let p=d.length-1;p>=0;p--)if(o.dist(d[p])<i)return!0}else u[e]=[];return u[e].push(o),!1}const xg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Jm{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const d=xg[15&o];if(!d)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new Jm(y,p,d,e)}constructor(e,i=64,o=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const d=xg.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+y+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return eg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:p,nodeSize:y}=this,x=[0,d.length-1,0],T=[];for(;x.length;){const A=x.pop()||0,C=x.pop()||0,D=x.pop()||0;if(C-D<=y){for(let N=D;N<=C;N++){const G=p[2*N],J=p[2*N+1];G>=e&&G<=o&&J>=i&&J<=u&&T.push(d[N])}continue}const P=D+C>>1,B=p[2*P],k=p[2*P+1];B>=e&&B<=o&&k>=i&&k<=u&&T.push(d[P]),(A===0?e<=B:i<=k)&&(x.push(D),x.push(P-1),x.push(1-A)),(A===0?o>=B:u>=k)&&(x.push(P+1),x.push(C),x.push(1-A))}return T}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:d,nodeSize:p}=this,y=[0,u.length-1,0],x=[],T=o*o;for(;y.length;){const A=y.pop()||0,C=y.pop()||0,D=y.pop()||0;if(C-D<=p){for(let N=D;N<=C;N++)wg(d[2*N],d[2*N+1],e,i)<=T&&x.push(u[N]);continue}const P=D+C>>1,B=d[2*P],k=d[2*P+1];wg(B,k,e,i)<=T&&x.push(u[P]),(A===0?e-o<=B:i-o<=k)&&(y.push(D),y.push(P-1),y.push(1-A)),(A===0?e+o>=B:i+o>=k)&&(y.push(P+1),y.push(C),y.push(1-A))}return x}}function eg(n,e,i,o,u,d){if(u-o<=i)return;const p=o+u>>1;bg(n,e,p,o,u,d),eg(n,e,i,o,p-1,1-d),eg(n,e,i,p+1,u,1-d)}function bg(n,e,i,o,u,d){for(;u>o;){if(u-o>600){const T=u-o+1,A=i-o+1,C=Math.log(T),D=.5*Math.exp(2*C/3),P=.5*Math.sqrt(C*D*(T-D)/T)*(A-T/2<0?-1:1);bg(n,e,i,Math.max(o,Math.floor(i-A*D/T+P)),Math.min(u,Math.floor(i+(T-A)*D/T+P)),d)}const p=e[2*i+d];let y=o,x=u;for(Np(n,e,o,i),e[2*u+d]>p&&Np(n,e,o,u);y<x;){for(Np(n,e,y,x),y++,x--;e[2*y+d]<p;)y++;for(;e[2*x+d]>p;)x--}e[2*o+d]===p?Np(n,e,o,x):(x++,Np(n,e,x,u)),x<=i&&(o=x+1),i<=x&&(u=x-1)}}function Np(n,e,i,o){tg(n,i,o),tg(e,2*i,2*o),tg(e,2*i+1,2*o+1)}function tg(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function wg(n,e,i,o){const u=n-i,d=e-o;return u*u+d*d}var ig;O.cH=void 0,(ig=O.cH||(O.cH={})).create="create",ig.load="load",ig.fullLoad="fullLoad";let Um=null,jp=[];const ng=1e3/60,ag="loadTime",rg="fullLoadTime",Zg={mark(n){performance.mark(n)},frame(n){const e=n;Um!=null&&jp.push(e-Um),Um=e},clearMetrics(){Um=null,jp=[],performance.clearMeasures(ag),performance.clearMeasures(rg);for(const n in O.cH)performance.clearMarks(O.cH[n])},getPerformanceMetrics(){performance.measure(ag,O.cH.create,O.cH.load),performance.measure(rg,O.cH.create,O.cH.fullLoad);const n=performance.getEntriesByName(ag)[0].duration,e=performance.getEntriesByName(rg)[0].duration,i=jp.length,o=1/(jp.reduce(((d,p)=>d+p),0)/i/1e3),u=jp.filter((d=>d>ng)).reduce(((d,p)=>d+(p-ng)/ng),0);return{loadTime:n,fullLoadTime:e,fps:o,percentDroppedFrames:u/(i+u)*100,totalFrames:i}}};O.$=Te,O.A=qt,O.B=Rr,O.C=Bn,O.D=at,O.E=Qt,O.F=function([n,e,i]){return e+=90,e*=Math.PI/180,i*=Math.PI/180,{x:n*Math.cos(e)*Math.sin(i),y:n*Math.sin(e)*Math.sin(i),z:n*Math.cos(i)}},O.G=Gi,O.H=gi,O.I=Ii,O.J=Ac,O.K=function(n){if(tn==null){const e=n.navigator?n.navigator.userAgent:null;tn=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return tn},O.L=class{constructor(n,e){this.target=n,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new pf((()=>this.process())),this.subscription=_l(this.target,"message",(i=>this.receive(i)),!1),this.globalScope=sr(self)?n:window}registerMessageHandler(n,e){this.messageHandlers[n]=e}unregisterMessageHandler(n){delete this.messageHandlers[n]}sendAsync(n,e){return new Promise(((i,o)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10),d=e?_l(e.signal,"abort",(()=>{d?.unsubscribe(),delete this.resolveRejects[u];const x={id:u,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(x)}),pp):null;this.resolveRejects[u]={resolve:x=>{d?.unsubscribe(),i(x)},reject:x=>{d?.unsubscribe(),o(x)}};const p=[],y=Object.assign(Object.assign({},n),{id:u,sourceMapId:this.mapId,origin:location.origin,data:Lr(n.data,p)});this.target.postMessage(y,{transfer:p})}))}receive(n){const e=n.data,i=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[i];const o=this.abortControllers[i];return delete this.abortControllers[i],void(o&&o.abort())}if(sr(self)||e.mustQueue)return this.tasks[i]=e,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,e)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),e=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(n,e)}processTask(n,e){return f(this,void 0,void 0,(function*(){if(e.type==="<response>"){const u=this.resolveRejects[n];return delete this.resolveRejects[n],u?void(e.error?u.reject(Nl(e.error)):u.resolve(Nl(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const i=Nl(e.data),o=new AbortController;this.abortControllers[n]=o;try{const u=yield this.messageHandlers[e.type](e.sourceMapId,i,o);this.completeTask(n,null,u)}catch(u){this.completeTask(n,u)}}))}completeTask(n,e,i){const o=[];delete this.abortControllers[n];const u={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?Lr(e):null,data:Lr(i,o)};this.target.postMessage(u,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},O.M=fe,O.N=function(){var n=new qt(16);return qt!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},O.O=function(n,e,i){var o,u,d,p,y,x,T,A,C,D,P,B,k=i[0],N=i[1],G=i[2];return e===n?(n[12]=e[0]*k+e[4]*N+e[8]*G+e[12],n[13]=e[1]*k+e[5]*N+e[9]*G+e[13],n[14]=e[2]*k+e[6]*N+e[10]*G+e[14],n[15]=e[3]*k+e[7]*N+e[11]*G+e[15]):(u=e[1],d=e[2],p=e[3],y=e[4],x=e[5],T=e[6],A=e[7],C=e[8],D=e[9],P=e[10],B=e[11],n[0]=o=e[0],n[1]=u,n[2]=d,n[3]=p,n[4]=y,n[5]=x,n[6]=T,n[7]=A,n[8]=C,n[9]=D,n[10]=P,n[11]=B,n[12]=o*k+y*N+C*G+e[12],n[13]=u*k+x*N+D*G+e[13],n[14]=d*k+T*N+P*G+e[14],n[15]=p*k+A*N+B*G+e[15]),n},O.P=De,O.Q=function(n,e,i){var o=i[0],u=i[1],d=i[2];return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*o,n[4]=e[4]*u,n[5]=e[5]*u,n[6]=e[6]*u,n[7]=e[7]*u,n[8]=e[8]*d,n[9]=e[9]*d,n[10]=e[10]*d,n[11]=e[11]*d,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},O.R=Ba,O.S=function(n,e,i){var o=e[0],u=e[1],d=e[2],p=e[3],y=e[4],x=e[5],T=e[6],A=e[7],C=e[8],D=e[9],P=e[10],B=e[11],k=e[12],N=e[13],G=e[14],J=e[15],q=i[0],X=i[1],te=i[2],ae=i[3];return n[0]=q*o+X*y+te*C+ae*k,n[1]=q*u+X*x+te*D+ae*N,n[2]=q*d+X*T+te*P+ae*G,n[3]=q*p+X*A+te*B+ae*J,n[4]=(q=i[4])*o+(X=i[5])*y+(te=i[6])*C+(ae=i[7])*k,n[5]=q*u+X*x+te*D+ae*N,n[6]=q*d+X*T+te*P+ae*G,n[7]=q*p+X*A+te*B+ae*J,n[8]=(q=i[8])*o+(X=i[9])*y+(te=i[10])*C+(ae=i[11])*k,n[9]=q*u+X*x+te*D+ae*N,n[10]=q*d+X*T+te*P+ae*G,n[11]=q*p+X*A+te*B+ae*J,n[12]=(q=i[12])*o+(X=i[13])*y+(te=i[14])*C+(ae=i[15])*k,n[13]=q*u+X*x+te*D+ae*N,n[14]=q*d+X*T+te*P+ae*G,n[15]=q*p+X*A+te*B+ae*J,n},O.T=qd,O.U=function(n,e){const i={};for(let o=0;o<e.length;o++){const u=e[o];u in n&&(i[u]=n[u])}return i},O.V=To,O.W=Yt,O.X=mp,O.Y=Tm,O.Z=re,O._=f,O.a=H,O.a$=Ma,O.a0=Yi,O.a1=$s,O.a2=Mr,O.a3=Mm,O.a4=Xh,O.a5=gt,O.a6=function(n,e,i){if(!n)return e||{};if(!e)return n||{};const o=$h(n),u=$h(e);(function(p,y){y.removeAll&&(p.add.clear(),p.update.clear(),p.remove.clear(),y.remove.clear());for(const x of y.remove)p.add.delete(x),p.update.delete(x);for(const[x,T]of y.update){const A=p.update.get(x);A&&(y.update.set(x,_p(A,T)),p.update.delete(x))}})(o,u);const d={};if((o.removeAll||u.removeAll)&&(d.removeAll=!0),d.remove=new Set([...o.remove,...u.remove]),d.add=new Map([...o.add,...u.add]),d.update=new Map([...o.update,...u.update]),d.remove.size&&d.add.size)for(const p of d.add.keys())d.remove.delete(p);return(function(p){const y={};return p.removeAll&&(y.removeAll=p.removeAll),p.remove&&(y.remove=Array.from(p.remove)),p.add&&(y.add=Array.from(p.add.values())),p.update&&(y.update=Array.from(p.update.values())),y})(d)},O.a7=function(n,e){const i=new Map;if(n==null||n.type==null)return i;if(n.type==="Feature"){const o=Yh(n,e);return o==null?void 0:(i.set(o,n),i)}if(n.type==="FeatureCollection"){const o=new Set;for(const u of n.features){const d=Yh(u,e);if(d==null||o.has(d))return;o.add(d),i.set(d,u)}return i}},O.a8=function(n,e,i){var o,u;const d=[];if(e.removeAll)n.clear();else if(e.remove)for(const p of e.remove){const y=n.get(p);y&&(d.push(y.geometry),n.delete(p))}if(e.add)for(const p of e.add){const y=Yh(p,i);if(y==null)continue;const x=n.get(y);x&&d.push(x.geometry),d.push(p.geometry),n.set(y,p)}if(e.update)for(const p of e.update){const y=n.get(p.id);if(!y)continue;const x=!!p.newGeometry,T=p.removeAllProperties||((o=p.removeProperties)===null||o===void 0?void 0:o.length)>0||((u=p.addOrUpdateProperties)===null||u===void 0?void 0:u.length)>0;if(!x&&!T)continue;d.push(y.geometry);const A=Object.assign({},y);if(n.set(p.id,A),x&&(d.push(p.newGeometry),A.geometry=p.newGeometry),T){if(A.properties=p.removeAllProperties?{}:Object.assign({},A.properties||{}),p.removeProperties)for(const C of p.removeProperties)delete A.properties[C];if(p.addOrUpdateProperties)for(const{key:C,value:D}of p.addOrUpdateProperties)A.properties[C]=D}}return d},O.a9=wi,O.aA=function(n,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:u}){return n.kind==="source"?o/Ur:n.kind==="composite"?Gi.number(o/Ur,u/Ur,i):e},O.aB=function(n,e){var i=e[0],o=e[1],u=e[2],d=e[3],p=e[4],y=e[5],x=e[6],T=e[7],A=e[8],C=e[9],D=e[10],P=e[11],B=e[12],k=e[13],N=e[14],G=e[15],J=i*y-o*p,q=i*x-u*p,X=i*T-d*p,te=o*x-u*y,ae=o*T-d*y,ye=u*T-d*x,Le=A*k-C*B,Pe=A*N-D*B,je=A*G-P*B,Qe=C*N-D*k,Ue=C*G-P*k,Re=D*G-P*N,Ee=J*Re-q*Ue+X*Qe+te*je-ae*Pe+ye*Le;return Ee?(n[0]=(y*Re-x*Ue+T*Qe)*(Ee=1/Ee),n[1]=(u*Ue-o*Re-d*Qe)*Ee,n[2]=(k*ye-N*ae+G*te)*Ee,n[3]=(D*ae-C*ye-P*te)*Ee,n[4]=(x*je-p*Re-T*Pe)*Ee,n[5]=(i*Re-u*je+d*Pe)*Ee,n[6]=(N*X-B*ye-G*q)*Ee,n[7]=(A*ye-D*X+P*q)*Ee,n[8]=(p*Ue-y*je+T*Le)*Ee,n[9]=(o*je-i*Ue-d*Le)*Ee,n[10]=(B*ae-k*X+G*J)*Ee,n[11]=(C*X-A*ae-P*J)*Ee,n[12]=(y*Pe-p*Qe-x*Le)*Ee,n[13]=(i*Qe-o*Pe+u*Le)*Ee,n[14]=(k*q-B*te-N*J)*Ee,n[15]=(A*te-C*q+D*J)*Ee,n):null},O.aC=Ke,O.aD=function(n){var e=n[0],i=n[1];return Math.sqrt(e*e+i*i)},O.aE=function(n){return n[0]=0,n[1]=0,n},O.aF=function(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n},O.aG=cp,O.aH=Va,O.aI=function(n,e,i,o){const u=e.y-n.y,d=e.x-n.x,p=o.y-i.y,y=o.x-i.x,x=p*d-y*u;if(x===0)return null;const T=(y*(n.y-i.y)-p*(n.x-i.x))/x;return new De(n.x+T*d,n.y+T*u)},O.aJ=a,O.aK=Xu,O.aL=function(n){let e=1/0,i=1/0,o=-1/0,u=-1/0;for(const d of n)e=Math.min(e,d.x),i=Math.min(i,d.y),o=Math.max(o,d.x),u=Math.max(u,d.y);return[e,i,o,u]},O.aM=kn,O.aN=li,O.aO=function(n,e,i,o,u=!1){if(!i[0]&&!i[1])return[0,0];const d=u?o==="map"?-n.bearingInRadians:0:o==="viewport"?n.bearingInRadians:0;if(d){const p=Math.sin(d),y=Math.cos(d);i=[i[0]*y-i[1]*p,i[0]*p+i[1]*y]}return[u?i[0]:li(e,i[0],n.zoom),u?i[1]:li(e,i[1],n.zoom)]},O.aQ=uf,O.aR=Fp,O.aS=sp,O.aT=Jm,O.aU=qi,O.aV=Oh,O.aW=Y,O.aX=We,O.aY=we,O.aZ=Ea,O.a_=gp,O.aa=Ql,O.ab=25,O.ac=na,O.ad=n=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((i=>{e.onloadstart=()=>{i(e)};for(const o of n){const u=window.document.createElement("source");ke(o)||(e.crossOrigin="Anonymous"),u.src=o,e.appendChild(u)}}))},O.ae=He,O.af=function(){return Bi++},O.ag=h,O.ah=Yc,O.ai=cd,O.aj=za,O.ak=jr,O.al=_f,O.am=function(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,o,u,d)=>{const p=u||d;return e[o]=!p||p.toLowerCase(),""})),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e},O.an=kt,O.ao=85.051129,O.ap=Fn,O.aq=function(n){return Math.pow(2,n)},O.ar=ma,O.as=Sm,O.at=function(n){return Math.log(n)/Math.LN2},O.au=function(n){var e=n[0],i=n[1];return e*e+i*i},O.av=function(n){if(!n.length)return new Set;const e=Math.max(...n.map((x=>x.canonical.z)));let i=1/0,o=-1/0,u=1/0,d=-1/0;const p=[];for(const x of n){const{x:T,y:A,z:C}=x.canonical,D=Math.pow(2,e-C),P=T*D,B=A*D;p.push({id:x,x:P,y:B}),P<i&&(i=P),P>o&&(o=P),B<u&&(u=B),B>d&&(d=B)}const y=new Set;for(const x of p)x.x!==i&&x.x!==o&&x.y!==u&&x.y!==d||y.add(x.id);return y},O.aw=function(n,e){const i=Math.abs(2*n.wrap)-+(n.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||o-i||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x},O.ax=class{constructor(n,e){this.max=n,this.onRemove=e,this.reset()}reset(){for(const n in this.data)for(const e of this.data[n])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(n,e,i){const o=n.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const u={value:e,timeout:void 0};if(i!==void 0&&(u.timeout=setTimeout((()=>{this.remove(n,u)}),i)),this.data[o].push(u),this.order.push(o),this.order.length>this.max){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const e=this.data[n].shift();return e.timeout&&clearTimeout(e.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),e.value}getByKey(n){const e=this.data[n];return e?e[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,e){if(!this.has(n))return this;const i=n.wrapped().key,o=e===void 0?0:this.data[i].indexOf(e),u=this.data[i][o];return this.data[i].splice(o,1),u.timeout&&clearTimeout(u.timeout),this.data[i].length===0&&delete this.data[i],this.onRemove(u.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(n){const e=[];for(const i in this.data)for(const o of this.data[i])n(o.value)||e.push(o);for(const i of e)this.remove(i.value.tileID,i)}},O.ay=function(n,e){let i=0,o=0;if(n.kind==="constant")o=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:u,minZoom:d,maxZoom:p}=n,y=u?kt(ba.interpolationFactor(u,e,d,p),0,1):0;n.kind==="camera"?o=Gi.number(n.minSize,n.maxSize,y):i=y}return{uSizeT:i,uSize:o}},O.b=ws,O.b$=Nr,O.b0=Kn,O.b1=function(n){var e=new qt(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e},O.b2=function(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n},O.b3=function(n,e){var i=e[0],o=e[1],u=e[2],d=i*i+o*o+u*u;return d>0&&(d=1/Math.sqrt(d)),n[0]=e[0]*d,n[1]=e[1]*d,n[2]=e[2]*d,n},O.b4=aa,O.b5=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]},O.b6=function(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n[3]=e[3]*i[3],n},O.b7=It,O.b8=function(n,e,i){const o=e[0]*i[0]+e[1]*i[1]+e[2]*i[2];return o===0?null:(-(n[0]*i[0]+n[1]*i[1]+n[2]*i[2])-i[3])/o},O.b9=ra,O.bA=function(n,e,i,o){return n[0]=e[0]+i[0]*o,n[1]=e[1]+i[1]*o,n[2]=e[2]+i[2]*o,n},O.bB=Oe,O.bC=function(n,e,i){var o=i[0],u=i[1],d=i[2],p=i[3],y=e[0],x=e[1],T=e[2],A=u*T-d*x,C=d*y-o*T,D=o*x-u*y;return n[0]=y+p*(A+=A)+u*(D+=D)-d*(C+=C),n[1]=x+p*C+d*A-o*D,n[2]=T+p*D+o*C-u*A,n},O.bD=function(n,e,i){const o=(function(x){var T=x[3],A=x[4],C=x[5],D=x[6],P=x[7],B=x[8];return x[0]*(B*A-C*P)+x[1]*(-B*T+C*D)+x[2]*(P*T-A*D)})([n[0],n[1],n[2],e[0],e[1],e[2],i[0],i[1],i[2]]);if(o===0)return null;const u=aa([],[e[0],e[1],e[2]],[i[0],i[1],i[2]]),d=aa([],[i[0],i[1],i[2]],[n[0],n[1],n[2]]),p=aa([],[n[0],n[1],n[2]],[e[0],e[1],e[2]]),y=Ma([],u,-n[3]);return Kn(y,y,Ma([],d,-e[3])),Kn(y,y,Ma([],p,-i[3])),Ma(y,y,1/o),y},O.bE=mf,O.bF=function(){return new Float64Array(4)},O.bG=function(n,e,i,o){var u=[],d=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],d[0]=u[0]*Math.cos(o)-u[1]*Math.sin(o),d[1]=u[0]*Math.sin(o)+u[1]*Math.cos(o),d[2]=u[2],n[0]=d[0]+i[0],n[1]=d[1]+i[1],n[2]=d[2]+i[2],n},O.bH=function(n,e,i,o){var u=[],d=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],d[0]=u[0],d[1]=u[1]*Math.cos(o)-u[2]*Math.sin(o),d[2]=u[1]*Math.sin(o)+u[2]*Math.cos(o),n[0]=d[0]+i[0],n[1]=d[1]+i[1],n[2]=d[2]+i[2],n},O.bI=function(n,e,i,o){var u=[],d=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],d[0]=u[2]*Math.sin(o)+u[0]*Math.cos(o),d[1]=u[1],d[2]=u[2]*Math.cos(o)-u[0]*Math.sin(o),n[0]=d[0]+i[0],n[1]=d[1]+i[1],n[2]=d[2]+i[2],n},O.bJ=function(n,e,i){var o=Math.sin(i),u=Math.cos(i),d=e[0],p=e[1],y=e[2],x=e[3],T=e[8],A=e[9],C=e[10],D=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*u-T*o,n[1]=p*u-A*o,n[2]=y*u-C*o,n[3]=x*u-D*o,n[8]=d*o+T*u,n[9]=p*o+A*u,n[10]=y*o+C*u,n[11]=x*o+D*u,n},O.bK=function(n,e){const i=de(n,360),o=de(e,360),u=o-i,d=o>i?u-360:u+360;return Math.abs(u)<Math.abs(d)?u:d},O.bL=function(n){return n[0]=0,n[1]=0,n[2]=0,n},O.bM=function(n,e,i,o){const u=Math.sqrt(n*n+e*e),d=Math.sqrt(i*i+o*o);n/=u,e/=u,i/=d,o/=d;const p=Math.acos(n*i+e*o);return-e*i+n*o>0?p:-p},O.bN=function(n,e){const i=de(n,2*Math.PI),o=de(e,2*Math.PI);return Math.min(Math.abs(i-o),Math.abs(i-o+2*Math.PI),Math.abs(i-o-2*Math.PI))},O.bO=function(){const n={},e=ge.$version;for(const i in ge.$root){const o=ge.$root[i];if(o.required){let u=null;u=i==="version"?e:o.type==="array"?[]:{},u!=null&&(n[i]=u)}}return n},O.bP=xe,O.bQ=zc,O.bR=function n(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let o=0;o<e.length;o++)if(!n(e[o],i[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&i!==null){if(typeof i!="object"||Object.keys(e).length!==Object.keys(i).length)return!1;for(const o in e)if(!n(e[o],i[o]))return!1;return!0}return e===i},O.bS=function(n){n=n.slice();const e=Object.create(null);for(let i=0;i<n.length;i++)e[n[i].id]=n[i];for(let i=0;i<n.length;i++)"ref"in n[i]&&(n[i]=yn(n[i],e[n[i].ref]));return n},O.bT=function(n,e){if(n.type==="custom")return new fp(n,e);switch(n.type){case"background":return new ni(n,e);case"circle":return new Vd(n,e);case"color-relief":return new Qp(n,e);case"fill":return new im(n,e);case"fill-extrusion":return new Jf(n,e);case"heatmap":return new $p(n,e);case"hillshade":return new cn(n,e);case"line":return new tp(n,e);case"raster":return new ks(n,e);case"symbol":return new Wl(n,e)}},O.bU=n=>n.type==="raster",O.bV=Ua,O.bW=function(n,e){if(!n)return[{command:"setStyle",args:[e]}];let i=[];try{if(!Dt(n.version,e.version))return[{command:"setStyle",args:[e]}];Dt(n.center,e.center)||i.push({command:"setCenter",args:[e.center]}),Dt(n.state,e.state)||i.push({command:"setGlobalState",args:[e.state]}),Dt(n.centerAltitude,e.centerAltitude)||i.push({command:"setCenterAltitude",args:[e.centerAltitude]}),Dt(n.zoom,e.zoom)||i.push({command:"setZoom",args:[e.zoom]}),Dt(n.bearing,e.bearing)||i.push({command:"setBearing",args:[e.bearing]}),Dt(n.pitch,e.pitch)||i.push({command:"setPitch",args:[e.pitch]}),Dt(n.roll,e.roll)||i.push({command:"setRoll",args:[e.roll]}),Dt(n.sprite,e.sprite)||i.push({command:"setSprite",args:[e.sprite]}),Dt(n.glyphs,e.glyphs)||i.push({command:"setGlyphs",args:[e.glyphs]}),Dt(n.transition,e.transition)||i.push({command:"setTransition",args:[e.transition]}),Dt(n.light,e.light)||i.push({command:"setLight",args:[e.light]}),Dt(n.terrain,e.terrain)||i.push({command:"setTerrain",args:[e.terrain]}),Dt(n.sky,e.sky)||i.push({command:"setSky",args:[e.sky]}),Dt(n.projection,e.projection)||i.push({command:"setProjection",args:[e.projection]});const o={},u=[];(function(p,y,x,T){let A;for(A in y=y||{},p=p||{})Object.prototype.hasOwnProperty.call(p,A)&&(Object.prototype.hasOwnProperty.call(y,A)||vi(A,x,T));for(A in y)Object.prototype.hasOwnProperty.call(y,A)&&(Object.prototype.hasOwnProperty.call(p,A)?Dt(p[A],y[A])||(p[A].type==="geojson"&&y[A].type==="geojson"&&Ai(p,y,A)?mi(x,{command:"setGeoJSONSourceData",args:[A,y[A].data]}):nn(A,y,x,T)):Pn(A,y,x))})(n.sources,e.sources,u,o);const d=[];n.layers&&n.layers.forEach((p=>{"source"in p&&o[p.source]?i.push({command:"removeLayer",args:[p.id]}):d.push(p)})),i=i.concat(u),(function(p,y,x){y=y||[];const T=(p=p||[]).map(yl),A=y.map(yl),C=p.reduce(Ao,{}),D=y.reduce(Ao,{}),P=T.slice(),B=Object.create(null);let k,N,G,J,q;for(let X=0,te=0;X<T.length;X++)k=T[X],Object.prototype.hasOwnProperty.call(D,k)?te++:(mi(x,{command:"removeLayer",args:[k]}),P.splice(P.indexOf(k,te),1));for(let X=0,te=0;X<A.length;X++)k=A[A.length-1-X],P[P.length-1-X]!==k&&(Object.prototype.hasOwnProperty.call(C,k)?(mi(x,{command:"removeLayer",args:[k]}),P.splice(P.lastIndexOf(k,P.length-te),1)):te++,J=P[P.length-X],mi(x,{command:"addLayer",args:[D[k],J]}),P.splice(P.length-X,0,k),B[k]=!0);for(let X=0;X<A.length;X++)if(k=A[X],N=C[k],G=D[k],!B[k]&&!Dt(N,G))if(Dt(N.source,G.source)&&Dt(N["source-layer"],G["source-layer"])&&Dt(N.type,G.type)){for(q in vn(N.layout,G.layout,x,k,null,"setLayoutProperty"),vn(N.paint,G.paint,x,k,null,"setPaintProperty"),Dt(N.filter,G.filter)||mi(x,{command:"setFilter",args:[k,G.filter]}),Dt(N.minzoom,G.minzoom)&&Dt(N.maxzoom,G.maxzoom)||mi(x,{command:"setLayerZoomRange",args:[k,G.minzoom,G.maxzoom]}),N)Object.prototype.hasOwnProperty.call(N,q)&&q!=="layout"&&q!=="paint"&&q!=="filter"&&q!=="metadata"&&q!=="minzoom"&&q!=="maxzoom"&&(q.indexOf("paint.")===0?vn(N[q],G[q],x,k,q.slice(6),"setPaintProperty"):Dt(N[q],G[q])||mi(x,{command:"setLayerProperty",args:[k,q,G[q]]}));for(q in G)Object.prototype.hasOwnProperty.call(G,q)&&!Object.prototype.hasOwnProperty.call(N,q)&&q!=="layout"&&q!=="paint"&&q!=="filter"&&q!=="metadata"&&q!=="minzoom"&&q!=="maxzoom"&&(q.indexOf("paint.")===0?vn(N[q],G[q],x,k,q.slice(6),"setPaintProperty"):Dt(N[q],G[q])||mi(x,{command:"setLayerProperty",args:[k,q,G[q]]}))}else mi(x,{command:"removeLayer",args:[k]}),J=P[P.lastIndexOf(k)+1],mi(x,{command:"addLayer",args:[G,J]})})(d,e.layers,i)}catch(o){console.warn("Unable to compute style diff:",o),i=[{command:"setStyle",args:[e]}]}return i},O.bX=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},O.bY=ga,O.bZ=Ys,O.b_=class extends Ra{constructor(n,e){super(n,e),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},O.ba=function(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n},O.bb=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]},O.bc=Am,O.bd=Wc,O.be=function(n,e,i,o,u){var d=1/Math.tan(e/2);if(n[0]=d/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=d,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,u!=null&&u!==1/0){var p=1/(o-u);n[10]=(u+o)*p,n[14]=2*u*o*p}else n[10]=-1,n[14]=-2*o;return n},O.bf=function(n){var e=new qt(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},O.bg=function(n,e,i){var o=Math.sin(i),u=Math.cos(i),d=e[0],p=e[1],y=e[2],x=e[3],T=e[4],A=e[5],C=e[6],D=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*u+T*o,n[1]=p*u+A*o,n[2]=y*u+C*o,n[3]=x*u+D*o,n[4]=T*u-d*o,n[5]=A*u-p*o,n[6]=C*u-y*o,n[7]=D*u-x*o,n},O.bh=function(n,e,i){var o=Math.sin(i),u=Math.cos(i),d=e[4],p=e[5],y=e[6],x=e[7],T=e[8],A=e[9],C=e[10],D=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=d*u+T*o,n[5]=p*u+A*o,n[6]=y*u+C*o,n[7]=x*u+D*o,n[8]=T*u-d*o,n[9]=A*u-p*o,n[10]=C*u-y*o,n[11]=D*u-x*o,n},O.bi=function(){const n=new Float32Array(16);return ma(n),n},O.bj=function(){const n=new Float64Array(16);return ma(n),n},O.bk=function(){return new Float64Array(16)},O.bl=function(n,e,i){const o=new Float64Array(4);return Oe(o,n,e-90,i),o},O.bm=function(n,e,i,o){var u,d,p,y,x,T=e[0],A=e[1],C=e[2],D=e[3],P=i[0],B=i[1],k=i[2],N=i[3];return(d=T*P+A*B+C*k+D*N)<0&&(d=-d,P=-P,B=-B,k=-k,N=-N),1-d>fi?(u=Math.acos(d),p=Math.sin(u),y=Math.sin((1-o)*u)/p,x=Math.sin(o*u)/p):(y=1-o,x=o),n[0]=y*T+x*P,n[1]=y*A+x*B,n[2]=y*C+x*k,n[3]=y*D+x*N,n},O.bn=function(n){const e=new Float64Array(9);(function(d,p){var y=p[0],x=p[1],T=p[2],A=p[3],C=y+y,D=x+x,P=T+T,B=y*C,k=x*C,N=x*D,G=T*C,J=T*D,q=T*P,X=A*C,te=A*D,ae=A*P;d[0]=1-N-q,d[3]=k-ae,d[6]=G+te,d[1]=k+ae,d[4]=1-B-q,d[7]=J-X,d[2]=G-te,d[5]=J+X,d[8]=1-B-N})(e,n);const i=Ea(-Math.asin(kt(e[2],-1,1)));let o,u;return Math.hypot(e[5],e[8])<.001?(o=0,u=-Ea(Math.atan2(e[3],e[4]))):(o=Ea(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),u=Ea(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:o,pitch:i+90,bearing:u}},O.bo=function(n,e){return n.roll==e.roll&&n.pitch==e.pitch&&n.bearing==e.bearing},O.bp=Ft,O.bq=Ko,O.br=br,O.bs=Vs,O.bt=ia,O.bu=Ge,O.bv=st,O.bw=Rn,O.bx=function(n,e,i,o,u){return Ge(o,u,kt((n-e)/(i-e),0,1))},O.by=de,O.bz=function(){return new Float64Array(3)},O.c=oe,O.c$=function(n,e,i,o,u){return f(this,void 0,void 0,(function*(){if(Yi())try{return yield $s(n,e,i,o,u)}catch{}return(function(d,p,y,x,T){const A=d.width,C=d.height;Hr&&Er||(Hr=new OffscreenCanvas(A,C),Er=Hr.getContext("2d",{willReadFrequently:!0})),Hr.width=A,Hr.height=C,Er.drawImage(d,0,0,A,C);const D=Er.getImageData(p,y,x,T);return Er.clearRect(0,0,A,C),D.data})(n,e,i,o,u)}))},O.c0=class extends Ra{constructor(n,e){super(n,e),this.current=La}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},O.c1=ql,O.c2=class extends Ra{constructor(n,e){super(n,e),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},O.c3=class extends Ra{constructor(n,e){super(n,e),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},O.c4=Qn,O.c5=function(n,e){var i=Math.sin(e),o=Math.cos(e);return n[0]=o,n[1]=i,n[2]=0,n[3]=-i,n[4]=o,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},O.c6=function(n,e,i){var o=e[0],u=e[1],d=e[2];return n[0]=o*i[0]+u*i[3]+d*i[6],n[1]=o*i[1]+u*i[4]+d*i[7],n[2]=o*i[2]+u*i[5]+d*i[8],n},O.c7=function(n,e,i,o,u,d,p){var y=1/(e-i),x=1/(o-u),T=1/(d-p);return n[0]=-2*y,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*x,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*T,n[11]=0,n[12]=(e+i)*y,n[13]=(u+o)*x,n[14]=(p+d)*T,n[15]=1,n},O.c8=class extends Ra{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;const e=new Float32Array(4*n.length);for(let i=0;i<n.length;i++)e[4*i]=n[i].r,e[4*i+1]=n[i].g,e[4*i+2]=n[i].b,e[4*i+3]=n[i].a;this.gl.uniform4fv(this.location,e)}}},O.c9=class extends Ra{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;const e=new Float32Array(n);this.gl.uniform1fv(this.location,e)}}},O.cA=function(n,e){return me[e]&&"touches"in n},O.cB=function(n){return me[n]||V[n]},O.cC=function(n,e,i){var o=e[0],u=e[1];return n[0]=i[0]*o+i[4]*u+i[12],n[1]=i[1]*o+i[5]*u+i[13],n},O.cD=function(n,e){const{x:i,y:o}=wi.fromLngLat(e);return!(n<0||n>25||o<0||o>=1||i<0||i>=1)},O.cE=function(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},O.cF=class extends Yo{},O.cG=Zg,O.cI=ue,O.cJ=function(n,e){oe.REGISTERED_PROTOCOLS[n]=e},O.cK=function(n){delete oe.REGISTERED_PROTOCOLS[n]},O.cL=function(n,e){const i={};for(let u=0;u<n.length;u++){const d=e&&e[n[u].id]||zs(n[u]);e&&(e[n[u].id]=d);let p=i[d];p||(p=i[d]=[]),p.push(n[u])}const o=[];for(const u in i)o.push(i[u]);return o},O.cM=tt,O.cN=yp,O.cO=Op,O.cP=sf,O.cQ=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=gt/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const e=n.bucket.layers[0],i=e.layout,o=e._unevaluatedLayout._values,u={layoutIconSize:o["icon-size"].possiblyEvaluate(new gi(n.bucket.zoom+1),n.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new gi(n.bucket.zoom+1),n.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new gi(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:T,maxZoom:A}=n.bucket.textSizeData;u.compositeTextSizes=[o["text-size"].possiblyEvaluate(new gi(T),n.canonical),o["text-size"].possiblyEvaluate(new gi(A),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:T,maxZoom:A}=n.bucket.iconSizeData;u.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new gi(T),n.canonical),o["icon-size"].possiblyEvaluate(new gi(A),n.canonical)]}const d=i.get("text-line-height")*kn,p=i.get("text-rotation-alignment")!=="viewport"&&i.get("symbol-placement")!=="point",y=i.get("text-keep-upright"),x=i.get("text-size");for(const T of n.bucket.features){const A=i.get("text-font").evaluate(T,{},n.canonical).join(","),C=x.evaluate(T,{},n.canonical),D=u.layoutTextSize.evaluate(T,{},n.canonical),P=u.layoutIconSize.evaluate(T,{},n.canonical),B={horizontal:{},vertical:void 0},k=T.text;let N,G=[0,0];if(k){const X=k.toString(),te=i.get("text-letter-spacing").evaluate(T,{},n.canonical)*kn,ae=Dc(X)?te:0,ye=i.get("text-anchor").evaluate(T,{},n.canonical),Le=dl(e,T,n.canonical);if(!Le){const Ue=i.get("text-radial-offset").evaluate(T,{},n.canonical);G=Ue?yi(ye,[Ue*kn,ei]):i.get("text-offset").evaluate(T,{},n.canonical).map((Re=>Re*kn))}let Pe=p?"center":i.get("text-justify").evaluate(T,{},n.canonical);const je=i.get("symbol-placement")==="point"?i.get("text-max-width").evaluate(T,{},n.canonical)*kn:1/0,Qe=()=>{n.bucket.allowVerticalPlacement&&hs(X)&&(B.vertical=qh(k,n.glyphMap,n.glyphPositions,n.imagePositions,A,je,d,ye,"left",ae,G,O.az.vertical,!0,D,C))};if(!p&&Le){const Ue=new Set;if(Pe==="auto")for(let Ee=0;Ee<Le.values.length;Ee+=2)Ue.add(Fp(Le.values[Ee]));else Ue.add(Pe);let Re=!1;for(const Ee of Ue)if(!B.horizontal[Ee])if(Re)B.horizontal[Ee]=B.horizontal[0];else{const rt=qh(k,n.glyphMap,n.glyphPositions,n.imagePositions,A,je,d,"center",Ee,ae,G,O.az.horizontal,!1,D,C);rt&&(B.horizontal[Ee]=rt,Re=rt.positionedLines.length===1)}Qe()}else{Pe==="auto"&&(Pe=Fp(ye));const Ue=qh(k,n.glyphMap,n.glyphPositions,n.imagePositions,A,je,d,ye,Pe,ae,G,O.az.horizontal,!1,D,C);Ue&&(B.horizontal[Pe]=Ue),Qe(),hs(X)&&p&&y&&(B.vertical=qh(k,n.glyphMap,n.glyphPositions,n.imagePositions,A,je,d,ye,Pe,ae,G,O.az.vertical,!1,D,C))}}let J=!1;if(T.icon&&T.icon.name){const X=n.imageMap[T.icon.name];X&&(N=lp(n.imagePositions[T.icon.name],i.get("icon-offset").evaluate(T,{},n.canonical),i.get("icon-anchor").evaluate(T,{},n.canonical)),J=!!X.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=J:n.bucket.sdfIcons!==J&&$i("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(X.pixelRatio!==n.bucket.pixelRatio||i.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const q=vg(B.horizontal)||B.vertical;n.bucket.iconsInText=!!q&&q.iconsInText,(q||N)&&Gg(n.bucket,T,B,N,n.imageMap,u,D,P,G,J,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},O.cR=$u,O.cS=Hl,O.cT=Vc,O.cU=function(n){const e=new nf;return(function(i,o){for(const u in i.layers)o.writeMessage(3,zf,i.layers[u])})(n,e),e.finish()},O.cV=function(n,e,i,o,u,d){let p=s(n,e,i,u,0);return p=s(p,e,o,d,1),p},O.cW=class{constructor(n){this.maxEntries=n,this.map=new Map}get(n){const e=this.map.get(n);return e!==void 0&&(this.map.delete(n),this.map.set(n,e)),e}set(n,e){if(this.map.has(n))this.map.delete(n);else if(this.map.size>=this.maxEntries){const i=this.map.keys().next().value;this.map.delete(i)}this.map.set(n,e)}clear(){this.map.clear()}},O.cX=ii,O.cY=nf,O.cZ=ud,O.c_=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},O.ca=class extends Fs{},O.cb=om,O.cc=class extends Zi{},O.cd=zh,O.ce=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},O.cf=bo,O.cg=function(n,e,i){var o=e[0],u=e[1],d=e[2],p=i[3]*o+i[7]*u+i[11]*d+i[15];return n[0]=(i[0]*o+i[4]*u+i[8]*d+i[12])/(p=p||1),n[1]=(i[1]*o+i[5]*u+i[9]*d+i[13])/p,n[2]=(i[2]*o+i[6]*u+i[10]*d+i[14])/p,n},O.ch=class extends $o{},O.ci=class extends t{},O.cj=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]&&n[4]===e[4]&&n[5]===e[5]&&n[6]===e[6]&&n[7]===e[7]&&n[8]===e[8]&&n[9]===e[9]&&n[10]===e[10]&&n[11]===e[11]&&n[12]===e[12]&&n[13]===e[13]&&n[14]===e[14]&&n[15]===e[15]},O.ck=function(n,e){var i=n[0],o=n[1],u=n[2],d=n[3],p=n[4],y=n[5],x=n[6],T=n[7],A=n[8],C=n[9],D=n[10],P=n[11],B=n[12],k=n[13],N=n[14],G=n[15],J=e[0],q=e[1],X=e[2],te=e[3],ae=e[4],ye=e[5],Le=e[6],Pe=e[7],je=e[8],Qe=e[9],Ue=e[10],Re=e[11],Ee=e[12],rt=e[13],it=e[14],ot=e[15];return Math.abs(i-J)<=fi*Math.max(1,Math.abs(i),Math.abs(J))&&Math.abs(o-q)<=fi*Math.max(1,Math.abs(o),Math.abs(q))&&Math.abs(u-X)<=fi*Math.max(1,Math.abs(u),Math.abs(X))&&Math.abs(d-te)<=fi*Math.max(1,Math.abs(d),Math.abs(te))&&Math.abs(p-ae)<=fi*Math.max(1,Math.abs(p),Math.abs(ae))&&Math.abs(y-ye)<=fi*Math.max(1,Math.abs(y),Math.abs(ye))&&Math.abs(x-Le)<=fi*Math.max(1,Math.abs(x),Math.abs(Le))&&Math.abs(T-Pe)<=fi*Math.max(1,Math.abs(T),Math.abs(Pe))&&Math.abs(A-je)<=fi*Math.max(1,Math.abs(A),Math.abs(je))&&Math.abs(C-Qe)<=fi*Math.max(1,Math.abs(C),Math.abs(Qe))&&Math.abs(D-Ue)<=fi*Math.max(1,Math.abs(D),Math.abs(Ue))&&Math.abs(P-Re)<=fi*Math.max(1,Math.abs(P),Math.abs(Re))&&Math.abs(B-Ee)<=fi*Math.max(1,Math.abs(B),Math.abs(Ee))&&Math.abs(k-rt)<=fi*Math.max(1,Math.abs(k),Math.abs(rt))&&Math.abs(N-it)<=fi*Math.max(1,Math.abs(N),Math.abs(it))&&Math.abs(G-ot)<=fi*Math.max(1,Math.abs(G),Math.abs(ot))},O.cl=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},O.cm=n=>n.type==="symbol",O.cn=n=>n.type==="circle",O.co=n=>n.type==="heatmap",O.cp=n=>n.type==="line",O.cq=n=>n.type==="fill",O.cr=n=>n.type==="fill-extrusion",O.cs=n=>n.type==="hillshade",O.ct=n=>n.type==="color-relief",O.cu=n=>n.type==="background",O.cv=n=>n.type==="custom",O.cw=ht,O.cx=function(n,e,i){const o=St(e.x-i.x,e.y-i.y),u=St(n.x-i.x,n.y-i.y),d=Math.atan2(o[0]*u[1]-o[1]*u[0],(function(p,y){return p[0]*y[0]+p[1]*y[1]})(o,u));return Ea(d)},O.cy=_t,O.cz=function(n,e){return V[e]&&(n instanceof MouseEvent||n instanceof WheelEvent)},O.d=ke,O.d0=Oc,O.d1=qe,O.d2=class{constructor(n,e){this.layers={[cd]:this},this.name=cd,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=n.length,this.features=n}feature(n){return new Nm(this.features[n],this.extent)}},O.d3=Ll,O.d4=mr,O.e=Mi,O.f=n=>f(void 0,void 0,void 0,(function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(e)}catch(i){throw new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),O.g=ve,O.h=n=>new Promise(((e,i)=>{const o=new Image;o.onload=()=>{e(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame((()=>{o.src=Ts}))},o.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(n)],{type:"image/png"});o.src=n.byteLength?URL.createObjectURL(u):Ts})),O.i=sr,O.j=(n,e)=>Be(Mi(n,{type:"json"}),e),O.k=ui,O.l=Et,O.m=Be,O.n=(n,e)=>Be(Mi(n,{type:"arrayBuffer"}),e),O.o=function(n){return new nf(n).readFields(gm,[])},O.p=rp,O.q=function(n){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))},O.r=Ch,O.s=_l,O.t=mn,O.u=ge,O.v=Ru,O.w=$i,O.x=Ic,O.y=Ir,O.z=Bs})),yt("worker",["./shared"],(function(O){class f{constructor(V,j){this.keyCache={},V&&this.replace(V,j)}replace(V,j){this._layerConfigs={},this._layers={},this.update(V,[],j)}update(V,j,H){for(const oe of V){this._layerConfigs[oe.id]=oe;const ve=this._layers[oe.id]=O.bT(oe,H);ve._featureFilter=O.aj(ve.filter,H),this.keyCache[oe.id]&&delete this.keyCache[oe.id]}for(const oe of j)delete this.keyCache[oe],delete this._layerConfigs[oe],delete this._layers[oe];this.familiesBySource={};const re=O.cL(Object.values(this._layerConfigs),this.keyCache);for(const oe of re){const ve=oe.map((nt=>this._layers[nt.id])),fe=ve[0];if(fe.isHidden())continue;const ue=fe.source||"";let xe=this.familiesBySource[ue];xe||(xe=this.familiesBySource[ue]={});const Be=fe.sourceLayer||O.ai;let ke=xe[Be];ke||(ke=xe[Be]=[]),ke.push(ve)}}}class De{constructor(V){const j={},H=[];for(const fe in V){const ue=V[fe],xe=j[fe]={};for(const Be in ue){const ke=ue[+Be];if(!ke||ke.bitmap.width===0||ke.bitmap.height===0)continue;const nt={x:0,y:0,w:ke.bitmap.width+2,h:ke.bitmap.height+2};H.push(nt),xe[Be]={rect:nt,metrics:ke.metrics}}}const{w:re,h:oe}=O.p(H),ve=new O.r({width:re||1,height:oe||1});for(const fe in V){const ue=V[fe];for(const xe in ue){const Be=ue[+xe];if(!Be||Be.bitmap.width===0||Be.bitmap.height===0)continue;const ke=j[fe][xe].rect;O.r.copy(Be.bitmap,ve,{x:0,y:0},{x:ke.x+1,y:ke.y+1},Be.bitmap)}}this.image=ve,this.positions=j}}O.cM("GlyphAtlas",De);class qe{constructor(V){this.tileID=new O.a2(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId,this.inFlightDependencies=[]}parse(V,j,H,re,oe){return O._(this,void 0,void 0,(function*(){this.status="parsing",this.data=V,this.collisionBoxArray=new O.ag;const ve=new O.cN(Object.keys(V.layers).sort()),fe=new O.cO(this.tileID,this.promoteId);fe.bucketLayerIDs=[];const ue={},xe={featureIndex:fe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:H,subdivisionGranularity:oe},Be=j.familiesBySource[this.source];for(const Ai in Be){const vn=V.layers[Ai];if(!vn)continue;vn.version===1&&O.w(`Vector tile source "${this.source}" layer "${Ai}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const yl=ve.encode(Ai),Ao=[];for(let He=0;He<vn.length;He++){const sa=vn.feature(He),oa=fe.getId(sa,Ai);Ao.push({feature:sa,id:oa,index:He,sourceLayerIndex:yl})}for(const He of Be[Ai]){const sa=He[0];sa.source!==this.source&&O.w(`layer.source = ${sa.source} does not equal this.source = ${this.source}`),sa.isHidden(this.zoom,!0)||(xt(He,this.zoom,H),(ue[sa.id]=sa.createBucket({index:fe.bucketLayerIDs.length,layers:He,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:yl,sourceID:this.source})).populate(Ao,xe,this.tileID.canonical),fe.bucketLayerIDs.push(He.map((oa=>oa.id))))}}const ke=O.bY(xe.glyphDependencies,(Ai=>Object.keys(Ai).map(Number)));this.inFlightDependencies.forEach((Ai=>Ai?.abort())),this.inFlightDependencies=[];let nt=Promise.resolve({});if(Object.keys(ke).length){const Ai=new AbortController;this.inFlightDependencies.push(Ai),nt=re.sendAsync({type:"GG",data:{stacks:ke,source:this.source,tileID:this.tileID,type:"glyphs"}},Ai)}const ct=Object.keys(xe.iconDependencies);let Et=Promise.resolve({});if(ct.length){const Ai=new AbortController;this.inFlightDependencies.push(Ai),Et=re.sendAsync({type:"GI",data:{icons:ct,source:this.source,tileID:this.tileID,type:"icons"}},Ai)}const ui=Object.keys(xe.patternDependencies);let Qt=Promise.resolve({});if(ui.length){const Ai=new AbortController;this.inFlightDependencies.push(Ai),Qt=re.sendAsync({type:"GI",data:{icons:ui,source:this.source,tileID:this.tileID,type:"patterns"}},Ai)}const ge=xe.dashDependencies;let pi=Promise.resolve({});if(Object.keys(ge).length){const Ai=new AbortController;this.inFlightDependencies.push(Ai),pi=re.sendAsync({type:"GDA",data:{dashes:ge}},Ai)}const[yn,Dt,mi,Pn]=yield Promise.all([nt,Et,Qt,pi]),vi=new De(yn),nn=new O.cP(Dt,mi);for(const Ai in ue){const vn=ue[Ai];vn instanceof O.ah?(xt(vn.layers,this.zoom,H),O.cQ({bucket:vn,glyphMap:yn,glyphPositions:vi.positions,imageMap:Dt,imagePositions:nn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:xe.subdivisionGranularity})):vn.hasDependencies&&(vn instanceof O.cR||vn instanceof O.cS||vn instanceof O.cT)&&(xt(vn.layers,this.zoom,H),vn.addFeatures(xe,this.tileID.canonical,nn.patternPositions,Pn))}return this.status="done",{buckets:Object.values(ue).filter((Ai=>!Ai.isEmpty())),featureIndex:fe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:vi.image,imageAtlas:nn,dashPositions:Pn,glyphMap:this.returnDependencies?yn:null,iconMap:this.returnDependencies?Dt:null,glyphPositions:this.returnDependencies?vi.positions:null}}))}}function xt(me,V,j){const H=new O.H(V);for(const re of me)re.recalculate(H,j)}class ut{constructor(V,j,H,re,oe){this.type=V,this.properties=H||{},this.extent=oe,this.pointsArray=j,this.id=re}loadGeometry(){return this.pointsArray.map((V=>V.map((j=>new O.P(j.x,j.y)))))}}class Bt{constructor(V,j,H){this.version=2,this._myFeatures=V,this.name=j,this.length=V.length,this.extent=H}feature(V){return this._myFeatures[V]}}class Xt{constructor(){this.layers={}}addLayer(V){this.layers[V.name]=V}}function di(me){let V=O.cU(me);return V.byteOffset===0&&V.byteLength===V.buffer.byteLength||(V=new Uint8Array(V)),{vectorTile:me,rawData:V.buffer}}function bt(me,V,j){const{extent:H}=me,re=Math.pow(2,j.z-V.z),oe=(j.x-V.x*re)*H,ve=(j.y-V.y*re)*H,fe=[];for(let ue=0;ue<me.length;ue++){const xe=me.feature(ue);let Be=xe.loadGeometry();for(const nt of Be)for(const ct of nt)ct.x=ct.x*re-oe,ct.y=ct.y*re-ve;const ke=128;Be=O.cV(Be,xe.type,-ke,-ke,H+ke,H+ke),Be.length!==0&&fe.push(new ut(xe.type,Be,xe.properties,xe.id,H))}return new Bt(fe,me.name,H)}class Te{constructor(V,j,H){this.actor=V,this.layerIndex=j,this.availableImages=H,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new O.cW(1e3)}loadVectorTile(V,j){return O._(this,void 0,void 0,(function*(){const H=yield O.n(V.request,j);try{return{vectorTile:V.encoding!=="mlt"?new O.cX(new O.cY(H.data)):new O.cZ(H.data),rawData:H.data,cacheControl:H.cacheControl,expires:H.expires}}catch(re){const oe=new Uint8Array(H.data);let ve=`Unable to parse the tile at ${V.request.url}, `;throw ve+=oe[0]===31&&oe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${re.message}`,new Error(ve)}}))}loadTile(V){return O._(this,void 0,void 0,(function*(){const{uid:j,overzoomParameters:H}=V;H&&(V.request=H.overzoomRequest);const re=!!(V&&V.request&&V.request.collectResourceTiming)&&new O.c_(V.request),oe=new qe(V);this.loading[j]=oe;const ve=new AbortController;oe.abort=ve;try{const fe=yield this.loadVectorTile(V,ve);if(delete this.loading[j],!fe)return null;if(H){const nt=this._getOverzoomTile(V,fe.vectorTile);fe.rawData=nt.rawData,fe.vectorTile=nt.vectorTile}const ue=fe.rawData,xe={};fe.expires&&(xe.expires=fe.expires),fe.cacheControl&&(xe.cacheControl=fe.cacheControl);const Be={};if(re){const nt=re.finish();nt&&(Be.resourceTiming=JSON.parse(JSON.stringify(nt)))}oe.vectorTile=fe.vectorTile;const ke=oe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity);this.loaded[j]=oe,this.fetching[j]={rawTileData:ue,cacheControl:xe,resourceTiming:Be};try{const nt=yield ke;return O.e({rawTileData:ue.slice(0),encoding:V.encoding},nt,xe,Be)}finally{delete this.fetching[j]}}catch(fe){throw delete this.loading[j],oe.status="done",this.loaded[j]=oe,fe}}))}_getOverzoomTile(V,j){const{tileID:H,source:re,overzoomParameters:oe}=V,{maxZoomTileID:ve}=oe,fe=`${ve.key}_${H.key}`,ue=this.overzoomedTileResultCache.get(fe);if(ue)return ue;const xe=new Xt,Be=this.layerIndex.familiesBySource[re];for(const nt in Be){const ct=j.layers[nt];if(!ct)continue;const Et=bt(ct,ve,H.canonical);Et.length>0&&xe.addLayer(Et)}const ke=di(xe);return this.overzoomedTileResultCache.set(fe,ke),ke}reloadTile(V){return O._(this,void 0,void 0,(function*(){const j=V.uid;if(!this.loaded||!this.loaded[j])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const H=this.loaded[j];if(H.showCollisionBoxes=V.showCollisionBoxes,H.status==="parsing"){const re=yield H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity);let oe;if(this.fetching[j]){const{rawTileData:ve,cacheControl:fe,resourceTiming:ue}=this.fetching[j];delete this.fetching[j],oe=O.e({rawTileData:ve.slice(0),encoding:V.encoding},re,fe,ue)}else oe=re;return oe}if(H.status==="done"&&H.vectorTile)return H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity)}))}abortTile(V){return O._(this,void 0,void 0,(function*(){const j=this.loading,H=V.uid;j&&j[H]&&j[H].abort&&(j[H].abort.abort(),delete j[H])}))}removeTile(V){return O._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[V.uid]&&delete this.loaded[V.uid]}))}}class Yi{constructor(){this.loaded={}}loadTile(V){return O._(this,void 0,void 0,(function*(){const{uid:j,encoding:H,rawImageData:re,redFactor:oe,greenFactor:ve,blueFactor:fe,baseShift:ue}=V,xe=re.width+2,Be=re.height+2,ke=O.b(re)?new O.R({width:xe,height:Be},yield O.c$(re,-1,-1,xe,Be)):re,nt=new O.d0(j,ke,H,oe,ve,fe,ue);return this.loaded=this.loaded||{},this.loaded[j]=nt,nt}))}removeTile(V){const j=this.loaded,H=V.uid;j&&j[H]&&delete j[H]}}var fi,qt,Qn=(function(){if(qt)return fi;function me(j,H){if(j.length!==0){V(j[0],H);for(var re=1;re<j.length;re++)V(j[re],!H)}}function V(j,H){for(var re=0,oe=0,ve=0,fe=j.length,ue=fe-1;ve<fe;ue=ve++){var xe=(j[ve][0]-j[ue][0])*(j[ue][1]+j[ve][1]),Be=re+xe;oe+=Math.abs(re)>=Math.abs(xe)?re-Be+xe:xe-Be+re,re=Be}re+oe>=0!=!!H&&j.reverse()}return qt=1,fi=function j(H,re){var oe,ve=H&&H.type;if(ve==="FeatureCollection")for(oe=0;oe<H.features.length;oe++)j(H.features[oe],re);else if(ve==="GeometryCollection")for(oe=0;oe<H.geometries.length;oe++)j(H.geometries[oe],re);else if(ve==="Feature")j(H.geometry,re);else if(ve==="Polygon")me(H.coordinates,re);else if(ve==="MultiPolygon")for(oe=0;oe<H.coordinates.length;oe++)me(H.coordinates[oe],re);return H}})(),ma=O.d1(Qn);const On={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:me=>me},It=Math.fround||(Dn=new Float32Array(1),me=>(Dn[0]=+me,Dn[0]));var Dn;class Kn{constructor(V){this.options=Object.assign(Object.create(On),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){const{log:j,minZoom:H,maxZoom:re}=this.options;j&&console.time("total time");const oe=`prepare ${V.length} points`;j&&console.time(oe),this.points=V;const ve=[];for(let ue=0;ue<V.length;ue++){const xe=V[ue];if(!xe.geometry)continue;const[Be,ke]=xe.geometry.coordinates,nt=It(en(Be)),ct=It(ra(ke));ve.push(nt,ct,1/0,ue,-1,1),this.options.reduce&&ve.push(0)}let fe=this.trees[re+1]=this._createTree(ve);j&&console.timeEnd(oe);for(let ue=re;ue>=H;ue--){const xe=+Date.now();fe=this.trees[ue]=this._createTree(this._cluster(fe,ue)),j&&console.log("z%d: %d clusters in %dms",ue,fe.numItems,+Date.now()-xe)}return j&&console.timeEnd("total time"),this}getClusters(V,j){let H=((V[0]+180)%360+360)%360-180;const re=Math.max(-90,Math.min(90,V[1]));let oe=V[2]===180?180:((V[2]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)H=-180,oe=180;else if(H>oe){const ke=this.getClusters([H,re,180,ve],j),nt=this.getClusters([-180,re,oe,ve],j);return ke.concat(nt)}const fe=this.trees[this._limitZoom(j)],ue=fe.range(en(H),ra(ve),en(oe),ra(re)),xe=fe.data,Be=[];for(const ke of ue){const nt=this.stride*ke;Be.push(xe[nt+5]>1?Ma(xe,nt,this.clusterProps):this.points[xe[nt+3]])}return Be}getChildren(V){const j=this._getOriginId(V),H=this._getOriginZoom(V),re="No cluster with the specified id.",oe=this.trees[H];if(!oe)throw new Error(re);const ve=oe.data;if(j*this.stride>=ve.length)throw new Error(re);const fe=this.options.radius/(this.options.extent*Math.pow(2,H-1)),ue=oe.within(ve[j*this.stride],ve[j*this.stride+1],fe),xe=[];for(const Be of ue){const ke=Be*this.stride;ve[ke+4]===V&&xe.push(ve[ke+5]>1?Ma(ve,ke,this.clusterProps):this.points[ve[ke+3]])}if(xe.length===0)throw new Error(re);return xe}getLeaves(V,j,H){const re=[];return this._appendLeaves(re,V,j=j||10,H=H||0,0),re}getTile(V,j,H){const re=this.trees[this._limitZoom(V)],oe=Math.pow(2,V),{extent:ve,radius:fe}=this.options,ue=fe/ve,xe=(H-ue)/oe,Be=(H+1+ue)/oe,ke={features:[]};return this._addTileFeatures(re.range((j-ue)/oe,xe,(j+1+ue)/oe,Be),re.data,j,H,oe,ke),j===0&&this._addTileFeatures(re.range(1-ue/oe,xe,1,Be),re.data,oe,H,oe,ke),j===oe-1&&this._addTileFeatures(re.range(0,xe,ue/oe,Be),re.data,-1,H,oe,ke),ke.features.length?ke:null}getClusterExpansionZoom(V){let j=this._getOriginZoom(V)-1;for(;j<=this.options.maxZoom;){const H=this.getChildren(V);if(j++,H.length!==1)break;V=H[0].properties.cluster_id}return j}_appendLeaves(V,j,H,re,oe){const ve=this.getChildren(j);for(const fe of ve){const ue=fe.properties;if(ue&&ue.cluster?oe+ue.point_count<=re?oe+=ue.point_count:oe=this._appendLeaves(V,ue.cluster_id,H,re,oe):oe<re?oe++:V.push(fe),V.length===H)break}return oe}_createTree(V){const j=new O.aT(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let H=0;H<V.length;H+=this.stride)j.add(V[H],V[H+1]);return j.finish(),j.data=V,j}_addTileFeatures(V,j,H,re,oe,ve){for(const fe of V){const ue=fe*this.stride,xe=j[ue+5]>1;let Be,ke,nt;if(xe)Be=aa(j,ue,this.clusterProps),ke=j[ue],nt=j[ue+1];else{const ui=this.points[j[ue+3]];Be=ui.properties;const[Qt,ge]=ui.geometry.coordinates;ke=en(Qt),nt=ra(ge)}const ct={type:1,geometry:[[Math.round(this.options.extent*(ke*oe-H)),Math.round(this.options.extent*(nt*oe-re))]],tags:Be};let Et;Et=xe||this.options.generateId?j[ue+3]:this.points[j[ue+3]].id,Et!==void 0&&(ct.id=Et),ve.features.push(ct)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,j){const{radius:H,extent:re,reduce:oe,minPoints:ve}=this.options,fe=H/(re*Math.pow(2,j)),ue=V.data,xe=[],Be=this.stride;for(let ke=0;ke<ue.length;ke+=Be){if(ue[ke+2]<=j)continue;ue[ke+2]=j;const nt=ue[ke],ct=ue[ke+1],Et=V.within(ue[ke],ue[ke+1],fe),ui=ue[ke+5];let Qt=ui;for(const ge of Et){const pi=ge*Be;ue[pi+2]>j&&(Qt+=ue[pi+5])}if(Qt>ui&&Qt>=ve){let ge,pi=nt*ui,yn=ct*ui,Dt=-1;const mi=(ke/Be<<5)+(j+1)+this.points.length;for(const Pn of Et){const vi=Pn*Be;if(ue[vi+2]<=j)continue;ue[vi+2]=j;const nn=ue[vi+5];pi+=ue[vi]*nn,yn+=ue[vi+1]*nn,ue[vi+4]=mi,oe&&(ge||(ge=this._map(ue,ke,!0),Dt=this.clusterProps.length,this.clusterProps.push(ge)),oe(ge,this._map(ue,vi)))}ue[ke+4]=mi,xe.push(pi/Qt,yn/Qt,1/0,mi,-1,Qt),oe&&xe.push(Dt)}else{for(let ge=0;ge<Be;ge++)xe.push(ue[ke+ge]);if(Qt>1)for(const ge of Et){const pi=ge*Be;if(!(ue[pi+2]<=j)){ue[pi+2]=j;for(let yn=0;yn<Be;yn++)xe.push(ue[pi+yn])}}}}return xe}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,j,H){if(V[j+5]>1){const ve=this.clusterProps[V[j+6]];return H?Object.assign({},ve):ve}const re=this.points[V[j+3]].properties,oe=this.options.map(re);return H&&oe===re?Object.assign({},oe):oe}}function Ma(me,V,j){return{type:"Feature",id:me[V+3],properties:aa(me,V,j),geometry:{type:"Point",coordinates:[(H=me[V],360*(H-.5)),Va(me[V+1])]}};var H}function aa(me,V,j){const H=me[V+5],re=H>=1e4?`${Math.round(H/1e3)}k`:H>=1e3?Math.round(H/100)/10+"k":H,oe=me[V+6],ve=oe===-1?{}:Object.assign({},j[oe]);return Object.assign(ve,{cluster:!0,cluster_id:me[V+3],point_count:H,point_count_abbreviated:re})}function en(me){return me/360+.5}function ra(me){const V=Math.sin(me*Math.PI/180),j=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return j<0?0:j>1?1:j}function Va(me){const V=(180-360*me)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function Jn(me,V,j,H){let re=H;const oe=V+(j-V>>1);let ve,fe=j-V;const ue=me[V],xe=me[V+1],Be=me[j],ke=me[j+1];for(let nt=V+3;nt<j;nt+=3){const ct=Oe(me[nt],me[nt+1],ue,xe,Be,ke);if(ct>re)ve=nt,re=ct;else if(ct===re){const Et=Math.abs(nt-oe);Et<fe&&(ve=nt,fe=Et)}}re>H&&(ve-V>3&&Jn(me,V,ve,H),me[ve+2]=re,j-ve>3&&Jn(me,ve,j,H))}function Oe(me,V,j,H,re,oe){let ve=re-j,fe=oe-H;if(ve!==0||fe!==0){const ue=((me-j)*ve+(V-H)*fe)/(ve*ve+fe*fe);ue>1?(j=re,H=oe):ue>0&&(j+=ve*ue,H+=fe*ue)}return ve=me-j,fe=V-H,ve*ve+fe*fe}function Ke(me,V,j,H){const re={id:me??null,type:V,geometry:j,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(V==="Point"||V==="MultiPoint"||V==="LineString")St(re,j);else if(V==="Polygon")St(re,j[0]);else if(V==="MultiLineString")for(const oe of j)St(re,oe);else if(V==="MultiPolygon")for(const oe of j)St(re,oe[0]);return re}function St(me,V){for(let j=0;j<V.length;j+=3)me.minX=Math.min(me.minX,V[j]),me.minY=Math.min(me.minY,V[j+1]),me.maxX=Math.max(me.maxX,V[j]),me.maxY=Math.max(me.maxY,V[j+1])}function gt(me,V,j,H){if(!V.geometry)return;const re=V.geometry.coordinates;if(re&&re.length===0)return;const oe=V.geometry.type,ve=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2);let fe=[],ue=V.id;if(j.promoteId?ue=V.properties[j.promoteId]:j.generateId&&(ue=H||0),oe==="Point")li(re,fe);else if(oe==="MultiPoint")for(const xe of re)li(xe,fe);else if(oe==="LineString")de(re,fe,ve,!1);else if(oe==="MultiLineString"){if(j.lineMetrics){for(const xe of re)fe=[],de(xe,fe,ve,!1),me.push(Ke(ue,"LineString",fe,V.properties));return}Ge(re,fe,ve,!1)}else if(oe==="Polygon")Ge(re,fe,ve,!0);else{if(oe!=="MultiPolygon"){if(oe==="GeometryCollection"){for(const xe of V.geometry.geometries)gt(me,{id:ue,geometry:xe,properties:V.properties},j,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const xe of re){const Be=[];Ge(xe,Be,ve,!0),fe.push(Be)}}me.push(Ke(ue,oe,fe,V.properties))}function li(me,V){V.push(st(me[0]),ht(me[1]),0)}function de(me,V,j,H){let re,oe,ve=0;for(let ue=0;ue<me.length;ue++){const xe=st(me[ue][0]),Be=ht(me[ue][1]);V.push(xe,Be,0),ue>0&&(ve+=H?(re*Be-xe*oe)/2:Math.sqrt(Math.pow(xe-re,2)+Math.pow(Be-oe,2))),re=xe,oe=Be}const fe=V.length-3;V[2]=1,Jn(V,0,fe,j),V[fe+2]=1,V.size=Math.abs(ve),V.start=0,V.end=V.size}function Ge(me,V,j,H){for(let re=0;re<me.length;re++){const oe=[];de(me[re],oe,j,H),V.push(oe)}}function st(me){return me/360+.5}function ht(me){const V=Math.sin(me*Math.PI/180),j=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return j<0?0:j>1?1:j}function _t(me,V,j,H,re,oe,ve,fe){if(H/=V,oe>=(j/=V)&&ve<H)return me;if(ve<j||oe>=H)return null;const ue=[];for(const xe of me){const Be=xe.geometry;let ke=xe.type;const nt=re===0?xe.minX:xe.minY,ct=re===0?xe.maxX:xe.maxY;if(nt>=j&&ct<H){ue.push(xe);continue}if(ct<j||nt>=H)continue;let Et=[];if(ke==="Point"||ke==="MultiPoint")kt(Be,Et,j,H,re);else if(ke==="LineString")Yt(Be,Et,j,H,re,!1,fe.lineMetrics);else if(ke==="MultiLineString")Bi(Be,Et,j,H,re,!1);else if(ke==="Polygon")Bi(Be,Et,j,H,re,!0);else if(ke==="MultiPolygon")for(const ui of Be){const Qt=[];Bi(ui,Qt,j,H,re,!0),Qt.length&&Et.push(Qt)}if(Et.length){if(fe.lineMetrics&&ke==="LineString"){for(const ui of Et)ue.push(Ke(xe.id,ke,ui,xe.tags));continue}ke!=="LineString"&&ke!=="MultiLineString"||(Et.length===1?(ke="LineString",Et=Et[0]):ke="MultiLineString"),ke!=="Point"&&ke!=="MultiPoint"||(ke=Et.length===3?"Point":"MultiPoint"),ue.push(Ke(xe.id,ke,Et,xe.tags))}}return ue.length?ue:null}function kt(me,V,j,H,re){for(let oe=0;oe<me.length;oe+=3){const ve=me[oe+re];ve>=j&&ve<=H&&ga(V,me[oe],me[oe+1],me[oe+2])}}function Yt(me,V,j,H,re,oe,ve){let fe=Mi(me);const ue=re===0?Ys:Ua;let xe,Be,ke=me.start;for(let Qt=0;Qt<me.length-3;Qt+=3){const ge=me[Qt],pi=me[Qt+1],yn=me[Qt+2],Dt=me[Qt+3],mi=me[Qt+4],Pn=re===0?ge:pi,vi=re===0?Dt:mi;let nn=!1;ve&&(xe=Math.sqrt(Math.pow(ge-Dt,2)+Math.pow(pi-mi,2))),Pn<j?vi>j&&(Be=ue(fe,ge,pi,Dt,mi,j),ve&&(fe.start=ke+xe*Be)):Pn>H?vi<H&&(Be=ue(fe,ge,pi,Dt,mi,H),ve&&(fe.start=ke+xe*Be)):ga(fe,ge,pi,yn),vi<j&&Pn>=j&&(Be=ue(fe,ge,pi,Dt,mi,j),nn=!0),vi>H&&Pn<=H&&(Be=ue(fe,ge,pi,Dt,mi,H),nn=!0),!oe&&nn&&(ve&&(fe.end=ke+xe*Be),V.push(fe),fe=Mi(me)),ve&&(ke+=xe)}let nt=me.length-3;const ct=me[nt],Et=me[nt+1],ui=re===0?ct:Et;ui>=j&&ui<=H&&ga(fe,ct,Et,me[nt+2]),nt=fe.length-3,oe&&nt>=3&&(fe[nt]!==fe[0]||fe[nt+1]!==fe[1])&&ga(fe,fe[0],fe[1],fe[2]),fe.length&&V.push(fe)}function Mi(me){const V=[];return V.size=me.size,V.start=me.start,V.end=me.end,V}function Bi(me,V,j,H,re,oe){for(const ve of me)Yt(ve,V,j,H,re,oe,!1)}function ga(me,V,j,H){me.push(V,j,H)}function Ys(me,V,j,H,re,oe){const ve=(oe-V)/(H-V);return ga(me,oe,j+(re-j)*ve,1),ve}function Ua(me,V,j,H,re,oe){const ve=(oe-j)/(re-j);return ga(me,V+(H-V)*ve,oe,1),ve}function gl(me,V){const j=[];for(let H=0;H<me.length;H++){const re=me[H],oe=re.type;let ve;if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")ve=$i(re.geometry,V);else if(oe==="MultiLineString"||oe==="Polygon"){ve=[];for(const fe of re.geometry)ve.push($i(fe,V))}else if(oe==="MultiPolygon"){ve=[];for(const fe of re.geometry){const ue=[];for(const xe of fe)ue.push($i(xe,V));ve.push(ue)}}j.push(Ke(re.id,oe,ve,re.tags))}return j}function $i(me,V){const j=[];j.size=me.size,me.start!==void 0&&(j.start=me.start,j.end=me.end);for(let H=0;H<me.length;H+=3)j.push(me[H]+V,me[H+1],me[H+2]);return j}function Aa(me,V){if(me.transformed)return me;const j=1<<me.z,H=me.x,re=me.y;for(const oe of me.features){const ve=oe.geometry,fe=oe.type;if(oe.geometry=[],fe===1)for(let ue=0;ue<ve.length;ue+=2)oe.geometry.push(sr(ve[ue],ve[ue+1],V,j,H,re));else for(let ue=0;ue<ve.length;ue++){const xe=[];for(let Be=0;Be<ve[ue].length;Be+=2)xe.push(sr(ve[ue][Be],ve[ue][Be+1],V,j,H,re));oe.geometry.push(xe)}}return me.transformed=!0,me}function sr(me,V,j,H,re,oe){return[Math.round(j*(me*H-re)),Math.round(j*(V*H-oe))]}function tn(me,V,j,H,re){const oe=V===re.maxZoom?0:re.tolerance/((1<<V)*re.extent),ve={features:[],numPoints:0,numSimplified:0,numFeatures:me.length,source:null,x:j,y:H,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const fe of me)ws(ve,fe,oe,re);return ve}function ws(me,V,j,H){const re=V.geometry,oe=V.type,ve=[];if(me.minX=Math.min(me.minX,V.minX),me.minY=Math.min(me.minY,V.minY),me.maxX=Math.max(me.maxX,V.maxX),me.maxY=Math.max(me.maxY,V.maxY),oe==="Point"||oe==="MultiPoint")for(let fe=0;fe<re.length;fe+=3)ve.push(re[fe],re[fe+1]),me.numPoints++,me.numSimplified++;else if(oe==="LineString")Ts(ve,re,me,j,!1,!1);else if(oe==="MultiLineString"||oe==="Polygon")for(let fe=0;fe<re.length;fe++)Ts(ve,re[fe],me,j,oe==="Polygon",fe===0);else if(oe==="MultiPolygon")for(let fe=0;fe<re.length;fe++){const ue=re[fe];for(let xe=0;xe<ue.length;xe++)Ts(ve,ue[xe],me,j,!0,xe===0)}if(ve.length){let fe=V.tags||null;if(oe==="LineString"&&H.lineMetrics){fe={};for(const xe in V.tags)fe[xe]=V.tags[xe];fe.mapbox_clip_start=re.start/re.size,fe.mapbox_clip_end=re.end/re.size}const ue={geometry:ve,type:oe==="Polygon"||oe==="MultiPolygon"?3:oe==="LineString"||oe==="MultiLineString"?2:1,tags:fe};V.id!==null&&(ue.id=V.id),me.features.push(ue)}}function Ts(me,V,j,H,re,oe){const ve=H*H;if(H>0&&V.size<(re?ve:H))return void(j.numPoints+=V.length/3);const fe=[];for(let ue=0;ue<V.length;ue+=3)(H===0||V[ue+2]>ve)&&(j.numSimplified++,fe.push(V[ue],V[ue+1])),j.numPoints++;re&&(function(ue,xe){let Be=0;for(let ke=0,nt=ue.length,ct=nt-2;ke<nt;ct=ke,ke+=2)Be+=(ue[ke]-ue[ct])*(ue[ke+1]+ue[ct+1]);if(Be>0===xe)for(let ke=0,nt=ue.length;ke<nt/2;ke+=2){const ct=ue[ke],Et=ue[ke+1];ue[ke]=ue[nt-2-ke],ue[ke+1]=ue[nt-1-ke],ue[nt-2-ke]=ct,ue[nt-1-ke]=Et}})(fe,oe),me.push(fe)}const $s={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Hr{constructor(V,j){const H=(j=this.options=(function(oe,ve){for(const fe in ve)oe[fe]=ve[fe];return oe})(Object.create($s),j)).debug;if(H&&console.time("preprocess data"),j.maxZoom<0||j.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(j.promoteId&&j.generateId)throw new Error("promoteId and generateId cannot be used together.");let re=(function(oe,ve){const fe=[];if(oe.type==="FeatureCollection")for(let ue=0;ue<oe.features.length;ue++)gt(fe,oe.features[ue],ve,ue);else gt(fe,oe.type==="Feature"?oe:{geometry:oe},ve);return fe})(V,j);this.tiles={},this.tileCoords=[],H&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",j.indexMaxZoom,j.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),re=(function(oe,ve){const fe=ve.buffer/ve.extent;let ue=oe;const xe=_t(oe,1,-1-fe,fe,0,-1,2,ve),Be=_t(oe,1,1-fe,2+fe,0,-1,2,ve);return(xe||Be)&&(ue=_t(oe,1,-fe,1+fe,0,-1,2,ve)||[],xe&&(ue=gl(xe,1).concat(ue)),Be&&(ue=ue.concat(gl(Be,-1)))),ue})(re,j),re.length&&this.splitTile(re,0,0,0),H&&(re.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(V,j,H,re,oe,ve,fe){const ue=[V,j,H,re],xe=this.options,Be=xe.debug;for(;ue.length;){re=ue.pop(),H=ue.pop(),j=ue.pop(),V=ue.pop();const ke=1<<j,nt=Er(j,H,re);let ct=this.tiles[nt];if(!ct&&(Be>1&&console.time("creation"),ct=this.tiles[nt]=tn(V,j,H,re,xe),this.tileCoords.push({z:j,x:H,y:re}),Be)){Be>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",j,H,re,ct.numFeatures,ct.numPoints,ct.numSimplified),console.timeEnd("creation"));const nn=`z${j}`;this.stats[nn]=(this.stats[nn]||0)+1,this.total++}if(ct.source=V,oe==null){if(j===xe.indexMaxZoom||ct.numPoints<=xe.indexMaxPoints)continue}else{if(j===xe.maxZoom||j===oe)continue;if(oe!=null){const nn=oe-j;if(H!==ve>>nn||re!==fe>>nn)continue}}if(ct.source=null,V.length===0)continue;Be>1&&console.time("clipping");const Et=.5*xe.buffer/xe.extent,ui=.5-Et,Qt=.5+Et,ge=1+Et;let pi=null,yn=null,Dt=null,mi=null,Pn=_t(V,ke,H-Et,H+Qt,0,ct.minX,ct.maxX,xe),vi=_t(V,ke,H+ui,H+ge,0,ct.minX,ct.maxX,xe);V=null,Pn&&(pi=_t(Pn,ke,re-Et,re+Qt,1,ct.minY,ct.maxY,xe),yn=_t(Pn,ke,re+ui,re+ge,1,ct.minY,ct.maxY,xe),Pn=null),vi&&(Dt=_t(vi,ke,re-Et,re+Qt,1,ct.minY,ct.maxY,xe),mi=_t(vi,ke,re+ui,re+ge,1,ct.minY,ct.maxY,xe),vi=null),Be>1&&console.timeEnd("clipping"),ue.push(pi||[],j+1,2*H,2*re),ue.push(yn||[],j+1,2*H,2*re+1),ue.push(Dt||[],j+1,2*H+1,2*re),ue.push(mi||[],j+1,2*H+1,2*re+1)}}getTile(V,j,H){V=+V,j=+j,H=+H;const re=this.options,{extent:oe,debug:ve}=re;if(V<0||V>24)return null;const fe=1<<V,ue=Er(V,j=j+fe&fe-1,H);if(this.tiles[ue])return Aa(this.tiles[ue],oe);ve>1&&console.log("drilling down to z%d-%d-%d",V,j,H);let xe,Be=V,ke=j,nt=H;for(;!xe&&Be>0;)Be--,ke>>=1,nt>>=1,xe=this.tiles[Er(Be,ke,nt)];return xe&&xe.source?(ve>1&&(console.log("found parent tile z%d-%d-%d",Be,ke,nt),console.time("drilling down")),this.splitTile(xe.source,Be,ke,nt,V,j,H),ve>1&&console.timeEnd("drilling down"),this.tiles[ue]?Aa(this.tiles[ue],oe):null):null}}function Er(me,V,j){return 32*((1<<me)*j+V)+me}class _l extends Te{constructor(V,j,H,re=Fn){super(V,j,H),this._dataUpdateable=new Map,this._createGeoJSONIndex=re}loadVectorTile(V,j){return O._(this,void 0,void 0,(function*(){const H=V.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const re=this._geoJSONIndex.getTile(H.z,H.x,H.y);return re?di(new O.d2(re.features,{version:2,extent:O.a5})):null}))}loadData(V){return O._(this,void 0,void 0,(function*(){var j;(j=this._pendingRequest)===null||j===void 0||j.abort();const H=this._startPerformance(V);this._pendingRequest=new AbortController;try{(!this._pendingData||V.request||V.data||V.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(V,this._pendingRequest));const re=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(re,V),this.loaded={};const oe={};return V.request&&(oe.data=re),this._finishPerformance(H,V,oe),oe}catch(re){if(delete this._pendingRequest,O.Z(re))return{abandoned:!0};throw re}}))}_startPerformance(V){var j;if(!((j=V?.request)===null||j===void 0)&&j.collectResourceTiming)return new O.c_(V.request)}_finishPerformance(V,j,H){if(!V)return;const re=V.finish();re&&(H.resourceTiming={},H.resourceTiming[j.source]=JSON.parse(JSON.stringify(re)))}getData(){return O._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(V){const j=this.loaded;return j&&j[V.uid]?super.reloadTile(V):this.loadTile(V)}loadAndProcessGeoJSON(V,j){return O._(this,void 0,void 0,(function*(){let H;if(V.request?H=yield this.loadGeoJSONFromUrl(V.request,V.promoteId,j):V.data?H=this._loadGeoJSONFromObject(V.data,V.promoteId):V.dataDiff&&(H=this._loadGeoJSONFromDiff(V.dataDiff,V.promoteId,V.source)),delete this._pendingRequest,typeof H!="object")throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);return ma(H,!0),V.filter&&(H=this._filterGeoJSON(H,V.filter)),H}))}loadGeoJSONFromUrl(V,j,H){return O._(this,void 0,void 0,(function*(){const re=yield O.j(V,H);return this._dataUpdateable=O.a7(re.data,j),re.data}))}_loadGeoJSONFromObject(V,j){return this._dataUpdateable=O.a7(V,j),V}_loadGeoJSONFromDiff(V,j,H){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${H}`);O.a8(this._dataUpdateable,V,j);const re=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(re)}_filterGeoJSON(V,j){const H=O.d3(j,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(H.result==="error")throw new Error(H.value.map((oe=>`${oe.key}: ${oe.message}`)).join(", "));const re=V.features.filter((oe=>H.value.evaluate({zoom:0},oe)));return this._toFeatureCollection(re)}_toFeatureCollection(V){return{type:"FeatureCollection",features:V}}removeSource(V){return O._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(V){return this._geoJSONIndex.getClusterExpansionZoom(V.clusterId)}getClusterChildren(V){return this._geoJSONIndex.getChildren(V.clusterId)}getClusterLeaves(V){return this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset)}}function Fn(me,V){return V.cluster?new Kn((function({superclusterOptions:j,clusterProperties:H}){if(!H||!j)return j;const re={},oe={},ve={accumulated:null,zoom:0},fe={properties:null},ue=Object.keys(H);for(const xe of ue){const[Be,ke]=H[xe],nt=O.d3(ke),ct=O.d3(typeof Be=="string"?[Be,["accumulated"],["get",xe]]:Be);re[xe]=nt.value,oe[xe]=ct.value}return j.map=xe=>{fe.properties=xe;const Be={};for(const ke of ue)Be[ke]=re[ke].evaluate(ve,fe);return Be},j.reduce=(xe,Be)=>{fe.properties=Be;for(const ke of ue)ve.accumulated=xe[ke],xe[ke]=oe[ke].evaluate(ve,fe)},j})(V)).load(me.features):(function(j,H){return new Hr(j,H)})(me,V.geojsonVtOptions)}class Ea{constructor(V){this.self=V,this.actor=new O.L(V),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(j,H)=>{if(this.externalWorkerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.externalWorkerSourceTypes[j]=H},this.self.addProtocol=O.cJ,this.self.removeProtocol=O.cK,this.self.registerRTLTextPlugin=j=>{O.d4.setMethods(j)},this.actor.registerMessageHandler("LDT",((j,H)=>this._getDEMWorkerSource(j,H.source).loadTile(H))),this.actor.registerMessageHandler("RDT",((j,H)=>O._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(j,H.source).removeTile(H)})))),this.actor.registerMessageHandler("GCEZ",((j,H)=>O._(this,void 0,void 0,(function*(){return this._getWorkerSource(j,H.type,H.source).getClusterExpansionZoom(H)})))),this.actor.registerMessageHandler("GCC",((j,H)=>O._(this,void 0,void 0,(function*(){return this._getWorkerSource(j,H.type,H.source).getClusterChildren(H)})))),this.actor.registerMessageHandler("GCL",((j,H)=>O._(this,void 0,void 0,(function*(){return this._getWorkerSource(j,H.type,H.source).getClusterLeaves(H)})))),this.actor.registerMessageHandler("LD",((j,H)=>this._getWorkerSource(j,H.type,H.source).loadData(H))),this.actor.registerMessageHandler("GD",((j,H)=>this._getWorkerSource(j,H.type,H.source).getData())),this.actor.registerMessageHandler("LT",((j,H)=>this._getWorkerSource(j,H.type,H.source).loadTile(H))),this.actor.registerMessageHandler("RT",((j,H)=>this._getWorkerSource(j,H.type,H.source).reloadTile(H))),this.actor.registerMessageHandler("AT",((j,H)=>this._getWorkerSource(j,H.type,H.source).abortTile(H))),this.actor.registerMessageHandler("RMT",((j,H)=>this._getWorkerSource(j,H.type,H.source).removeTile(H))),this.actor.registerMessageHandler("RS",((j,H)=>O._(this,void 0,void 0,(function*(){if(!this.workerSources[j]||!this.workerSources[j][H.type]||!this.workerSources[j][H.type][H.source])return;const re=this.workerSources[j][H.type][H.source];delete this.workerSources[j][H.type][H.source],re.removeSource!==void 0&&re.removeSource(H)})))),this.actor.registerMessageHandler("RM",(j=>O._(this,void 0,void 0,(function*(){delete this.layerIndexes[j],delete this.availableImages[j],delete this.workerSources[j],delete this.demWorkerSources[j],this.globalStates.delete(j)})))),this.actor.registerMessageHandler("SR",((j,H)=>O._(this,void 0,void 0,(function*(){this.referrer=H})))),this.actor.registerMessageHandler("SRPS",((j,H)=>this._syncRTLPluginState(j,H))),this.actor.registerMessageHandler("IS",((j,H)=>O._(this,void 0,void 0,(function*(){this.self.importScripts(H)})))),this.actor.registerMessageHandler("SI",((j,H)=>this._setImages(j,H))),this.actor.registerMessageHandler("UL",((j,H)=>O._(this,void 0,void 0,(function*(){this._getLayerIndex(j).update(H.layers,H.removedIds,this._getGlobalState(j))})))),this.actor.registerMessageHandler("UGS",((j,H)=>O._(this,void 0,void 0,(function*(){const re=this._getGlobalState(j);for(const oe in H)re[oe]=H[oe]})))),this.actor.registerMessageHandler("SL",((j,H)=>O._(this,void 0,void 0,(function*(){this._getLayerIndex(j).replace(H,this._getGlobalState(j))}))))}_getGlobalState(V){let j=this.globalStates.get(V);return j||(j={},this.globalStates.set(V,j)),j}_setImages(V,j){return O._(this,void 0,void 0,(function*(){this.availableImages[V]=j;for(const H in this.workerSources[V]){const re=this.workerSources[V][H];for(const oe in re)re[oe].availableImages=j}}))}_syncRTLPluginState(V,j){return O._(this,void 0,void 0,(function*(){return yield O.d4.syncState(j,this.self.importScripts)}))}_getAvailableImages(V){let j=this.availableImages[V];return j||(j=[]),j}_getLayerIndex(V){let j=this.layerIndexes[V];return j||(j=this.layerIndexes[V]=new f),j}_getWorkerSource(V,j,H){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][j]||(this.workerSources[V][j]={}),!this.workerSources[V][j][H]){const re={sendAsync:(oe,ve)=>(oe.targetMapId=V,this.actor.sendAsync(oe,ve))};switch(j){case"vector":this.workerSources[V][j][H]=new Te(re,this._getLayerIndex(V),this._getAvailableImages(V));break;case"geojson":this.workerSources[V][j][H]=new _l(re,this._getLayerIndex(V),this._getAvailableImages(V));break;default:this.workerSources[V][j][H]=new this.externalWorkerSourceTypes[j](re,this._getLayerIndex(V),this._getAvailableImages(V))}}return this.workerSources[V][j][H]}_getDEMWorkerSource(V,j){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][j]||(this.demWorkerSources[V][j]=new Yi),this.demWorkerSources[V][j]}}return O.i(self)&&(self.worker=new Ea(self)),Ea})),yt("index",["exports","./shared"],(function(O,f){var De="5.15.0";function qe(){var m=new f.A(4);return f.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}let xt,ut,Bt;const Xt={frame(m,t,r){const l=requestAnimationFrame((_=>{h(),t(_)})),{unsubscribe:h}=f.s(m.signal,"abort",(()=>{h(),cancelAnimationFrame(l),r(new f.a(m.signal.reason))}),!1)},frameAsync(m){return new Promise(((t,r)=>{this.frame(m,t,r)}))},getImageData(m,t=0){return this.getImageCanvasContext(m).getImageData(-t,-t,m.width+2*t,m.height+2*t)},getImageCanvasContext(m){const t=window.document.createElement("canvas"),r=t.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return t.width=m.width,t.height=m.height,r.drawImage(m,0,0,m.width,m.height),r},resolveURL:m=>(xt||(xt=document.createElement("a")),xt.href=m,xt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return Bt!==void 0?Bt:!!matchMedia&&(ut==null&&(ut=matchMedia("(prefers-reduced-motion: reduce)")),ut.matches)},set prefersReducedMotion(m){Bt=m}},di=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(m){this._frozenAt=m}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function bt(){return di.getCurrentTime()}class Te{static testProp(t){if(!Te.docStyle)return t[0];for(let r=0;r<t.length;r++)if(t[r]in Te.docStyle)return t[r];return t[0]}static create(t,r,l){const h=window.document.createElement(t);return r!==void 0&&(h.className=r),l&&l.appendChild(h),h}static createNS(t,r){return window.document.createElementNS(t,r)}static disableDrag(){Te.docStyle&&Te.selectProp&&(Te.userSelect=Te.docStyle[Te.selectProp],Te.docStyle[Te.selectProp]="none")}static enableDrag(){Te.docStyle&&Te.selectProp&&(Te.docStyle[Te.selectProp]=Te.userSelect)}static setTransform(t,r){t.style[Te.transformProp]=r}static addEventListener(t,r,l,h={}){t.addEventListener(r,l,"passive"in h?h:h.capture)}static removeEventListener(t,r,l,h={}){t.removeEventListener(r,l,"passive"in h?h:h.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",Te.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Te.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",Te.suppressClickInternal,!0)}),0)}static getScale(t){const r=t.getBoundingClientRect();return{x:r.width/t.offsetWidth||1,y:r.height/t.offsetHeight||1,boundingClientRect:r}}static getPoint(t,r,l){const h=r.boundingClientRect;return new f.P((l.clientX-h.left)/r.x-t.clientLeft,(l.clientY-h.top)/r.y-t.clientTop)}static mousePos(t,r){const l=Te.getScale(t);return Te.getPoint(t,l,r)}static touchPos(t,r){const l=[],h=Te.getScale(t);for(let _=0;_<r.length;_++)l.push(Te.getPoint(t,h,r[_]));return l}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const r=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),l=r.querySelectorAll("script");for(const h of l)h.remove();return Te.clean(r),r.innerHTML}static isPossiblyDangerous(t,r){const l=r.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!l.includes("javascript:")&&!l.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const r=t.children;for(const l of r)Te.removeAttributes(l),Te.clean(l)}static removeAttributes(t){for(const{name:r,value:l}of t.attributes)Te.isPossiblyDangerous(r,l)&&t.removeAttribute(r)}}Te.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Te.selectProp=Te.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Te.transformProp=Te.testProp(["transform","WebkitTransform"]);const Yi={supported:!1,testSupport:function(m){!Qn&&qt&&(ma?On(m):fi=m)}};let fi,qt,Qn=!1,ma=!1;function On(m){const t=m.createTexture();m.bindTexture(m.TEXTURE_2D,t);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,qt),m.isContextLost())return;Yi.supported=!0}catch{}m.deleteTexture(t),Qn=!0}var It;typeof document<"u"&&(qt=document.createElement("img"),qt.onload=()=>{fi&&On(fi),fi=null,ma=!0},qt.onerror=()=>{Qn=!0,fi=null},qt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(m){let t,r,l,h;m.resetRequestQueue=()=>{t=[],r=0,l=0,h={}},m.addThrottleControl=S=>{const E=l++;return h[E]=S,E},m.removeThrottleControl=S=>{delete h[S],v()},m.getImage=(S,E,z=!0)=>new Promise(((R,I)=>{Yi.supported&&(S.headers||(S.headers={}),S.headers.accept="image/webp,*/*"),f.e(S,{type:"image"}),t.push({abortController:E,requestParameters:S,supportImageRefresh:z,state:"queued",onError:F=>{I(F)},onSuccess:F=>{R(F)}}),v()}));const _=S=>f._(this,void 0,void 0,(function*(){S.state="running";const{requestParameters:E,supportImageRefresh:z,onError:R,onSuccess:I,abortController:F}=S,U=z===!1&&!f.i(self)&&!f.g(E.url)&&(!E.headers||Object.keys(E.headers).reduce((($,K)=>$&&K==="accept"),!0));r++;const Y=U?b(E,F):f.m(E,F);try{const $=yield Y;delete S.abortController,S.state="completed",$.data instanceof HTMLImageElement||f.b($.data)?I($):$.data&&I({data:yield(W=$.data,typeof createImageBitmap=="function"?f.f(W):f.h(W)),cacheControl:$.cacheControl,expires:$.expires})}catch($){delete S.abortController,R($)}finally{r--,v()}var W})),v=()=>{const S=(()=>{for(const E of Object.keys(h))if(h[E]())return!0;return!1})()?f.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:f.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let E=r;E<S&&t.length>0;E++){const z=t.shift();z.abortController.signal.aborted?E--:_(z)}},b=(S,E)=>new Promise(((z,R)=>{const I=new Image,F=S.url,U=S.credentials;U&&U==="include"?I.crossOrigin="use-credentials":(U&&U==="same-origin"||!f.d(F))&&(I.crossOrigin="anonymous"),E.signal.addEventListener("abort",(()=>{I.src="",R(new f.a(E.signal.reason))})),I.fetchPriority="high",I.onload=()=>{I.onerror=I.onload=null,z({data:I})},I.onerror=()=>{I.onerror=I.onload=null,E.signal.aborted||R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},I.src=F}))})(It||(It={})),It.resetRequestQueue();class Dn{constructor(t){this._transformRequestFn=t??null}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function Kn(m){const t=[];if(typeof m=="string")t.push({id:"default",url:m});else if(m&&m.length>0){const r=[];for(const{id:l,url:h}of m){const _=`${l}${h}`;r.indexOf(_)===-1&&(r.push(_),t.push({id:l,url:h}))}}return t}function Ma(m,t,r){try{const l=new URL(m);return l.pathname+=`${t}${r}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${m}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function aa(m){const{userImage:t}=m;return!!(t&&t.render&&t.render())&&(m.data.replace(new Uint8Array(t.data.buffer)),!0)}class en extends f.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new f.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new f.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:r,promiseResolve:l}of this.requestors)l(this._getImagesForIds(r));this.requestors=[]}}getImage(t){const r=this.images[t];if(r&&!r.data&&r.spriteData){const l=r.spriteData;r.data=new f.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),r.spriteData=null}return r}addImage(t,r){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,r)&&(this.images[t]=r)}_validate(t,r){let l=!0;const h=r.data||r.spriteData;return this._validateStretch(r.stretchX,h&&h.width)||(this.fire(new f.k(new Error(`Image "${t}" has invalid "stretchX" value`))),l=!1),this._validateStretch(r.stretchY,h&&h.height)||(this.fire(new f.k(new Error(`Image "${t}" has invalid "stretchY" value`))),l=!1),this._validateContent(r.content,r)||(this.fire(new f.k(new Error(`Image "${t}" has invalid "content" value`))),l=!1),l}_validateStretch(t,r){if(!t)return!0;let l=0;for(const h of t){if(h[0]<l||h[1]<h[0]||r<h[1])return!1;l=h[1]}return!0}_validateContent(t,r){if(!t)return!0;if(t.length!==4)return!1;const l=r.spriteData,h=l&&l.width||r.data.width,_=l&&l.height||r.data.height;return!(t[0]<0||h<t[0]||t[1]<0||_<t[1]||t[2]<0||h<t[2]||t[3]<0||_<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,r,l=!0){const h=this.getImage(t);if(l&&(h.data.width!==r.data.width||h.data.height!==r.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=h.version+1,this.images[t]=r,this.updatedImages[t]=!0}removeImage(t){const r=this.images[t];delete this.images[t],delete this.patterns[t],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((r,l)=>{let h=!0;if(!this.isLoaded())for(const _ of t)this.images[_]||(h=!1);this.isLoaded()||h?r(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:r})}))}_getImagesForIds(t){const r={};for(const l of t){let h=this.getImage(l);h||(this.fire(new f.l("styleimagemissing",{id:l})),h=this.getImage(l)),h?r[l]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,textFitWidth:h.textFitWidth,textFitHeight:h.textFitHeight,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:f.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return r}getPixelSize(){const{width:t,height:r}=this.atlasImage;return{width:t,height:r}}getPattern(t){const r=this.patterns[t],l=this.getImage(t);if(!l)return null;if(r&&r.position.version===l.version)return r.position;if(r)r.position.version=l.version;else{const h={w:l.data.width+2,h:l.data.height+2,x:0,y:0},_=new f.I(h,l);this.patterns[t]={bin:h,position:_}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const r=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new f.T(t,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const _ in this.patterns)t.push(this.patterns[_].bin);const{w:r,h:l}=f.p(t),h=this.atlasImage;h.resize({width:r||1,height:l||1});for(const _ in this.patterns){const{bin:v}=this.patterns[_],b=v.x+1,S=v.y+1,E=this.getImage(_).data,z=E.width,R=E.height;f.R.copy(E,h,{x:0,y:0},{x:b,y:S},{width:z,height:R}),f.R.copy(E,h,{x:0,y:R-1},{x:b,y:S-1},{width:z,height:1}),f.R.copy(E,h,{x:0,y:0},{x:b,y:S+R},{width:z,height:1}),f.R.copy(E,h,{x:z-1,y:0},{x:b-1,y:S},{width:1,height:R}),f.R.copy(E,h,{x:0,y:0},{x:b+z,y:S},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const r of t){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const l=this.getImage(r);l||f.w(`Image with ID: "${r}" was not found`),aa(l)&&this.updateImage(r,l)}}cloneImages(){const t={};for(const r in this.images){const l=this.images[r];t[r]=Object.assign(Object.assign({},l),{data:l.data?l.data.clone():null})}return t}}const ra=1e20;function Va(m,t,r,l,h,_,v,b,S){for(let E=t;E<t+l;E++)Jn(m,r*_+E,_,h,v,b,S);for(let E=r;E<r+h;E++)Jn(m,E*_+t,1,l,v,b,S)}function Jn(m,t,r,l,h,_,v){_[0]=0,v[0]=-ra,v[1]=ra,h[0]=m[t];for(let b=1,S=0,E=0;b<l;b++){h[b]=m[t+b*r];const z=b*b;do{const R=_[S];E=(h[b]-h[R]+z-R*R)/(b-R)/2}while(E<=v[S]&&--S>-1);S++,_[S]=b,v[S]=E,v[S+1]=ra}for(let b=0,S=0;b<l;b++){for(;v[S+1]<b;)S++;const E=_[S],z=b-E;m[t+b*r]=h[E]+z*z}}const Oe=f.v.layout_symbol["text-font"].default.join(",");class Ke{constructor(t,r,l){this.requestManager=t,this.localIdeographFontFamily=r,this.entries={},this.lang=l}setURL(t){this.url=t}getGlyphs(t){return f._(this,void 0,void 0,(function*(){const r=[];for(const _ in t)for(const v of t[_])r.push(this._getAndCacheGlyphsPromise(_,v));const l=yield Promise.all(r),h={};for(const{stack:_,id:v,glyph:b}of l)h[_]||(h[_]={}),h[_][v]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics};return h}))}_getAndCacheGlyphsPromise(t,r){return f._(this,void 0,void 0,(function*(){let l=this.entries[t];l||(l=this.entries[t]={glyphs:{},requests:{},ranges:{}});let h=l.glyphs[r];return h!==void 0?{stack:t,id:r,glyph:h}:!this.url||this._charUsesLocalIdeographFontFamily(r)?(h=l.glyphs[r]=this._drawGlyph(l,t,r),{stack:t,id:r,glyph:h}):yield this._downloadAndCacheRangePromise(t,r)}))}_downloadAndCacheRangePromise(t,r){return f._(this,void 0,void 0,(function*(){const l=this.entries[t],h=Math.floor(r/256);if(l.ranges[h])return{stack:t,id:r,glyph:null};if(!l.requests[h]){const _=Ke.loadGlyphRange(t,h,this.url,this.requestManager);l.requests[h]=_}try{const _=yield l.requests[h];for(const v in _)l.glyphs[+v]=_[+v];return l.ranges[h]=!0,{stack:t,id:r,glyph:_[r]||null}}catch(_){const v=l.glyphs[r]=this._drawGlyph(l,t,r);return this._warnOnMissingGlyphRange(v,h,r,_),{stack:t,id:r,glyph:v}}}))}_warnOnMissingGlyphRange(t,r,l,h){const _=256*r,v=_+255,b=l.toString(16).padStart(4,"0").toUpperCase();f.w(`Unable to load glyph range ${r}, ${_}-${v}. Rendering codepoint U+${b} locally instead. ${h}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&f.q(t)}_drawGlyph(t,r,l){const h=r===Oe&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(l),_=h?"ideographTinySDF":"tinySDF";t[_]||(t[_]=this._createTinySDF(h?this.localIdeographFontFamily:r));const v=t[_].draw(String.fromCodePoint(l));return{id:l,bitmap:new f.r({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const r=t?t.split(","):[];r.push("sans-serif");const l=r.map((h=>/[-\w]+/.test(h)?h:`'${CSS.escape(h)}'`)).join(",");return new Ke.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:l,fontWeight:this._fontWeight(r[0]),fontStyle:this._fontStyle(r[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const r={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let l;for(const[h,_]of Object.entries(r))new RegExp(`\\b${h}\\b`,"i").test(t)&&(l=`${_}`);return l}destroy(){for(const t in this.entries){const r=this.entries[t];r.tinySDF&&(r.tinySDF=null),r.ideographTinySDF&&(r.ideographTinySDF=null),r.glyphs={},r.requests={},r.ranges={}}this.entries={}}}Ke.loadGlyphRange=function(m,t,r,l){return f._(this,void 0,void 0,(function*(){const h=256*t,_=h+255,v=l.transformRequest(r.replace("{fontstack}",m).replace("{range}",`${h}-${_}`),"Glyphs"),b=yield f.n(v,new AbortController);if(!b||!b.data)throw new Error(`Could not load glyph range. range: ${t}, ${h}-${_}`);const S={};for(const E of f.o(b.data))S[E.id]=E;return S}))},Ke.TinySDF=class{constructor({fontSize:m=24,buffer:t=3,radius:r=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:_="normal",fontStyle:v="normal",lang:b=null}={}){this.buffer=t,this.cutoff=l,this.radius=r,this.lang=b;const S=this.size=m+4*t,E=this._createCanvas(S),z=this.ctx=E.getContext("2d",{willReadFrequently:!0});z.font=`${v} ${_} ${m}px ${h}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(m){const t=document.createElement("canvas");return t.width=t.height=m,t}draw(m){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:_}=this.ctx.measureText(m),v=Math.ceil(r),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-h))),S=Math.min(this.size-this.buffer,v+Math.ceil(l)),E=b+2*this.buffer,z=S+2*this.buffer,R=Math.max(E*z,0),I=new Uint8ClampedArray(R),F={data:I,width:E,height:z,glyphWidth:b,glyphHeight:S,glyphTop:v,glyphLeft:0,glyphAdvance:t};if(b===0||S===0)return F;const{ctx:U,buffer:Y,gridInner:W,gridOuter:$}=this;this.lang&&(U.lang=this.lang),U.clearRect(Y,Y,b,S),U.fillText(m,Y,Y+v);const K=U.getImageData(Y,Y,b,S);$.fill(ra,0,R),W.fill(0,0,R);for(let ne=0;ne<S;ne++)for(let Q=0;Q<b;Q++){const ie=K.data[4*(ne*b+Q)+3]/255;if(ie===0)continue;const se=(ne+Y)*E+Q+Y;if(ie===1)$[se]=0,W[se]=ra;else{const ee=.5-ie;$[se]=ee>0?ee*ee:0,W[se]=ee<0?ee*ee:0}}Va($,0,0,E,z,E,this.f,this.v,this.z),Va(W,Y,Y,b,S,E,this.f,this.v,this.z);for(let ne=0;ne<R;ne++){const Q=Math.sqrt($[ne])-Math.sqrt(W[ne]);I[ne]=Math.round(255-255*(Q/this.radius+this.cutoff))}return F}};class St{constructor(){this.specification=f.u.light.position}possiblyEvaluate(t,r){return f.F(t.expression.evaluate(r))}interpolate(t,r,l){return{x:f.G.number(t.x,r.x,l),y:f.G.number(t.y,r.y,l),z:f.G.number(t.z,r.z,l)}}}let gt;class li extends f.E{constructor(t){super(),gt=gt||new f.t({anchor:new f.D(f.u.light.anchor),position:new St,color:new f.D(f.u.light.color),intensity:new f.D(f.u.light.intensity)}),this._transitionable=new f.x(gt,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r={}){if(!this._validate(f.y,t,r))for(const l in t){const h=t[l];l.endsWith(f.z)?this._transitionable.setTransition(l.slice(0,-f.z.length),h):this._transitionable.setValue(l,h)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,l){return(!l||l.validate!==!1)&&f.B(this,t.call(f.C,{value:r,style:{glyphs:!0,sprite:!0},styleSpec:f.u}))}}const de=new f.t({"sky-color":new f.D(f.u.sky["sky-color"]),"horizon-color":new f.D(f.u.sky["horizon-color"]),"fog-color":new f.D(f.u.sky["fog-color"]),"fog-ground-blend":new f.D(f.u.sky["fog-ground-blend"]),"horizon-fog-blend":new f.D(f.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new f.D(f.u.sky["sky-horizon-blend"]),"atmosphere-blend":new f.D(f.u.sky["atmosphere-blend"])});class Ge extends f.E{constructor(t){super(),this._transitionable=new f.x(de,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new f.H(0))}setSky(t,r={}){if(!this._validate(f.J,t,r)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in t){const h=t[l];l.endsWith(f.z)?this._transitionable.setTransition(l.slice(0,-f.z.length),h):this._transitionable.setValue(l,h)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,l={}){return l?.validate!==!1&&f.B(this,t.call(f.C,f.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:f.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class st{constructor(t,r){this.width=t,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,r){const l=t.join(",")+String(r);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(t,r)),this.dashEntry[l]}getDashRanges(t,r,l){const h=[];let _=t.length%2==1?-t[t.length-1]*l:0,v=t[0]*l,b=!0;h.push({left:_,right:v,isDash:b,zeroLength:t[0]===0});let S=t[0];for(let E=1;E<t.length;E++){b=!b;const z=t[E];_=S*l,S+=z,v=S*l,h.push({left:_,right:v,isDash:b,zeroLength:z===0})}return h}addRoundDash(t,r,l){const h=r/2;for(let _=-l;_<=l;_++){const v=this.width*(this.nextRow+l+_);let b=0,S=t[b];for(let E=0;E<this.width;E++){E/S.right>1&&(S=t[++b]);const z=Math.abs(E-S.left),R=Math.abs(E-S.right),I=Math.min(z,R);let F;const U=_/l*(h+1);if(S.isDash){const Y=h-Math.abs(U);F=Math.sqrt(I*I+Y*Y)}else F=h-Math.sqrt(I*I+U*U);this.data[v+E]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(t){for(let b=t.length-1;b>=0;--b){const S=t[b],E=t[b+1];S.zeroLength?t.splice(b,1):E&&E.isDash===S.isDash&&(E.left=S.left,t.splice(b,1))}const r=t[0],l=t[t.length-1];r.isDash===l.isDash&&(r.left=l.left-this.width,l.right=r.right+this.width);const h=this.width*this.nextRow;let _=0,v=t[_];for(let b=0;b<this.width;b++){b/v.right>1&&(v=t[++_]);const S=Math.abs(b-v.left),E=Math.abs(b-v.right),z=Math.min(S,E);this.data[h+b]=Math.max(0,Math.min(255,(v.isDash?z:-z)+128))}}addDash(t,r){const l=r?7:0,h=2*l+1;if(this.nextRow+h>this.height)return f.w("LineAtlas out of space"),null;let _=0;for(let b=0;b<t.length;b++)_+=t[b];if(_!==0){const b=this.width/_,S=this.getDashRanges(t,this.width,b);r?this.addRoundDash(S,b,l):this.addRegularDash(S)}const v={y:this.nextRow+l,height:2*l,width:_};return this.nextRow+=h,this.dirty=!0,v}bind(t){const r=t.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}const ht="maplibre_preloaded_worker_pool";class _t{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<_t.workerCount;)this.workers.push(new Worker(f.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((r=>{r.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[ht]}numActive(){return Object.keys(this.active).length}}const kt=Math.floor(Xt.hardwareConcurrency/2);let Yt,Mi;function Bi(){return Yt||(Yt=new _t),Yt}_t.workerCount=f.K(globalThis)?Math.max(Math.min(kt,3),1):1;class ga{constructor(t,r){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=r;const l=this.workerPool.acquire(r);for(let h=0;h<l.length;h++){const _=new f.L(l[h],r);_.name=`Worker ${h}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,r){const l=[];for(const h of this.actors)l.push(h.sendAsync({type:t,data:r}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((r=>{r.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,r){for(const l of this.actors)l.registerMessageHandler(t,r)}unregisterMessageHandler(t){for(const r of this.actors)r.unregisterMessageHandler(t)}}function Ys(){return Mi||(Mi=new ga(Bi(),f.M),Mi.registerMessageHandler("GR",((m,t,r)=>f.m(t,r)))),Mi}function Ua(m,t){const r=f.N();return f.O(r,r,[1,1,0]),f.Q(r,r,[.5*m.width,.5*m.height,1]),m.calculatePosMatrix?f.S(r,r,m.calculatePosMatrix(t.toUnwrapped())):r}function gl(m,t,r,l,h,_,v){var b;const S=(function(I,F,U){if(I)for(const Y of I){const W=F[Y];if(W&&W.source===U&&W.type==="fill-extrusion")return!0}else for(const Y in F){const W=F[Y];if(W.source===U&&W.type==="fill-extrusion")return!0}return!1})((b=h?.layers)!==null&&b!==void 0?b:null,t,m.id),E=_.maxPitchScaleFactor(),z=m.tilesIn(l,E,S);z.sort($i);const R=[];for(const I of z)R.push({wrappedTileID:I.tileID.wrapped().key,queryResults:I.tile.queryRenderedFeatures(t,r,m.getState(),I.queryGeometry,I.cameraQueryGeometry,I.scale,h,_,E,Ua(_,I.tileID),v?(F,U)=>v(I.tileID,F,U):void 0)});return(function(I,F){for(const U in I)for(const Y of I[U])Aa(Y,F);return I})((function(I){const F={},U={};for(const Y of I){const W=Y.queryResults,$=Y.wrappedTileID,K=U[$]=U[$]||{};for(const ne in W){const Q=W[ne],ie=K[ne]=K[ne]||{},se=F[ne]=F[ne]||[];for(const ee of Q)ie[ee.featureIndex]||(ie[ee.featureIndex]=!0,se.push(ee))}}return F})(R),m)}function $i(m,t){const r=m.tileID,l=t.tileID;return r.overscaledZ-l.overscaledZ||r.canonical.y-l.canonical.y||r.wrap-l.wrap||r.canonical.x-l.canonical.x}function Aa(m,t){const r=m.feature,l=t.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=l}function sr(m,t,r){return f._(this,void 0,void 0,(function*(){let l=m;if(m.url?l=(yield f.j(t.transformRequest(m.url,"Source"),r)).data:yield Xt.frameAsync(r),!l)return null;const h=f.U(f.e(l,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(h.vectorLayerIds=l.vector_layers.map((_=>_.id))),h}))}class tn{constructor(t,r){t&&(r?this.setSouthWest(t).setNorthEast(r):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof f.V?new f.V(t.lng,t.lat):f.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof f.V?new f.V(t.lng,t.lat):f.V.convert(t),this}extend(t){const r=this._sw,l=this._ne;let h,_;if(t instanceof f.V)h=t,_=t;else{if(!(t instanceof tn))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(tn.convert(t)):this.extend(f.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(f.V.convert(t)):this;if(h=t._sw,_=t._ne,!h||!_)return this}return r||l?(r.lng=Math.min(h.lng,r.lng),r.lat=Math.min(h.lat,r.lat),l.lng=Math.max(_.lng,l.lng),l.lat=Math.max(_.lat,l.lat)):(this._sw=new f.V(h.lng,h.lat),this._ne=new f.V(_.lng,_.lat)),this}getCenter(){return new f.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new f.V(this.getWest(),this.getNorth())}getSouthEast(){return new f.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:r,lat:l}=f.V.convert(t);let h=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}intersects(t){if(!((t=tn.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const r=Math.abs(this.getEast()-this.getWest()),l=Math.abs(t.getEast()-t.getWest());if(r>=360||l>=360)return!0;const h=f.W(this.getWest(),-180,180),_=f.W(this.getEast(),-180,180),v=f.W(t.getWest(),-180,180),b=f.W(t.getEast(),-180,180),S=h>=_,E=v>=b;return!(!S||!E)||(S?b>=h||v<=_:E?_>=v||h<=b:v<=_&&b>=h)}static convert(t){return t instanceof tn?t:t&&new tn(t)}static fromLngLat(t,r=0){const l=360*r/40075017,h=l/Math.cos(Math.PI/180*t.lat);return new tn(new f.V(t.lng-h,t.lat-l),new f.V(t.lng+h,t.lat+l))}adjustAntiMeridian(){const t=new f.V(this._sw.lng,this._sw.lat),r=new f.V(this._ne.lng,this._ne.lat);return new tn(t,t.lng>r.lng?new f.V(r.lng+360,r.lat):r)}}class ws{constructor(t,r,l){this.bounds=tn.convert(this.validateBounds(t)),this.minzoom=r||0,this.maxzoom=l||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const r=Math.pow(2,t.z),l=Math.floor(f.Y(this.bounds.getWest())*r),h=Math.floor(f.X(this.bounds.getNorth())*r),_=Math.ceil(f.Y(this.bounds.getEast())*r),v=Math.ceil(f.X(this.bounds.getSouth())*r);return t.x>=l&&t.x<_&&t.y>=h&&t.y<v}}class Ts extends f.E{constructor(t,r,l,h){if(super(),this.id=t,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,f.e(this,f.U(r,["url","scheme","tileSize","promoteId","encoding"])),this._options=f.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}load(){return f._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new f.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield sr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(f.e(this,t),t.bounds&&(this.tileBounds=new ws(t.bounds,this.minzoom,this.maxzoom)),this.fire(new f.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,f.Z(t)||this.fire(new f.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return f.e({},this._options)}loadTile(t){return f._(this,void 0,void 0,(function*(){const r=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(r,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};l.request.collectResourceTiming=this._collectResourceTiming;let h="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((_,v)=>{t.reloadPromise={resolve:_,reject:v}}))}else t.actor=this.dispatcher.getActor(),h="LT";t.abortController=new AbortController;try{const _=yield t.actor.sendAsync({type:h,data:l},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,_)}catch(_){if(delete t.abortController,t.aborted)return;if(_&&_.status!==404)throw _;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const r=t.tileID.scaledTo(this.maxzoom).canonical,l=r.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:r,overzoomRequest:this.map._requestManager.transformRequest(l,"Tile")}}_afterTileLoadWorkerResponse(t,r){if(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),r&&this.map._refreshExpiredTiles&&t.setExpiryData(r),t.loadVectorData(r,this.map.painter),t.reloadPromise){const l=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(l.resolve).catch(l.reject)}}abortTile(t){return f._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return f._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class $s extends f.E{constructor(t,r,l,h){super(),this.id=t,this.dispatcher=l,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=f.e({type:"raster"},r),f.e(this,f.U(r,["url","scheme","tileSize"]))}load(){return f._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new f.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield sr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(f.e(this,r),r.bounds&&(this.tileBounds=new ws(r.bounds,this.minzoom,this.maxzoom)),this.fire(new f.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(r){this._tileJSONRequest=null,this._loaded=!0,f.Z(r)||this.fire(new f.k(r))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return f.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return f._(this,void 0,void 0,(function*(){const r=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const l=yield It.getImage(this.map._requestManager.transformRequest(r,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&(l.cacheControl||l.expires)&&t.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const h=this.map.painter.context,_=h.gl,v=l.data;t.texture=this.map.painter.getTileTexture(v.width),t.texture?t.texture.update(v,{useMipmap:!0}):(t.texture=new f.T(h,v,_.RGBA,{useMipmap:!0}),t.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(l){if(delete t.abortController,t.aborted)t.state="unloaded";else if(l)throw t.state="errored",l}}))}abortTile(t){return f._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return f._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class Hr extends $s{constructor(t,r,l,h){super(t,r,l,h),this.type="raster-dem",this.maxzoom=22,this._options=f.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(t){return f._(this,void 0,void 0,(function*(){const r=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(r,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const h=yield It.getImage(l,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(h&&h.data){const _=h.data;this.map._refreshExpiredTiles&&(h.cacheControl||h.expires)&&t.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const v=f.b(_)&&f.$()?_:yield this.readImageNow(_),b={type:this.type,uid:t.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const S=yield t.actor.sendAsync({type:"LDT",data:b});t.dem=S,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(h){if(delete t.abortController,t.aborted)t.state="unloaded";else if(h)throw t.state="errored",h}}))}readImageNow(t){return f._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&f.a0()){const r=t.width+2,l=t.height+2;try{return new f.R({width:r,height:l},yield f.a1(t,-1,-1,r,l))}catch{}}return Xt.getImageData(t,1)}))}_getNeighboringTiles(t){const r=t.canonical,l=Math.pow(2,r.z),h=(r.x-1+l)%l,_=r.x===0?t.wrap-1:t.wrap,v=(r.x+1+l)%l,b=r.x+1===l?t.wrap+1:t.wrap,S={};return S[new f.a2(t.overscaledZ,_,r.z,h,r.y).key]={backfilled:!1},S[new f.a2(t.overscaledZ,b,r.z,v,r.y).key]={backfilled:!1},r.y>0&&(S[new f.a2(t.overscaledZ,_,r.z,h,r.y-1).key]={backfilled:!1},S[new f.a2(t.overscaledZ,t.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},S[new f.a2(t.overscaledZ,b,r.z,v,r.y-1).key]={backfilled:!1}),r.y+1<l&&(S[new f.a2(t.overscaledZ,_,r.z,h,r.y+1).key]={backfilled:!1},S[new f.a2(t.overscaledZ,t.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},S[new f.a2(t.overscaledZ,b,r.z,v,r.y+1).key]={backfilled:!1}),S}unloadTile(t){return f._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function Er(m){return m.type==="GeometryCollection"?m.geometries.map((t=>t.coordinates)).flat(1/0):m.coordinates.flat(1/0)}function _l(m){const t=new tn;let r;switch(m.type){case"FeatureCollection":r=m.features.map((l=>Er(l.geometry))).flat(1/0);break;case"Feature":r=Er(m.geometry);break;default:r=Er(m)}if(r.length==0)return t;for(let l=0;l<r.length-1;l+=2)t.extend([r[l],r[l+1]]);return t}class Fn extends f.E{constructor(t,r,l,h){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:r.data},this.actor=l.getActor(),this.setEventedParent(h),this._data=typeof r.data=="string"?{url:r.data}:{geojson:r.data},this._options=f.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId,r.clusterMaxZoom!==void 0&&this.maxzoom<=r.clusterMaxZoom&&f.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${r.clusterMaxZoom}".`),this.workerOptions=f.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(r.buffer!==void 0?r.buffer:128),tolerance:this._pixelsToTileUnits(r.tolerance!==void 0?r.tolerance:.375),extent:f.a5,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(r.clusterMaxZoom),minPoints:Math.max(2,r.clusterMinPoints||2),extent:f.a5,radius:this._pixelsToTileUnits(r.clusterRadius||50),log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(f.a5/this.tileSize)}_getClusterMaxZoom(t){const r=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||f.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${r}"`),r}load(){return f._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,r){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const l=this._updateWorkerData();return r?l:this}updateData(t,r){this._pendingWorkerUpdate.diff=f.a6(this._pendingWorkerUpdate.diff,t);const l=this._updateWorkerData();return r?l:this}getData(){return f._(this,void 0,void 0,(function*(){const t=f.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return f._(this,void 0,void 0,(function*(){return _l(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,r,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:r,offset:l}})}_updateWorkerData(){return f._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void f.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:r}=this._pendingWorkerUpdate,l=f.e({type:this.type},this.workerOptions);t!==void 0?(typeof t=="string"?(l.request=this.map._requestManager.transformRequest(Xt.resolveURL(t),"Source"),l.request.collectResourceTiming=this._collectResourceTiming):l.data=t,this._pendingWorkerUpdate.data=void 0):r&&(l.dataDiff=r,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new f.l("dataloading",{dataType:"source"}));try{const h=yield this.actor.sendAsync({type:"LD",data:l});if(this._isUpdatingWorker=!1,this._removed||h.abandoned)return void this.fire(new f.l("dataabort",{dataType:"source"}));h.data&&(this._data={geojson:h.data});const _=this._applyDiffToSource(r),v=this._getShouldReloadTileOptions(_);let b=null;h.resourceTiming&&h.resourceTiming[this.id]&&(b=h.resourceTiming[this.id].slice(0));const S={dataType:"source"};this._collectResourceTiming&&b&&b.length>0&&f.e(S,{resourceTiming:b}),this.fire(new f.l("data",Object.assign(Object.assign({},S),{sourceDataType:"metadata"}))),this.fire(new f.l("data",Object.assign(Object.assign({},S),{sourceDataType:"content",shouldReloadTileOptions:v})))}catch(h){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new f.l("dataabort",{dataType:"source"}));this.fire(new f.k(h))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiffToSource(t){if(!t)return;const r=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const h=f.a7(this._data.geojson,r);if(!h)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:h}}if(!this._data.updateable)return;const l=f.a8(this._data.updateable,t,r);return t.removeAll||this._options.cluster?void 0:l}_getShouldReloadTileOptions(t){if(t)return{affectedBounds:t.filter(Boolean).map((r=>_l(r)))}}shouldReloadTile(t,{affectedBounds:r}){if(t.state==="loading")return!0;if(t.state==="unloaded")return!1;const{buffer:l,extent:h}=this.workerOptions.geojsonVtOptions,_=(function({x:v,y:b,z:S},E=0){const z=f.a3((v-E)/Math.pow(2,S)),R=f.a4((b+1+E)/Math.pow(2,S)),I=f.a3((v+1+E)/Math.pow(2,S)),F=f.a4((b-E)/Math.pow(2,S));return new tn([z,R],[I,F])})(t.tileID.canonical,l/h);for(const v of r)if(_.intersects(v))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return f._(this,void 0,void 0,(function*(){const r=t.actor?"RT":"LT";t.actor=this.actor;const l={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const h=yield this.actor.sendAsync({type:r,data:l},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(h,this.map.painter,r==="RT")}))}abortTile(t){return f._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return f._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return f.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class Ea extends f.E{constructor(t,r,l,h){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=l,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=r}load(t){return f._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new f.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const r=yield It.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,r&&r.data&&(this.image=r.data,t&&(this.coordinates=t),this._finishLoading())}catch(r){this._request=null,this._loaded=!0,f.Z(r)||this.fire(new f.k(r))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new f.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const r=t.map(f.a9.fromLngLat);var l;return this.tileID=(function(h){const _=f.aa.fromPoints(h),v=_.width(),b=_.height(),S=Math.max(v,b),E=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),z=Math.pow(2,E);return new f.ac(E,Math.floor((_.minX+_.maxX)/2*z),Math.floor((_.minY+_.maxY)/2*z))})(r),this.terrainTileRanges=this._getOverlappingTileRanges(r),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=r.map((h=>this.tileID.getTilePoint(h)._round())),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new f.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,r=t.gl;this.texture||(this.texture=new f.T(t,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const _=this.tiles[h];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,l=!0)}l&&this.fire(new f.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return f._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:r,minY:l,maxX:h,maxY:_}=f.aa.fromPoints(t),v={};for(let b=0;b<=f.ab;b++){const S=Math.pow(2,b),E=Math.floor(r*S),z=Math.floor(l*S),R=Math.floor(h*S),I=Math.floor(_*S);v[b]={minTileX:E,minTileY:z,maxTileX:R,maxTileY:I}}return v}}class me extends Ea{constructor(t,r,l,h){super(t,r,l,h),this.roundZoom=!0,this.type="video",this.options=r}load(){return f._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const r of t.urls)this.urls.push(this.map._requestManager.transformRequest(r,"Source").url);try{const r=yield f.ad(this.urls);if(this._loaded=!0,!r)return;this.video=r,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(r){this.fire(new f.k(r))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const r=this.video.seekable;t<r.start(0)||t>r.end(0)?this.fire(new f.k(new f.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,r=t.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new f.T(t,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const _=this.tiles[h];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,l=!0)}l&&this.fire(new f.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class V extends Ea{constructor(t,r,l,h){super(t,r,l,h),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some((_=>!Array.isArray(_)||_.length!==2||_.some((v=>typeof v!="number"))))||this.fire(new f.k(new f.ae(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new f.k(new f.ae(`sources.${t}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new f.k(new f.ae(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new f.k(new f.ae(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new f.k(new f.ae(`sources.${t}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){return f._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new f.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,l=r.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new f.T(r,this.canvas,l.RGBA,{premultiply:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));let h=!1;for(const _ in this.tiles){const v=this.tiles[_];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,h=!0)}h&&this.fire(new f.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const j={},H=m=>{switch(m){case"geojson":return Fn;case"image":return Ea;case"raster":return $s;case"raster-dem":return Hr;case"vector":return Ts;case"video":return me;case"canvas":return V}return j[m]},re="RTLPluginLoaded";class oe extends f.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ys()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((r=>{throw this.status="error",r}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return f._(this,arguments,void 0,(function*(r,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Xt.resolveURL(r),!this.url)throw new Error(`requested url ${r} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return f._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new f.l(re))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ve=null;function fe(){return ve||(ve=new oe),ve}var ue,xe;(function(m){m[m.Base=0]="Base",m[m.Parent=1]="Parent"})(ue||(ue={})),(function(m){m[m.Departing=0]="Departing",m[m.Incoming=1]="Incoming"})(xe||(xe={}));class Be{constructor(t,r){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=f.af(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:r,fadingParentID:l,fadeEndTime:h}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=r,this.fadingParentID=l,this.fadeEndTime=h}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=bt(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,r,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(h,_){const v={};if(!_)return v;for(const b of h){const S=b.layerIds.map((E=>_.getLayer(E))).filter(Boolean);if(S.length!==0){b.layers=S,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map((E=>S.filter((z=>z.id===E))[0])));for(const E of S)v[E.id]=b}}return v})(t.buckets,r?.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const _=this.buckets[h];if(_ instanceof f.ah){if(this.hasSymbolBuckets=!0,!l)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const _=this.buckets[h];if(_ instanceof f.ah&&_.hasRTLText){this.hasRTLText=!0,fe().lazyLoad();break}}this.queryPadding=0;for(const h in this.buckets){const _=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(h).queryRadius(_))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new f.ag}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(t)}const r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new f.T(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new f.T(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,r,l,h,_,v,b,S,E,z,R){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:_,scale:v,tileSize:this.tileSize,pixelPosMatrix:z,transform:S,params:b,queryPadding:this.queryPadding*E,getElevation:R},t,r,l):{}}querySourceFeatures(t,r){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),_=r&&r.sourceLayer?r.sourceLayer:"",v=h[f.ai]||h[_];if(!v)return;const b=f.aj(r?.filter,r?.globalState),{z:S,x:E,y:z}=this.tileID.canonical,R={z:S,x:E,y:z};for(let I=0;I<v.length;I++){const F=v.feature(I);if(b.needGeometry){const W=f.ak(F,!0);if(!b.filter(new f.H(this.tileID.overscaledZ),W,this.tileID.canonical))continue}else if(!b.filter(new f.H(this.tileID.overscaledZ),F))continue;const U=l.getId(F,_),Y=new f.al(F,S,E,z,U);Y.tile=R,t.push(Y)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const l=f.am(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(r)if(this.expirationTime<r)h=!0;else{const _=this.expirationTime-r;_?this.expirationTime=l+Math.max(_,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const h in this.buckets){if(!r.style.hasLayer(h))continue;const _=this.buckets[h],v=_.layers[0].sourceLayer||f.ai,b=l[v],S=t[v];if(!b||!S||Object.keys(S).length===0)continue;_.update(S,b,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const E=r&&r.style&&r.style.getLayer(h);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(_)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<bt()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=bt()+t}setDependencies(t,r){const l={};for(const h of r)l[h]=!0;this.dependencies[t]=l}hasDependency(t,r){for(const l of t){const h=this.dependencies[l];if(h){for(const _ of r)if(h[_])return!0}}return!1}}class ke{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,l){const h=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},f.e(this.stateChanges[t][h],l),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==h&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][h]===null){this.deletedStates[t][h]={};for(const _ in this.state[t][h])l[_]||(this.deletedStates[t][h][_]=null)}else for(const _ in l)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][_]===null&&delete this.deletedStates[t][h][_]}removeFeatureState(t,r,l){if(this.deletedStates[t]===null)return;const h=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&r!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][l]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(l in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][l]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}getState(t,r){const l=String(r),h=f.e({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const _=this.deletedStates[t][r];if(_===null)return{};for(const v in _)delete h[v]}return h}initializeTileState(t,r){t.setFeatureState(this.state,r)}coalesceChanges(t,r){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const _={};for(const v in this.stateChanges[h])this.state[h][v]||(this.state[h][v]={}),f.e(this.state[h][v],this.stateChanges[h][v]),_[v]=this.state[h][v];l[h]=_}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const _={};if(this.deletedStates[h]===null)for(const v in this.state[h])_[v]={},this.state[h][v]={};else for(const v in this.deletedStates[h]){if(this.deletedStates[h][v]===null)this.state[h][v]={};else for(const b of Object.keys(this.deletedStates[h][v]))delete this.state[h][v][b];_[v]=this.state[h][v]}l[h]=l[h]||{},f.e(l[h],_)}this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0&&t.setFeatureState(l,r)}}const nt=89.25;function ct(m,t){const r=f.an(t.lat,-f.ao,f.ao);return new f.P(f.Y(t.lng)*m,f.X(r)*m)}function Et(m,t){return new f.a9(t.x/m,t.y/m).toLngLat()}function ui(m){return m.cameraToCenterDistance*Math.min(.85*Math.tan(f.ap(90-m.pitch)),Math.tan(f.ap(nt-m.pitch)))}function Qt(m,t){const r=m.canonical,l=t/f.aq(r.z),h=r.x+Math.pow(2,r.z)*m.wrap,_=f.ar(new Float64Array(16));return f.O(_,_,[h*l,r.y*l,0]),f.Q(_,_,[l/f.a5,l/f.a5,1]),_}function ge(m,t,r,l,h){const _=f.a9.fromLngLat(m,t),v=h*f.as(1,m.lat),{x:b,y:S,z:E}=pi(r,l);return new f.a9(_.x+v*-b,_.y+v*-S,_.z+v*-E)}function pi(m,t){const r=f.ap(m),l=f.ap(t),h=Math.cos(-r),_=Math.sin(r);return{x:_*Math.sin(l),y:-_*Math.cos(l),z:h}}function yn(m,t,r){const l=t.intersectsFrustum(m);if(!r||l===0)return l;const h=t.intersectsPlane(r);return h===0?0:l===2&&h===2?2:1}function Dt(m,t,r){let l=0;const h=(r-t)/10;for(let _=0;_<10;_++)l+=h*Math.pow(Math.cos(t+(_+.5)/10*(r-t)),m);return l}function mi(m,t){return function(r,l,h,_,v){const b=2*((m-1)/f.at(Math.cos(f.ap(nt-v))/Math.cos(f.ap(nt)))-1),S=Math.acos(h/_),E=2*Dt(b-1,0,f.ap(v/2)),z=Math.min(f.ap(nt),S+f.ap(v/2)),R=Dt(b-1,Math.min(z,S-f.ap(v/2)),z),I=Math.atan(l/h),F=Math.hypot(l,h);let U=r;return U+=f.at(_/F/Math.max(.5,Math.cos(f.ap(v/2)))),U+=b*f.at(Math.cos(I))/2,U-=f.at(Math.max(1,R/E/t))/2,U}}const Pn=mi(9.314,3);function vi(m,t){const r=(t.roundZoom?Math.round:Math.floor)(m.zoom+f.at(m.tileSize/t.tileSize));return Math.max(0,r)}function nn(m,t){const r=m.getCameraFrustum(),l=m.getClippingPlane(),h=m.screenPointToMercatorCoordinate(m.getCameraPoint()),_=f.a9.fromLngLat(m.center,m.elevation);h.z=_.z+Math.cos(m.pitchInRadians)*m.cameraToCenterDistance/m.worldSize;const v=m.getCoveringTilesDetailsProvider(),b=v.allowVariableZoom(m,t),S=vi(m,t),E=t.minzoom||0,z=t.maxzoom!==void 0?t.maxzoom:m.maxZoom,R=Math.min(Math.max(0,S),z),I=Math.pow(2,R),F=[I*h.x,I*h.y,0],U=[I*_.x,I*_.y,0],Y=Math.hypot(_.x-h.x,_.y-h.y),W=Math.abs(_.z-h.z),$=Math.hypot(Y,W),K=ie=>({zoom:0,x:0,y:0,wrap:ie,fullyVisible:!1}),ne=[],Q=[];if(m.renderWorldCopies&&v.allowWorldCopies())for(let ie=1;ie<=3;ie++)ne.push(K(-ie)),ne.push(K(ie));for(ne.push(K(0));ne.length>0;){const ie=ne.pop(),se=ie.x,ee=ie.y;let ce=ie.fullyVisible;const Me={x:se,y:ee,z:ie.zoom},_e=v.getTileBoundingVolume(Me,ie.wrap,m.elevation,t);if(!ce){const Ye=yn(r,_e,l);if(Ye===0)continue;ce=Ye===2}const be=v.distanceToTile2d(h.x,h.y,Me,_e);let we=S;b&&(we=(t.calculateTileZoom||Pn)(m.zoom+f.at(m.tileSize/t.tileSize),be,W,$,m.fov)),we=(t.roundZoom?Math.round:Math.floor)(we),we=Math.max(0,we);const Xe=Math.min(we,z);if(ie.wrap=v.getWrap(_,Me,ie.wrap),ie.zoom>=Xe){if(ie.zoom<E)continue;const Ye=R-ie.zoom,Ne=F[0]-.5-(se<<Ye),We=F[1]-.5-(ee<<Ye),zt=t.reparseOverscaled?Math.max(ie.zoom,we):ie.zoom;Q.push({tileID:new f.a2(ie.zoom===z?zt:ie.zoom,ie.wrap,ie.zoom,se,ee),distanceSq:f.au([U[0]-.5-se,U[1]-.5-ee]),tileDistanceToCamera:Math.sqrt(Ne*Ne+We*We)})}else for(let Ye=0;Ye<4;Ye++)ne.push({zoom:ie.zoom+1,x:(se<<1)+Ye%2,y:(ee<<1)+(Ye>>1),wrap:ie.wrap,fullyVisible:ce})}return Q.sort(((ie,se)=>ie.distanceSq-se.distanceSq)).map((ie=>ie.tileID))}const Ai=f.aa.fromPoints([new f.P(0,0),new f.P(f.a5,f.a5)]);function vn(m){return m==="raster"||m==="image"||m==="video"}function yl(m,t,r,l,h,_,v){if(!t.hasData())return!1;const{tileID:b,fadingRole:S,fadingDirection:E,fadingParentID:z}=t;if(S===ue.Base&&E===xe.Incoming&&z)return r[z.key]=z,!0;const R=Math.max(b.overscaledZ-h,_);for(let I=b.overscaledZ-1;I>=R;I--){const F=b.scaledTo(I),U=m.getLoadedTile(F);if(U)return t.setCrossFadeLogic({fadingRole:ue.Base,fadingDirection:xe.Incoming,fadingParentID:U.tileID,fadeEndTime:l+v}),U.setCrossFadeLogic({fadingRole:ue.Parent,fadingDirection:xe.Departing,fadeEndTime:l+v}),r[F.key]=F,!0}return!1}function Ao(m,t,r,l,h,_){if(!t.hasData())return!1;const v=t.tileID.children(h);let b=He(m,t,v,r,l,h,_);if(b)return!0;for(const S of v)He(m,t,S.children(h),r,l,h,_)&&(b=!0);return b}function He(m,t,r,l,h,_,v){if(r[0].overscaledZ>=_)return!1;let b=!1;for(const S of r){const E=m.getLoadedTile(S);if(!E)continue;const{fadingRole:z,fadingDirection:R,fadingParentID:I}=E;z===ue.Base&&R===xe.Departing&&I||(E.setCrossFadeLogic({fadingRole:ue.Base,fadingDirection:xe.Departing,fadingParentID:t.tileID,fadeEndTime:h+v}),t.setCrossFadeLogic({fadingRole:ue.Parent,fadingDirection:xe.Incoming,fadeEndTime:h+v})),l[S.key]=S,b=!0}return b}function sa(m,t,r,l){const h=m.tileID;return!!m.selfFading||!m.hasData()&&!!t.has(h)&&(m.setSelfFadeLogic(r+l),!0)}function oa(m,t){var r;m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let l=t.tileID.canonical.x-m.tileID.canonical.x;const h=t.tileID.canonical.y-m.tileID.canonical.y,_=Math.pow(2,m.tileID.canonical.z),v=t.tileID.key;l===0&&h===0||Math.abs(h)>1||(Math.abs(l)>1&&(Math.abs(l+_)===1?l+=_:Math.abs(l-_)===1&&(l-=_)),t.dem&&m.dem&&(m.dem.backfillBorder(t.dem,l,h),!((r=m.neighboringTiles)===null||r===void 0)&&r[v]&&(m.neighboringTiles[v].backfilled=!0)))}class Cr{constructor(){this._tiles={}}handleWrapJump(t){const r={};for(const l in this._tiles){const h=this._tiles[l];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+t),r[h.tileID.key]=h}this._tiles=r}setFeatureState(t,r){for(const l in this._tiles)this._tiles[l].setFeatureState(t,r)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((r=>r.tileID)).sort(f.aw).map((r=>r.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,r){this._tiles[t]=r}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const r=this.getTileById(t.key);return r?.hasData()?r:null}isIdRenderable(t,r=!1){var l;return(l=this.getTileById(t))===null||l===void 0?void 0:l.isRenderable(r)}getRenderableIds(t=0,r){const l=[];for(const h of this.getAllIds())this.isIdRenderable(h,r)&&l.push(this.getTileById(h));return r?l.sort(((h,_)=>{const v=h.tileID,b=_.tileID,S=new f.P(v.canonical.x,v.canonical.y)._rotate(-t),E=new f.P(b.canonical.x,b.canonical.y)._rotate(-t);return v.overscaledZ-b.overscaledZ||E.y-S.y||E.x-S.x})).map((h=>h.tileID.key)):l.map((h=>h.tileID)).sort(f.aw).map((h=>h.key))}}class Ri extends f.E{constructor(t,r,l){super(),this.id=t,this.dispatcher=l,this.on("data",(h=>this._dataHandler(h))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((h,_,v,b)=>{const S=new(H(_.type))(h,_,v,b);if(S.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${S.id}`);return S})(t,r,l,this),this._inViewTiles=new Cr,this._outOfViewCache=new f.ax(0,(h=>this._unloadTile(h))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new ke,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const r of this._inViewTiles.getAllTiles())r.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new Cr}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,r,l){return f._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,r,l)}catch(h){t.state="errored",h.status!==404?this._source.fire(new f.k(h,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new f.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const r of this._inViewTiles.getAllTiles())r.upload(t),r.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var r;return this._inViewTiles.getRenderableIds((r=this.transform)===null||r===void 0?void 0:r.bearingInRadians,t)}hasRenderableParent(t){const r=t.overscaledZ-1;if(r>=this._source.minzoom){const l=this.getLoadedTile(t.scaledTo(r));if(l)return this._inViewTiles.isIdRenderable(l.tileID.key)}return!1}reload(t,r=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const l of this._inViewTiles.getAllIds()){const h=this._inViewTiles.getTileById(l);r&&!this._source.shouldReloadTile(h,r)||(t?this._reloadTile(l,"expired"):h.state!=="errored"&&this._reloadTile(l,"reloading"))}}}_reloadTile(t,r){return f._(this,void 0,void 0,(function*(){const l=this._inViewTiles.getTileById(t);l&&(l.state!=="loading"&&(l.state=r),yield this._loadTile(l,t,r))}))}_tileLoaded(t,r,l){t.timeAdded=bt(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),l==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this.getSource().type==="raster-dem"&&t.dem&&(function(h,_){var v,b;const S=_.getRenderableIds();for(const E of S){if(!h.neighboringTiles||!h.neighboringTiles[E])continue;const z=_.getTileById(E);h.neighboringTiles[E].backfilled||oa(h,z),!((b=(v=z.neighboringTiles)===null||v===void 0?void 0:v[h.tileID.key])===null||b===void 0)&&b.backfilled||oa(z,h)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new f.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,r){const l=this._getLoadedDescendents(r),h=new Set;for(const _ of r){const v=l[_.key];if(!v?.length){h.add(_);continue}const b=_.overscaledZ+Ri.maxOverzooming,S=v.filter((R=>R.tileID.overscaledZ<=b));if(!S.length){h.add(_);continue}const E=Math.min(...S.map((R=>R.tileID.overscaledZ))),z=S.filter((R=>R.tileID.overscaledZ===E)).map((R=>R.tileID));for(const R of z)t[R.key]=R;this._areDescendentsComplete(z,E,_.overscaledZ)||h.add(_)}return h}_getLoadedDescendents(t){var r;const l={};for(const h of this._inViewTiles.getAllTiles().filter((_=>_.hasData())))for(const _ of t)h.tileID.isChildOf(_)&&(l[r=_.key]||(l[r]=[])).push(h);return l}_areDescendentsComplete(t,r,l){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===r:Math.pow(4,r-l)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const r=Math.ceil(t.width/this._source.tileSize)+1,l=Math.ceil(t.height/this._source.tileSize)+1,h=Math.floor(r*l*(this._maxTileCacheZoomLevels===null?f.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._outOfViewCache.setMaxSize(_)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,r&&(this._inViewTiles.handleWrapJump(r),this._resetTileReloadTimers())}update(t,r){if(!this._sourceLoaded||this._paused)return;let l;this.transform=t,this.terrain=r,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((S=>new f.a2(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y))):(l=nn(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter((S=>this._source.hasTile(S))))):l=[],this.usedForTerrain&&(l=this._addTerrainIdealTiles(l));const h=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,h&&this.fire(new f.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const _=vi(t,this._source),v=this._updateRetainedTiles(l,_),b=vn(this._source.type);b&&this._rasterFadeDuration>0&&!r&&(function(S,E,z,R,I,F,U){const Y=bt(),W=f.av(E);for(const $ of E){const K=S.getTileById($.key);K.fadingDirection!==xe.Departing&&K.fadeOpacity!==0||K.resetFadeLogic(),yl(S,K,z,Y,R,I,U)||Ao(S,K,z,Y,F,U)||sa(K,W,Y,U)||K.resetFadeLogic()}})(this._inViewTiles,l,v,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),b?this._cleanUpRasterTiles(v):this._cleanUpVectorTiles(v)}_cleanUpRasterTiles(t){for(const r of this._inViewTiles.getAllIds())t[r]||this._removeTile(r)}_cleanUpVectorTiles(t){for(const r of this._inViewTiles.getAllIds()){const l=this._inViewTiles.getTileById(r);t[r]?l.clearSymbolFadeHold():l.hasSymbolBuckets?l.holdingForSymbolFade()?l.symbolFadeFinished()&&this._removeTile(r):l.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(r)}}_addTerrainIdealTiles(t){const r=[];for(const l of t)if(l.canonical.z>this._source.minzoom){const h=l.scaledTo(l.canonical.z-1);r.push(h);const _=l.scaledTo(Math.max(this._source.minzoom,Math.min(l.canonical.z,5)));r.push(_)}return t.concat(r)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,r){var l;const h=new Set;for(const E of t)this._addTile(E).hasData()||h.add(E);const _=t.reduce(((E,z)=>(E[z.key]=z,E)),{}),v=this._retainLoadedChildren(_,h),b={},S=Math.max(r-Ri.maxUnderzooming,this._source.minzoom);for(const E of v){let z=this._inViewTiles.getTileById(E.key),R=z?.wasRequested();for(let I=E.overscaledZ-1;I>=S;--I){const F=E.scaledTo(I);if(b[F.key])break;if(b[F.key]=!0,z=this.getTile(F),!z&&R&&(z=this._addTile(F)),z){const U=z.hasData();if((U||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||R)&&(_[F.key]=F),R=z.wasRequested(),U)break}}}return _}_addTile(t){let r=this._inViewTiles.getTileById(t.key);if(r)return r;r=this._outOfViewCache.getAndRemove(t),r&&(r.resetFadeLogic(),this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null));const l=r;return r||(r=new Be(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(r,t.key,r.state)),r.uses++,this._inViewTiles.setTile(t.key,r),l||this._source.fire(new f.l("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(t,r){this._clearTileReloadTimer(t);const l=r.getExpiryTimeout();l&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),l))}_clearTileReloadTimer(t){const r=this._timers[t];r&&(clearTimeout(r),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const r=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,r)}}refreshTiles(t){for(const r of this._inViewTiles.getAllIds()){const l=this._inViewTiles.getTileById(r);(this._inViewTiles.isIdRenderable(r)||l.state=="errored")&&t.some((h=>h.equals(l.tileID.canonical)))&&this._reloadTile(r,"expired")}}_removeTile(t){const r=this._inViewTiles.getTileById(t);r&&(r.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._outOfViewCache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,r,l){const h=[],_=this.transform;if(!_)return h;const v=_.getCoveringTilesDetailsProvider().allowWorldCopies(),b=l?_.getCameraQueryGeometry(t):t,S=F=>_.screenPointToMercatorCoordinate(F,this.terrain),E=this.transformBbox(t,S,!v),z=this.transformBbox(b,S,!v),R=this.getIds(),I=f.aa.fromPoints(z);for(let F=0;F<R.length;F++){const U=this._inViewTiles.getTileById(R[F]);if(U.holdingForSymbolFade())continue;const Y=v?[U.tileID]:[U.tileID.unwrapTo(-1),U.tileID.unwrapTo(0)],W=Math.pow(2,_.zoom-U.tileID.overscaledZ),$=r*U.queryPadding*f.a5/U.tileSize/W;for(const K of Y){const ne=I.map((Q=>K.getTilePoint(new f.a9(Q.x,Q.y))));if(ne.expandBy($),ne.intersects(Ai)){const Q=E.map((se=>K.getTilePoint(se))),ie=z.map((se=>K.getTilePoint(se)));h.push({tile:U,tileID:v?K:K.unwrapTo(0),queryGeometry:Q,cameraQueryGeometry:ie,scale:W})}}}return h}transformBbox(t,r,l){let h=t.map(r);if(l){const _=f.aa.fromPoints(t);_.shrinkBy(.001*Math.min(_.width(),_.height()));const v=_.map(r);f.aa.fromPoints(h).covers(v)||(h=h.map((b=>b.x>.5?new f.a9(b.x-1,b.y,b.z):b)))}return h}getVisibleCoordinates(t){const r=this.getRenderableIds(t).map((l=>this._inViewTiles.getTileById(l).tileID));return this.transform&&this.transform.populateCache(r),r}hasTransition(){return!!this._source.hasTransition()||!(!vn(this._source.type)||!(function(t,r){if(r<=0)return!1;const l=bt();for(const h of t.getAllTiles())if(h.fadeEndTime>=l)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,r,l){this._state.updateState(t=t||f.ai,r,l)}removeFeatureState(t,r,l){this._state.removeFeatureState(t=t||f.ai,r,l)}getFeatureState(t,r){return this._state.getState(t=t||f.ai,r)}setDependencies(t,r,l){const h=this._inViewTiles.getTileById(t);h&&h.setDependencies(r,l)}reloadTilesForDependencies(t,r){for(const l of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(l).hasDependency(t,r)&&this._reloadTile(l,"reloading");this._outOfViewCache.filter((l=>!l.hasDependency(t,r)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}Ri.maxUnderzooming=10,Ri.maxOverzooming=3;class $e{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=f.an(t,0,1);let r=1,l=this._distances[r];const h=t*this.paddedLength+this.padding;for(;l<h&&r<this._distances.length;)l=this._distances[++r];const _=r-1,v=this._distances[_],b=l-v,S=b>0?(h-v)/b:0;return this.points[_].mult(1-S).add(this.points[r].mult(S))}}function Rt(m,t){let r=!0;return m==="always"||m!=="never"&&t!=="never"||(r=!1),r}class Nt{constructor(t,r,l){const h=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/l),this.yCellCount=Math.ceil(r/l);for(let v=0;v<this.xCellCount*this.yCellCount;v++)h.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,l,h,_){this._forEachCell(r,l,h,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(_)}insertCircle(t,r,l,h){this._forEachCell(r-h,l-h,r+h,l+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(l),this.circles.push(h)}_insertBoxCell(t,r,l,h,_,v){this.boxCells[_].push(v)}_insertCircleCell(t,r,l,h,_,v){this.circleCells[_].push(v)}_query(t,r,l,h,_,v,b){if(l<0||t>this.width||h<0||r>this.height)return[];const S=[];if(t<=0&&r<=0&&this.width<=l&&this.height<=h){if(_)return[{key:null,x1:t,y1:r,x2:l,y2:h}];for(let E=0;E<this.boxKeys.length;E++)S.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const z=this.circles[3*E],R=this.circles[3*E+1],I=this.circles[3*E+2];S.push({key:this.circleKeys[E],x1:z-I,y1:R-I,x2:z+I,y2:R+I})}}else this._forEachCell(t,r,l,h,this._queryCell,S,{hitTest:_,overlapMode:v,seenUids:{box:{},circle:{}}},b);return S}query(t,r,l,h){return this._query(t,r,l,h,!1,null)}hitTest(t,r,l,h,_,v){return this._query(t,r,l,h,!0,_,v).length>0}hitTestCircle(t,r,l,h,_){const v=t-l,b=t+l,S=r-l,E=r+l;if(b<0||v>this.width||E<0||S>this.height)return!1;const z=[];return this._forEachCell(v,S,b,E,this._queryCellCircle,z,{hitTest:!0,overlapMode:h,circle:{x:t,y:r,radius:l},seenUids:{box:{},circle:{}}},_),z.length>0}_queryCell(t,r,l,h,_,v,b,S){const{seenUids:E,hitTest:z,overlapMode:R}=b,I=this.boxCells[_];if(I!==null){const U=this.bboxes;for(const Y of I)if(!E.box[Y]){E.box[Y]=!0;const W=4*Y,$=this.boxKeys[Y];if(t<=U[W+2]&&r<=U[W+3]&&l>=U[W+0]&&h>=U[W+1]&&(!S||S($))&&(!z||!Rt(R,$.overlapMode))&&(v.push({key:$,x1:U[W],y1:U[W+1],x2:U[W+2],y2:U[W+3]}),z))return!0}}const F=this.circleCells[_];if(F!==null){const U=this.circles;for(const Y of F)if(!E.circle[Y]){E.circle[Y]=!0;const W=3*Y,$=this.circleKeys[Y];if(this._circleAndRectCollide(U[W],U[W+1],U[W+2],t,r,l,h)&&(!S||S($))&&(!z||!Rt(R,$.overlapMode))){const K=U[W],ne=U[W+1],Q=U[W+2];if(v.push({key:$,x1:K-Q,y1:ne-Q,x2:K+Q,y2:ne+Q}),z)return!0}}}return!1}_queryCellCircle(t,r,l,h,_,v,b,S){const{circle:E,seenUids:z,overlapMode:R}=b,I=this.boxCells[_];if(I!==null){const U=this.bboxes;for(const Y of I)if(!z.box[Y]){z.box[Y]=!0;const W=4*Y,$=this.boxKeys[Y];if(this._circleAndRectCollide(E.x,E.y,E.radius,U[W+0],U[W+1],U[W+2],U[W+3])&&(!S||S($))&&!Rt(R,$.overlapMode))return v.push(!0),!0}}const F=this.circleCells[_];if(F!==null){const U=this.circles;for(const Y of F)if(!z.circle[Y]){z.circle[Y]=!0;const W=3*Y,$=this.circleKeys[Y];if(this._circlesCollide(U[W],U[W+1],U[W+2],E.x,E.y,E.radius)&&(!S||S($))&&!Rt(R,$.overlapMode))return v.push(!0),!0}}}_forEachCell(t,r,l,h,_,v,b,S){const E=this._convertToXCellCoord(t),z=this._convertToYCellCoord(r),R=this._convertToXCellCoord(l),I=this._convertToYCellCoord(h);for(let F=E;F<=R;F++)for(let U=z;U<=I;U++)if(_.call(this,t,r,l,h,this.xCellCount*U+F,v,b,S))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,l,h,_,v){const b=h-t,S=_-r,E=l+v;return E*E>b*b+S*S}_circleAndRectCollide(t,r,l,h,_,v,b){const S=(v-h)/2,E=Math.abs(t-(h+S));if(E>S+l)return!1;const z=(b-_)/2,R=Math.abs(r-(_+z));if(R>z+l)return!1;if(E<=S||R<=z)return!0;const I=E-S,F=R-z;return I*I+F*F<=l*l}}function Ga(m,t,r){const l=f.N();if(!m){const{vecSouth:R,vecEast:I}=Xr(t),F=qe();F[0]=I[0],F[1]=I[1],F[2]=R[0],F[3]=R[1],h=F,(z=(v=(_=F)[0])*(E=_[3])-(S=_[2])*(b=_[1]))&&(h[0]=E*(z=1/z),h[1]=-b*z,h[2]=-S*z,h[3]=v*z),l[0]=F[0],l[1]=F[1],l[4]=F[2],l[5]=F[3]}var h,_,v,b,S,E,z;return f.Q(l,l,[1/r,1/r,1]),l}function rc(m,t,r,l){if(m){const h=f.N();if(!t){const{vecSouth:_,vecEast:v}=Xr(r);h[0]=v[0],h[1]=v[1],h[4]=_[0],h[5]=_[1]}return f.Q(h,h,[l,l,1]),h}return r.pixelsToClipSpaceMatrix}function Xr(m){const t=Math.cos(m.rollInRadians),r=Math.sin(m.rollInRadians),l=Math.cos(m.pitchInRadians),h=Math.cos(m.bearingInRadians),_=Math.sin(m.bearingInRadians),v=f.aC();v[0]=-h*l*r-_*t,v[1]=-_*l*r+h*t;const b=f.aD(v);b<1e-9?f.aE(v):f.aF(v,v,1/b);const S=f.aC();S[0]=h*l*t-_*r,S[1]=_*l*t+h*r;const E=f.aD(S);return E<1e-9?f.aE(S):f.aF(S,S,1/E),{vecEast:S,vecSouth:v}}function Pt(m,t,r,l){let h;l?(h=[m,t,l(m,t),1],f.aH(h,h,r)):(h=[m,t,0,1],or(h,h,r));const _=h[3];return{point:new f.P(h[0]/_,h[1]/_),signedDistanceFromCamera:_,isOccluded:!1}}function Eo(m,t){return .5+m/t*.5}function Yr(m,t){return m.x>=-t[0]&&m.x<=t[0]&&m.y>=-t[1]&&m.y<=t[1]}function Ss(m,t,r,l,h,_,v,b,S,E,z,R,I){const F=r?m.textSizeData:m.iconSizeData,U=f.ay(F,t.transform.zoom),Y=[256/t.width*2+1,256/t.height*2+1],W=r?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;W.clear();const $=m.lineVertexArray,K=r?m.text.placedSymbolArray:m.icon.placedSymbolArray,ne=t.transform.width/t.transform.height;let Q=!1;for(let ie=0;ie<K.length;ie++){const se=K.get(ie);if(se.hidden||se.writingMode===f.az.vertical&&!Q){Qr(se.numGlyphs,W);continue}Q=!1;const ee=new f.P(se.anchorX,se.anchorY),ce={getElevation:I,pitchedLabelPlaneMatrix:l,lineVertexArray:$,pitchWithMap:_,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:ee,unwrappedTileID:S,width:E,height:z,translation:R},Me=xl(se.anchorX,se.anchorY,ce);if(!Yr(Me.point,Y)){Qr(se.numGlyphs,W);continue}const _e=Eo(t.transform.cameraToCenterDistance,Me.signedDistanceFromCamera),be=f.aA(F,U,se),we=_?be*t.transform.getPitchedTextCorrection(se.anchorX,se.anchorY,S)/_e:be*_e,Xe=an({projectionContext:ce,pitchedLabelPlaneMatrixInverse:h,symbol:se,fontSize:we,flip:!1,keepUpright:v,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:W,aspectRatio:ne,rotateToLine:b});Q=Xe.useVertical,(Xe.notEnoughRoom||Q||Xe.needsFlipping&&an({projectionContext:ce,pitchedLabelPlaneMatrixInverse:h,symbol:se,fontSize:we,flip:!0,keepUpright:v,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:W,aspectRatio:ne,rotateToLine:b}).notEnoughRoom)&&Qr(se.numGlyphs,W)}r?m.text.dynamicLayoutVertexBuffer.updateData(W):m.icon.dynamicLayoutVertexBuffer.updateData(W)}function $r(m,t,r,l,h,_,v,b){const S=_.glyphStartIndex+_.numGlyphs,E=_.lineStartIndex,z=_.lineStartIndex+_.lineLength,R=t.getoffsetX(_.glyphStartIndex),I=t.getoffsetX(S-1),F=zr(m*R,r,l,h,_.segment,E,z,b,v);if(!F)return null;const U=zr(m*I,r,l,h,_.segment,E,z,b,v);return U?b.projectionCache.anyProjectionOccluded?null:{first:F,last:U}:null}function Wr(m,t,r,l){return m===f.az.horizontal&&Math.abs(r.y-t.y)>Math.abs(r.x-t.x)*l?{useVertical:!0}:(m===f.az.vertical?t.y<r.y:t.x>r.x)?{needsFlipping:!0}:null}function an(m){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:r,symbol:l,fontSize:h,flip:_,keepUpright:v,glyphOffsetArray:b,dynamicLayoutVertexArray:S,aspectRatio:E,rotateToLine:z}=m,R=h/24,I=l.lineOffsetX*R,F=l.lineOffsetY*R;let U;if(l.numGlyphs>1){const Y=l.glyphStartIndex+l.numGlyphs,W=l.lineStartIndex,$=l.lineStartIndex+l.lineLength,K=$r(R,b,I,F,_,l,z,t);if(!K)return{notEnoughRoom:!0};const ne=Ms(K.first.point.x,K.first.point.y,t,r),Q=Ms(K.last.point.x,K.last.point.y,t,r);if(v&&!_){const ie=Wr(l.writingMode,ne,Q,E);if(ie)return ie}U=[K.first];for(let ie=l.glyphStartIndex+1;ie<Y-1;ie++){const se=zr(R*b.getoffsetX(ie),I,F,_,l.segment,W,$,t,z);if(!se)return{notEnoughRoom:!0};U.push(se)}U.push(K.last)}else{if(v&&!_){const W=Kt(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,$=l.lineStartIndex+l.segment+1,K=new f.P(t.lineVertexArray.getx($),t.lineVertexArray.gety($)),ne=Kt(K.x,K.y,t),Q=ne.signedDistanceFromCamera>0?ne.point:vl(t.tileAnchorPoint,K,W,1,t),ie=Ms(W.x,W.y,t,r),se=Ms(Q.x,Q.y,t,r),ee=Wr(l.writingMode,ie,se,E);if(ee)return ee}const Y=zr(R*b.getoffsetX(l.glyphStartIndex),I,F,_,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,t,z);if(!Y||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};U=[Y]}for(const Y of U)f.aG(S,Y.point,Y.angle);return{}}function vl(m,t,r,l,h){const _=m.add(m.sub(t)._unit()),v=Kt(_.x,_.y,h).point,b=r.sub(v);return r.add(b._mult(l/b.mag()))}function la(m,t,r){const l=t.projectionCache;if(l.projections[m])return l.projections[m];const h=new f.P(t.lineVertexArray.getx(m),t.lineVertexArray.gety(m)),_=Kt(h.x,h.y,t);if(_.signedDistanceFromCamera>0)return l.projections[m]=_.point,l.anyProjectionOccluded=l.anyProjectionOccluded||_.isOccluded,_.point;const v=m-r.direction;return vl(r.distanceFromAnchor===0?t.tileAnchorPoint:new f.P(t.lineVertexArray.getx(v),t.lineVertexArray.gety(v)),h,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,t)}function Kt(m,t,r){const l=m+r.translation[0],h=t+r.translation[1];let _;return r.pitchWithMap?(_=Pt(l,h,r.pitchedLabelPlaneMatrix,r.getElevation),_.isOccluded=!1):(_=r.transform.projectTileCoordinates(l,h,r.unwrappedTileID,r.getElevation),_.point.x=(.5*_.point.x+.5)*r.width,_.point.y=(.5*-_.point.y+.5)*r.height),_}function Ms(m,t,r,l){if(r.pitchWithMap){const h=[m,t,0,1];return f.aH(h,h,l),r.transform.projectTileCoordinates(h[0]/h[3],h[1]/h[3],r.unwrappedTileID,r.getElevation).point}return{x:m/r.width*2-1,y:1-t/r.height*2}}function xl(m,t,r){return r.transform.projectTileCoordinates(m,t,r.unwrappedTileID,r.getElevation)}function bl(m,t,r){return m._unit()._perp()._mult(t*r)}function Ws(m,t,r,l,h,_,v,b,S){if(b.projectionCache.offsets[m])return b.projectionCache.offsets[m];const E=r.add(t);if(m+S.direction<l||m+S.direction>=h)return b.projectionCache.offsets[m]=E,E;const z=la(m+S.direction,b,S),R=bl(z.sub(r),v,S.direction),I=r.add(R),F=z.add(R);return b.projectionCache.offsets[m]=f.aI(_,E,I,F)||E,b.projectionCache.offsets[m]}function zr(m,t,r,l,h,_,v,b,S){const E=l?m-t:m+t;let z=E>0?1:-1,R=0;l&&(z*=-1,R=Math.PI),z<0&&(R+=Math.PI);let I,F=z>0?_+h:_+h+1;b.projectionCache.cachedAnchorPoint?I=b.projectionCache.cachedAnchorPoint:(I=Kt(b.tileAnchorPoint.x,b.tileAnchorPoint.y,b).point,b.projectionCache.cachedAnchorPoint=I);let U,Y,W=I,$=I,K=0,ne=0;const Q=Math.abs(E),ie=[];let se;for(;K+ne<=Q;){if(F+=z,F<_||F>=v)return null;K+=ne,$=W,Y=U;const Me={absOffsetX:Q,direction:z,distanceFromAnchor:K,previousVertex:$};if(W=la(F,b,Me),r===0)ie.push($),se=W.sub($);else{let _e;const be=W.sub($);_e=be.mag()===0?bl(la(F+z,b,Me).sub(W),r,z):bl(be,r,z),Y||(Y=$.add(_e)),U=Ws(F,_e,W,_,v,Y,r,b,Me),ie.push(Y),se=U.sub(Y)}ne=se.mag()}const ee=se._mult((Q-K)/ne)._add(Y||$),ce=R+Math.atan2(W.y-$.y,W.x-$.x);return ie.push(ee),{point:ee,angle:S?ce:0,path:ie}}const ou=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Qr(m,t){for(let r=0;r<m;r++){const l=t.length;t.resize(l+4),t.float32.set(ou,3*l)}}function or(m,t,r){const l=t[0],h=t[1];return m[0]=r[0]*l+r[4]*h+r[12],m[1]=r[1]*l+r[5]*h+r[13],m[3]=r[3]*l+r[7]*h+r[15],m}const ai=100;class ah{constructor(t,r=new Nt(t.width+200,t.height+200,25),l=new Nt(t.width+200,t.height+200,25)){this.transform=t,this.grid=r,this.ignoredGrid=l,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ai,this.screenBottomBoundary=t.height+ai,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,r,l,h,_,v,b,S,E,z,R,I){const F=this.projectAndGetPerspectiveRatio(t.anchorPointX+S[0],t.anchorPointY+S[1],_,z,I),U=l*F.perspectiveRatio;let Y;if(v||b)Y=this._projectCollisionBox(t,U,h,_,v,b,S,F,z,R,I);else{const se=F.x+(R?R.x*U:0),ee=F.y+(R?R.y*U:0);Y={allPointsOccluded:!1,box:[se+t.x1*U,ee+t.y1*U,se+t.x2*U,ee+t.y2*U]}}const[W,$,K,ne]=Y.box,Q=v?Y.allPointsOccluded:F.isOccluded;let ie=Q;return ie||(ie=F.perspectiveRatio<this.perspectiveRatioCutoff),ie||(ie=!this.isInsideGrid(W,$,K,ne)),ie||r!=="always"&&this.grid.hitTest(W,$,K,ne,r,E)?{box:[W,$,K,ne],placeable:!1,offscreen:!1,occluded:Q}:{box:[W,$,K,ne],placeable:!0,offscreen:this.isOffscreen(W,$,K,ne),occluded:Q}}placeCollisionCircles(t,r,l,h,_,v,b,S,E,z,R,I,F,U){const Y=[],W=new f.P(r.anchorX,r.anchorY),$=this.getPerspectiveRatio(W.x,W.y,v,U),K=(E?_*this.transform.getPitchedTextCorrection(r.anchorX,r.anchorY,v)/$:_*$)/f.aM,ne={getElevation:U,pitchedLabelPlaneMatrix:b,lineVertexArray:l,pitchWithMap:E,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:W,unwrappedTileID:v,width:this.transform.width,height:this.transform.height,translation:F},Q=$r(K,h,r.lineOffsetX*K,r.lineOffsetY*K,!1,r,!1,ne);let ie=!1,se=!1,ee=!0;if(Q){const ce=.5*R*$+I,Me=new f.P(-100,-100),_e=new f.P(this.screenRightBoundary,this.screenBottomBoundary),be=new $e,we=Q.first,Xe=Q.last;let Ye=[];for(let zt=we.path.length-1;zt>=1;zt--)Ye.push(we.path[zt]);for(let zt=1;zt<Xe.path.length;zt++)Ye.push(Xe.path[zt]);const Ne=2.5*ce;if(E){const zt=this.projectPathToScreenSpace(Ye,ne);Ye=zt.some((hi=>hi.signedDistanceFromCamera<=0))?[]:zt.map((hi=>hi.point))}let We=[];if(Ye.length>0){const zt=Ye[0].clone(),hi=Ye[0].clone();for(let Li=1;Li<Ye.length;Li++)zt.x=Math.min(zt.x,Ye[Li].x),zt.y=Math.min(zt.y,Ye[Li].y),hi.x=Math.max(hi.x,Ye[Li].x),hi.y=Math.max(hi.y,Ye[Li].y);We=zt.x>=Me.x&&hi.x<=_e.x&&zt.y>=Me.y&&hi.y<=_e.y?[Ye]:hi.x<Me.x||zt.x>_e.x||hi.y<Me.y||zt.y>_e.y?[]:f.aJ([Ye],Me.x,Me.y,_e.x,_e.y)}for(const zt of We){be.reset(zt,.25*ce);let hi=0;hi=be.length<=.5*ce?1:Math.ceil(be.paddedLength/Ne)+1;for(let Li=0;Li<hi;Li++){const zi=Li/Math.max(hi-1,1),Ni=be.lerp(zi),bi=Ni.x+ai,Ki=Ni.y+ai;Y.push(bi,Ki,ce,0);const ji=bi-ce,Vn=Ki-ce,ln=bi+ce,un=Ki+ce;if(ee=ee&&this.isOffscreen(ji,Vn,ln,un),se=se||this.isInsideGrid(ji,Vn,ln,un),t!=="always"&&this.grid.hitTestCircle(bi,Ki,ce,t,z)&&(ie=!0,!S))return{circles:[],offscreen:!1,collisionDetected:ie}}}}return{circles:!S&&ie||!se||$<this.perspectiveRatioCutoff?[]:Y,offscreen:ee,collisionDetected:ie}}projectPathToScreenSpace(t,r){const l=(function(h,_){const v=f.N();return f.aB(v,_.pitchedLabelPlaneMatrix),h.map((b=>{const S=Pt(b.x,b.y,v,_.getElevation),E=_.transform.projectTileCoordinates(S.point.x,S.point.y,_.unwrappedTileID,_.getElevation);return E.point.x=(.5*E.point.x+.5)*_.width,E.point.y=(.5*-E.point.y+.5)*_.height,E}))})(t,r);return(function(h){let _=0,v=0,b=0,S=0;for(let E=0;E<h.length;E++)h[E].isOccluded?(b=E+1,S=0):(S++,S>v&&(v=S,_=b));return h.slice(_,_+v)})(l)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[],l=new f.aa;for(const R of t){const I=new f.P(R.x+ai,R.y+ai);l.extend(I),r.push(I)}const{minX:h,minY:_,maxX:v,maxY:b}=l,S=this.grid.query(h,_,v,b).concat(this.ignoredGrid.query(h,_,v,b)),E={},z={};for(const R of S){const I=R.key;if(E[I.bucketInstanceId]===void 0&&(E[I.bucketInstanceId]={}),E[I.bucketInstanceId][I.featureIndex])continue;const F=[new f.P(R.x1,R.y1),new f.P(R.x2,R.y1),new f.P(R.x2,R.y2),new f.P(R.x1,R.y2)];f.aK(r,F)&&(E[I.bucketInstanceId][I.featureIndex]=!0,z[I.bucketInstanceId]===void 0&&(z[I.bucketInstanceId]=[]),z[I.bucketInstanceId].push(I.featureIndex))}return z}insertCollisionBox(t,r,l,h,_,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:_,collisionGroupID:v,overlapMode:r},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,l,h,_,v){const b=l?this.ignoredGrid:this.grid,S={bucketInstanceId:h,featureIndex:_,collisionGroupID:v,overlapMode:r};for(let E=0;E<t.length;E+=4)b.insertCircle(S,t[E],t[E+1],t[E+2])}projectAndGetPerspectiveRatio(t,r,l,h,_){if(_){let v;h?(v=[t,r,h(t,r),1],f.aH(v,v,_)):(v=[t,r,0,1],or(v,v,_));const b=v[3];return{x:(v[0]/b+1)/2*this.transform.width+ai,y:(-v[1]/b+1)/2*this.transform.height+ai,perspectiveRatio:.5+this.transform.cameraToCenterDistance/b*.5,isOccluded:!1,signedDistanceFromCamera:b}}{const v=this.transform.projectTileCoordinates(t,r,l,h);return{x:(v.point.x+1)/2*this.transform.width+ai,y:(1-v.point.y)/2*this.transform.height+ai,perspectiveRatio:.5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5,isOccluded:v.isOccluded,signedDistanceFromCamera:v.signedDistanceFromCamera}}}getPerspectiveRatio(t,r,l,h){const _=this.transform.projectTileCoordinates(t,r,l,h);return .5+this.transform.cameraToCenterDistance/_.signedDistanceFromCamera*.5}isOffscreen(t,r,l,h){return l<ai||t>=this.screenRightBoundary||h<ai||r>this.screenBottomBoundary}isInsideGrid(t,r,l,h){return l>=0&&t<this.gridRightBoundary&&h>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=f.ar([]);return f.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,r,l,h,_,v,b,S,E,z,R){let I=1,F=0,U=0,Y=1;const W=t.anchorPointX+b[0],$=t.anchorPointY+b[1];if(v&&!_){const Ye=this.projectAndGetPerspectiveRatio(W+1,$,h,E,R),Ne=Ye.x-S.x,We=Math.atan((Ye.y-S.y)/Ne)+(Ne<0?Math.PI:0),zt=Math.sin(We),hi=Math.cos(We);I=hi,F=zt,U=-zt,Y=hi}else if(!v&&_){const Ye=Xr(this.transform);I=Ye.vecEast[0],F=Ye.vecEast[1],U=Ye.vecSouth[0],Y=Ye.vecSouth[1]}let K=S.x,ne=S.y,Q=r;_&&(K=W,ne=$,Q=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),Q*=this.transform.getPitchedTextCorrection(W,$,h),z||(Q*=f.an(.5+S.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),z&&(K+=I*z.x*Q+U*z.y*Q,ne+=F*z.x*Q+Y*z.y*Q);const ie=t.x1*Q,se=t.x2*Q,ee=(ie+se)/2,ce=t.y1*Q,Me=t.y2*Q,_e=(ce+Me)/2,be=[{offsetX:ie,offsetY:ce},{offsetX:ee,offsetY:ce},{offsetX:se,offsetY:ce},{offsetX:se,offsetY:_e},{offsetX:se,offsetY:Me},{offsetX:ee,offsetY:Me},{offsetX:ie,offsetY:Me},{offsetX:ie,offsetY:_e}];let we=[];for(const{offsetX:Ye,offsetY:Ne}of be)we.push(new f.P(K+I*Ye+U*Ne,ne+F*Ye+Y*Ne));let Xe=!1;if(_){const Ye=we.map((Ne=>this.projectAndGetPerspectiveRatio(Ne.x,Ne.y,h,E,R)));Xe=Ye.some((Ne=>!Ne.isOccluded)),we=Ye.map((Ne=>new f.P(Ne.x,Ne.y)))}else Xe=!0;return{box:f.aL(we),allPointsOccluded:!Xe}}}class pd{constructor(t,r,l,h){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):h&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class Co{constructor(t,r,l,h,_){this.text=new pd(t?t.text:null,r,l,_),this.icon=new pd(t?t.icon:null,r,h,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class rh{constructor(t,r,l){this.text=t,this.icon=r,this.skipFade=l}}class lu{constructor(t,r,l,h,_){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=l,this.bucketIndex=h,this.tileID=_}}class md{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:l=>l.collisionGroupID===r}}return this.collisionGroups[t]}}function _a(m,t,r,l,h){const{horizontalAlign:_,verticalAlign:v}=f.aS(m);return new f.P(-(_-.5)*t+l[0]*h,-(v-.5)*r+l[1]*h)}class uu{constructor(t,r,l,h,_){this.transform=t.clone(),this.terrain=r,this.collisionIndex=new ah(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new md(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const r=this.terrain;return r?(l,h)=>r.getElevation(t,l,h):null}getBucketParts(t,r,l,h){const _=l.getBucket(r),v=l.latestFeatureIndex;if(!_||!v||r.id!==_.layerIds[0])return;const b=l.collisionBoxArray,S=_.layers[0].layout,E=_.layers[0].paint,z=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),R=l.tileSize/f.a5,I=l.tileID.toUnwrapped(),F=S.get("text-rotation-alignment")==="map",U=f.aN(l,1,this.transform.zoom),Y=f.aO(this.collisionIndex.transform,l,E.get("text-translate"),E.get("text-translate-anchor")),W=f.aO(this.collisionIndex.transform,l,E.get("icon-translate"),E.get("icon-translate-anchor")),$=Ga(F,this.transform,U);this.retainedQueryData[_.bucketInstanceId]=new lu(_.bucketInstanceId,v,_.sourceLayerIndex,_.index,l.tileID);const K={bucket:_,layout:S,translationText:Y,translationIcon:W,unwrappedTileID:I,pitchedLabelPlaneMatrix:$,scale:z,textPixelRatio:R,holdingForFade:l.holdingForSymbolFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:f.ay(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(h)for(const ne of _.sortKeyRanges){const{sortKey:Q,symbolInstanceStart:ie,symbolInstanceEnd:se}=ne;t.push({sortKey:Q,symbolInstanceStart:ie,symbolInstanceEnd:se,parameters:K})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:K})}attemptAnchorPlacement(t,r,l,h,_,v,b,S,E,z,R,I,F,U,Y,W,$,K,ne,Q){const ie=f.aP[t.textAnchor],se=[t.textOffset0,t.textOffset1],ee=_a(ie,l,h,se,_),ce=this.collisionIndex.placeCollisionBox(r,I,S,E,z,b,v,W,R.predicate,ne,ee,Q);if((!K||this.collisionIndex.placeCollisionBox(K,I,S,E,z,b,v,$,R.predicate,ne,ee,Q).placeable)&&ce.placeable){let Me;if(this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(Me=this.prevPlacement.variableOffsets[F.crossTileID].anchor),F.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[F.crossTileID]={textOffset:se,width:l,height:h,anchor:ie,textBoxScale:_,prevAnchor:Me},this.markUsedJustification(U,ie,F,Y),U.allowVerticalPlacement&&(this.markUsedOrientation(U,Y,F),this.placedOrientations[F.crossTileID]=Y),{shift:ee,placedGlyphBoxes:ce}}}placeLayerBucketPart(t,r,l){const{bucket:h,layout:_,translationText:v,translationIcon:b,unwrappedTileID:S,pitchedLabelPlaneMatrix:E,textPixelRatio:z,holdingForFade:R,collisionBoxArray:I,partiallyEvaluatedTextSize:F,collisionGroup:U}=t.parameters,Y=_.get("text-optional"),W=_.get("icon-optional"),$=f.aQ(_,"text-overlap","text-allow-overlap"),K=$==="always",ne=f.aQ(_,"icon-overlap","icon-allow-overlap"),Q=ne==="always",ie=_.get("text-rotation-alignment")==="map",se=_.get("text-pitch-alignment")==="map",ee=_.get("icon-text-fit")!=="none",ce=_.get("symbol-z-order")==="viewport-y",Me=K&&(Q||!h.hasIconData()||W),_e=Q&&(K||!h.hasTextData()||Y);!h.collisionArrays&&I&&h.deserializeCollisionBoxes(I);const be=this.retainedQueryData[h.bucketInstanceId].tileID,we=this._getTerrainElevationFunc(be),Xe=this.transform.getFastPathSimpleProjectionMatrix(be),Ye=(Ne,We,zt)=>{var hi,Li;if(r[Ne.crossTileID])return;if(R)return void(this.placements[Ne.crossTileID]=new rh(!1,!1,!1));let zi=!1,Ni=!1,bi=!0,Ki=null,ji={box:null,placeable:!1,offscreen:null,occluded:!1},Vn={placeable:!1},ln=null,un=null,Un=null,gs=0,_s=0,Fr=0;We.textFeatureIndex?gs=We.textFeatureIndex:Ne.useRuntimeCollisionCircles&&(gs=Ne.featureIndex),We.verticalTextFeatureIndex&&(_s=We.verticalTextFeatureIndex);const Ra=We.textBox;if(Ra){const La=_i=>{let Di=f.az.horizontal;if(h.allowVerticalPlacement&&!_i&&this.prevPlacement){const wn=this.prevPlacement.placedOrientations[Ne.crossTileID];wn&&(this.placedOrientations[Ne.crossTileID]=wn,Di=wn,this.markUsedOrientation(h,Di,Ne))}return Di},er=(_i,Di)=>{if(h.allowVerticalPlacement&&Ne.numVerticalGlyphVertices>0&&We.verticalTextBox){for(const wn of h.writingModes)if(wn===f.az.vertical?(ji=Di(),Vn=ji):ji=_i(),ji&&ji.placeable)break}else ji=_i()},yr=Ne.textAnchorOffsetStartIndex,vr=Ne.textAnchorOffsetEndIndex;if(vr===yr){const _i=(Di,wn)=>{const En=this.collisionIndex.placeCollisionBox(Di,$,z,be,S,se,ie,v,U.predicate,we,void 0,Xe);return En&&En.placeable&&(this.markUsedOrientation(h,wn,Ne),this.placedOrientations[Ne.crossTileID]=wn),En};er((()=>_i(Ra,f.az.horizontal)),(()=>{const Di=We.verticalTextBox;return h.allowVerticalPlacement&&Ne.numVerticalGlyphVertices>0&&Di?_i(Di,f.az.vertical):{box:null,offscreen:null}})),La(ji&&ji.placeable)}else{let _i=f.aP[(Li=(hi=this.prevPlacement)===null||hi===void 0?void 0:hi.variableOffsets[Ne.crossTileID])===null||Li===void 0?void 0:Li.anchor];const Di=(En,Rc,Lc)=>{const _o=En.x2-En.x1,Rd=En.y2-En.y1,yo=Ne.textBoxScale,Bc=ee&&ne==="never"?Rc:null;let Ns=null,js=$==="never"?1:2,jr="never";_i&&js++;for(let kc=0;kc<js;kc++){for(let Zu=yr;Zu<vr;Zu++){const Hu=h.textAnchorOffsets.get(Zu);if(_i&&Hu.textAnchor!==_i)continue;const Xu=this.attemptAnchorPlacement(Hu,En,_o,Rd,yo,ie,se,z,be,S,U,jr,Ne,h,Lc,v,b,Bc,we);if(Xu&&(Ns=Xu.placedGlyphBoxes,Ns&&Ns.placeable))return zi=!0,Ki=Xu.shift,Ns}_i?_i=null:jr=$}return l&&!Ns&&(Ns={box:this.collisionIndex.placeCollisionBox(Ra,"always",z,be,S,se,ie,v,U.predicate,we,void 0,Xe).box,offscreen:!1,placeable:!1,occluded:!1}),Ns};er((()=>Di(Ra,We.iconBox,f.az.horizontal)),(()=>{const En=We.verticalTextBox;return h.allowVerticalPlacement&&(!ji||!ji.placeable)&&Ne.numVerticalGlyphVertices>0&&En?Di(En,We.verticalIconBox,f.az.vertical):{box:null,occluded:!0,offscreen:null}})),ji&&(zi=ji.placeable,bi=ji.offscreen);const wn=La(ji&&ji.placeable);if(!zi&&this.prevPlacement){const En=this.prevPlacement.variableOffsets[Ne.crossTileID];En&&(this.variableOffsets[Ne.crossTileID]=En,this.markUsedJustification(h,En.anchor,Ne,wn))}}}if(ln=ji,zi=ln&&ln.placeable,bi=ln&&ln.offscreen,Ne.useRuntimeCollisionCircles&&Ne.centerJustifiedTextSymbolIndex>=0){const La=h.text.placedSymbolArray.get(Ne.centerJustifiedTextSymbolIndex),er=f.aA(h.textSizeData,F,La),yr=_.get("text-padding");un=this.collisionIndex.placeCollisionCircles($,La,h.lineVertexArray,h.glyphOffsetArray,er,S,E,l,se,U.predicate,Ne.collisionCircleDiameter,yr,v,we),un.circles.length&&un.collisionDetected&&!l&&f.w("Collisions detected, but collision boxes are not shown"),zi=K||un.circles.length>0&&!un.collisionDetected,bi=bi&&un.offscreen}if(We.iconFeatureIndex&&(Fr=We.iconFeatureIndex),We.iconBox){const La=er=>this.collisionIndex.placeCollisionBox(er,ne,z,be,S,se,ie,b,U.predicate,we,ee&&Ki?Ki:void 0,Xe);Vn&&Vn.placeable&&We.verticalIconBox?(Un=La(We.verticalIconBox),Ni=Un.placeable):(Un=La(We.iconBox),Ni=Un.placeable),bi=bi&&Un.offscreen}const Ko=Y||Ne.numHorizontalGlyphVertices===0&&Ne.numVerticalGlyphVertices===0,ql=W||Ne.numIconVertices===0;Ko||ql?ql?Ko||(Ni=Ni&&zi):zi=Ni&&zi:Ni=zi=Ni&&zi;const Nr=Ni&&Un.placeable;if(zi&&ln.placeable&&this.collisionIndex.insertCollisionBox(ln.box,$,_.get("text-ignore-placement"),h.bucketInstanceId,Vn&&Vn.placeable&&_s?_s:gs,U.ID),Nr&&this.collisionIndex.insertCollisionBox(Un.box,ne,_.get("icon-ignore-placement"),h.bucketInstanceId,Fr,U.ID),un&&zi&&this.collisionIndex.insertCollisionCircles(un.circles,$,_.get("text-ignore-placement"),h.bucketInstanceId,gs,U.ID),l&&this.storeCollisionData(h.bucketInstanceId,zt,We,ln,Un,un),Ne.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ne.crossTileID]=new rh((zi||Me)&&!ln?.occluded,(Ni||_e)&&!Un?.occluded,bi||h.justReloaded),r[Ne.crossTileID]=!0};if(ce){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ne=h.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let We=Ne.length-1;We>=0;--We){const zt=Ne[We];Ye(h.symbolInstances.get(zt),h.collisionArrays[zt],zt)}}else for(let Ne=t.symbolInstanceStart;Ne<t.symbolInstanceEnd;Ne++)Ye(h.symbolInstances.get(Ne),h.collisionArrays[Ne],Ne);h.justReloaded=!1}storeCollisionData(t,r,l,h,_,v){if(l.textBox||l.iconBox){let b,S;this.collisionBoxArrays.has(t)?b=this.collisionBoxArrays.get(t):(b=new Map,this.collisionBoxArrays.set(t,b)),b.has(r)?S=b.get(r):(S={text:null,icon:null},b.set(r,S)),l.textBox&&(S.text=h.box),l.iconBox&&(S.icon=_.box)}if(v){let b=this.collisionCircleArrays[t];b===void 0&&(b=this.collisionCircleArrays[t]=[]);for(let S=0;S<v.circles.length;S+=4)b.push(v.circles[S+0]-ai),b.push(v.circles[S+1]-ai),b.push(v.circles[S+2]),b.push(v.collisionDetected?1:0)}}markUsedJustification(t,r,l,h){let _;_=h===f.az.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[f.aR(r)];const v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const b of v)b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=_>=0&&b!==_?0:l.crossTileID)}markUsedOrientation(t,r,l){const h=r===f.az.horizontal||r===f.az.horizontalOnly?r:0,_=r===f.az.vertical?r:0,v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const b of v)t.text.placedSymbolArray.get(b).placedOrientation=h;l.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let l=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const h=r?r.symbolFadeChange(t):1,_=r?r.opacities:{},v=r?r.variableOffsets:{},b=r?r.placedOrientations:{};for(const S in this.placements){const E=this.placements[S],z=_[S];z?(this.opacities[S]=new Co(z,h,E.text,E.icon),l=l||E.text!==z.text.placed||E.icon!==z.icon.placed):(this.opacities[S]=new Co(null,h,E.text,E.icon,E.skipFade),l=l||E.text||E.icon)}for(const S in _){const E=_[S];if(!this.opacities[S]){const z=new Co(E,h,!1,!1);z.isHidden()||(this.opacities[S]=z,l=l||E.text.placed||E.icon.placed)}}for(const S in v)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=v[S]);for(const S in b)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=b[S]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r){const l={};for(const h of r){const _=h.getBucket(t);_&&h.latestFeatureIndex&&t.id===_.layerIds[0]&&this.updateBucketOpacities(_,h.tileID,l,h.collisionBoxArray)}}updateBucketOpacities(t,r,l,h){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const _=t.layers[0],v=_.layout,b=new Co(null,0,!1,!1,!0),S=v.get("text-allow-overlap"),E=v.get("icon-allow-overlap"),z=_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"),R=v.get("text-rotation-alignment")==="map",I=v.get("text-pitch-alignment")==="map",F=v.get("icon-text-fit")!=="none",U=new Co(null,0,S&&(E||!t.hasIconData()||v.get("icon-optional")),E&&(S||!t.hasTextData()||v.get("text-optional")),!0);!t.collisionArrays&&h&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(h);const Y=($,K,ne)=>{for(let Q=0;Q<K/4;Q++)$.opacityVertexArray.emplaceBack(ne);$.hasVisibleVertices=$.hasVisibleVertices||ne!==Do},W=this.collisionBoxArrays.get(t.bucketInstanceId);for(let $=0;$<t.symbolInstances.length;$++){const K=t.symbolInstances.get($),{numHorizontalGlyphVertices:ne,numVerticalGlyphVertices:Q,crossTileID:ie}=K;let se=this.opacities[ie];l[ie]?se=b:se||(se=U,this.opacities[ie]=se),l[ie]=!0;const ee=K.numIconVertices>0,ce=this.placedOrientations[K.crossTileID],Me=ce===f.az.vertical,_e=ce===f.az.horizontal||ce===f.az.horizontalOnly;if(ne>0||Q>0){const we=oc(se.text);Y(t.text,ne,Me?Do:we),Y(t.text,Q,_e?Do:we);const Xe=se.text.isHidden();[K.rightJustifiedTextSymbolIndex,K.centerJustifiedTextSymbolIndex,K.leftJustifiedTextSymbolIndex].forEach((We=>{We>=0&&(t.text.placedSymbolArray.get(We).hidden=Xe||Me?1:0)})),K.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(K.verticalPlacedTextSymbolIndex).hidden=Xe||_e?1:0);const Ye=this.variableOffsets[K.crossTileID];Ye&&this.markUsedJustification(t,Ye.anchor,K,ce);const Ne=this.placedOrientations[K.crossTileID];Ne&&(this.markUsedJustification(t,"left",K,Ne),this.markUsedOrientation(t,Ne,K))}if(ee){const we=oc(se.icon),Xe=!(F&&K.verticalPlacedIconSymbolIndex&&Me);K.placedIconSymbolIndex>=0&&(Y(t.icon,K.numIconVertices,Xe?we:Do),t.icon.placedSymbolArray.get(K.placedIconSymbolIndex).hidden=se.icon.isHidden()),K.verticalPlacedIconSymbolIndex>=0&&(Y(t.icon,K.numVerticalIconVertices,Xe?Do:we),t.icon.placedSymbolArray.get(K.verticalPlacedIconSymbolIndex).hidden=se.icon.isHidden())}const be=W&&W.has($)?W.get($):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const we=t.collisionArrays[$];if(we){let Xe=new f.P(0,0);if(we.textBox||we.verticalTextBox){let Ye=!0;if(z){const Ne=this.variableOffsets[ie];Ne?(Xe=_a(Ne.anchor,Ne.width,Ne.height,Ne.textOffset,Ne.textBoxScale),R&&Xe._rotate(I?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Ye=!1}if(we.textBox||we.verticalTextBox){let Ne;we.textBox&&(Ne=Me),we.verticalTextBox&&(Ne=_e),sc(t.textCollisionBox.collisionVertexArray,se.text.placed,!Ye||Ne,be.text,Xe.x,Xe.y)}}if(we.iconBox||we.verticalIconBox){const Ye=!!(!_e&&we.verticalIconBox);let Ne;we.iconBox&&(Ne=Ye),we.verticalIconBox&&(Ne=!Ye),sc(t.iconCollisionBox.collisionVertexArray,se.icon.placed,Ne,be.icon,F?Xe.x:0,F?Xe.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const l=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*l>t}setStale(){this.stale=!0}}function sc(m,t,r,l,h,_){l&&l.length!==0||(l=[0,0,0,0]);const v=l[0]-ai,b=l[1]-ai,S=l[2]-ai,E=l[3]-ai;m.emplaceBack(t?1:0,r?1:0,h||0,_||0,v,b),m.emplaceBack(t?1:0,r?1:0,h||0,_||0,S,b),m.emplaceBack(t?1:0,r?1:0,h||0,_||0,S,E),m.emplaceBack(t?1:0,r?1:0,h||0,_||0,v,E)}const cu=Math.pow(2,25),Qs=Math.pow(2,24),gd=Math.pow(2,17),wl=Math.pow(2,16),As=Math.pow(2,9),_d=Math.pow(2,8),zo=Math.pow(2,1);function oc(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const t=m.placed?1:0,r=Math.floor(127*m.opacity);return r*cu+t*Qs+r*gd+t*wl+r*As+t*_d+r*zo+t}const Do=0;class Ks{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,r,l,h,_){const v=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(v,h,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort(((b,S)=>b.sortKey-S.sortKey)));this._currentPartIndex<v.length;)if(r.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,_())return!0;return!1}}class Tl{constructor(t,r,l,h,_,v,b,S){this.placement=new uu(t,r,v,b,S),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,r,l){const h=bt(),_=()=>!this._forceFullPlacement&&bt()-h>2;for(;this._currentPlacementIndex>=0;){const v=r[t[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=b)&&(!v.maxzoom||v.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new Ks(v)),this._inProgressLayer.continuePlacement(l[v.source],this.placement,this._showCollisionBoxes,v,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Ft=512/f.a5/2;class Dr{constructor(t,r,l){this.tileID=t,this.bucketInstanceId=l,this._symbolsByKey={};const h=new Map;for(let _=0;_<r.length;_++){const v=r.get(_),b=v.key,S=h.get(b);S?S.push(v):h.set(b,[v])}for(const[_,v]of h){const b={positions:v.map((S=>({x:Math.floor(S.anchorX*Ft),y:Math.floor(S.anchorY*Ft)}))),crossTileIDs:v.map((S=>S.crossTileID))};if(b.positions.length>128){const S=new f.aT(b.positions.length,16,Uint16Array);for(const{x:E,y:z}of b.positions)S.add(E,z);S.finish(),delete b.positions,b.index=S}this._symbolsByKey[_]=b}}getScaledCoordinates(t,r){const{x:l,y:h,z:_}=this.tileID.canonical,{x:v,y:b,z:S}=r.canonical,E=Ft/Math.pow(2,S-_),z=(b*f.a5+t.anchorY)*E,R=h*f.a5*Ft;return{x:Math.floor((v*f.a5+t.anchorX)*E-l*f.a5*Ft),y:Math.floor(z-R)}}findMatches(t,r,l){const h=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let _=0;_<t.length;_++){const v=t.get(_);if(v.crossTileID)continue;const b=this._symbolsByKey[v.key];if(!b)continue;const S=this.getScaledCoordinates(v,r);if(b.index){const E=b.index.range(S.x-h,S.y-h,S.x+h,S.y+h).sort();for(const z of E){const R=b.crossTileIDs[z];if(!l[R]){l[R]=!0,v.crossTileID=R;break}}}else if(b.positions)for(let E=0;E<b.positions.length;E++){const z=b.positions[E],R=b.crossTileIDs[E];if(Math.abs(z.x-S.x)<=h&&Math.abs(z.y-S.y)<=h&&!l[R]){l[R]=!0,v.crossTileID=R;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class sh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class hu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(r!==0)for(const l in this.indexes){const h=this.indexes[l],_={};for(const v in h){const b=h[v];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+r),_[b.tileID.key]=b}this.indexes[l]=_}this.lng=t}addBucket(t,r,l){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<r.symbolInstances.length;_++)r.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const h=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const v=this.indexes[_];if(Number(_)>t.overscaledZ)for(const b in v){const S=v[b];S.tileID.isChildOf(t)&&S.findMatches(r.symbolInstances,t,h)}else{const b=v[t.scaledTo(Number(_)).key];b&&b.findMatches(r.symbolInstances,t,h)}}for(let _=0;_<r.symbolInstances.length;_++){const v=r.symbolInstances.get(_);v.crossTileID||(v.crossTileID=l.generate(),h[v.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Dr(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const l of r.getCrossTileIDsLists())for(const h of l)delete this.usedCrossTileIDs[t][h]}removeStaleBuckets(t){let r=!1;for(const l in this.indexes){const h=this.indexes[l];for(const _ in h)t[h[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,h[_]),delete h[_],r=!0)}return r}}class In{constructor(){this.layerIndexes={},this.crossTileIDs=new sh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,l){let h=this.layerIndexes[t.id];h===void 0&&(h=this.layerIndexes[t.id]=new hu);let _=!1;const v={};h.handleWrapJump(l);for(const b of r){const S=b.getBucket(t);S&&t.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(b.tileID,S,this.crossTileIDs)&&(_=!0),v[S.bucketInstanceId]=!0)}return h.removeStaleBuckets(v)&&(_=!0),_}pruneUnusedLayers(t){const r={};t.forEach((l=>{r[l]=!0}));for(const l in this.layerIndexes)r[l]||delete this.layerIndexes[l]}}var xn="void main() {fragColor=vec4(1.0);}";const Vi={prelude:wt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:wt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:wt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:wt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:wt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:wt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:wt(xn,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:wt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:wt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:wt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:wt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:wt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:wt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:wt(xn,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:wt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:wt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:wt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:wt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:wt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:wt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:wt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:wt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:wt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:wt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:wt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:wt(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:wt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:wt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:wt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:wt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:wt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:wt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:wt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:wt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:wt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:wt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:wt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function wt(m,t){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=t.match(/in ([\w]+) ([\w]+)/g),h=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=_?_.concat(h):h,b={};return{fragmentSource:m=m.replace(r,((S,E,z,R,I)=>(b[I]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${I}
in ${z} ${R} ${I};
#else
uniform ${z} ${R} u_${I};
#endif
`:`
#ifdef HAS_UNIFORM_u_${I}
    ${z} ${R} ${I} = u_${I};
#endif
`))),vertexSource:t=t.replace(r,((S,E,z,R,I)=>{const F=R==="float"?"vec2":"vec4",U=I.match(/color/)?"color":F;return b[I]?E==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
in ${z} ${F} a_${I};
out ${z} ${R} ${I};
#else
uniform ${z} ${R} u_${I};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = a_${I};
#else
    ${z} ${R} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = unpack_mix_${U}(a_${I}, u_${I}_t);
#else
    ${z} ${R} ${I} = u_${I};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
in ${z} ${F} a_${I};
#else
uniform ${z} ${R} u_${I};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${z} ${R} ${I} = a_${I};
#else
    ${z} ${R} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${z} ${R} ${I} = unpack_mix_${U}(a_${I}, u_${I}_t);
#else
    ${z} ${R} ${I} = u_${I};
#endif
`})),staticAttributes:l,staticUniforms:v}}class Ei{constructor(t,r,l){this.vertexBuffer=t,this.indexBuffer=r,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var lr=f.aU([{name:"a_pos",type:"Int16",components:2}]);const rn="#define PROJECTION_MERCATOR",ya="mercator";class Rn{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return ya}get shaderDefine(){return rn}get shaderPreludeCode(){return Vi.projectionMercator}get vertexShaderPreludeCode(){return Vi.projectionMercator.vertexSource}get subdivisionGranularity(){return f.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,r,l,h,_){if(this._cachedMesh)return this._cachedMesh;const v=new f.aW;v.emplaceBack(0,0),v.emplaceBack(f.a5,0),v.emplaceBack(0,f.a5),v.emplaceBack(f.a5,f.a5);const b=t.createVertexBuffer(v,lr.members),S=f.aX.simpleSegment(0,0,4,2),E=new f.aY;E.emplaceBack(1,0,2),E.emplaceBack(1,2,3);const z=t.createIndexBuffer(E);return this._cachedMesh=new Ei(b,z,S),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class qa{constructor(t=0,r=0,l=0,h=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(l)||l<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=l,this.right=h}interpolate(t,r,l){return r.top!=null&&t.top!=null&&(this.top=f.G.number(t.top,r.top,l)),r.bottom!=null&&t.bottom!=null&&(this.bottom=f.G.number(t.bottom,r.bottom,l)),r.left!=null&&t.left!=null&&(this.left=f.G.number(t.left,r.left,l)),r.right!=null&&t.right!=null&&(this.right=f.G.number(t.right,r.right,l)),this}getCenter(t,r){const l=f.an((this.left+t-this.right)/2,0,t),h=f.an((this.top+r-this.bottom)/2,0,r);return new f.P(l,h)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new qa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Kr(m,t){if(!m.renderWorldCopies||m.lngRange)return;const r=t.lng-m.center.lng;t.lng+=r>180?-360:r<-180?360:0}function Ui(m){return Math.max(0,Math.floor(m))}class Js{constructor(t,r){var l;this.applyConstrain=(h,_)=>this._constrainOverride!==null?this._constrainOverride(h,_):this._callbacks.defaultConstrain(h,_),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=r?.renderWorldCopies===void 0||!!r?.renderWorldCopies,this._minZoom=r?.minZoom||0,this._maxZoom=r?.maxZoom||22,this._minPitch=r?.minPitch==null?0:r?.minPitch,this._maxPitch=r?.maxPitch==null?60:r?.maxPitch,this._constrainOverride=(l=r?.constrainOverride)!==null&&l!==void 0?l:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new f.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Ui(this._zoom),this._scale=f.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new qa,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,r,l){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Ui(this._zoom),this._scale=f.aq(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new qa(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!l&&t.autoCalculateNearFarZ,r&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new f.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const r=f.W(t,-180,180)*Math.PI/180;var l,h,_,v,b,S,E,z,R;this._bearingInRadians!==r&&(this._unmodified=!1,this._bearingInRadians=r,this._calcMatrices(),this._rotationMatrix=qe(),l=this._rotationMatrix,_=-this._bearingInRadians,v=(h=this._rotationMatrix)[0],b=h[1],S=h[2],E=h[3],z=Math.sin(_),R=Math.cos(_),l[0]=v*R+S*z,l[1]=b*R+E*z,l[2]=v*-z+S*R,l[3]=b*-z+E*R)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const r=f.an(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==r&&(this._unmodified=!1,this._pitchInRadians=r,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const r=t/180*Math.PI;this._rollInRadians!==r&&(this._unmodified=!1,this._rollInRadians=r,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return f.aZ(this._fovInRadians)}setFov(t){t=f.an(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=f.ap(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const r=this.applyConstrain(this._center,t).zoom;this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this._tileZoom=Math.max(0,Math.floor(r)),this._scale=f.aq(r),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,r){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=r,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,l){this._unmodified=!1,this._edgeInsets.interpolate(t,r,l),this.constrainInternal(),this._calcMatrices()}resize(t,r,l=!0){this._width=t,this._height=r,l&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new tn([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-f.ao,f.ao])}getCameraQueryGeometry(t,r){if(r.length===1)return[r[0],t];{const{minX:l,minY:h,maxX:_,maxY:v}=f.aa.fromPoints(r).extend(t);return[new f.P(l,h),new f.P(_,h),new f.P(_,v),new f.P(l,v),new f.P(l,h)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:r,zoom:l}=this.applyConstrain(this.center,this.zoom);this.setCenter(r),this.setZoom(l),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=f.ar(new Float64Array(16));f.Q(t,t,[this._width/2,-this._height/2,1]),f.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=f.ar(new Float64Array(16)),f.Q(t,t,[1,-1,1]),f.O(t,t,[-1,-1,0]),f.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,r,l,h){const _=l!==void 0?l:this.bearing,v=h=h!==void 0?h:this.pitch,{distanceToCenter:b,clampedElevation:S}=this._distanceToCenterFromAltElevationPitch(r,this.elevation,v),{x:E,y:z}=pi(v,_),R=f.a9.fromLngLat(t,r);let I,F,U=f.a_(1,R.y),Y=0;do{if(Y+=1,Y>10)break;F=b/U,I=new f.a9(R.x+E*F,R.y+z*F),U=1/I.meterInMercatorCoordinateUnits()}while(Math.abs(b-F*U)>1e-12);return{center:I.toLngLat(),elevation:S,zoom:f.at(this.height/2/Math.tan(this.fovInRadians/2)/F/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const r=1/this.worldSize,l=f.as(1,this.center.lat)*this.worldSize,h=f.a9.fromLngLat(this.center,this.elevation),_=h.x/r,v=h.y/r,b=h.z/r,S=this.pitch,E=this.bearing,{x:z,y:R,z:I}=pi(S,E),F=this.cameraToCenterDistance,U=_+F*-z,Y=v+F*-R,W=b+F*I,{distanceToCenter:$,clampedElevation:K}=this._distanceToCenterFromAltElevationPitch(W/l,t,S),ne=$*l,Q=new f.a9((U+z*ne)*r,(Y+R*ne)*r,0).toLngLat(),ie=f.as(1,Q.lat),se=f.at(this.height/2/Math.tan(this.fovInRadians/2)/$/ie/this.tileSize);this._elevation=K,this._center=Q,this.setZoom(se)}_distanceToCenterFromAltElevationPitch(t,r,l){const h=-Math.cos(f.ap(l)),_=t-r;let v,b=r;return h*_>=0||Math.abs(h)<.1?(v=1e4,b=t+v*h):v=-_/h,{distanceToCenter:v,clampedElevation:b}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new f.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=f.as(1,this.center.lat)*this.worldSize;return ge(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const r=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/r,t.canonical.y/r,1/r/f.a5,1/r/f.a5]}}class Za{constructor(t,r){this.min=t,this.max=r,this.center=f.a$([],f.b0([],this.min,this.max),.5)}quadrant(t){const r=[t%2==0,t<2],l=f.b1(this.min),h=f.b1(this.max);for(let _=0;_<r.length;_++)l[_]=r[_]?this.min[_]:this.center[_],h[_]=r[_]?this.center[_]:this.max[_];return h[2]=this.max[2],new Za(l,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let r=!0;for(let l=0;l<t.planes.length;l++){const h=this.intersectsPlane(t.planes[l]);if(h===0)return 0;h===1&&(r=!1)}return r?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let r=t[3],l=t[3];for(let h=0;h<3;h++)t[h]>0?(r+=t[h]*this.min[h],l+=t[h]*this.max[h]):(l+=t[h]*this.min[h],r+=t[h]*this.max[h]);return r>=0?2:l<0?0:1}}class Po{distanceToTile2d(t,r,l,h){const _=h.distanceX([t,r]),v=h.distanceY([t,r]);return Math.hypot(_,v)}getWrap(t,r,l){return l}getTileBoundingVolume(t,r,l,h){var _,v;let b=0,S=0;if(h?.terrain){const z=new f.a2(t.z,r,t.z,t.x,t.y),R=h.terrain.getMinMaxElevation(z);b=(_=R.minElevation)!==null&&_!==void 0?_:Math.min(0,l),S=(v=R.maxElevation)!==null&&v!==void 0?v:Math.max(0,l)}const E=1<<t.z;return new Za([r+t.x/E,t.y/E,b],[r+(t.x+1)/E,(t.y+1)/E,S])}allowVariableZoom(t,r){const l=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,h=f.an(78.5-l/2,0,60);return!!r.terrain||t.pitch>h}allowWorldCopies(){return!0}prepareNextFrame(){}}class va{constructor(t,r,l){this.points=t,this.planes=r,this.aabb=l}static fromInvProjectionMatrix(t,r=1,l=0,h,_){const v=_?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],b=Math.pow(2,l),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((I=>(function(F,U,Y,W){const $=f.aH([],F,U),K=1/$[3]/Y*W;return f.b6($,$,[K,K,1/$[3],K])})(I,t,r,b)));h&&(function(I,F,U,Y){const W=Y?4:0,$=Y?0:4;let K=0;const ne=[],Q=[];for(let ee=0;ee<4;ee++){const ce=f.b2([],I[ee+$],I[ee+W]),Me=f.b7(ce);f.a$(ce,ce,1/Me),ne.push(Me),Q.push(ce)}for(let ee=0;ee<4;ee++){const ce=f.b8(I[ee+W],Q[ee],U);K=ce!==null&&ce>=0?Math.max(K,ce):Math.max(K,ne[ee])}const ie=(function(ee,ce){const Me=f.b2([],ee[ce[0]],ee[ce[1]]),_e=f.b2([],ee[ce[2]],ee[ce[1]]),be=[0,0,0,0];return f.b3(be,f.b4([],Me,_e)),be[3]=-f.b5(be,ee[ce[0]]),be})(I,F),se=(function(ee,ce){const Me=f.b9(ee),_e=f.ba([],ee,1/Me),be=f.b2([],ce,f.a$([],_e,f.b5(ce,_e))),we=f.b9(be);if(we>0){const Xe=Math.sqrt(1-_e[3]*_e[3]),Ye=f.a$([],_e,-_e[3]),Ne=f.b0([],Ye,f.a$([],be,Xe/we));return f.bb(ce,Ne)}return null})(U,ie);if(se!==null){const ee=se/f.b5(Q[0],ie);K=Math.min(K,ee)}for(let ee=0;ee<4;ee++){const ce=Math.min(K,ne[ee]);I[ee+$]=[I[ee+W][0]+Q[ee][0]*ce,I[ee+W][1]+Q[ee][1]*ce,I[ee+W][2]+Q[ee][2]*ce,1]}})(S,v[0],h,_);const E=v.map((I=>{const F=f.b2([],S[I[0]],S[I[1]]),U=f.b2([],S[I[2]],S[I[1]]),Y=f.b3([],f.b4([],F,U)),W=-f.b5(Y,S[I[1]]);return Y.concat(W)})),z=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],R=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const I of S)for(let F=0;F<3;F++)z[F]=Math.min(z[F],I[F]),R[F]=Math.max(R[F],I[F]);return new va(S,E,new Za(z,R))}}class An{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,r,l){return this._helper.interpolatePadding(t,r,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,r,l=!0){this._helper.resize(t,r,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,r){this._helper.overrideNearFarZ(t,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,r){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(r,l)=>{l=f.an(+l,this.minZoom,this.maxZoom);const h={center:new f.V(r.lng,r.lat),zoom:l};let _=this._helper._lngRange;if(!this._helper._renderWorldCopies&&_===null){const Q=179.9999999999;_=[-Q,Q]}const v=this.tileSize*f.aq(h.zoom);let b=0,S=v,E=0,z=v,R=0,I=0;const{x:F,y:U}=this.size;if(this._helper._latRange){const Q=this._helper._latRange;b=f.X(Q[1])*v,S=f.X(Q[0])*v,S-b<U&&(R=U/(S-b))}_&&(E=f.W(f.Y(_[0])*v,0,v),z=f.W(f.Y(_[1])*v,0,v),z<E&&(z+=v),z-E<F&&(I=F/(z-E)));const{x:Y,y:W}=ct(v,r);let $,K;const ne=Math.max(I||0,R||0);if(ne){const Q=new f.P(I?(z+E)/2:Y,R?(S+b)/2:W);return h.center=Et(v,Q).wrap(),h.zoom+=f.at(ne),h}if(this._helper._latRange){const Q=U/2;W-Q<b&&(K=b+Q),W+Q>S&&(K=S-Q)}if(_){const Q=(E+z)/2;let ie=Y;this._helper._renderWorldCopies&&(ie=f.W(Y,Q-v/2,Q+v/2));const se=F/2;ie-se<E&&($=E+se),ie+se>z&&($=z-se)}if($!==void 0||K!==void 0){const Q=new f.P($??Y,K??W);h.center=Et(v,Q).wrap()}return h},this.applyConstrain=(r,l)=>this._helper.applyConstrain(r,l),this._helper=new Js({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(r,l)=>this.defaultConstrain(r,l)},t),this._coveringTilesDetailsProvider=new Po}clone(){const t=new An;return t.apply(this),t}apply(t,r,l){this._helper.apply(t,r,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const r=[new f.bc(0,t)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new f.P(0,0)),h=this.screenPointToMercatorCoordinate(new f.P(this._helper._width,0)),_=this.screenPointToMercatorCoordinate(new f.P(this._helper._width,this._helper._height)),v=this.screenPointToMercatorCoordinate(new f.P(0,this._helper._height)),b=Math.floor(Math.min(l.x,h.x,_.x,v.x)),S=Math.floor(Math.max(l.x,h.x,_.x,v.x)),E=1;for(let z=b-E;z<=S+E;z++)z!==0&&r.push(new f.bc(z,t))}return r}getCameraFrustum(){return va.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const r=this.screenPointToLocation(this.centerPoint,t),l=t?t.getElevationForLngLatZoom(r,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(t,r){const l=f.as(this.elevation,this.center.lat),h=this.screenPointToMercatorCoordinateAtZ(r,l),_=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),v=f.a9.fromLngLat(t),b=new f.a9(v.x-(h.x-_.x),v.y-(h.y-_.y));this.setCenter(b?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,r){return r?this.coordinatePoint(f.a9.fromLngLat(t),r.getElevationForLngLat(t,this),this._pixelMatrix3D):this.coordinatePoint(f.a9.fromLngLat(t))}screenPointToLocation(t,r){var l;return(l=this.screenPointToMercatorCoordinate(t,r))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(t,r){if(r){const l=r.pointCoordinate(t);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,r){const l=r||0,h=[t.x,t.y,0,1],_=[t.x,t.y,1,1];f.aH(h,h,this._pixelMatrixInverse),f.aH(_,_,this._pixelMatrixInverse);const v=h[3],b=_[3],S=h[1]/v,E=_[1]/b,z=h[2]/v,R=_[2]/b,I=z===R?0:(l-z)/(R-z);return new f.a9(f.G.number(h[0]/v,_[0]/b,I)/this.worldSize,f.G.number(S,E,I)/this.worldSize,l)}coordinatePoint(t,r=0,l=this._pixelMatrix){const h=[t.x*this.worldSize,t.y*this.worldSize,r,1];return f.aH(h,h,l),new f.P(h[0]/h[3],h[1]/h[3])}getBounds(){const t=Math.max(0,this._helper._height/2-ui(this));return new tn().extend(this.screenPointToLocation(new f.P(0,t))).extend(this.screenPointToLocation(new f.P(this._helper._width,t))).extend(this.screenPointToLocation(new f.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new f.P(0,this._helper._height)))}isPointOnMapSurface(t,r){return r?r.pointCoordinate(t)!=null:t.y>this.height/2-ui(this)}calculatePosMatrix(t,r=!1,l){var h;const _=(h=t.key)!==null&&h!==void 0?h:f.bd(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),v=r?this._alignedPosMatrixCache:this._posMatrixCache;if(v.has(_)){const E=v.get(_);return l?E.f32:E.f64}const b=Qt(t,this.worldSize);f.S(b,r?this._alignedProjMatrix:this._viewProjMatrix,b);const S={f64:b,f32:new Float32Array(b)};return v.set(_,S),l?S.f32:S.f64}calculateFogMatrix(t){const r=t.key,l=this._fogMatrixCacheF32;if(l.has(r))return l.get(r);const h=Qt(t,this.worldSize);return f.S(h,this._fogMatrix,h),l.set(r,new Float32Array(h)),l.get(r)}calculateCenterFromCameraLngLatAlt(t,r,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,r,l,h)}_calculateNearFarZIfNeeded(t,r,l){if(!this._helper.autoCalculateNearFarZ)return;const h=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),_=t-h*this._helper._pixelPerMeter/Math.cos(r),v=h<0?_:t,b=Math.PI/2+this.pitchInRadians,S=f.ap(this.fov)*(Math.abs(Math.cos(f.ap(this.roll)))*this.height+Math.abs(Math.sin(f.ap(this.roll)))*this.width)/this.height*(.5+l.y/this.height),E=Math.sin(S)*v/Math.sin(f.an(Math.PI-b-S,.01,Math.PI-.01)),z=ui(this),R=Math.atan(z/this._helper.cameraToCenterDistance),I=f.ap(.75),F=R>I?2*R*(.5+l.y/(2*z)):I,U=Math.sin(F)*v/Math.sin(f.an(Math.PI-b-F,.01,Math.PI-.01)),Y=Math.min(E,U);this._helper._farZ=1.01*(Math.cos(Math.PI/2-r)*Y+v),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,r=ct(this.worldSize,this.center),l=r.x,h=r.y;this._helper._pixelPerMeter=f.as(1,this.center.lat)*this.worldSize;const _=f.ap(Math.min(this.pitch,nt)),v=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(_));let b;this._calculateNearFarZIfNeeded(v,_,t),b=new Float64Array(16),f.be(b,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),f.aB(this._invProjMatrix,b),b[8]=2*-t.x/this._helper._width,b[9]=2*t.y/this._helper._height,this._projectionMatrix=f.bf(b),f.Q(b,b,[1,-1,1]),f.O(b,b,[0,0,-this._helper.cameraToCenterDistance]),f.bg(b,b,-this.rollInRadians),f.bh(b,b,this.pitchInRadians),f.bg(b,b,-this.bearingInRadians),f.O(b,b,[-l,-h,0]),this._mercatorMatrix=f.Q([],b,[this.worldSize,this.worldSize,this.worldSize]),f.Q(b,b,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=f.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,b),f.O(b,b,[0,0,-this.elevation]),this._viewProjMatrix=b,this._invViewProjMatrix=f.aB([],b);const S=[0,0,-1,1];f.aH(S,S,this._invViewProjMatrix),this._cameraPosition=[S[0]/S[3],S[1]/S[3],S[2]/S[3]],this._fogMatrix=new Float64Array(16),f.be(this._fogMatrix,this.fovInRadians,this.width/this.height,v,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,f.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),f.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),f.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),f.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),f.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),f.O(this._fogMatrix,this._fogMatrix,[-l,-h,0]),f.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),f.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=f.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,b);const E=this._helper._width%2/2,z=this._helper._height%2/2,R=Math.cos(this.bearingInRadians),I=Math.sin(-this.bearingInRadians),F=l-Math.round(l)+R*E+I*z,U=h-Math.round(h)+R*z+I*E,Y=new Float64Array(b);if(f.O(Y,Y,[F>.5?F-1:F,U>.5?U-1:U,0]),this._alignedProjMatrix=Y,b=f.aB(new Float64Array(16),this._pixelMatrix),!b)throw new Error("failed to invert matrix");this._pixelMatrixInverse=b,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new f.P(0,0)),r=[t.x*this.worldSize,t.y*this.worldSize,0,1];return f.aH(r,r,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=f.as(1,this.center.lat)*this.worldSize;return ge(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,r){const l=f.a9.fromLngLat(t),h=[l.x*this.worldSize,l.y*this.worldSize,r,1];return f.aH(h,h,this._viewProjMatrix),h[2]/h[3]}getProjectionData(t){const{overscaledTileID:r,aligned:l,applyTerrainMatrix:h}=t,_=this._helper.getMercatorTileCoordinates(r),v=r?this.calculatePosMatrix(r,l,!0):null;let b;return b=r&&r.terrainRttPosMatrix32f&&h?r.terrainRttPosMatrix32f:v||f.bi(),{mainMatrix:b,tileMercatorCoords:_,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:b}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,r,l){return 1}transformLightDirection(t){return f.b1(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,r,l,h){const _=this.calculatePosMatrix(l);let v;h?(v=[t,r,h(t,r),1],f.aH(v,v,_)):(v=[t,r,0,1],or(v,v,_));const b=v[3];return{point:new f.P(v[0]/b,v[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}populateCache(t){for(const r of t)this.calculatePosMatrix(r)}getMatrixForModel(t,r){const l=f.a9.fromLngLat(t,r),h=l.meterInMercatorCoordinateUnits(),_=f.bj();return f.O(_,_,[l.x,l.y,l.z]),f.bg(_,_,Math.PI),f.bh(_,_,Math.PI/2),f.Q(_,_,[-h,h,h]),_}getProjectionDataForCustomLayer(t=!0){const r=new f.a2(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:r,applyGlobeMatrix:t}),h=Qt(r,this.worldSize);f.S(h,this._viewProjMatrix,h),l.tileMercatorCoords=[0,0,1,1];const _=[f.a5,f.a5,this.worldSize/this._helper.pixelsPerMeter],v=f.bk();return f.Q(v,h,_),l.fallbackMatrix=v,l.mainMatrix=v,l}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function xa(){f.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function du(m){if(m.useSlerp)if(m.k<1){const t=f.bl(m.startEulerAngles.roll,m.startEulerAngles.pitch,m.startEulerAngles.bearing),r=f.bl(m.endEulerAngles.roll,m.endEulerAngles.pitch,m.endEulerAngles.bearing),l=new Float64Array(4);f.bm(l,t,r,m.k);const h=f.bn(l);m.tr.setRoll(h.roll),m.tr.setPitch(h.pitch),m.tr.setBearing(h.bearing)}else m.tr.setRoll(m.endEulerAngles.roll),m.tr.setPitch(m.endEulerAngles.pitch),m.tr.setBearing(m.endEulerAngles.bearing);else m.tr.setRoll(f.G.number(m.startEulerAngles.roll,m.endEulerAngles.roll,m.k)),m.tr.setPitch(f.G.number(m.startEulerAngles.pitch,m.endEulerAngles.pitch,m.k)),m.tr.setBearing(f.G.number(m.startEulerAngles.bearing,m.endEulerAngles.bearing,m.k))}function Io(m,t,r,l,h){const _=h.padding,v=ct(h.worldSize,r.getNorthWest()),b=ct(h.worldSize,r.getNorthEast()),S=ct(h.worldSize,r.getSouthEast()),E=ct(h.worldSize,r.getSouthWest()),z=f.ap(-l),R=v.rotate(z),I=b.rotate(z),F=S.rotate(z),U=E.rotate(z),Y=new f.P(Math.max(R.x,I.x,U.x,F.x),Math.max(R.y,I.y,U.y,F.y)),W=new f.P(Math.min(R.x,I.x,U.x,F.x),Math.min(R.y,I.y,U.y,F.y)),$=Y.sub(W),K=(h.width-(_.left+_.right+t.left+t.right))/$.x,ne=(h.height-(_.top+_.bottom+t.top+t.bottom))/$.y;if(ne<0||K<0)return void xa();const Q=Math.min(f.at(h.scale*Math.min(K,ne)),m.maxZoom),ie=f.P.convert(m.offset),se=new f.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(f.ap(l)),ee=ie.add(se).mult(h.scale/f.aq(Q));return{center:Et(h.worldSize,v.add(S).div(2).sub(ee)),zoom:Q,bearing:l}}class Ro{get useGlobeControls(){return!1}handlePanInertia(t,r){const l=t.mag(),h=Math.abs(ui(r));return{easingOffset:t.mult(Math.min(.75*h/l,1)),easingCenter:r.center}}handleMapControlsRollPitchBearingZoom(t,r){t.bearingDelta&&r.setBearing(r.bearing+t.bearingDelta),t.pitchDelta&&r.setPitch(r.pitch+t.pitchDelta),t.rollDelta&&r.setRoll(r.roll+t.rollDelta),t.zoomDelta&&r.setZoom(r.zoom+t.zoomDelta)}handleMapControlsPan(t,r,l){t.around.distSqr(r.centerPoint)<.01||r.setLocationAtPoint(l,t.around)}cameraForBoxAndBearing(t,r,l,h,_){return Io(t,r,l,h,_)}handleJumpToCenterZoom(t,r){t.zoom!==(r.zoom!==void 0?+r.zoom:t.zoom)&&t.setZoom(+r.zoom),r.center!==void 0&&t.setCenter(f.V.convert(r.center))}handleEaseTo(t,r){const l=t.zoom,h=t.padding,_={roll:t.roll,pitch:t.pitch,bearing:t.bearing},v={roll:r.roll===void 0?t.roll:r.roll,pitch:r.pitch===void 0?t.pitch:r.pitch,bearing:r.bearing===void 0?t.bearing:r.bearing},b=r.zoom!==void 0,S=!t.isPaddingEqual(r.padding);let E=!1;const z=b?+r.zoom:t.zoom;let R=t.centerPoint.add(r.offsetAsPoint);const I=t.screenPointToLocation(R),{center:F,zoom:U}=t.applyConstrain(f.V.convert(r.center||I),z??l);Kr(t,F);const Y=ct(t.worldSize,I),W=ct(t.worldSize,F).sub(Y),$=f.aq(U-l);return E=U!==l,{easeFunc:K=>{if(E&&t.setZoom(f.G.number(l,U,K)),f.bo(_,v)||du({startEulerAngles:_,endEulerAngles:v,tr:t,k:K,useSlerp:_.roll!=v.roll}),S&&(t.interpolatePadding(h,r.padding,K),R=t.centerPoint.add(r.offsetAsPoint)),r.around)t.setLocationAtPoint(r.around,r.aroundPoint);else{const ne=f.aq(t.zoom-l),Q=U>l?Math.min(2,$):Math.max(.5,$),ie=Math.pow(Q,1-K),se=Et(t.worldSize,Y.add(W.mult(K*ie)).mult(ne));t.setLocationAtPoint(t.renderWorldCopies?se.wrap():se,R)}},isZooming:E,elevationCenter:F}}handleFlyTo(t,r){const l=r.zoom!==void 0,h=t.zoom,_=t.applyConstrain(f.V.convert(r.center||r.locationAtOffset),l?+r.zoom:h),v=_.center,b=_.zoom;Kr(t,v);const S=ct(t.worldSize,r.locationAtOffset),E=ct(t.worldSize,v).sub(S),z=E.mag(),R=f.aq(b-h);let I;if(r.minZoom!==void 0){const F=Math.min(+r.minZoom,h,b),U=t.applyConstrain(v,F).zoom;I=f.aq(U-h)}return{easeFunc:(F,U,Y,W)=>{t.setZoom(F===1?b:h+f.at(U));const $=F===1?v:Et(t.worldSize,S.add(E.mult(Y)).mult(U));t.setLocationAtPoint(t.renderWorldCopies?$.wrap():$,W)},scaleOfZoom:R,targetCenter:v,scaleOfMinZoom:I,pixelPathLength:z}}}class xi{constructor(t,r,l){this.blendFunction=t,this.blendColor=r,this.mask=l}}xi.Replace=[1,0],xi.disabled=new xi(xi.Replace,f.bp.transparent,[!1,!1,!1,!1]),xi.unblended=new xi(xi.Replace,f.bp.transparent,[!0,!0,!0,!0]),xi.alphaBlended=new xi([1,771],f.bp.transparent,[!0,!0,!0,!0]);const eo=2305;class Ut{constructor(t,r,l){this.enable=t,this.mode=r,this.frontFace=l}}Ut.disabled=new Ut(!1,1029,eo),Ut.backCCW=new Ut(!0,1029,eo),Ut.frontCCW=new Ut(!0,1028,eo);class Lt{constructor(t,r,l){this.func=t,this.mask=r,this.range=l}}Lt.ReadOnly=!1,Lt.ReadWrite=!0,Lt.disabled=new Lt(519,Lt.ReadOnly,[0,1]);const Lo=7680;class Jt{constructor(t,r,l,h,_,v){this.test=t,this.ref=r,this.mask=l,this.fail=h,this.depthFail=_,this.pass=v}}Jt.disabled=new Jt({func:519,mask:0},0,0,Lo,Lo,Lo);const fu=new WeakMap;function ur(m){var t;if(fu.has(m))return fu.get(m);{const r=(t=m.getParameter(m.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return fu.set(m,r),r}}class to{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const r=t.context,l=r.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const h=new f.aW;h.emplaceBack(-1,-1),h.emplaceBack(2,-1),h.emplaceBack(-1,2);const _=new f.aY;_.emplaceBack(0,1,2),this._fullscreenTriangle=new Ei(r.createVertexBuffer(h,lr.members),r.createIndexBuffer(_),f.aX.simpleSegment(0,0,h.length,_.length)),this._resultBuffer=new Uint8Array(4),r.activeTexture.set(l.TEXTURE1);const v=l.createTexture();l.bindTexture(l.TEXTURE_2D,v),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=r.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(v),ur(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,r){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,r),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,r=t.gl;t.activeTexture.set(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,r){const l=this._cachedRenderContext.context,h=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:f.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,h.TRIANGLES,Lt.disabled,Jt.disabled,xi.unblended,Ut.disabled,((_,v)=>({u_input:_,u_output_expected:v}))(t,r),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&ur(h)){h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.readBuffer(h.COLOR_ATTACHMENT0),h.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),h.bindBuffer(h.PIXEL_PACK_BUFFER,null);const _=h.fenceSync(h.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:_}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&ur(t)){const r=t.clientWaitSync(this._readbackQueue.sync,0,0);if(r===t.WAIT_FAILED)return f.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(r===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=to._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let r=0;return r+=t[0]/256,r+=t[1]/65536,r+=t[2]/16777216,t[3]<127&&(r=-r),r/128}}const io=f.a5/128;function yd(m,t){const r=m.granularity!==void 0?Math.max(m.granularity,1):1,l=r+(m.generateBorders?2:0),h=r+(m.extendToNorthPole||m.generateBorders?1:0)+(m.extendToSouthPole||m.generateBorders?1:0),_=l+1,v=h+1,b=m.generateBorders?-1:0,S=m.generateBorders||m.extendToNorthPole?-1:0,E=r+(m.generateBorders?1:0),z=r+(m.generateBorders||m.extendToSouthPole?1:0),R=_*v,I=l*h*6,F=_*v>65536;if(F&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const U=F||t==="32bit",Y=new Int16Array(2*R);let W=0;for(let ne=S;ne<=z;ne++)for(let Q=b;Q<=E;Q++){let ie=Q/r*f.a5;Q===-1&&(ie=-io),Q===r+1&&(ie=f.a5+io);let se=ne/r*f.a5;ne===-1&&(se=m.extendToNorthPole?f.br:-io),ne===r+1&&(se=m.extendToSouthPole?f.bs:f.a5+io),Y[W++]=ie,Y[W++]=se}const $=U?new Uint32Array(I):new Uint16Array(I);let K=0;for(let ne=0;ne<h;ne++)for(let Q=0;Q<l;Q++){const ie=Q+1+ne*_,se=Q+(ne+1)*_,ee=Q+1+(ne+1)*_;$[K++]=Q+ne*_,$[K++]=se,$[K++]=ie,$[K++]=ie,$[K++]=se,$[K++]=ee}return{vertices:Y.buffer.slice(0),indices:$.buffer.slice(0),uses32bitIndices:U}}const pu=new f.aV({fill:new f.bt(128,2),line:new f.bt(512,0),tile:new f.bt(128,32),stencil:new f.bt(128,1),circle:3});class oh{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Vi.projectionGlobe}get vertexShaderPreludeCode(){return Vi.projectionMercator.vertexSource}get subdivisionGranularity(){return pu}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new to(t));const r=f.X(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-r*Math.PI*2))-.5*Math.PI,h=this._errorMeasurement.updateErrorLoop(r,l),_=bt();h!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=h,this._errorMeasurementLastChangeTime=_);const v=Math.min(Math.max((_-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=f.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,f.bv(v))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,r,l,h,_){const v=(_==="stencil"?pu.stencil:pu.tile).getGranularityForZoomLevel(r.z);return this._getMesh(t,{granularity:v,generateBorders:l,extendToNorthPole:r.y===0&&h,extendToSouthPole:r.y===(1<<r.z)-1&&h})}_getMesh(t,r){const l=this._getMeshKey(r);if(l in this._tileMeshCache)return this._tileMeshCache[l];const h=(function(_,v){const b=yd(v,"16bit"),S=f.aW.deserialize({arrayBuffer:b.vertices,length:b.vertices.byteLength/2/2}),E=f.aY.deserialize({arrayBuffer:b.indices,length:b.indices.byteLength/2/3});return new Ei(_.createVertexBuffer(S,lr.members),_.createIndexBuffer(E),f.aX.simpleSegment(0,0,S.length,E.length))})(t,r);return this._tileMeshCache[l]=h,h}recalculate(t){}hasTransition(){const t=bt();let r=!1;return r=r||(t-this._errorMeasurementLastChangeTime)/1e3<.7,r=r||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,r}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const kf=new f.t({type:new f.D(f.u.projection.type)});class lh extends f.E{constructor(t){super(),this._transitionable=new f.x(kf,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new f.H(0)),this._mercatorProjection=new Rn,this._verticalPerspectiveProjection=new oh}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof f.bw){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,r,l,h,_){return this.currentProjection.getMeshFromTileID(t,r,l,h,_)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function ba(m){const t=Bo(m.worldSize,m.center.lat);return 2*Math.PI*t}function Jr(m,t,r,l,h){const _=1/(1<<h),v=t/f.a5*_+l*_,b=f.by((m/f.a5*_+r*_)*Math.PI*2+Math.PI,2*Math.PI),S=2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI,E=Math.cos(S),z=new Float64Array(3);return z[0]=Math.sin(b)*E,z[1]=Math.sin(S),z[2]=Math.cos(b)*E,z}function Gi(m){return(function(t,r){const l=Math.cos(r),h=new Float64Array(3);return h[0]=Math.sin(t)*l,h[1]=Math.sin(r),h[2]=Math.cos(t)*l,h})(m.lng*Math.PI/180,m.lat*Math.PI/180)}function Bo(m,t){return m/(2*Math.PI)/Math.cos(t*Math.PI/180)}function mu(m){const t=Math.asin(m[1])/Math.PI*180,r=Math.sqrt(m[0]*m[0]+m[2]*m[2]);if(r>1e-6){const l=m[0]/r,h=Math.acos(m[2]/r),_=(l>0?h:-h)/Math.PI*180;return new f.V(f.W(_,-180,180),t)}return new f.V(0,t)}function gu(m){return Math.cos(m*Math.PI/180)}function sn(m,t){const r=gu(m),l=gu(t);return f.at(l/r)}function vd(m,t){const r=m.rotate(t.bearingInRadians),l=t.zoom+sn(t.center.lat,0),h=f.bu(1/gu(t.center.lat),1/gu(Math.min(Math.abs(t.center.lat),60)),f.bx(l,7,3,0,1)),_=360/ba({worldSize:t.worldSize,center:{lat:t.center.lat}});return new f.V(t.center.lng-r.x*_*h,f.an(t.center.lat+r.y*_,-f.ao,f.ao))}function lc(m){const t=.5*m,r=Math.sin(t),l=Math.cos(t);return Math.log(r+l)-Math.log(l-r)}function xd(m,t,r,l){const h=m.lat+r*l;if(Math.abs(r)>1){const _=(Math.sign(m.lat+r)!==Math.sign(m.lat)?-Math.abs(m.lat):Math.abs(m.lat))*Math.PI/180,v=Math.abs(m.lat+r)*Math.PI/180,b=lc(_+l*(v-_)),S=lc(_),E=lc(v);return new f.V(m.lng+t*((b-S)/(E-S)),h)}return new f.V(m.lng+t*l,h)}class Of{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,r,l,h){const _=`${t.z}_${t.x}_${t.y}_${h?.terrain?"t":""}`,v=this._cache.get(_);if(v)return v;const b=this._cachePrevious.get(_);if(b)return this._cache.set(_,b),b;const S=this._boundingVolumeFactory(t,r,l,h);return this._cache.set(_,S),this._hadAnyChanges=!0,S}}class Sl{constructor(t,r,l,h){this.min=l,this.max=h,this.points=t,this.planes=r}static fromAabb(t,r){const l=[];for(let h=0;h<8;h++)l.push([1&~h?t[0]:r[0],(h>>1&1)==1?r[1]:t[1],(h>>2&1)==1?r[2]:t[2]]);return new Sl(l,[[-1,0,0,r[0]],[1,0,0,-t[0]],[0,-1,0,r[1]],[0,1,0,-t[1]],[0,0,-1,r[2]],[0,0,1,-t[2]]],t,r)}static fromCenterSizeAngles(t,r,l){const h=f.bB([],l[0],l[1],l[2]),_=f.bC([],[r[0],0,0],h),v=f.bC([],[0,r[1],0],h),b=f.bC([],[0,0,r[2]],h),S=[...t],E=[...t];for(let R=0;R<8;R++)for(let I=0;I<3;I++){const F=t[I]+_[I]*(1&~R?-1:1)+v[I]*((R>>1&1)==1?1:-1)+b[I]*((R>>2&1)==1?1:-1);S[I]=Math.min(S[I],F),E[I]=Math.max(E[I],F)}const z=[];for(let R=0;R<8;R++){const I=[...t];f.b0(I,I,f.a$([],_,1&~R?-1:1)),f.b0(I,I,f.a$([],v,(R>>1&1)==1?1:-1)),f.b0(I,I,f.a$([],b,(R>>2&1)==1?1:-1)),z.push(I)}return new Sl(z,[[..._,-f.b5(_,z[0])],[...v,-f.b5(v,z[0])],[...b,-f.b5(b,z[0])],[-_[0],-_[1],-_[2],-f.b5(_,z[7])],[-v[0],-v[1],-v[2],-f.b5(v,z[7])],[-b[0],-b[1],-b[2],-f.b5(b,z[7])]],S,E)}intersectsFrustum(t){let r=!0;const l=this.points.length,h=this.planes.length,_=t.planes.length,v=t.points.length;for(let b=0;b<_;b++){const S=t.planes[b];let E=0;for(let z=0;z<l;z++){const R=this.points[z];S[0]*R[0]+S[1]*R[1]+S[2]*R[2]+S[3]>=0&&E++}if(E===0)return 0;E<l&&(r=!1)}if(r)return 2;for(let b=0;b<h;b++){const S=this.planes[b];let E=0;for(let z=0;z<v;z++){const R=t.points[z];S[0]*R[0]+S[1]*R[1]+S[2]*R[2]+S[3]>=0&&E++}if(E===0)return 0}return 1}intersectsPlane(t){const r=this.points.length;let l=0;for(let h=0;h<r;h++){const _=this.points[h];t[0]*_[0]+t[1]*_[1]+t[2]*_[2]+t[3]>=0&&l++}return l===r?2:l===0?0:1}}function uc(m,t,r){const l=m-t;return l<0?-l:Math.max(0,l-r)}function Ml(m,t,r,l,h){const _=m-r;let v;return v=_<0?Math.min(-_,1+_-h):_>1?Math.min(Math.max(_-h,0),1-_):0,Math.max(v,uc(t,l,h))}class uh{constructor(){this._boundingVolumeCache=new Of(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,r,l,h){const _=1<<l.z,v=1/_,b=l.x/_,S=l.y/_;let E=2;return E=Math.min(E,Ml(t,r,b,S,v)),E=Math.min(E,Ml(t,r,b+.5,-S-v,v)),E=Math.min(E,Ml(t,r,b+.5,2-S-v,v)),E}getWrap(t,r,l){const h=1<<r.z,_=1/h,v=r.x/h,b=uc(t.x,v,_),S=uc(t.x,v-1,_),E=uc(t.x,v+1,_),z=Math.min(b,S,E);return z===E?1:z===S?-1:0}allowVariableZoom(t,r){return vi(t,r)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,r,l,h){return this._boundingVolumeCache.getTileBoundingVolume(t,r,l,h)}_computeTileBoundingVolume(t,r,l,h){var _,v;let b=0,S=0;if(h?.terrain){const E=new f.a2(t.z,r,t.z,t.x,t.y),z=h.terrain.getMinMaxElevation(E);b=(_=z.minElevation)!==null&&_!==void 0?_:Math.min(0,l),S=(v=z.maxElevation)!==null&&v!==void 0?v:Math.max(0,l)}if(b/=f.bE,S/=f.bE,b+=1,S+=1,t.z<=0)return Sl.fromAabb([-S,-S,-S],[S,S,S]);if(t.z===1)return Sl.fromAabb([t.x===0?-S:0,t.y===0?0:-S,-S],[t.x===0?0:S,t.y===0?S:0,S]);{const E=[Jr(0,0,t.x,t.y,t.z),Jr(f.a5,0,t.x,t.y,t.z),Jr(f.a5,f.a5,t.x,t.y,t.z),Jr(0,f.a5,t.x,t.y,t.z)],z=[];for(const be of E)z.push(f.a$([],be,S));if(S!==b)for(const be of E)z.push(f.a$([],be,b));t.y===0&&z.push([0,1,0]),t.y===(1<<t.z)-1&&z.push([0,-1,0]);const R=[1,1,1],I=[-1,-1,-1];for(const be of z)for(let we=0;we<3;we++)R[we]=Math.min(R[we],be[we]),I[we]=Math.max(I[we],be[we]);const F=Jr(f.a5/2,f.a5/2,t.x,t.y,t.z),U=f.b4([],[0,1,0],F);f.b3(U,U);const Y=f.b4([],F,U);f.b3(Y,Y);const W=f.b4([],E[2],E[1]);f.b3(W,W);const $=f.b4([],E[0],E[3]);f.b3($,$),z.push(f.a$([],F,S)),t.y>=(1<<t.z)/2&&z.push(f.a$([],Jr(f.a5/2,0,t.x,t.y,t.z),S)),t.y<(1<<t.z)/2&&z.push(f.a$([],Jr(f.a5/2,f.a5,t.x,t.y,t.z),S));const K=_u(F,z),ne=_u(Y,z),Q=[-F[0],-F[1],-F[2],K.max],ie=[F[0],F[1],F[2],-K.min],se=[-Y[0],-Y[1],-Y[2],ne.max],ee=[Y[0],Y[1],Y[2],-ne.min],ce=[...W,0],Me=[...$,0],_e=[];return t.y===0?_e.push(f.bD(Me,ce,Q),f.bD(Me,ce,ie)):_e.push(f.bD(se,ce,Q),f.bD(se,ce,ie),f.bD(se,Me,Q),f.bD(se,Me,ie)),t.y===(1<<t.z)-1?_e.push(f.bD(Me,ce,Q),f.bD(Me,ce,ie)):_e.push(f.bD(ee,ce,Q),f.bD(ee,ce,ie),f.bD(ee,Me,Q),f.bD(ee,Me,ie)),new Sl(_e,[Q,ie,se,ee,ce,Me],R,I)}}}function _u(m,t){let r=1/0,l=-1/0;for(const h of t){const _=f.b5(m,h);r=Math.min(r,_),l=Math.max(l,_)}return{min:r,max:l}}class Al{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,r,l){return this._helper.interpolatePadding(t,r,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,r){this._helper.resize(t,r)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,r){this._helper.overrideNearFarZ(t,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=f.bF(),this._projectionMatrix=f.bj(),this._globeViewProjMatrix32f=f.bi(),this._globeViewProjMatrixNoCorrection=f.bj(),this._globeViewProjMatrixNoCorrectionInverted=f.bj(),this._globeProjMatrixInverted=f.bj(),this._cameraPosition=f.bz(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(r,l)=>{const h=f.an(r.lat,-f.ao,f.ao),_=f.an(+l,this.minZoom+sn(0,h),this.maxZoom);return{center:new f.V(r.lng,h),zoom:_}},this.applyConstrain=(r,l)=>this._helper.applyConstrain(r,l),this._helper=new Js({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(r,l)=>this.defaultConstrain(r,l)},t),this._coveringTilesDetailsProvider=new uh}clone(){const t=new Al;return t.apply(this),t}apply(t,r){this._globeLatitudeErrorCorrectionRadians=r||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=f.bz();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:r,applyGlobeMatrix:l}=t,h=this._helper.getMercatorTileCoordinates(r);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:h,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const r=this.pitchInRadians,l=this.cameraToCenterDistance/t,h=Math.sin(r)*l,_=Math.cos(r)*l+1,v=1/Math.sqrt(h*h+_*_)*1;let b=-h,S=_;const E=Math.sqrt(b*b+S*S);b/=E,S/=E;const z=[0,b,S];f.bG(z,z,[0,0,0],-this.bearingInRadians),f.bH(z,z,[0,0,0],-1*this.center.lat*Math.PI/180),f.bI(z,z,[0,0,0],this.center.lng*Math.PI/180);const R=1/f.b7(z);return f.a$(z,z,R),[...z,-v*R]}isLocationOccluded(t){return!this.isSurfacePointVisible(Gi(t))}transformLightDirection(t){const r=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,h=Math.cos(l),_=[Math.sin(r)*h,Math.sin(l),Math.cos(r)*h],v=[_[2],0,-_[0]],b=[0,0,0];f.b4(b,v,_),f.b3(v,v),f.b3(b,b);const S=[0,0,0];return f.b3(S,[v[0]*t[0]+b[0]*t[1]+_[0]*t[2],v[1]*t[0]+b[1]*t[1]+_[1]*t[2],v[2]*t[0]+b[2]*t[1]+_[2]*t[2]]),S}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,r,l){const h=(function(b,S,E){const z=1/(1<<E.z);return new f.a9(b/f.a5*z+E.x*z,S/f.a5*z+E.y*z)})(t,r,l.canonical),_=(v=h.y,[f.by(h.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI]);var v;return this.getCircleRadiusCorrection()/Math.cos(_[1])}projectTileCoordinates(t,r,l,h){const _=l.canonical,v=Jr(t,r,_.x,_.y,_.z),b=1+(h?h(t,r):0)/f.bE,S=[v[0]*b,v[1]*b,v[2]*b,1];f.aH(S,S,this._globeViewProjMatrixNoCorrection);const E=this._cachedClippingPlane,z=E[0]*v[0]+E[1]*v[1]+E[2]*v[2]+E[3]<0;return{point:new f.P(S[0]/S[3],S[1]/S[3]),signedDistanceFromCamera:S[3],isOccluded:z}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=Bo(this.worldSize,this.center.lat),r=f.bk(),l=f.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),f.be(r,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const h=this.centerOffset;r[8]=2*-h.x/this._helper._width,r[9]=2*h.y/this._helper._height,this._projectionMatrix=f.bf(r),this._globeProjMatrixInverted=f.bk(),f.aB(this._globeProjMatrixInverted,r),f.O(r,r,[0,0,-this.cameraToCenterDistance]),f.bg(r,r,this.rollInRadians),f.bh(r,r,-this.pitchInRadians),f.bg(r,r,this.bearingInRadians),f.O(r,r,[0,0,-t]);const _=f.bz();_[0]=t,_[1]=t,_[2]=t,f.bh(l,r,this.center.lat*Math.PI/180),f.bJ(l,l,-this.center.lng*Math.PI/180),f.Q(l,l,_),this._globeViewProjMatrixNoCorrection=l,f.bh(r,r,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),f.bJ(r,r,-this.center.lng*Math.PI/180),f.Q(r,r,_),this._globeViewProjMatrix32f=new Float32Array(r),this._globeViewProjMatrixNoCorrectionInverted=f.bk(),f.aB(this._globeViewProjMatrixNoCorrectionInverted,l);const v=f.bz();this._cameraPosition=f.bz(),this._cameraPosition[2]=this.cameraToCenterDistance/t,f.bG(this._cameraPosition,this._cameraPosition,v,-this.rollInRadians),f.bH(this._cameraPosition,this._cameraPosition,v,this.pitchInRadians),f.bG(this._cameraPosition,this._cameraPosition,v,-this.bearingInRadians),f.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),f.bH(this._cameraPosition,this._cameraPosition,v,-this.center.lat*Math.PI/180),f.bI(this._cameraPosition,this._cameraPosition,v,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const b=f.bf(this._globeViewProjMatrixNoCorrectionInverted);f.Q(b,b,[1,1,-1]),this._cachedFrustum=va.fromInvProjectionMatrix(b,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){f.w("calculateFogMatrix is not supported on globe projection.");const r=f.bk();return f.ar(r),r}getVisibleUnwrappedCoordinates(t){return[new f.bc(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&f.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,r){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=Gi(t);f.a$(l,l,1+r/f.bE);const h=f.bF();return f.aH(h,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),h[2]/h[3]}populateCache(t){}getBounds(){const t=.5*this.width,r=.5*this.height,l=[new f.P(0,0),new f.P(t,0),new f.P(this.width,0),new f.P(this.width,r),new f.P(this.width,this.height),new f.P(t,this.height),new f.P(0,this.height),new f.P(0,r)],h=[];for(const R of l)h.push(this.unprojectScreenPoint(R));let _=0,v=0,b=0,S=0;const E=this.center;for(const R of h){const I=f.bK(E.lng,R.lng),F=f.bK(E.lat,R.lat);I<v&&(v=I),I>_&&(_=I),F<S&&(S=F),F>b&&(b=F)}const z=[E.lng+v,E.lat+S,E.lng+_,E.lat+b];return this.isSurfacePointOnScreen([0,1,0])&&(z[3]=90,z[0]=-180,z[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(z[1]=-90,z[0]=-180,z[2]=180),new tn(z)}calculateCenterFromCameraLngLatAlt(t,r,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,r,l,h)}setLocationAtPoint(t,r){const l=Gi(this.unprojectScreenPoint(r)),h=Gi(t),_=f.bz();f.bL(_);const v=f.bz();f.bI(v,l,_,-this.center.lng*Math.PI/180),f.bH(v,v,_,this.center.lat*Math.PI/180);const b=h[0]*h[0]+h[2]*h[2],S=v[0]*v[0];if(b<S)return;const E=Math.sqrt(b-S),z=-E,R=f.bM(h[0],h[2],v[0],E),I=f.bM(h[0],h[2],v[0],z),F=f.bz();f.bI(F,h,_,-R);const U=f.bM(F[1],F[2],v[1],v[2]),Y=f.bz();f.bI(Y,h,_,-I);const W=f.bM(Y[1],Y[2],v[1],v[2]),$=.5*Math.PI,K=U>=-$&&U<=$,ne=W>=-$&&W<=$;let Q,ie;if(K&&ne){const Me=this.center.lng*Math.PI/180,_e=this.center.lat*Math.PI/180;f.bN(R,Me)+f.bN(U,_e)<f.bN(I,Me)+f.bN(W,_e)?(Q=R,ie=U):(Q=I,ie=W)}else if(K)Q=R,ie=U;else{if(!ne)return;Q=I,ie=W}const se=Q/Math.PI*180,ee=ie/Math.PI*180,ce=this.center.lat;this.setCenter(new f.V(se,f.an(ee,-90,90))),this.setZoom(this.zoom+sn(ce,this.center.lat))}locationToScreenPoint(t,r){const l=Gi(t);if(r){const h=r.getElevationForLngLatZoom(t,this._helper._tileZoom);f.a$(l,l,1+h/f.bE)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(t){const r=f.bF();return f.aH(r,[...t,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],new f.P((.5*r[0]+.5)*this.width,(.5*-r[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,r){if(r){const l=r.pointCoordinate(t);if(l)return l}return f.a9.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,r){var l;return(l=this.screenPointToMercatorCoordinate(t,r))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(t,r){const l=this._cameraPosition,h=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(l,h)}getRayDirectionFromPixel(t){const r=f.bF();r[0]=t.x/this.width*2-1,r[1]=-1*(t.y/this.height*2-1),r[2]=1,r[3]=1,f.aH(r,r,this._globeViewProjMatrixNoCorrectionInverted),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3];const l=f.bz();l[0]=r[0]-this._cameraPosition[0],l[1]=r[1]-this._cameraPosition[1],l[2]=r[2]-this._cameraPosition[2];const h=f.bz();return f.b3(h,l),h}isSurfacePointVisible(t){const r=this._cachedClippingPlane;return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const r=f.bF();return f.aH(r,[...t,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3],r[0]>-1&&r[0]<1&&r[1]>-1&&r[1]<1&&r[2]>-1&&r[2]<1}rayPlanetIntersection(t,r){const l=f.b5(t,r),h=f.bz(),_=f.bz();f.a$(_,r,l),f.b2(h,t,_);const v=1-f.b5(h,h);if(v<0)return null;const b=f.b5(t,t)-1,S=-l+(l<0?1:-1)*Math.sqrt(v),E=b/S,z=S;return{tMin:Math.min(E,z),tMax:Math.max(E,z)}}unprojectScreenPoint(t){const r=this._cameraPosition,l=this.getRayDirectionFromPixel(t),h=this.rayPlanetIntersection(r,l);if(h){const z=f.bz();f.b0(z,r,[l[0]*h.tMin,l[1]*h.tMin,l[2]*h.tMin]);const R=f.bz();return f.b3(R,z),mu(R)}const _=this._cachedClippingPlane,v=_[0]*l[0]+_[1]*l[1]+_[2]*l[2],b=-f.bb(_,r)/v,S=f.bz();if(b>0)f.b0(S,r,[l[0]*b,l[1]*b,l[2]*b]);else{const z=f.bz();f.b0(z,r,[2*l[0],2*l[1],2*l[2]]);const R=f.bb(this._cachedClippingPlane,z);f.b2(S,z,[this._cachedClippingPlane[0]*R,this._cachedClippingPlane[1]*R,this._cachedClippingPlane[2]*R])}const E=(function(z){const R=f.bz();return R[0]=z[0]*-z[3],R[1]=z[1]*-z[3],R[2]=z[2]*-z[3],{center:R,radius:Math.sqrt(1-z[3]*z[3])}})(_);return mu((function(z,R,I){const F=f.bz();f.b2(F,I,z);const U=f.bz();return f.bA(U,z,F,R/f.b9(F)),U})(E.center,E.radius,S))}getMatrixForModel(t,r){const l=f.V.convert(t),h=1/f.bE,_=f.bj();return f.bJ(_,_,l.lng/180*Math.PI),f.bh(_,_,-l.lat/180*Math.PI),f.O(_,_,[0,0,1+r/f.bE]),f.bh(_,_,.5*Math.PI),f.Q(_,_,[h,h,h]),_}getProjectionDataForCustomLayer(t=!0){const r=this.getProjectionData({overscaledTileID:new f.a2(0,0,0,0,0),applyGlobeMatrix:t});return r.tileMercatorCoords=[0,0,1,1],r}getFastPathSimpleProjectionMatrix(t){}}class El{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,r,l){return this._helper.interpolatePadding(t,r,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,r,l=!0){this._helper.resize(t,r,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,r){this._helper.overrideNearFarZ(t,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,r){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=r,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(r,l)=>this.currentTransform.defaultConstrain(r,l),this.applyConstrain=(r,l)=>this._helper.applyConstrain(r,l),this._helper=new Js({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(r,l)=>this.defaultConstrain(r,l)},t),this._globeness=1,this._mercatorTransform=new An,this._verticalPerspectiveTransform=new Al}clone(){const t=new El;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const r=this._mercatorTransform.getProjectionData(t),l=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:r.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:r.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return f.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return f.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,r,l){const h=this._mercatorTransform.getPitchedTextCorrection(t,r,l),_=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,r,l);return f.bu(h,_,this._globeness)}projectTileCoordinates(t,r,l,h){return this.currentTransform.projectTileCoordinates(t,r,l,h)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,r){return this.currentTransform.lngLatToCameraDepth(t,r)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,r,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,r,l,h)}setLocationAtPoint(t,r){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,r),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,r),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,r){return this.currentTransform.locationToScreenPoint(t,r)}screenPointToMercatorCoordinate(t,r){return this.currentTransform.screenPointToMercatorCoordinate(t,r)}screenPointToLocation(t,r){return this.currentTransform.screenPointToLocation(t,r)}isPointOnMapSurface(t,r){return this.currentTransform.isPointOnMapSurface(t,r)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,r){return this.currentTransform.getMatrixForModel(t,r)}getProjectionDataForCustomLayer(t=!0){const r=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return r;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return l.fallbackMatrix=r.mainMatrix,l}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class fn{get useGlobeControls(){return!0}handlePanInertia(t,r){const l=vd(t,r);return Math.abs(l.lng-r.center.lng)>180&&(l.lng=r.center.lng+179.5*Math.sign(l.lng-r.center.lng)),{easingCenter:l,easingOffset:new f.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,r){const l=t.around,h=r.screenPointToLocation(l);t.bearingDelta&&r.setBearing(r.bearing+t.bearingDelta),t.pitchDelta&&r.setPitch(r.pitch+t.pitchDelta),t.rollDelta&&r.setRoll(r.roll+t.rollDelta);const _=r.zoom;t.zoomDelta&&r.setZoom(r.zoom+t.zoomDelta);const v=r.zoom-_;if(v===0)return;const b=f.bK(r.center.lng,h.lng),S=b/(Math.abs(b/180)+1),E=f.bK(r.center.lat,h.lat),z=r.getRayDirectionFromPixel(l),R=r.cameraPosition,I=-1*f.b5(R,z),F=f.bz();f.b0(F,R,[z[0]*I,z[1]*I,z[2]*I]);const U=f.b7(F)-1,Y=Math.exp(.5*-Math.max(U-.3,0)),W=Bo(r.worldSize,r.center.lat)/Math.min(r.width,r.height),$=f.bx(W,.9,.5,1,.25),K=(1-f.aq(-v))*Math.min(Y,$),ne=r.center.lat,Q=r.zoom,ie=new f.V(r.center.lng+S*K,f.an(r.center.lat+E*K,-f.ao,f.ao));r.setLocationAtPoint(h,l);const se=r.center,ee=f.bx(Math.abs(b),45,85,0,1),ce=f.bx(W,.75,.35,0,1),Me=Math.pow(Math.max(ee,ce),.25),_e=f.bK(se.lng,ie.lng),be=f.bK(se.lat,ie.lat);r.setCenter(new f.V(se.lng+_e*Me,se.lat+be*Me).wrap()),r.setZoom(Q+sn(ne,r.center.lat))}handleMapControlsPan(t,r,l){if(!t.panDelta)return;const h=r.center.lat,_=r.zoom;r.setCenter(vd(t.panDelta,r).wrap()),r.setZoom(_+sn(h,r.center.lat))}cameraForBoxAndBearing(t,r,l,h,_){const v=Io(t,r,l,h,_),b=r.left/_.width*2-1,S=(_.width-r.right)/_.width*2-1,E=r.top/_.height*-2+1,z=(_.height-r.bottom)/_.height*-2+1,R=f.bK(l.getWest(),l.getEast())<0,I=R?l.getEast():l.getWest(),F=R?l.getWest():l.getEast(),U=Math.max(l.getNorth(),l.getSouth()),Y=Math.min(l.getNorth(),l.getSouth()),W=I+.5*f.bK(I,F),$=U+.5*f.bK(U,Y),K=_.clone();K.setCenter(v.center),K.setBearing(v.bearing),K.setPitch(0),K.setRoll(0),K.setZoom(v.zoom);const ne=K.modelViewProjectionMatrix,Q=[Gi(l.getNorthWest()),Gi(l.getNorthEast()),Gi(l.getSouthWest()),Gi(l.getSouthEast()),Gi(new f.V(F,$)),Gi(new f.V(I,$)),Gi(new f.V(W,U)),Gi(new f.V(W,Y))],ie=Gi(v.center);let se=Number.POSITIVE_INFINITY;for(const ee of Q)b<0&&(se=fn.getLesserNonNegativeNonNull(se,fn.solveVectorScale(ee,ie,ne,"x",b))),S>0&&(se=fn.getLesserNonNegativeNonNull(se,fn.solveVectorScale(ee,ie,ne,"x",S))),E>0&&(se=fn.getLesserNonNegativeNonNull(se,fn.solveVectorScale(ee,ie,ne,"y",E))),z<0&&(se=fn.getLesserNonNegativeNonNull(se,fn.solveVectorScale(ee,ie,ne,"y",z)));if(Number.isFinite(se)&&se!==0)return v.zoom=K.zoom+f.at(se),v;xa()}handleJumpToCenterZoom(t,r){const l=t.center.lat,h=t.applyConstrain(r.center?f.V.convert(r.center):t.center,t.zoom).center;t.setCenter(h.wrap());const _=r.zoom!==void 0?+r.zoom:t.zoom+sn(l,h.lat);t.zoom!==_&&t.setZoom(_)}handleEaseTo(t,r){const l=t.zoom,h=t.center,_=t.padding,v={roll:t.roll,pitch:t.pitch,bearing:t.bearing},b={roll:r.roll===void 0?t.roll:r.roll,pitch:r.pitch===void 0?t.pitch:r.pitch,bearing:r.bearing===void 0?t.bearing:r.bearing},S=r.zoom!==void 0,E=!t.isPaddingEqual(r.padding);let z=!1;const R=r.center?f.V.convert(r.center):h,I=t.applyConstrain(R,l).center;Kr(t,I);const F=t.clone();F.setCenter(I),F.setZoom(S?+r.zoom:l+sn(h.lat,R.lat)),F.setBearing(r.bearing);const U=new f.P(f.an(t.centerPoint.x+r.offsetAsPoint.x,0,t.width),f.an(t.centerPoint.y+r.offsetAsPoint.y,0,t.height));F.setLocationAtPoint(I,U);const Y=(r.offset&&r.offsetAsPoint.mag())>0?F.center:I,W=S?+r.zoom:l+sn(h.lat,Y.lat),$=l+sn(h.lat,0),K=W+sn(Y.lat,0),ne=f.bK(h.lng,Y.lng),Q=f.bK(h.lat,Y.lat),ie=f.aq(K-$);return z=W!==l,{easeFunc:se=>{if(f.bo(v,b)||du({startEulerAngles:v,endEulerAngles:b,tr:t,k:se,useSlerp:v.roll!=b.roll}),E&&t.interpolatePadding(_,r.padding,se),r.around)f.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(r.around,r.aroundPoint);else{const ee=K>$?Math.min(2,ie):Math.max(.5,ie),ce=Math.pow(ee,1-se),Me=xd(h,ne,Q,se*ce);t.setCenter(Me.wrap())}if(z){const ee=f.G.number($,K,se)+sn(0,t.center.lat);t.setZoom(ee)}},isZooming:z,elevationCenter:Y}}handleFlyTo(t,r){const l=r.zoom!==void 0,h=t.center,_=t.zoom,v=t.padding,b=!t.isPaddingEqual(r.padding),S=t.applyConstrain(f.V.convert(r.center||r.locationAtOffset),_).center,E=l?+r.zoom:t.zoom+sn(t.center.lat,S.lat),z=t.clone();z.setCenter(S),z.setZoom(E),z.setBearing(r.bearing);const R=new f.P(f.an(t.centerPoint.x+r.offsetAsPoint.x,0,t.width),f.an(t.centerPoint.y+r.offsetAsPoint.y,0,t.height));z.setLocationAtPoint(S,R);const I=z.center;Kr(t,I);const F=(function(Q,ie,se){const ee=Gi(ie),ce=Gi(se),Me=f.b5(ee,ce),_e=Math.acos(Me),be=ba(Q);return _e/(2*Math.PI)*be})(t,h,I),U=_+sn(h.lat,0),Y=E+sn(I.lat,0),W=f.aq(Y-U);let $;if(typeof r.minZoom=="number"){const Q=+r.minZoom+sn(I.lat,0),ie=Math.min(Q,U,Y)+sn(0,I.lat),se=t.applyConstrain(I,ie).zoom+sn(I.lat,0);$=f.aq(se-U)}const K=f.bK(h.lng,I.lng),ne=f.bK(h.lat,I.lat);return{easeFunc:(Q,ie,se,ee)=>{const ce=xd(h,K,ne,se);b&&t.interpolatePadding(v,r.padding,Q);const Me=Q===1?I:ce;t.setCenter(Me.wrap());const _e=U+f.at(ie);t.setZoom(Q===1?E:_e+sn(0,Me.lat))},scaleOfZoom:W,targetCenter:I,scaleOfMinZoom:$,pixelPathLength:F}}static solveVectorScale(t,r,l,h,_){const v=h==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],b=[l[3],l[7],l[11],l[15]],S=t[0]*v[0]+t[1]*v[1]+t[2]*v[2],E=t[0]*b[0]+t[1]*b[1]+t[2]*b[2],z=r[0]*v[0]+r[1]*v[1]+r[2]*v[2],R=r[0]*b[0]+r[1]*b[1]+r[2]*b[2];return z+_*E===S+_*R||b[3]*(S-z)+v[3]*(R-E)+S*R==z*E?null:(z+v[3]-_*R-_*b[3])/(z-S-_*R+_*E)}static getLesserNonNegativeNonNull(t,r){return r!==null&&r>=0&&r<t?r:t}}class Cl{constructor(t){this._globe=t,this._mercatorCameraHelper=new Ro,this._verticalPerspectiveCameraHelper=new fn}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,r){return this.currentHelper.handlePanInertia(t,r)}handleMapControlsRollPitchBearingZoom(t,r){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,r)}handleMapControlsPan(t,r,l){this.currentHelper.handleMapControlsPan(t,r,l)}cameraForBoxAndBearing(t,r,l,h,_){return this.currentHelper.cameraForBoxAndBearing(t,r,l,h,_)}handleJumpToCenterZoom(t,r){this.currentHelper.handleJumpToCenterZoom(t,r)}handleEaseTo(t,r){return this.currentHelper.handleEaseTo(t,r)}handleFlyTo(t,r){return this.currentHelper.handleFlyTo(t,r)}}const zl=(m,t)=>f.B(m,t&&t.filter((r=>r.identifier!=="source.canvas"))),Dl=f.bO();class no extends f.E{constructor(t,r={}){var l,h;super(),this._rtlPluginLoaded=()=>{for(const v in this.tileManagers){const b=this.tileManagers[v].getSource().type;b!=="vector"&&b!=="geojson"||this.tileManagers[v].reload()}},this.map=t,this.dispatcher=new ga(Bi(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((v,b)=>this.getGlyphs(v,b))),this.dispatcher.registerMessageHandler("GI",((v,b)=>this.getImages(v,b))),this.dispatcher.registerMessageHandler("GDA",((v,b)=>this.getDashes(v,b))),this.imageManager=new en,this.imageManager.setEventedParent(this);const _=((l=t._container)===null||l===void 0?void 0:l.lang)||typeof document<"u"&&((h=document.documentElement)===null||h===void 0?void 0:h.lang)||void 0;this.glyphManager=new Ke(t._requestManager,r.localIdeographFontFamily,_),this.lineAtlas=new st(256,512),this.crossTileSymbolIndex=new In,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",f.bP()),fe().on(re,this._rtlPluginLoaded),this.on("data",(v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const b=this.tileManagers[v.sourceId];if(!b)return;const S=b.getSource();if(S&&S.vectorLayerIds)for(const E in this._layers){const z=this._layers[E];z.source===S.id&&this._validateLayer(z)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new f.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,r){var l,h,_;this._checkLoaded();const v=r===null?(_=(h=(l=this.stylesheet.state)===null||l===void 0?void 0:l[t])===null||h===void 0?void 0:h.default)!==null&&_!==void 0?_:null:r;if(f.bR(v,this._globalState[t]))return this;this._globalState[t]=v,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const r=[];for(const l in t)!f.bR(this._globalState[l],t[l].default)&&(r.push(l),this._globalState[l]=t[l].default);this._applyGlobalStateChanges(r)}_applyGlobalStateChanges(t){if(t.length===0)return;const r=new Set,l={};for(const h of t){l[h]=this._globalState[h];for(const _ in this._layers){const v=this._layers[_],b=v.getLayoutAffectingGlobalStateRefs(),S=v.getPaintAffectingGlobalStateRefs(),E=v.getVisibilityAffectingGlobalStateRefs();if(b.has(h)&&r.add(v.source),S.has(h))for(const{name:z,value:R}of S.get(h))this._updatePaintProperty(v,z,R);E?.has(h)&&(v.recalculateVisibility(),this._updateLayer(v))}}this.dispatcher.broadcast("UGS",l);for(const h in this.tileManagers)r.has(h)&&(this._reloadSource(h),this._changed=!0)}loadURL(t,r={},l){this.fire(new f.l("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const h=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const _=this._loadStyleRequest;f.j(h,this._loadStyleRequest).then((v=>{this._loadStyleRequest=null,this._load(v.data,r,l)})).catch((v=>{this._loadStyleRequest=null,v&&!_.signal.aborted&&this.fire(new f.k(v))}))}loadJSON(t,r={},l){this.fire(new f.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Xt.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,r.validate=r.validate!==!1,this._load(t,r,l)})).catch((()=>{}))}loadEmpty(){this.fire(new f.l("dataloading",{dataType:"style"})),this._load(Dl,{validate:!1})}_load(t,r,l){var h,_;let v=r.transformStyle?r.transformStyle(l,t):t;if(!r.validate||!zl(this,f.C(v))){v=Object.assign({},v),this._loaded=!0,this.stylesheet=v;for(const b in v.sources)this.addSource(b,v.sources[b],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new li(this.stylesheet.light),this._setProjectionInternal(((h=this.stylesheet.projection)===null||h===void 0?void 0:h.type)||"mercator"),this.sky=new Ge(this.stylesheet.sky),this.map.setTerrain((_=this.stylesheet.terrain)!==null&&_!==void 0?_:null),this.fire(new f.l("data",{dataType:"style"})),this.fire(new f.l("style.load"))}}_createLayers(){var t,r,l;const h=f.bS(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",h),this._order=h.map((_=>_.id)),this._layers={},this._serializedLayers=null;for(const _ of h){const v=f.bT(_,this._globalState);if(v.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=v,f.bU(v)&&this.tileManagers[v.source]){const b=(l=(r=_.paint)===null||r===void 0?void 0:r["raster-fade-duration"])!==null&&l!==void 0?l:v.paint.get("raster-fade-duration");this.tileManagers[v.source].setRasterFadeDuration(b)}}}_loadSprite(t,r=!1,l=void 0){this.imageManager.setLoaded(!1);const h=new AbortController;let _;this._spriteRequest=h,(function(v,b,S,E){return f._(this,void 0,void 0,(function*(){const z=Kn(v),R=S>1?"@2x":"",I={},F={};for(const{id:U,url:Y}of z){const W=b.transformRequest(Ma(Y,R,".json"),"SpriteJSON");I[U]=f.j(W,E);const $=b.transformRequest(Ma(Y,R,".png"),"SpriteImage");F[U]=It.getImage($,E)}return yield Promise.all([...Object.values(I),...Object.values(F)]),(function(U,Y){return f._(this,void 0,void 0,(function*(){const W={};for(const $ in U){W[$]={};const K=Xt.getImageCanvasContext((yield Y[$]).data),ne=(yield U[$]).data;for(const Q in ne){const{width:ie,height:se,x:ee,y:ce,sdf:Me,pixelRatio:_e,stretchX:be,stretchY:we,content:Xe,textFitWidth:Ye,textFitHeight:Ne}=ne[Q];W[$][Q]={data:null,pixelRatio:_e,sdf:Me,stretchX:be,stretchY:we,content:Xe,textFitWidth:Ye,textFitHeight:Ne,spriteData:{width:ie,height:se,x:ee,y:ce,context:K}}}}return W}))})(I,F)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((v=>{if(this._spriteRequest=null,v)for(const b in v){this._spritesImagesIds[b]=[];const S=this._spritesImagesIds[b]?this._spritesImagesIds[b].filter((E=>!(E in v))):[];for(const E of S)this.imageManager.removeImage(E),this._changedImages[E]=!0;for(const E in v[b]){const z=b==="default"?E:`${b}:${E}`;this._spritesImagesIds[b].push(z),z in this.imageManager.images?this.imageManager.updateImage(z,v[b][E],!1):this.imageManager.addImage(z,v[b][E]),r&&(this._changedImages[z]=!0)}}})).catch((v=>{this._spriteRequest=null,_=v,h.signal.aborted||this.fire(new f.k(_))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new f.l("data",{dataType:"style"})),l&&l(_)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new f.l("data",{dataType:"style"}))}_validateLayer(t){const r=this.tileManagers[t.source];if(!r)return;const l=t.sourceLayer;if(!l)return;const h=r.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(l)===-1)&&this.fire(new f.k(new Error(`Source layer "${l}" does not exist on source "${h.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,r=!1){const l=this._serializedAllLayers();if(!t||t.length===0)return Object.values(r?f.bV(l):l);const h=[];for(const _ of t)if(l[_]){const v=r?f.bV(l[_]):l[_];h.push(v)}return h}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const r=Object.keys(this._layers);for(const l of r){const h=this._layers[l];h.type!=="custom"&&(t[l]=h.serialize())}return t}hasTransitions(){var t,r,l;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((r=this.sky)===null||r===void 0)&&r.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const h in this.tileManagers)if(this.tileManagers[h].hasTransition())return!0;for(const h in this._layers)if(this._layers[h].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const r=this._changed;if(r){const h=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(h.length||_.length)&&this._updateWorkerLayers(h,_);for(const v in this._updatedSources){const b=this._updatedSources[v];if(b==="reload")this._reloadSource(v);else{if(b!=="clear")throw new Error(`Invalid action ${b}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const l={};for(const h in this.tileManagers){const _=this.tileManagers[h];l[h]=_.used,_.used=!1}for(const h of this._order){const _=this._layers[h];_.recalculate(t,this._availableImages),!_.isHidden(t.zoom)&&_.source&&(this.tileManagers[_.source].used=!0)}for(const h in l){const _=this.tileManagers[h];!!l[h]!=!!_.used&&_.fire(new f.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,r&&this.fire(new f.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const r in this.tileManagers)this.tileManagers[r].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,r){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,r={}){var l;this._checkLoaded();const h=this.serialize();if(t=r.transformStyle?r.transformStyle(h,t):t,((l=r.validate)===null||l===void 0||l)&&zl(this,f.C(t)))return!1;(t=f.bV(t)).layers=f.bS(t.layers);const _=f.bW(h,t),v=this._getOperationsToPerform(_);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(const b of v.operations)b();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const r=[],l=[];for(const h of t)switch(h.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":r.push((()=>this.addLayer.apply(this,h.args)));break;case"removeLayer":r.push((()=>this.removeLayer.apply(this,h.args)));break;case"setPaintProperty":r.push((()=>this.setPaintProperty.apply(this,h.args)));break;case"setLayoutProperty":r.push((()=>this.setLayoutProperty.apply(this,h.args)));break;case"setFilter":r.push((()=>this.setFilter.apply(this,h.args)));break;case"addSource":r.push((()=>this.addSource.apply(this,h.args)));break;case"removeSource":r.push((()=>this.removeSource.apply(this,h.args)));break;case"setLayerZoomRange":r.push((()=>this.setLayerZoomRange.apply(this,h.args)));break;case"setLight":r.push((()=>this.setLight.apply(this,h.args)));break;case"setGeoJSONSourceData":r.push((()=>this.setGeoJSONSourceData.apply(this,h.args)));break;case"setGlyphs":r.push((()=>this.setGlyphs.apply(this,h.args)));break;case"setSprite":r.push((()=>this.setSprite.apply(this,h.args)));break;case"setTerrain":r.push((()=>this.map.setTerrain.apply(this,h.args)));break;case"setSky":r.push((()=>this.setSky.apply(this,h.args)));break;case"setProjection":this.setProjection.apply(this,h.args);break;case"setGlobalState":r.push((()=>this.setGlobalState.apply(this,h.args)));break;case"setTransition":r.push((()=>{}));break;default:l.push(h.command)}return{operations:r,unimplemented:l}}addImage(t,r){if(this.getImage(t))return this.fire(new f.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,r),this._afterImageUpdated(t)}updateImage(t,r){this.imageManager.updateImage(t,r)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new f.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new f.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,r,l={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(f.C.source,`sources.${t}`,r,null,l))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const h=this.tileManagers[t]=new Ri(t,r,this.dispatcher);h.style=this,h.setEventedParent(this,(()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:t}))),h.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new f.k(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));const r=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],r.fire(new f.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,r){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const l=this.tileManagers[t].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(r),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,r,l={}){this._checkLoaded();const h=t.id;if(this.getLayer(h))return void this.fire(new f.k(new Error(`Layer "${h}" already exists on this map.`)));let _;if(t.type==="custom"){if(zl(this,f.bX(t)))return;_=f.bT(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(h,t.source),t=f.bV(t),t=f.e(t,{source:h})),this._validate(f.C.layer,`layers.${h}`,t,{arrayIndex:-1},l))return;_=f.bT(t,this._globalState),this._validateLayer(_),_.setEventedParent(this,{layer:{id:h}})}const v=r?this._order.indexOf(r):this._order.length;if(r&&v===-1)this.fire(new f.k(new Error(`Cannot add layer "${h}" before non-existing layer "${r}".`)));else{if(this._order.splice(v,0,h),this._layerOrderChanged=!0,this._layers[h]=_,this._removedLayers[h]&&_.source&&_.type!=="custom"){const b=this._removedLayers[h];delete this._removedLayers[h],b.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.tileManagers[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(t,r){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new f.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===r)return;const l=this._order.indexOf(t);this._order.splice(l,1);const h=r?this._order.indexOf(r):this._order.length;r&&h===-1?this.fire(new f.k(new Error(`Cannot move layer "${t}" before non-existing layer "${r}".`))):(this._order.splice(h,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const r=this._layers[t];if(!r)return void this.fire(new f.k(new Error(`Cannot remove non-existing layer "${t}".`)));r.setEventedParent(null);const l=this._order.indexOf(t);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=r,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],r.onRemove&&r.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,r,l){this._checkLoaded();const h=this.getLayer(t);h?h.minzoom===r&&h.maxzoom===l||(r!=null&&(h.minzoom=r),l!=null&&(h.maxzoom=l),this._updateLayer(h)):this.fire(new f.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,r,l={}){this._checkLoaded();const h=this.getLayer(t);if(h){if(!f.bR(h.filter,r))return r==null?(h.setFilter(void 0),void this._updateLayer(h)):void(this._validate(f.C.filter,`layers.${h.id}.filter`,r,null,l)||(h.setFilter(f.bV(r)),this._updateLayer(h)))}else this.fire(new f.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return f.bV(this.getLayer(t).filter)}setLayoutProperty(t,r,l,h={}){this._checkLoaded();const _=this.getLayer(t);_?f.bR(_.getLayoutProperty(r),l)||(_.setLayoutProperty(r,l,h),this._updateLayer(_)):this.fire(new f.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,r){const l=this.getLayer(t);if(l)return l.getLayoutProperty(r);this.fire(new f.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,r,l,h={}){this._checkLoaded();const _=this.getLayer(t);_?f.bR(_.getPaintProperty(r),l)||this._updatePaintProperty(_,r,l,h):this.fire(new f.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,r,l,h={}){t.setPaintProperty(r,l,h)&&this._updateLayer(t),f.bU(t)&&r==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(l),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,r){return this.getLayer(t).getPaintProperty(r)}setFeatureState(t,r){this._checkLoaded();const l=t.source,h=t.sourceLayer,_=this.tileManagers[l];if(_===void 0)return void this.fire(new f.k(new Error(`The source '${l}' does not exist in the map's style.`)));const v=_.getSource().type;v==="geojson"&&h?this.fire(new f.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||h?(t.id===void 0&&this.fire(new f.k(new Error("The feature id parameter must be provided."))),_.setFeatureState(h,t.id,r)):this.fire(new f.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,r){this._checkLoaded();const l=t.source,h=this.tileManagers[l];if(h===void 0)return void this.fire(new f.k(new Error(`The source '${l}' does not exist in the map's style.`)));const _=h.getSource().type,v=_==="vector"?t.sourceLayer:void 0;_!=="vector"||v?r&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new f.k(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(v,t.id,r):this.fire(new f.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const r=t.source,l=t.sourceLayer,h=this.tileManagers[r];if(h!==void 0)return h.getSource().type!=="vector"||l?(t.id===void 0&&this.fire(new f.k(new Error("The feature id parameter must be provided."))),h.getFeatureState(l,t.id)):void this.fire(new f.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new f.k(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return f.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=f.bY(this.tileManagers,(_=>_.serialize())),r=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,h=this.stylesheet;return f.bZ({version:h.version,name:h.name,metadata:h.metadata,light:h.light,sky:h.sky,center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,sprite:h.sprite,glyphs:h.glyphs,transition:h.transition,projection:h.projection,sources:t,layers:r,terrain:l},(_=>_!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const r=v=>this._layers[v].type==="fill-extrusion",l={},h=[];for(let v=this._order.length-1;v>=0;v--){const b=this._order[v];if(r(b)){l[b]=v;for(const S of t){const E=S[b];if(E)for(const z of E)h.push(z)}}}h.sort(((v,b)=>b.intersectionZ-v.intersectionZ));const _=[];for(let v=this._order.length-1;v>=0;v--){const b=this._order[v];if(r(b))for(let S=h.length-1;S>=0;S--){const E=h[S].feature;if(l[E.layer.id]<v)break;_.push(E),h.pop()}else for(const S of t){const E=S[b];if(E)for(const z of E)_.push(z.feature)}}return _}queryRenderedFeatures(t,r,l){r&&r.filter&&this._validate(f.C.filter,"queryRenderedFeatures.filter",r.filter,null,r);const h={};if(r&&r.layers){if(!(Array.isArray(r.layers)||r.layers instanceof Set))return this.fire(new f.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const E of r.layers){const z=this._layers[E];if(!z)return this.fire(new f.k(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];h[z.source]=!0}}const _=[];r.availableImages=this._availableImages;const v=this._serializedAllLayers(),b=r.layers instanceof Set?r.layers:Array.isArray(r.layers)?new Set(r.layers):null,S=Object.assign(Object.assign({},r),{layers:b,globalState:this._globalState});for(const E in this.tileManagers)r.layers&&!h[E]||_.push(gl(this.tileManagers[E],this._layers,v,t,S,l,this.map.terrain?(z,R,I)=>this.map.terrain.getElevation(z,R,I):void 0));return this.placement&&_.push((function(E,z,R,I,F,U,Y){const W={},$=U.queryRenderedSymbols(I),K=[];for(const ne of Object.keys($).map(Number))K.push(Y[ne]);K.sort($i);for(const ne of K){const Q=ne.featureIndex.lookupSymbolFeatures($[ne.bucketInstanceId],z,ne.bucketIndex,ne.sourceLayerIndex,{filterSpec:F.filter,globalState:F.globalState},F.layers,F.availableImages,E);for(const ie in Q){const se=W[ie]=W[ie]||[],ee=Q[ie];ee.sort(((ce,Me)=>{const _e=ne.featureSortOrder;if(_e){const be=_e.indexOf(ce.featureIndex);return _e.indexOf(Me.featureIndex)-be}return Me.featureIndex-ce.featureIndex}));for(const ce of ee)se.push(ce)}}return(function(ne,Q,ie){for(const se in ne)for(const ee of ne[se])Aa(ee,ie[Q[se].source]);return ne})(W,E,R)})(this._layers,v,this.tileManagers,t,S,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(t,r){r?.filter&&this._validate(f.C.filter,"querySourceFeatures.filter",r.filter,null,r);const l=this.tileManagers[t];return l?(function(h,_){const v=h.getRenderableIds().map((E=>h.getTileByID(E))),b=[],S={};for(let E=0;E<v.length;E++){const z=v[E],R=z.tileID.canonical.key;S[R]||(S[R]=!0,z.querySourceFeatures(b,_))}return b})(l,r?Object.assign(Object.assign({},r),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,r={}){this._checkLoaded();const l=this.light.getLight();let h=!1;for(const v in t)if(!f.bR(t[v],l[v])){h=!0;break}if(!h)return;const _={now:bt(),transition:f.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,r),this.light.updateTransitions(_)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,r={}){this._checkLoaded();const l=this.getSky();let h=!1;if(!t&&!l)return;if(t&&!l)h=!0;else if(!t&&l)h=!0;else for(const v in t)if(!f.bR(t[v],l[v])){h=!0;break}if(!h)return;const _={now:bt(),transition:f.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,r),this.sky.updateTransitions(_)}_setProjectionInternal(t){const r=(function(l,h){const _={constrainOverride:h};if(Array.isArray(l)){const v=new lh({type:l});return{projection:v,transform:new El(_),cameraHelper:new Cl(v)}}switch(l){case"mercator":return{projection:new Rn,transform:new An(_),cameraHelper:new Ro};case"globe":{const v=new lh({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:v,transform:new El(_),cameraHelper:new Cl(v)}}case"vertical-perspective":return{projection:new oh,transform:new Al(_),cameraHelper:new fn};default:return f.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new Rn,transform:new An(_),cameraHelper:new Ro}}})(t,this.map.transformConstrain);this.projection=r.projection,this.map.migrateProjection(r.transform,r.cameraHelper);for(const l in this.tileManagers)this.tileManagers[l].reload()}_validate(t,r,l,h,_={}){return(!_||_.validate!==!1)&&zl(this,t.call(f.C,f.e({key:r,style:this.serialize(),value:l,styleSpec:f.u},h)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),fe().off(re,this._rtlPluginLoaded);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.tileManagers){const l=this.tileManagers[r];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const r in this.tileManagers)this.tileManagers[r].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,r,l,h,_=!1){let v=!1,b=!1;const S={};for(const E of this._order){const z=this._layers[E];if(z.type!=="symbol")continue;if(!S[z.source]){const I=this.tileManagers[z.source];S[z.source]=I.getRenderableIds(!0).map((F=>I.getTileByID(F))).sort(((F,U)=>U.tileID.overscaledZ-F.tileID.overscaledZ||(F.tileID.isLessThan(U.tileID)?-1:1)))}const R=this.crossTileSymbolIndex.addLayer(z,S[z.source],t.center.lng);v=v||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(bt(),t.zoom))&&(this.pauseablePlacement=new Tl(t,this.map.terrain,this._order,_,r,l,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(bt()),b=!0),v&&this.pauseablePlacement.placement.setStale()),b||v)for(const E of this._order){const z=this._layers[E];z.type==="symbol"&&this.placement.updateLayerOpacities(z,S[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(bt())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,r){return f._(this,void 0,void 0,(function*(){const l=yield this.imageManager.getImages(r.icons);this._updateTilesForChangedImages();const h=this.tileManagers[r.source];return h&&h.setDependencies(r.tileID.key,r.type,r.icons),l}))}getGlyphs(t,r){return f._(this,void 0,void 0,(function*(){const l=yield this.glyphManager.getGlyphs(r.stacks),h=this.tileManagers[r.source];return h&&h.setDependencies(r.tileID.key,r.type,[""]),l}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,r={}){this._checkLoaded(),t&&this._validate(f.C.glyphs,"glyphs",t,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,r){return f._(this,void 0,void 0,(function*(){const l={};for(const[h,_]of Object.entries(r.dashes))l[h]=this.lineAtlas.getDash(_.dasharray,_.round);return l}))}addSprite(t,r,l={},h){this._checkLoaded();const _=[{id:t,url:r}],v=[...Kn(this.stylesheet.sprite),..._];this._validate(f.C.sprite,"sprite",v,null,l)||(this.stylesheet.sprite=v,this._loadSprite(_,!0,h))}removeSprite(t){this._checkLoaded();const r=Kn(this.stylesheet.sprite);if(r.find((l=>l.id===t))){if(this._spritesImagesIds[t])for(const l of this._spritesImagesIds[t])this.imageManager.removeImage(l),this._changedImages[l]=!0;r.splice(r.findIndex((l=>l.id===t)),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new f.l("data",{dataType:"style"}))}else this.fire(new f.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Kn(this.stylesheet.sprite)}setSprite(t,r={},l){this._checkLoaded(),t&&this._validate(f.C.sprite,"sprite",t,null,r)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,l):(this._unloadSprite(),l&&l(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const r=this.tileManagers[t];r.setEventedParent(null),r.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const r=this._layers[t];r.setEventedParent(null),r.onRemove&&r.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var bd=f.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class yu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,r,l,h,_,v,b,S,E){this.context=t;let z=this.boundPaintVertexBuffers.length!==h.length;for(let R=0;!z&&R<h.length;R++)this.boundPaintVertexBuffers[R]!==h[R]&&(z=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==l||z||this.boundIndexBuffer!==_||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==b||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==E?this.freshBind(r,l,h,_,v,b,S,E):(t.bindVertexArray.set(this.vao),b&&b.bind(),_&&_.dynamicDraw&&_.bind(),S&&S.bind(),E&&E.bind())}freshBind(t,r,l,h,_,v,b,S){const E=t.numAttributes,z=this.context,R=z.gl;this.vao&&this.destroy(),this.vao=z.createVertexArray(),z.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=h,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=b,this.boundDynamicVertexBuffer3=S,r.enableAttributes(R,t);for(const I of l)I.enableAttributes(R,t);v&&v.enableAttributes(R,t),b&&b.enableAttributes(R,t),S&&S.enableAttributes(R,t),r.bind(),r.setVertexAttribPointers(R,t,_);for(const I of l)I.bind(),I.setVertexAttribPointers(R,t,_);v&&(v.bind(),v.setVertexAttribPointers(R,t,_)),h&&h.bind(),b&&(b.bind(),b.setVertexAttribPointers(R,t,_)),S&&(S.bind(),S.setVertexAttribPointers(R,t,_)),z.currentNumAttributes=E}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const wd=(m,t,r,l,h)=>({u_texture:0,u_ele_delta:m,u_fog_matrix:t,u_fog_color:r?r.properties.get("fog-color"):f.bp.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:h?0:r?r.calculateFogBlendOpacity(l):0,u_horizon_color:r?r.properties.get("horizon-color"):f.bp.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1,u_is_globe_mode:h?1:0}),Pr={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function cc(m){const t=[];for(let r=0;r<m.length;r++){if(m[r]===null)continue;const l=m[r].split(" ");t.push(l.pop())}return t}class Td{constructor(t,r,l,h,_,v,b,S,E=[]){const z=t.gl;this.program=z.createProgram();const R=cc(r.staticAttributes),I=l?l.getBinderAttributes():[],F=R.concat(I),U=Vi.prelude.staticUniforms?cc(Vi.prelude.staticUniforms):[],Y=b.staticUniforms?cc(b.staticUniforms):[],W=r.staticUniforms?cc(r.staticUniforms):[],$=l?l.getBinderUniforms():[],K=U.concat(Y).concat(W).concat($),ne=[];for(const _e of K)ne.indexOf(_e)<0&&ne.push(_e);const Q=l?l.defines():[];ur(z)&&Q.unshift("#version 300 es"),_&&Q.push("#define OVERDRAW_INSPECTOR;"),v&&Q.push("#define TERRAIN3D;"),S&&Q.push(S),E&&Q.push(...E);let ie=Q.concat(Vi.prelude.fragmentSource,b.fragmentSource,r.fragmentSource).join(`
`),se=Q.concat(Vi.prelude.vertexSource,b.vertexSource,r.vertexSource).join(`
`);ur(z)||(ie=(function(_e){return _e.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(ie),se=(function(_e){return _e.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(se));const ee=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(ee,ie),z.compileShader(ee),!z.getShaderParameter(ee,z.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${z.getShaderInfoLog(ee)}`);z.attachShader(this.program,ee);const ce=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(ce,se),z.compileShader(ce),!z.getShaderParameter(ce,z.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${z.getShaderInfoLog(ce)}`);z.attachShader(this.program,ce),this.attributes={};const Me={};this.numAttributes=F.length;for(let _e=0;_e<this.numAttributes;_e++)F[_e]&&(z.bindAttribLocation(this.program,_e,F[_e]),this.attributes[F[_e]]=_e);if(z.linkProgram(this.program),!z.getProgramParameter(this.program,z.LINK_STATUS))throw new Error(`Program failed to link: ${z.getProgramInfoLog(this.program)}`);z.deleteShader(ce),z.deleteShader(ee);for(let _e=0;_e<ne.length;_e++){const be=ne[_e];if(be&&!Me[be]){const we=z.getUniformLocation(this.program,be);we&&(Me[be]=we)}}this.fixedUniforms=h(t,Me),this.terrainUniforms=((_e,be)=>({u_depth:new f.b_(_e,be.u_depth),u_terrain:new f.b_(_e,be.u_terrain),u_terrain_dim:new f.bq(_e,be.u_terrain_dim),u_terrain_matrix:new f.c0(_e,be.u_terrain_matrix),u_terrain_unpack:new f.c1(_e,be.u_terrain_unpack),u_terrain_exaggeration:new f.bq(_e,be.u_terrain_exaggeration)}))(t,Me),this.projectionUniforms=((_e,be)=>({u_projection_matrix:new f.c0(_e,be.u_projection_matrix),u_projection_tile_mercator_coords:new f.c1(_e,be.u_projection_tile_mercator_coords),u_projection_clipping_plane:new f.c1(_e,be.u_projection_clipping_plane),u_projection_transition:new f.bq(_e,be.u_projection_transition),u_projection_fallback_matrix:new f.c0(_e,be.u_projection_fallback_matrix)}))(t,Me),this.binderUniforms=l?l.getUniforms(t,Me):[]}draw(t,r,l,h,_,v,b,S,E,z,R,I,F,U,Y,W,$,K,ne){const Q=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(l),t.setStencilMode(h),t.setColorMode(_),t.setCullFace(v),S){t.activeTexture.set(Q.TEXTURE2),Q.bindTexture(Q.TEXTURE_2D,S.depthTexture),t.activeTexture.set(Q.TEXTURE3),Q.bindTexture(Q.TEXTURE_2D,S.texture);for(const se in this.terrainUniforms)this.terrainUniforms[se].set(S[se])}if(E)for(const se in E)this.projectionUniforms[Pr[se]].set(E[se]);if(b)for(const se in this.fixedUniforms)this.fixedUniforms[se].set(b[se]);W&&W.setUniforms(t,this.binderUniforms,U,{zoom:Y});let ie=0;switch(r){case Q.LINES:ie=2;break;case Q.TRIANGLES:ie=3;break;case Q.LINE_STRIP:ie=1}for(const se of F.get()){const ee=se.vaos||(se.vaos={});(ee[z]||(ee[z]=new yu)).bind(t,this,R,W?W.getPaintVertexBuffers():[],I,se.vertexOffset,$,K,ne),Q.drawElements(r,se.primitiveLength*ie,Q.UNSIGNED_SHORT,se.primitiveOffset*ie*2)}}}function Sd(m,t,r){const l=1/f.aN(r,1,t.transform.tileZoom),h=Math.pow(2,r.tileID.overscaledZ),_=r.tileSize*Math.pow(2,t.transform.tileZoom)/h,v=_*(r.tileID.canonical.x+r.tileID.wrap*h),b=_*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[l,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[v>>16,b>>16],u_pixel_coord_lower:[65535&v,65535&b]}}const hc=(m,t,r,l)=>{const h=m.style.light,_=h.properties.get("position"),v=[_.x,_.y,_.z],b=f.c4();h.properties.get("anchor")==="viewport"&&f.c5(b,m.transform.bearingInRadians),f.c6(v,v,b);const S=m.transform.transformLightDirection(v),E=h.properties.get("color");return{u_lightpos:v,u_lightpos_globe:S,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+t,u_opacity:r,u_fill_translate:l}},dc=(m,t,r,l,h,_,v)=>f.e(hc(m,t,r,l),Sd(_,m,v),{u_height_factor:-Math.pow(2,h.overscaledZ)/v.tileSize/8}),ko=(m,t,r,l)=>f.e(Sd(t,m,r),{u_fill_translate:l}),Pl=(m,t)=>({u_world:m,u_fill_translate:t}),Md=(m,t,r,l,h)=>f.e(ko(m,t,r,h),{u_world:l}),vu=(m,t,r,l,h)=>{const _=m.transform;let v,b,S=0;if(r.paint.get("circle-pitch-alignment")==="map"){const E=f.aN(t,1,_.zoom);v=!0,b=[E,E],S=E/(f.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*h}else v=!1,b=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(r.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+v,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:b,u_globe_extrude_scale:S,u_translate:l}},ao=m=>({u_pixel_extrude_scale:[1/m.width,1/m.height]}),ch=m=>({u_viewport_size:[m.width,m.height]}),xu=(m,t=1)=>({u_color:m,u_overlay:0,u_overlay_scale:t}),ro=(m,t,r,l)=>{const h=f.aN(m,1,t)/(f.a5*Math.pow(2,m.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:f.aN(m,1,t),u_intensity:r,u_globe_extrude_scale:h}},hh=(m,t,r,l)=>{const h=f.N();f.c7(h,0,m.width,m.height,0,0,1);const _=m.context.gl;return{u_matrix:h,u_world:[_.drawingBufferWidth,_.drawingBufferHeight],u_image:r,u_color_ramp:l,u_opacity:t.paint.get("heatmap-opacity")}},bu=(m,t,r)=>{const l=r.paint.get("hillshade-accent-color");let h;switch(r.paint.get("hillshade-method")){case"basic":h=4;break;case"combined":h=1;break;case"igor":h=2;break;case"multidirectional":h=3;break;default:h=0}const _=r.getIlluminationProperties();for(let v=0;v<_.directionRadians.length;v++)r.paint.get("hillshade-illumination-anchor")==="viewport"&&(_.directionRadians[v]+=m.transform.bearingInRadians);return{u_image:0,u_latrange:Ff(0,t.tileID),u_exaggeration:r.paint.get("hillshade-exaggeration"),u_altitudes:_.altitudeRadians,u_azimuths:_.directionRadians,u_accent:l,u_method:h,u_highlights:_.highlightColor,u_shadows:_.shadowColor}},Ad=(m,t)=>{const r=t.stride,l=f.N();return f.c7(l,0,f.a5,-f.a5,0,0,1),f.O(l,l,[0,-f.a5,0]),{u_matrix:l,u_image:1,u_dimension:[r,r],u_zoom:m.overscaledZ,u_unpack:t.getUnpackVector()}};function Ff(m,t){const r=Math.pow(2,t.canonical.z),l=t.canonical.y;return[new f.a9(0,l/r).toLngLat().lat,new f.a9(0,(l+1)/r).toLngLat().lat]}const Ed=(m,t,r=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:r,u_opacity:m.paint.get("color-relief-opacity")}),wu=(m,t,r,l)=>{const h=m.transform;return{u_translation:Tu(m,t,r),u_ratio:l/f.aN(t,1,h.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Cd=(m,t,r,l,h)=>f.e(wu(m,t,r,l),{u_image:0,u_image_height:h}),dh=(m,t,r,l,h)=>{const _=m.transform,v=cr(t,_);return{u_translation:Tu(m,t,r),u_texsize:t.imageAtlasTexture.size,u_ratio:l/f.aN(t,1,_.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[v,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},Ca=(m,t,r,l,h)=>{const _=cr(t,m.transform);return f.e(wu(m,t,r,l),{u_tileratio:_,u_crossfade_from:h.fromScale,u_crossfade_to:h.toScale,u_image:0,u_mix:h.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})},so=(m,t,r,l,h,_)=>{const v=cr(t,m.transform);return f.e(wu(m,t,r,l),{u_image:0,u_image_height:_,u_tileratio:v,u_crossfade_from:h.fromScale,u_crossfade_to:h.toScale,u_image_dash:1,u_mix:h.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})};function cr(m,t){return 1/f.aN(m,1,t.tileZoom)}function Tu(m,t,r){return f.aO(m.transform,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const fc=(m,t,r,l,h)=>{return{u_tl_parent:m,u_scale_parent:t,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(v=l.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(_=l.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:pc(l.paint.get("raster-hue-rotate")),u_coords_top:[h[0].x,h[0].y,h[1].x,h[1].y],u_coords_bottom:[h[3].x,h[3].y,h[2].x,h[2].y]};var _,v};function pc(m){m*=Math.PI/180;const t=Math.sin(m),r=Math.cos(m);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const Su=(m,t,r,l,h,_,v,b,S,E,z,R,I)=>{const F=v.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:F.cameraToCenterDistance,u_pitch:F.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:F.width/F.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_label_plane_matrix:b,u_coord_matrix:S,u_is_text:+z,u_pitch_with_map:+l,u_is_along_line:h,u_is_variable_anchor:_,u_texsize:R,u_texture:0,u_translation:E,u_pitched_scale:I}},mc=(m,t,r,l,h,_,v,b,S,E,z,R,I,F)=>{const U=v.transform;return f.e(Su(m,t,r,l,h,_,v,b,S,E,z,R,F),{u_gamma_scale:l?Math.cos(U.pitch*Math.PI/180)*U.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:1})},hr=(m,t,r,l,h,_,v,b,S,E,z,R,I)=>f.e(mc(m,t,r,l,h,_,v,b,S,E,!0,z,0,I),{u_texsize_icon:R,u_texture_icon:1}),Mu=(m,t)=>({u_opacity:m,u_color:t}),Au=(m,t,r,l,h)=>f.e((function(_,v,b,S){const E=b.imageManager.getPattern(_.from.toString()),z=b.imageManager.getPattern(_.to.toString()),{width:R,height:I}=b.imageManager.getPixelSize(),F=Math.pow(2,S.tileID.overscaledZ),U=S.tileSize*Math.pow(2,b.transform.tileZoom)/F,Y=U*(S.tileID.canonical.x+S.tileID.wrap*F),W=U*S.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:E.tl,u_pattern_br_a:E.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[R,I],u_mix:v.t,u_pattern_size_a:E.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:v.fromScale,u_scale_b:v.toScale,u_tile_units_to_pixels:1/f.aN(S,1,b.transform.tileZoom),u_pixel_coord_upper:[Y>>16,W>>16],u_pixel_coord_lower:[65535&Y,65535&W]}})(r,h,t,l),{u_opacity:m}),gc=(m,t)=>{},zd={fillExtrusion:(m,t)=>({u_lightpos:new f.c2(m,t.u_lightpos),u_lightpos_globe:new f.c2(m,t.u_lightpos_globe),u_lightintensity:new f.bq(m,t.u_lightintensity),u_lightcolor:new f.c2(m,t.u_lightcolor),u_vertical_gradient:new f.bq(m,t.u_vertical_gradient),u_opacity:new f.bq(m,t.u_opacity),u_fill_translate:new f.c3(m,t.u_fill_translate)}),fillExtrusionPattern:(m,t)=>({u_lightpos:new f.c2(m,t.u_lightpos),u_lightpos_globe:new f.c2(m,t.u_lightpos_globe),u_lightintensity:new f.bq(m,t.u_lightintensity),u_lightcolor:new f.c2(m,t.u_lightcolor),u_vertical_gradient:new f.bq(m,t.u_vertical_gradient),u_height_factor:new f.bq(m,t.u_height_factor),u_opacity:new f.bq(m,t.u_opacity),u_fill_translate:new f.c3(m,t.u_fill_translate),u_image:new f.b_(m,t.u_image),u_texsize:new f.c3(m,t.u_texsize),u_pixel_coord_upper:new f.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new f.c3(m,t.u_pixel_coord_lower),u_scale:new f.c2(m,t.u_scale),u_fade:new f.bq(m,t.u_fade)}),fill:(m,t)=>({u_fill_translate:new f.c3(m,t.u_fill_translate)}),fillPattern:(m,t)=>({u_image:new f.b_(m,t.u_image),u_texsize:new f.c3(m,t.u_texsize),u_pixel_coord_upper:new f.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new f.c3(m,t.u_pixel_coord_lower),u_scale:new f.c2(m,t.u_scale),u_fade:new f.bq(m,t.u_fade),u_fill_translate:new f.c3(m,t.u_fill_translate)}),fillOutline:(m,t)=>({u_world:new f.c3(m,t.u_world),u_fill_translate:new f.c3(m,t.u_fill_translate)}),fillOutlinePattern:(m,t)=>({u_world:new f.c3(m,t.u_world),u_image:new f.b_(m,t.u_image),u_texsize:new f.c3(m,t.u_texsize),u_pixel_coord_upper:new f.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new f.c3(m,t.u_pixel_coord_lower),u_scale:new f.c2(m,t.u_scale),u_fade:new f.bq(m,t.u_fade),u_fill_translate:new f.c3(m,t.u_fill_translate)}),circle:(m,t)=>({u_camera_to_center_distance:new f.bq(m,t.u_camera_to_center_distance),u_scale_with_map:new f.b_(m,t.u_scale_with_map),u_pitch_with_map:new f.b_(m,t.u_pitch_with_map),u_extrude_scale:new f.c3(m,t.u_extrude_scale),u_device_pixel_ratio:new f.bq(m,t.u_device_pixel_ratio),u_globe_extrude_scale:new f.bq(m,t.u_globe_extrude_scale),u_translate:new f.c3(m,t.u_translate)}),collisionBox:(m,t)=>({u_pixel_extrude_scale:new f.c3(m,t.u_pixel_extrude_scale)}),collisionCircle:(m,t)=>({u_viewport_size:new f.c3(m,t.u_viewport_size)}),debug:(m,t)=>({u_color:new f.b$(m,t.u_color),u_overlay:new f.b_(m,t.u_overlay),u_overlay_scale:new f.bq(m,t.u_overlay_scale)}),depth:gc,clippingMask:gc,heatmap:(m,t)=>({u_extrude_scale:new f.bq(m,t.u_extrude_scale),u_intensity:new f.bq(m,t.u_intensity),u_globe_extrude_scale:new f.bq(m,t.u_globe_extrude_scale)}),heatmapTexture:(m,t)=>({u_matrix:new f.c0(m,t.u_matrix),u_world:new f.c3(m,t.u_world),u_image:new f.b_(m,t.u_image),u_color_ramp:new f.b_(m,t.u_color_ramp),u_opacity:new f.bq(m,t.u_opacity)}),hillshade:(m,t)=>({u_image:new f.b_(m,t.u_image),u_latrange:new f.c3(m,t.u_latrange),u_exaggeration:new f.bq(m,t.u_exaggeration),u_altitudes:new f.c9(m,t.u_altitudes),u_azimuths:new f.c9(m,t.u_azimuths),u_accent:new f.b$(m,t.u_accent),u_method:new f.b_(m,t.u_method),u_shadows:new f.c8(m,t.u_shadows),u_highlights:new f.c8(m,t.u_highlights)}),hillshadePrepare:(m,t)=>({u_matrix:new f.c0(m,t.u_matrix),u_image:new f.b_(m,t.u_image),u_dimension:new f.c3(m,t.u_dimension),u_zoom:new f.bq(m,t.u_zoom),u_unpack:new f.c1(m,t.u_unpack)}),colorRelief:(m,t)=>({u_image:new f.b_(m,t.u_image),u_unpack:new f.c1(m,t.u_unpack),u_dimension:new f.c3(m,t.u_dimension),u_elevation_stops:new f.b_(m,t.u_elevation_stops),u_color_stops:new f.b_(m,t.u_color_stops),u_color_ramp_size:new f.b_(m,t.u_color_ramp_size),u_opacity:new f.bq(m,t.u_opacity)}),line:(m,t)=>({u_translation:new f.c3(m,t.u_translation),u_ratio:new f.bq(m,t.u_ratio),u_device_pixel_ratio:new f.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new f.c3(m,t.u_units_to_pixels)}),lineGradient:(m,t)=>({u_translation:new f.c3(m,t.u_translation),u_ratio:new f.bq(m,t.u_ratio),u_device_pixel_ratio:new f.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new f.c3(m,t.u_units_to_pixels),u_image:new f.b_(m,t.u_image),u_image_height:new f.bq(m,t.u_image_height)}),linePattern:(m,t)=>({u_translation:new f.c3(m,t.u_translation),u_texsize:new f.c3(m,t.u_texsize),u_ratio:new f.bq(m,t.u_ratio),u_device_pixel_ratio:new f.bq(m,t.u_device_pixel_ratio),u_image:new f.b_(m,t.u_image),u_units_to_pixels:new f.c3(m,t.u_units_to_pixels),u_scale:new f.c2(m,t.u_scale),u_fade:new f.bq(m,t.u_fade)}),lineSDF:(m,t)=>({u_translation:new f.c3(m,t.u_translation),u_ratio:new f.bq(m,t.u_ratio),u_device_pixel_ratio:new f.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new f.c3(m,t.u_units_to_pixels),u_image:new f.b_(m,t.u_image),u_mix:new f.bq(m,t.u_mix),u_tileratio:new f.bq(m,t.u_tileratio),u_crossfade_from:new f.bq(m,t.u_crossfade_from),u_crossfade_to:new f.bq(m,t.u_crossfade_to),u_lineatlas_width:new f.bq(m,t.u_lineatlas_width),u_lineatlas_height:new f.bq(m,t.u_lineatlas_height)}),lineGradientSDF:(m,t)=>({u_translation:new f.c3(m,t.u_translation),u_ratio:new f.bq(m,t.u_ratio),u_device_pixel_ratio:new f.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new f.c3(m,t.u_units_to_pixels),u_image:new f.b_(m,t.u_image),u_image_height:new f.bq(m,t.u_image_height),u_tileratio:new f.bq(m,t.u_tileratio),u_crossfade_from:new f.bq(m,t.u_crossfade_from),u_crossfade_to:new f.bq(m,t.u_crossfade_to),u_image_dash:new f.b_(m,t.u_image_dash),u_mix:new f.bq(m,t.u_mix),u_lineatlas_width:new f.bq(m,t.u_lineatlas_width),u_lineatlas_height:new f.bq(m,t.u_lineatlas_height)}),raster:(m,t)=>({u_tl_parent:new f.c3(m,t.u_tl_parent),u_scale_parent:new f.bq(m,t.u_scale_parent),u_buffer_scale:new f.bq(m,t.u_buffer_scale),u_fade_t:new f.bq(m,t.u_fade_t),u_opacity:new f.bq(m,t.u_opacity),u_image0:new f.b_(m,t.u_image0),u_image1:new f.b_(m,t.u_image1),u_brightness_low:new f.bq(m,t.u_brightness_low),u_brightness_high:new f.bq(m,t.u_brightness_high),u_saturation_factor:new f.bq(m,t.u_saturation_factor),u_contrast_factor:new f.bq(m,t.u_contrast_factor),u_spin_weights:new f.c2(m,t.u_spin_weights),u_coords_top:new f.c1(m,t.u_coords_top),u_coords_bottom:new f.c1(m,t.u_coords_bottom)}),symbolIcon:(m,t)=>({u_is_size_zoom_constant:new f.b_(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new f.b_(m,t.u_is_size_feature_constant),u_size_t:new f.bq(m,t.u_size_t),u_size:new f.bq(m,t.u_size),u_camera_to_center_distance:new f.bq(m,t.u_camera_to_center_distance),u_pitch:new f.bq(m,t.u_pitch),u_rotate_symbol:new f.b_(m,t.u_rotate_symbol),u_aspect_ratio:new f.bq(m,t.u_aspect_ratio),u_fade_change:new f.bq(m,t.u_fade_change),u_label_plane_matrix:new f.c0(m,t.u_label_plane_matrix),u_coord_matrix:new f.c0(m,t.u_coord_matrix),u_is_text:new f.b_(m,t.u_is_text),u_pitch_with_map:new f.b_(m,t.u_pitch_with_map),u_is_along_line:new f.b_(m,t.u_is_along_line),u_is_variable_anchor:new f.b_(m,t.u_is_variable_anchor),u_texsize:new f.c3(m,t.u_texsize),u_texture:new f.b_(m,t.u_texture),u_translation:new f.c3(m,t.u_translation),u_pitched_scale:new f.bq(m,t.u_pitched_scale)}),symbolSDF:(m,t)=>({u_is_size_zoom_constant:new f.b_(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new f.b_(m,t.u_is_size_feature_constant),u_size_t:new f.bq(m,t.u_size_t),u_size:new f.bq(m,t.u_size),u_camera_to_center_distance:new f.bq(m,t.u_camera_to_center_distance),u_pitch:new f.bq(m,t.u_pitch),u_rotate_symbol:new f.b_(m,t.u_rotate_symbol),u_aspect_ratio:new f.bq(m,t.u_aspect_ratio),u_fade_change:new f.bq(m,t.u_fade_change),u_label_plane_matrix:new f.c0(m,t.u_label_plane_matrix),u_coord_matrix:new f.c0(m,t.u_coord_matrix),u_is_text:new f.b_(m,t.u_is_text),u_pitch_with_map:new f.b_(m,t.u_pitch_with_map),u_is_along_line:new f.b_(m,t.u_is_along_line),u_is_variable_anchor:new f.b_(m,t.u_is_variable_anchor),u_texsize:new f.c3(m,t.u_texsize),u_texture:new f.b_(m,t.u_texture),u_gamma_scale:new f.bq(m,t.u_gamma_scale),u_device_pixel_ratio:new f.bq(m,t.u_device_pixel_ratio),u_is_halo:new f.b_(m,t.u_is_halo),u_translation:new f.c3(m,t.u_translation),u_pitched_scale:new f.bq(m,t.u_pitched_scale)}),symbolTextAndIcon:(m,t)=>({u_is_size_zoom_constant:new f.b_(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new f.b_(m,t.u_is_size_feature_constant),u_size_t:new f.bq(m,t.u_size_t),u_size:new f.bq(m,t.u_size),u_camera_to_center_distance:new f.bq(m,t.u_camera_to_center_distance),u_pitch:new f.bq(m,t.u_pitch),u_rotate_symbol:new f.b_(m,t.u_rotate_symbol),u_aspect_ratio:new f.bq(m,t.u_aspect_ratio),u_fade_change:new f.bq(m,t.u_fade_change),u_label_plane_matrix:new f.c0(m,t.u_label_plane_matrix),u_coord_matrix:new f.c0(m,t.u_coord_matrix),u_is_text:new f.b_(m,t.u_is_text),u_pitch_with_map:new f.b_(m,t.u_pitch_with_map),u_is_along_line:new f.b_(m,t.u_is_along_line),u_is_variable_anchor:new f.b_(m,t.u_is_variable_anchor),u_texsize:new f.c3(m,t.u_texsize),u_texsize_icon:new f.c3(m,t.u_texsize_icon),u_texture:new f.b_(m,t.u_texture),u_texture_icon:new f.b_(m,t.u_texture_icon),u_gamma_scale:new f.bq(m,t.u_gamma_scale),u_device_pixel_ratio:new f.bq(m,t.u_device_pixel_ratio),u_is_halo:new f.b_(m,t.u_is_halo),u_translation:new f.c3(m,t.u_translation),u_pitched_scale:new f.bq(m,t.u_pitched_scale)}),background:(m,t)=>({u_opacity:new f.bq(m,t.u_opacity),u_color:new f.b$(m,t.u_color)}),backgroundPattern:(m,t)=>({u_opacity:new f.bq(m,t.u_opacity),u_image:new f.b_(m,t.u_image),u_pattern_tl_a:new f.c3(m,t.u_pattern_tl_a),u_pattern_br_a:new f.c3(m,t.u_pattern_br_a),u_pattern_tl_b:new f.c3(m,t.u_pattern_tl_b),u_pattern_br_b:new f.c3(m,t.u_pattern_br_b),u_texsize:new f.c3(m,t.u_texsize),u_mix:new f.bq(m,t.u_mix),u_pattern_size_a:new f.c3(m,t.u_pattern_size_a),u_pattern_size_b:new f.c3(m,t.u_pattern_size_b),u_scale_a:new f.bq(m,t.u_scale_a),u_scale_b:new f.bq(m,t.u_scale_b),u_pixel_coord_upper:new f.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new f.c3(m,t.u_pixel_coord_lower),u_tile_units_to_pixels:new f.bq(m,t.u_tile_units_to_pixels)}),terrain:(m,t)=>({u_texture:new f.b_(m,t.u_texture),u_ele_delta:new f.bq(m,t.u_ele_delta),u_fog_matrix:new f.c0(m,t.u_fog_matrix),u_fog_color:new f.b$(m,t.u_fog_color),u_fog_ground_blend:new f.bq(m,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new f.bq(m,t.u_fog_ground_blend_opacity),u_horizon_color:new f.b$(m,t.u_horizon_color),u_horizon_fog_blend:new f.bq(m,t.u_horizon_fog_blend),u_is_globe_mode:new f.bq(m,t.u_is_globe_mode)}),terrainDepth:(m,t)=>({u_ele_delta:new f.bq(m,t.u_ele_delta)}),terrainCoords:(m,t)=>({u_texture:new f.b_(m,t.u_texture),u_terrain_coords_id:new f.bq(m,t.u_terrain_coords_id),u_ele_delta:new f.bq(m,t.u_ele_delta)}),projectionErrorMeasurement:(m,t)=>({u_input:new f.bq(m,t.u_input),u_output_expected:new f.bq(m,t.u_output_expected)}),atmosphere:(m,t)=>({u_sun_pos:new f.c2(m,t.u_sun_pos),u_atmosphere_blend:new f.bq(m,t.u_atmosphere_blend),u_globe_position:new f.c2(m,t.u_globe_position),u_globe_radius:new f.bq(m,t.u_globe_radius),u_inv_proj_matrix:new f.c0(m,t.u_inv_proj_matrix)}),sky:(m,t)=>({u_sky_color:new f.b$(m,t.u_sky_color),u_horizon_color:new f.b$(m,t.u_horizon_color),u_horizon:new f.c3(m,t.u_horizon),u_horizon_normal:new f.c3(m,t.u_horizon_normal),u_sky_horizon_blend:new f.bq(m,t.u_sky_horizon_blend),u_sky_blend:new f.bq(m,t.u_sky_blend)})};class Oo{constructor(t,r,l){this.context=t;const h=t.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Fo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class fh{constructor(t,r,l,h){this.length=r.length,this.attributes=l,this.itemSize=r.bytesPerElement,this.dynamicDraw=h,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),t.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let l=0;l<this.attributes.length;l++){const h=r.attributes[this.attributes[l].name];h!==void 0&&t.enableVertexAttribArray(h)}}setVertexAttribPointers(t,r,l){for(let h=0;h<this.attributes.length;h++){const _=this.attributes[h],v=r.attributes[_.name];v!==void 0&&t.vertexAttribPointer(v,_.components,t[Fo[_.type]],!1,this.itemSize,_.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ri{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class es extends ri{getDefault(){return f.bp.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Eu extends ri{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Cu extends ri{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class _c extends ri{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class No extends ri{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class zu extends ri{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Il extends ri{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Ha extends ri{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class ph extends ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class yc extends ri{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Xa extends ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class ts extends ri{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class wa extends ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class Es extends ri{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class jo extends ri{getDefault(){return f.bp.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Vo extends ri{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Du extends ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class oo extends ri{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class dr extends ri{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class mh extends ri{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Rl extends ri{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Ot extends ri{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class vc extends ri{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Ya extends ri{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class xc extends ri{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class $a extends ri{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Dd extends ri{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class bc extends ri{getDefault(){return null}set(t){var r;if(t===this.current&&!this.dirty)return;const l=this.gl;ur(l)?l.bindVertexArray(t):(r=l.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class lo extends ri{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class gh extends ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class wc extends ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class uo extends ri{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class Ll extends uo{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ta extends uo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class co extends uo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const ho="Framebuffer is not complete";class Uo{constructor(t,r,l,h,_){this.context=t,this.width=r,this.height=l;const v=t.gl,b=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new Ll(t,b),h)this.depthAttachment=_?new co(t,b):new Ta(t,b);else if(_)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error(ho)}destroy(){const t=this.context.gl,r=this.colorAttachment.get();if(r&&t.deleteTexture(r),this.depthAttachment){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}t.deleteFramebuffer(this.framebuffer)}}class fo{constructor(t){var r,l;if(this.gl=t,this.clearColor=new es(this),this.clearDepth=new Eu(this),this.clearStencil=new Cu(this),this.colorMask=new _c(this),this.depthMask=new No(this),this.stencilMask=new zu(this),this.stencilFunc=new Il(this),this.stencilOp=new Ha(this),this.stencilTest=new ph(this),this.depthRange=new yc(this),this.depthTest=new Xa(this),this.depthFunc=new ts(this),this.blend=new wa(this),this.blendFunc=new Es(this),this.blendColor=new jo(this),this.blendEquation=new Vo(this),this.cullFace=new Du(this),this.cullFaceSide=new oo(this),this.frontFace=new dr(this),this.program=new mh(this),this.activeTexture=new Rl(this),this.viewport=new Ot(this),this.bindFramebuffer=new vc(this),this.bindRenderbuffer=new Ya(this),this.bindTexture=new xc(this),this.bindVertexBuffer=new $a(this),this.bindElementBuffer=new Dd(this),this.bindVertexArray=new bc(this),this.pixelStoreUnpack=new lo(this),this.pixelStoreUnpackPremultiplyAlpha=new gh(this),this.pixelStoreUnpackFlipY=new wc(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),ur(t)){this.HALF_FLOAT=t.HALF_FLOAT;const h=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=t.RGBA16F)!==null&&r!==void 0?r:h?.RGBA16F_EXT,this.RGB16F=(l=t.RGB16F)!==null&&l!==void 0?l:h?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const h=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=h?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r){return new Oo(this,t,r)}createVertexBuffer(t,r,l){return new fh(this,t,r,l)}createRenderbuffer(t,r,l){const h=this.gl,_=h.createRenderbuffer();return this.bindRenderbuffer.set(_),h.renderbufferStorage(h.RENDERBUFFER,t,r,l),this.bindRenderbuffer.set(null),_}createFramebuffer(t,r,l,h){return new Uo(this,t,r,l,h)}clear({color:t,depth:r,stencil:l}){const h=this.gl;let _=0;t&&(_|=h.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(_|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),l!==void 0&&(_|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),h.clear(_)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){f.bR(t.blendFunction,xi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return ur(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var r;return ur(this.gl)?this.gl.deleteVertexArray(t):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let Ln;function Nn(m,t,r,l,h){const _=m.context,v=m.transform,b=_.gl,S=m.useProgram("collisionBox"),E=[];let z=0,R=0;for(let $=0;$<l.length;$++){const K=l[$],ne=t.getTile(K).getBucket(r);if(!ne)continue;const Q=h?ne.textCollisionBox:ne.iconCollisionBox,ie=ne.collisionCircleArray;ie.length>0&&(E.push({circleArray:ie,circleOffset:R,coord:K}),z+=ie.length/4,R=z),Q&&S.draw(_,b.LINES,Lt.disabled,Jt.disabled,m.colorModeForRenderPass(),Ut.disabled,ao(m.transform),m.style.map.terrain&&m.style.map.terrain.getTerrainData(K),v.getProjectionData({overscaledTileID:K,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),r.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,null,m.transform.zoom,null,null,Q.collisionVertexBuffer)}if(!h||!E.length)return;const I=m.useProgram("collisionCircle"),F=new f.ca;F.resize(4*z),F._trim();let U=0;for(const $ of E)for(let K=0;K<$.circleArray.length/4;K++){const ne=4*K,Q=$.circleArray[ne+0],ie=$.circleArray[ne+1],se=$.circleArray[ne+2],ee=$.circleArray[ne+3];F.emplace(U++,Q,ie,se,ee,0),F.emplace(U++,Q,ie,se,ee,1),F.emplace(U++,Q,ie,se,ee,2),F.emplace(U++,Q,ie,se,ee,3)}(!Ln||Ln.length<2*z)&&(Ln=(function($){const K=2*$,ne=new f.cc;ne.resize(K),ne._trim();for(let Q=0;Q<K;Q++){const ie=6*Q;ne.uint16[ie+0]=4*Q+0,ne.uint16[ie+1]=4*Q+1,ne.uint16[ie+2]=4*Q+2,ne.uint16[ie+3]=4*Q+2,ne.uint16[ie+4]=4*Q+3,ne.uint16[ie+5]=4*Q+0}return ne})(z));const Y=_.createIndexBuffer(Ln,!0),W=_.createVertexBuffer(F,f.cb.members,!0);for(const $ of E){const K=ch(m.transform);I.draw(_,b.TRIANGLES,Lt.disabled,Jt.disabled,m.colorModeForRenderPass(),Ut.disabled,K,m.style.map.terrain&&m.style.map.terrain.getTerrainData($.coord),null,r.id,W,Y,f.aX.simpleSegment(0,2*$.circleOffset,$.circleArray.length,$.circleArray.length/2),null,m.transform.zoom,null,null,null)}W.destroy(),Y.destroy()}const is=f.ar(new Float32Array(16));function ns(m,t,r,l,h,_){const{horizontalAlign:v,verticalAlign:b}=f.aS(m);return new f.P((-(v-.5)*t/h+l[0])*_,(-(b-.5)*r/h+l[1])*_)}function za(m,t,r,l,h,_){const v=t.tileAnchorPoint.add(new f.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let b=l.mult(_);r||(b=b.rotate(-h));const S=v.add(b);return Pt(S.x,S.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(r){const b=Kt(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(m),S=Math.atan(b.y/b.x)+(b.x<0?Math.PI:0);return m.add(l.rotate(S))}return m.add(l)}function Cs(m,t,r,l,h,_,v,b,S,E,z,R){const I=m.text.placedSymbolArray,F=m.text.dynamicLayoutVertexArray,U=m.icon.dynamicLayoutVertexArray,Y={};F.clear();for(let W=0;W<I.length;W++){const $=I.get(W),K=$.hidden||!$.crossTileID||m.allowVerticalPlacement&&!$.placedOrientation?null:l[$.crossTileID];if(K){const ne=new f.P($.anchorX,$.anchorY),Q={getElevation:R,width:h.width,height:h.height,pitchedLabelPlaneMatrix:_,pitchWithMap:r,transform:h,tileAnchorPoint:ne,translation:E,unwrappedTileID:z},ie=r?xl(ne.x,ne.y,Q):Kt(ne.x,ne.y,Q),se=Eo(h.cameraToCenterDistance,ie.signedDistanceFromCamera);let ee=f.aA(m.textSizeData,b,$)*se/f.aM;r&&(ee*=m.tilePixelRatio/v);const{width:ce,height:Me,anchor:_e,textOffset:be,textBoxScale:we}=K,Xe=ns(_e,ce,Me,be,we,ee),Ye=h.getPitchedTextCorrection(ne.x+E[0],ne.y+E[1],z),Ne=za(ie.point,Q,t,Xe,-h.bearingInRadians,Ye),We=m.allowVerticalPlacement&&$.placedOrientation===f.az.vertical?Math.PI/2:0;for(let zt=0;zt<$.numGlyphs;zt++)f.aG(F,Ne,We);S&&$.associatedIconIndex>=0&&(Y[$.associatedIconIndex]={shiftedAnchor:Ne,angle:We})}else Qr($.numGlyphs,F)}if(S){U.clear();const W=m.icon.placedSymbolArray;for(let $=0;$<W.length;$++){const K=W.get($);if(K.hidden)Qr(K.numGlyphs,U);else{const ne=Y[$];if(ne)for(let Q=0;Q<K.numGlyphs;Q++)f.aG(U,ne.shiftedAnchor,ne.angle);else Qr(K.numGlyphs,U)}}m.icon.dynamicLayoutVertexBuffer.updateData(U)}m.text.dynamicLayoutVertexBuffer.updateData(F)}function _h(m,t,r){return r.iconsInText&&t?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Go(m,t,r,l,h,_,v,b,S,E,z,R,I){const F=m.context,U=F.gl,Y=m.transform,W=b==="map",$=S==="map",K=b!=="viewport"&&r.layout.get("symbol-placement")!=="point",ne=W&&!$&&!K,Q=!r.layout.get("symbol-sort-key").isConstant();let ie=!1;const se=m.getDepthModeForSublayer(0,Lt.ReadOnly),ee=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ce=[],Me=Y.getCircleRadiusCorrection();for(const _e of l){const be=t.getTile(_e),we=be.getBucket(r);if(!we)continue;const Xe=h?we.text:we.icon;if(!Xe||!Xe.segments.get().length||!Xe.hasVisibleVertices)continue;const Ye=Xe.programConfigurations.get(r.id),Ne=h||we.sdfIcons,We=h?we.textSizeData:we.iconSizeData,zt=$||Y.pitch!==0,hi=m.useProgram(_h(Ne,h,we),Ye),Li=f.ay(We,Y.zoom),zi=m.style.map.terrain&&m.style.map.terrain.getTerrainData(_e);let Ni,bi,Ki,ji,Vn=[0,0],ln=null;if(h)bi=be.glyphAtlasTexture,Ki=U.LINEAR,Ni=be.glyphAtlasTexture.size,we.iconsInText&&(Vn=be.imageAtlasTexture.size,ln=be.imageAtlasTexture,ji=zt||m.options.rotating||m.options.zooming||We.kind==="composite"||We.kind==="camera"?U.LINEAR:U.NEAREST);else{const _i=r.layout.get("icon-size").constantOr(0)!==1||we.iconsNeedLinear;bi=be.imageAtlasTexture,Ki=Ne||m.options.rotating||m.options.zooming||_i||zt?U.LINEAR:U.NEAREST,Ni=be.imageAtlasTexture.size}const un=f.aN(be,1,m.transform.zoom),Un=Ga(W,m.transform,un),gs=f.N();f.aB(gs,Un);const _s=rc($,W,m.transform,un),Fr=f.aO(Y,be,_,v),Ra=Y.getProjectionData({overscaledTileID:_e,applyGlobeMatrix:!I,applyTerrainMatrix:!0}),Ko=ee&&we.hasTextData(),ql=r.layout.get("icon-text-fit")!=="none"&&Ko&&we.hasIconData();if(K){const _i=m.style.map.terrain?(wn,En)=>m.style.map.terrain.getElevation(_e,wn,En):null,Di=r.layout.get("text-rotation-alignment")==="map";Ss(we,m,h,Un,gs,$,E,Di,_e.toUnwrapped(),Y.width,Y.height,Fr,_i)}const Nr=h&&ee||ql,La=K||Nr?is:$?Un:m.transform.clipSpaceToPixelsMatrix,er=Ne&&r.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let yr;yr=Ne?we.iconsInText?hr(We.kind,Li,ne,$,K,Nr,m,La,_s,Fr,Ni,Vn,Me):mc(We.kind,Li,ne,$,K,Nr,m,La,_s,Fr,h,Ni,0,Me):Su(We.kind,Li,ne,$,K,Nr,m,La,_s,Fr,h,Ni,Me);const vr={program:hi,buffers:Xe,uniformValues:yr,projectionData:Ra,atlasTexture:bi,atlasTextureIcon:ln,atlasInterpolation:Ki,atlasInterpolationIcon:ji,isSDF:Ne,hasHalo:er};if(Q&&we.canOverlap){ie=!0;const _i=Xe.segments.get();for(const Di of _i)ce.push({segments:new f.aX([Di]),sortKey:Di.sortKey,state:vr,terrainData:zi})}else ce.push({segments:Xe.segments,sortKey:0,state:vr,terrainData:zi})}ie&&ce.sort(((_e,be)=>_e.sortKey-be.sortKey));for(const _e of ce){const be=_e.state;if(F.activeTexture.set(U.TEXTURE0),be.atlasTexture.bind(be.atlasInterpolation,U.CLAMP_TO_EDGE),be.atlasTextureIcon&&(F.activeTexture.set(U.TEXTURE1),be.atlasTextureIcon&&be.atlasTextureIcon.bind(be.atlasInterpolationIcon,U.CLAMP_TO_EDGE)),be.isSDF){const we=be.uniformValues;be.hasHalo&&(we.u_is_halo=1,Bl(be.buffers,_e.segments,r,m,be.program,se,z,R,we,be.projectionData,_e.terrainData)),we.u_is_halo=0}Bl(be.buffers,_e.segments,r,m,be.program,se,z,R,be.uniformValues,be.projectionData,_e.terrainData)}}function Bl(m,t,r,l,h,_,v,b,S,E,z){const R=l.context;h.draw(R,R.gl.TRIANGLES,_,v,b,Ut.backCCW,S,z,E,r.id,m.layoutVertexBuffer,m.indexBuffer,t,r.paint,l.transform.zoom,m.programConfigurations.get(r.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function yh(m,t,r,l,h){const _=m.context,v=_.gl,b=Jt.disabled,S=new xi([v.ONE,v.ONE],f.bp.transparent,[!0,!0,!0,!0]),E=t.getBucket(r);if(!E)return;const z=l.key;let R=r.heatmapFbos.get(z);R||(R=Ci(_,t.tileSize,t.tileSize),r.heatmapFbos.set(z,R)),_.bindFramebuffer.set(R.framebuffer),_.viewport.set([0,0,t.tileSize,t.tileSize]),_.clear({color:f.bp.transparent});const I=E.programConfigurations.get(r.id),F=m.useProgram("heatmap",I,!h),U=m.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Y=m.style.map.terrain.getTerrainData(l);F.draw(_,v.TRIANGLES,Lt.disabled,b,S,Ut.disabled,ro(t,m.transform.zoom,r.paint.get("heatmap-intensity"),1),Y,U,r.id,E.layoutVertexBuffer,E.indexBuffer,E.segments,r.paint,m.transform.zoom,I)}function jn(m,t,r,l,h){const _=m.context,v=_.gl,b=m.transform;_.setColorMode(m.colorModeForRenderPass());const S=$t(_,t),E=r.key,z=t.heatmapFbos.get(E);if(!z)return;_.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,z.colorAttachment.get()),_.activeTexture.set(v.TEXTURE1),S.bind(v.LINEAR,v.CLAMP_TO_EDGE);const R=b.getProjectionData({overscaledTileID:r,applyTerrainMatrix:h,applyGlobeMatrix:!l});m.useProgram("heatmapTexture").draw(_,v.TRIANGLES,Lt.disabled,Jt.disabled,m.colorModeForRenderPass(),Ut.disabled,hh(m,t,0,1),null,R,t.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,t.paint,b.zoom),z.destroy(),t.heatmapFbos.delete(E)}function Ci(m,t,r){var l,h;const _=m.gl,v=_.createTexture();_.bindTexture(_.TEXTURE_2D,v),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR);const b=(l=m.HALF_FLOAT)!==null&&l!==void 0?l:_.UNSIGNED_BYTE,S=(h=m.RGBA16F)!==null&&h!==void 0?h:_.RGBA;_.texImage2D(_.TEXTURE_2D,0,S,t,r,0,_.RGBA,b,null);const E=m.createFramebuffer(t,r,!1,!1);return E.colorAttachment.set(v),E}function $t(m,t){return t.colorRampTexture||(t.colorRampTexture=new f.T(m,t.colorRamp,m.gl.RGBA)),t.colorRampTexture}function zs(m,t,r,l,h,_,v,b){let S=256;if(h.stepInterpolant){const E=t.getSource().maxzoom,z=v.canonical.z===E?Math.ceil(1<<m.transform.maxZoom-v.canonical.z):1;S=f.an(f.ce(_.maxLineLength/f.a5*1024*z),256,r.maxTextureSize)}return b.gradient=f.cf({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:S,image:b.gradient||void 0,clips:_.lineClipsArray}),b.texture?b.texture.update(b.gradient):b.texture=new f.T(r,b.gradient,l.RGBA),b.version=h.gradientVersion,b.texture}function Wa(m,t,r,l,h){m.activeTexture.set(t.TEXTURE0),r.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),l.updatePaintBuffers(h)}function Wi(m,t,r,l,h,_){(h||m.lineAtlas.dirty)&&(t.activeTexture.set(r.TEXTURE0),m.lineAtlas.bind(t)),l.updatePaintBuffers(_)}function Da(m,t,r,l,h,_,v){const b=_.gradients[h.id];let S=b.texture;h.gradientVersion!==b.version&&(S=zs(m,t,r,l,h,_,v,b)),r.activeTexture.set(l.TEXTURE0),S.bind(h.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE)}function Pa(m,t,r,l,h,_,v,b,S){const E=_.gradients[h.id];let z=E.texture;h.gradientVersion!==E.version&&(z=zs(m,t,r,l,h,_,v,E)),r.activeTexture.set(l.TEXTURE0),z.bind(h.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE),r.activeTexture.set(l.TEXTURE1),m.lineAtlas.bind(r),b.updatePaintBuffers(S)}function Pu(m,t,r,l,h){if(!r||!l||!l.imageAtlas)return;const _=l.imageAtlas.patternPositions;let v=_[r.to.toString()],b=_[r.from.toString()];if(!v&&b&&(v=b),!b&&v&&(b=v),!v||!b){const S=h.getPaintProperty(t);v=_[S],b=_[S]}v&&b&&m.setConstantPatternPositions(v,b)}function as(m,t,r,l,h,_,v,b){const S=m.context.gl,E="fill-pattern",z=r.paint.get(E),R=z&&z.constantOr(1),I=r.getCrossfadeParameters();let F,U,Y,W,$;const K=m.transform,ne=r.paint.get("fill-translate"),Q=r.paint.get("fill-translate-anchor");v?(U=R&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=S.LINES):(U=R?"fillPattern":"fill",F=S.TRIANGLES);const ie=z.constantOr(null);for(const se of l){const ee=t.getTile(se);if(R&&!ee.patternsLoaded())continue;const ce=ee.getBucket(r);if(!ce)continue;const Me=ce.programConfigurations.get(r.id),_e=m.useProgram(U,Me),be=m.style.map.terrain&&m.style.map.terrain.getTerrainData(se);R&&(m.context.activeTexture.set(S.TEXTURE0),ee.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),Me.updatePaintBuffers(I)),Pu(Me,E,ie,ee,r);const we=K.getProjectionData({overscaledTileID:se,applyGlobeMatrix:!b,applyTerrainMatrix:!0}),Xe=f.aO(K,ee,ne,Q);if(v){W=ce.indexBuffer2,$=ce.segments2;const Ne=[S.drawingBufferWidth,S.drawingBufferHeight];Y=U==="fillOutlinePattern"&&R?Md(m,I,ee,Ne,Xe):Pl(Ne,Xe)}else W=ce.indexBuffer,$=ce.segments,Y=R?ko(m,I,ee,Xe):{u_fill_translate:Xe};const Ye=m.stencilModeForClipping(se);_e.draw(m.context,F,h,Ye,_,Ut.backCCW,Y,be,we,r.id,ce.layoutVertexBuffer,W,$,r.paint,m.transform.zoom,Me)}}function rs(m,t,r,l,h,_,v,b){const S=m.context,E=S.gl,z="fill-extrusion-pattern",R=r.paint.get(z),I=R.constantOr(1),F=r.getCrossfadeParameters(),U=r.paint.get("fill-extrusion-opacity"),Y=R.constantOr(null),W=m.transform;for(const $ of l){const K=t.getTile($),ne=K.getBucket(r);if(!ne)continue;const Q=m.style.map.terrain&&m.style.map.terrain.getTerrainData($),ie=ne.programConfigurations.get(r.id),se=m.useProgram(I?"fillExtrusionPattern":"fillExtrusion",ie);I&&(m.context.activeTexture.set(E.TEXTURE0),K.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),ie.updatePaintBuffers(F));const ee=W.getProjectionData({overscaledTileID:$,applyGlobeMatrix:!b,applyTerrainMatrix:!0});Pu(ie,z,Y,K,r);const ce=f.aO(W,K,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Me=r.paint.get("fill-extrusion-vertical-gradient"),_e=I?dc(m,Me,U,ce,$,F,K):hc(m,Me,U,ce);se.draw(S,S.gl.TRIANGLES,h,_,v,Ut.backCCW,_e,Q,ee,r.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,r.paint,m.transform.zoom,ie,m.style.map.terrain&&ne.centroidVertexBuffer)}}function ss(m,t,r,l,h,_,v,b,S){var E;const z=m.style.projection,R=m.context,I=m.transform,F=R.gl,U=[`#define NUM_ILLUMINATION_SOURCES ${r.paint.get("hillshade-highlight-color").values.length}`],Y=m.useProgram("hillshade",null,!1,U),W=!m.options.moving;for(const $ of l){const K=t.getTile($),ne=K.fbo;if(!ne)continue;const Q=z.getMeshFromTileID(R,$.canonical,b,!0,"raster"),ie=(E=m.style.map.terrain)===null||E===void 0?void 0:E.getTerrainData($);R.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,ne.colorAttachment.get());const se=I.getProjectionData({overscaledTileID:$,aligned:W,applyGlobeMatrix:!S,applyTerrainMatrix:!0});Y.draw(R,F.TRIANGLES,_,h[$.overscaledZ],v,Ut.backCCW,bu(m,K,r),ie,se,r.id,Q.vertexBuffer,Q.indexBuffer,Q.segments)}}function Ds(m,t,r,l,h,_,v,b,S){var E;const z=m.style.projection,R=m.context,I=m.transform,F=R.gl,U=m.useProgram("colorRelief"),Y=!m.options.moving;let W=!0,$=0;for(const K of l){const ne=t.getTile(K),Q=ne.dem;if(W){const _e=F.getParameter(F.MAX_TEXTURE_SIZE),{elevationTexture:be,colorTexture:we}=r.getColorRampTextures(R,_e,Q.getUnpackVector());R.activeTexture.set(F.TEXTURE1),be.bind(F.NEAREST,F.CLAMP_TO_EDGE),R.activeTexture.set(F.TEXTURE4),we.bind(F.LINEAR,F.CLAMP_TO_EDGE),W=!1,$=be.size[0]}if(!Q||!Q.data)continue;const ie=Q.stride,se=Q.getPixels();if(R.activeTexture.set(F.TEXTURE0),R.pixelStoreUnpackPremultiplyAlpha.set(!1),ne.demTexture=ne.demTexture||m.getTileTexture(ie),ne.demTexture){const _e=ne.demTexture;_e.update(se,{premultiply:!1}),_e.bind(F.LINEAR,F.CLAMP_TO_EDGE)}else ne.demTexture=new f.T(R,se,F.RGBA,{premultiply:!1}),ne.demTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const ee=z.getMeshFromTileID(R,K.canonical,b,!0,"raster"),ce=(E=m.style.map.terrain)===null||E===void 0?void 0:E.getTerrainData(K),Me=I.getProjectionData({overscaledTileID:K,aligned:Y,applyGlobeMatrix:!S,applyTerrainMatrix:!0});U.draw(R,F.TRIANGLES,_,h[K.overscaledZ],v,Ut.backCCW,Ed(r,ne.dem,$),ce,Me,r.id,ee.vertexBuffer,ee.indexBuffer,ee.segments)}}const Ps=[new f.P(0,0),new f.P(f.a5,0),new f.P(f.a5,f.a5),new f.P(0,f.a5)];function fr(m,t,r,l,h,_,v,b,S=!1,E=!1){const z=l[l.length-1].overscaledZ,R=m.context,I=R.gl,F=m.useProgram("raster"),U=m.transform,Y=m.style.projection,W=m.colorModeForRenderPass(),$=!m.options.moving,K=r.paint.get("raster-opacity"),ne=r.paint.get("raster-resampling"),Q=r.paint.get("raster-fade-duration"),ie=!!m.style.map.terrain;for(const se of l){const ee=m.getDepthModeForSublayer(se.overscaledZ-z,K===1?Lt.ReadWrite:Lt.ReadOnly,I.LESS),ce=t.getTile(se),Me=ne==="nearest"?I.NEAREST:I.LINEAR;R.activeTexture.set(I.TEXTURE0),ce.texture.bind(Me,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),R.activeTexture.set(I.TEXTURE1);const{parentTile:_e,parentScaleBy:be,parentTopLeft:we,fadeValues:Xe}=os(ce,t,Q,ie);ce.fadeOpacity=Xe.tileOpacity,_e?(_e.fadeOpacity=Xe.parentTileOpacity,_e.texture.bind(Me,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST)):ce.texture.bind(Me,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),ce.texture.useMipmap&&R.extTextureFilterAnisotropic&&m.transform.pitch>20&&I.texParameterf(I.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);const Ye=m.style.map.terrain&&m.style.map.terrain.getTerrainData(se),Ne=U.getProjectionData({overscaledTileID:se,aligned:$,applyGlobeMatrix:!E,applyTerrainMatrix:!0}),We=fc(we,be,Xe.fadeMix,r,b),zt=Y.getMeshFromTileID(R,se.canonical,_,v,"raster");F.draw(R,I.TRIANGLES,ee,h?h[se.overscaledZ]:Jt.disabled,W,S?Ut.frontCCW:Ut.backCCW,We,Ye,Ne,r.id,zt.vertexBuffer,zt.indexBuffer,zt.segments)}}function os(m,t,r,l){const h={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(r===0||l)return h;if(m.fadingParentID){const _=t.getLoadedTile(m.fadingParentID);if(!_)return h;const v=Math.pow(2,_.tileID.overscaledZ-m.tileID.overscaledZ),b=[m.tileID.canonical.x*v%1,m.tileID.canonical.y*v%1],S=(function(E,z,R){const I=bt(),F=(I-z.timeAdded)/R,U=E.fadingDirection===xe.Incoming,Y=f.an((I-E.timeAdded)/R,0,1),W=f.an(1-F,0,1),$=U?Y:W;return{tileOpacity:$,parentTileOpacity:U?W:Y,fadeMix:{opacity:1,mix:1-$}}})(m,_,r);return{parentTile:_,parentScaleBy:v,parentTopLeft:b,fadeValues:S}}if(m.selfFading){const _=(function(v,b){const S=(bt()-v.timeAdded)/b,E=f.an(S,0,1);return{tileOpacity:E,fadeMix:{opacity:E,mix:0}}})(m,r);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:_}}return h}const Is=new f.bp(1,0,0,1),ls=new f.bp(0,1,0,1),Tc=new f.bp(0,0,1,1),Sc=new f.bp(1,0,1,1),Qa=new f.bp(0,1,1,1);function kl(m,t,r,l){bn(m,0,t+r/2,m.transform.width,r,l)}function Rs(m,t,r,l){bn(m,t-r/2,0,r,m.transform.height,l)}function bn(m,t,r,l,h,_){const v=m.context,b=v.gl;b.enable(b.SCISSOR_TEST),b.scissor(t*m.pixelRatio,r*m.pixelRatio,l*m.pixelRatio,h*m.pixelRatio),v.clear({color:_}),b.disable(b.SCISSOR_TEST)}function Iu(m,t,r){const l=m.context,h=l.gl,_=m.useProgram("debug"),v=Lt.disabled,b=Jt.disabled,S=m.colorModeForRenderPass(),E="$debug",z=m.style.map.terrain&&m.style.map.terrain.getTerrainData(r);l.activeTexture.set(h.TEXTURE0);const R=t.getTileByID(r.key).latestRawTileData,I=Math.floor((R&&R.byteLength||0)/1024),F=t.getTile(r).tileSize,U=512/Math.min(F,512)*(r.overscaledZ/m.transform.zoom)*.5;let Y=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(Y+=` => ${r.overscaledZ}`),(function($,K){$.initDebugOverlayCanvas();const ne=$.debugOverlayCanvas,Q=$.context.gl,ie=$.debugOverlayCanvas.getContext("2d");ie.clearRect(0,0,ne.width,ne.height),ie.shadowColor="white",ie.shadowBlur=2,ie.lineWidth=1.5,ie.strokeStyle="white",ie.textBaseline="top",ie.font="bold 36px Open Sans, sans-serif",ie.fillText(K,5,5),ie.strokeText(K,5,5),$.debugOverlayTexture.update(ne),$.debugOverlayTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE)})(m,`${Y} ${I}kB`);const W=m.transform.getProjectionData({overscaledTileID:r,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(l,h.TRIANGLES,v,b,xi.alphaBlended,Ut.disabled,xu(f.bp.transparent,U),null,W,E,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),_.draw(l,h.LINE_STRIP,v,b,S,Ut.disabled,xu(f.bp.red),z,W,E,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function Mc(m,t,r,l){const{isRenderingGlobe:h}=l,_=m.context,v=_.gl,b=m.transform,S=m.colorModeForRenderPass(),E=m.getDepthModeFor3D(),z=m.useProgram("terrain");_.bindFramebuffer.set(null),_.viewport.set([0,0,m.width,m.height]);for(const R of r){const I=t.getTerrainMesh(R.tileID),F=m.renderToTexture.getTexture(R),U=t.getTerrainData(R.tileID);_.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,F.texture);const Y=t.getMeshFrameDelta(b.zoom),W=b.calculateFogMatrix(R.tileID.toUnwrapped()),$=wd(Y,W,m.style.sky,b.pitch,h),K=b.getProjectionData({overscaledTileID:R.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});z.draw(_,v.TRIANGLES,E,Jt.disabled,S,Ut.backCCW,$,U,K,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}}function vh(m,t){if(!t.mesh){const r=new f.aW;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1);const l=new f.aY;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),t.mesh=new Ei(m.createVertexBuffer(r,lr.members),m.createIndexBuffer(l),f.aX.simpleSegment(0,0,r.length,l.length))}return t.mesh}class Pd{constructor(t,r){this.context=new fo(t),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:f.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ri.maxOverzooming+Ri.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new In}resize(t,r,l){if(this.width=Math.floor(t*l),this.height=Math.floor(r*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style._order)this.style._layers[h].resize()}setup(){const t=this.context,r=new f.aW;r.emplaceBack(0,0),r.emplaceBack(f.a5,0),r.emplaceBack(0,f.a5),r.emplaceBack(f.a5,f.a5),this.tileExtentBuffer=t.createVertexBuffer(r,lr.members),this.tileExtentSegments=f.aX.simpleSegment(0,0,4,2);const l=new f.aW;l.emplaceBack(0,0),l.emplaceBack(f.a5,0),l.emplaceBack(0,f.a5),l.emplaceBack(f.a5,f.a5),this.debugBuffer=t.createVertexBuffer(l,lr.members),this.debugSegments=f.aX.simpleSegment(0,0,4,5);const h=new f.ch;h.emplaceBack(0,0,0,0),h.emplaceBack(f.a5,0,f.a5,0),h.emplaceBack(0,f.a5,0,f.a5),h.emplaceBack(f.a5,f.a5,f.a5,f.a5),this.rasterBoundsBuffer=t.createVertexBuffer(h,bd.members),this.rasterBoundsSegments=f.aX.simpleSegment(0,0,4,2);const _=new f.aW;_.emplaceBack(0,0),_.emplaceBack(f.a5,0),_.emplaceBack(0,f.a5),_.emplaceBack(f.a5,f.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(_,lr.members),this.rasterBoundsSegmentsPosOnly=f.aX.simpleSegment(0,0,4,5);const v=new f.aW;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(v,lr.members),this.viewportSegments=f.aX.simpleSegment(0,0,4,2);const b=new f.ci;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(b);const S=new f.aY;S.emplaceBack(1,0,2),S.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(S);const E=this.context.gl;this.stencilClearMode=new Jt({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO),this.tileExtentMesh=new Ei(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,r=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=f.N();f.c7(l,0,this.width,this.height,0,0,1),f.Q(l,l,[r.drawingBufferWidth,r.drawingBufferHeight,0]);const h={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(t,r.TRIANGLES,Lt.disabled,this.stencilClearMode,xi.disabled,Ut.disabled,null,null,h,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,r,l){if(this.currentStencilSource===t.source||!t.isTileClipped()||!r||!r.length)return;this.currentStencilSource=t.source,this.nextStencilID+r.length>256&&this.clearStencil();const h=this.context;h.setColorMode(xi.disabled),h.setDepthMode(Lt.disabled);const _={};for(const v of r)_[v.key]=this.nextStencilID++;this._renderTileMasks(_,r,l,!0),this._renderTileMasks(_,r,l,!1),this._tileClippingMaskIDs=_}_renderTileMasks(t,r,l,h){const _=this.context,v=_.gl,b=this.style.projection,S=this.transform,E=this.useProgram("clippingMask");for(const z of r){const R=t[z.key],I=this.style.map.terrain&&this.style.map.terrain.getTerrainData(z),F=b.getMeshFromTileID(this.context,z.canonical,h,!0,"stencil"),U=S.getProjectionData({overscaledTileID:z,applyGlobeMatrix:!l,applyTerrainMatrix:!0});E.draw(_,v.TRIANGLES,Lt.disabled,new Jt({func:v.ALWAYS,mask:0},R,255,v.KEEP,v.KEEP,v.REPLACE),xi.disabled,l?Ut.disabled:Ut.backCCW,null,I,U,"$clipping",F.vertexBuffer,F.indexBuffer,F.segments)}}_renderTilesDepthBuffer(){const t=this.context,r=t.gl,l=this.style.projection,h=this.transform,_=this.useProgram("depth"),v=this.getDepthModeFor3D(),b=nn(h,{tileSize:h.tileSize});for(const S of b){const E=this.style.map.terrain&&this.style.map.terrain.getTerrainData(S),z=l.getMeshFromTileID(this.context,S.canonical,!0,!0,"raster"),R=h.getProjectionData({overscaledTileID:S,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(t,r.TRIANGLES,v,Jt.disabled,xi.disabled,Ut.backCCW,null,E,R,"$clipping",z.vertexBuffer,z.indexBuffer,z.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new Jt({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){const r=this.context.gl;return new Jt({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const r=this.context.gl,l=t.sort(((v,b)=>b.overscaledZ-v.overscaledZ)),h=l[l.length-1].overscaledZ,_=l[0].overscaledZ-h+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const v={};for(let b=0;b<_;b++)v[b+h]=new Jt({func:r.GEQUAL,mask:255},b+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=_,[v,l]}return[{[h]:Jt.disabled},l]}stencilConfigForOverlapTwoPass(t){const r=this.context.gl,l=t.sort(((v,b)=>b.overscaledZ-v.overscaledZ)),h=l[l.length-1].overscaledZ,_=l[0].overscaledZ-h+1;if(this.clearStencil(),_>1){const v={},b={};for(let S=0;S<_;S++)v[S+h]=new Jt({func:r.GREATER,mask:255},_+1+S,255,r.KEEP,r.KEEP,r.REPLACE),b[S+h]=new Jt({func:r.GREATER,mask:255},1+S,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID=2*_+1,[v,b,l]}return this.nextStencilID=3,[{[h]:new Jt({func:r.GREATER,mask:255},2,255,r.KEEP,r.KEEP,r.REPLACE)},{[h]:new Jt({func:r.GREATER,mask:255},1,255,r.KEEP,r.KEEP,r.REPLACE)},l]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new xi([t.CONSTANT_COLOR,t.ONE],new f.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?xi.unblended:xi.alphaBlended}getDepthModeForSublayer(t,r,l){if(!this.opaquePassEnabledForLayer())return Lt.disabled;const h=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Lt(l||this.context.gl.LEQUAL,r,[h,h])}getDepthModeFor3D(){return new Lt(this.context.gl.LEQUAL,Lt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,r){var l,h;this.style=t,this.options=r,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(bt()),this.imageManager.beginFrame();const _=this.style._order,v=this.style.tileManagers,b={},S={},E={},z={isRenderingToTexture:!1,isRenderingGlobe:((l=t.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const I in v){const F=v[I];F.used&&F.prepare(this.context),b[I]=F.getVisibleCoordinates(!1),S[I]=b[I].slice().reverse(),E[I]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<_.length;I++)if(this.style._layers[_[I]].is3D()){this.opaquePassCutoff=I;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const I of _){const F=this.style._layers[I];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const U=S[F.source];(F.type==="custom"||U.length)&&this.renderLayer(this,v[F.source],F,U,z)}if((h=this.style.projection)===null||h===void 0||h.updateGPUdependent({context:this.context,useProgram:I=>this.useProgram(I)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?f.bp.black:f.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(I,F){const U=I.context,Y=U.gl,W=((se,ee,ce)=>{const Me=Math.cos(ee.rollInRadians),_e=Math.sin(ee.rollInRadians),be=ui(ee),we=ee.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:se.properties.get("sky-color"),u_horizon_color:se.properties.get("horizon-color"),u_horizon:[(ee.width/2-be*_e)*ce,(ee.height/2+be*Me)*ce],u_horizon_normal:[-_e,Me],u_sky_horizon_blend:se.properties.get("sky-horizon-blend")*ee.height/2*ce,u_sky_blend:we}})(F,I.style.map.transform,I.pixelRatio),$=new Lt(Y.LEQUAL,Lt.ReadWrite,[0,1]),K=Jt.disabled,ne=I.colorModeForRenderPass(),Q=I.useProgram("sky"),ie=vh(U,F);Q.draw(U,Y.TRIANGLES,$,K,ne,Ut.disabled,W,null,void 0,"sky",ie.vertexBuffer,ie.indexBuffer,ie.segments)})(this,this.style.sky),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[_[this.currentLayer]],F=v[I.source],U=b[I.source];this._renderTileClippingMasks(I,U,!1),this.renderLayer(this,F,I,U,z)}this.renderPass="translucent";let R=!1;for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const I=this.style._layers[_[this.currentLayer]],F=v[I.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(I,z))continue;this.opaquePassEnabledForLayer()||R||(R=!0,z.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const U=(I.type==="symbol"?E:S)[I.source];this._renderTileClippingMasks(I,b[I.source],!!this.renderToTexture),this.renderLayer(this,F,I,U,z)}if(z.isRenderingGlobe&&(function(I,F,U){const Y=I.context,W=Y.gl,$=I.useProgram("atmosphere"),K=new Lt(W.LEQUAL,Lt.ReadOnly,[0,1]),ne=I.transform,Q=(function(we,Xe){const Ye=we.properties.get("position"),Ne=[-Ye.x,-Ye.y,-Ye.z],We=f.ar(new Float64Array(16));return we.properties.get("anchor")==="map"&&(f.bg(We,We,Xe.rollInRadians),f.bh(We,We,-Xe.pitchInRadians),f.bg(We,We,Xe.bearingInRadians),f.bh(We,We,Xe.center.lat*Math.PI/180),f.bJ(We,We,-Xe.center.lng*Math.PI/180)),f.cg(Ne,Ne,We),Ne})(U,I.transform),ie=ne.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),se=F.properties.get("atmosphere-blend")*ie.projectionTransition;if(se===0)return;const ee=Bo(ne.worldSize,ne.center.lat),ce=ne.inverseProjectionMatrix,Me=new Float64Array(4);Me[3]=1,f.aH(Me,Me,ne.modelViewProjectionMatrix),Me[0]/=Me[3],Me[1]/=Me[3],Me[2]/=Me[3],Me[3]=1,f.aH(Me,Me,ce),Me[0]/=Me[3],Me[1]/=Me[3],Me[2]/=Me[3],Me[3]=1;const _e=((we,Xe,Ye,Ne,We)=>({u_sun_pos:we,u_atmosphere_blend:Xe,u_globe_position:Ye,u_globe_radius:Ne,u_inv_proj_matrix:We}))(Q,se,[Me[0],Me[1],Me[2]],ee,ce),be=vh(Y,F);$.draw(Y,W.TRIANGLES,K,Jt.disabled,xi.alphaBlended,Ut.disabled,_e,null,null,"atmosphere",be.vertexBuffer,be.indexBuffer,be.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const I=(function(F,U){let Y=null;const W=Object.values(F._layers).flatMap((Q=>Q.source&&!Q.isHidden(U)?[F.tileManagers[Q.source]]:[])),$=W.filter((Q=>Q.getSource().type==="vector")),K=W.filter((Q=>Q.getSource().type!=="vector")),ne=Q=>{(!Y||Y.getSource().maxzoom<Q.getSource().maxzoom)&&(Y=Q)};return $.forEach((Q=>ne(Q))),Y||K.forEach((Q=>ne(Q))),Y})(this.style,this.transform.zoom);I&&(function(F,U,Y){for(let W=0;W<Y.length;W++)Iu(F,U,Y[W])})(this,I,I.getVisibleCoordinates())}this.options.showPadding&&(function(I){const F=I.transform.padding;kl(I,I.transform.height-(F.top||0),3,Is),kl(I,F.bottom||0,3,ls),Rs(I,F.left||0,3,Tc),Rs(I,I.transform.width-(F.right||0),3,Sc);const U=I.transform.centerPoint;(function(Y,W,$,K){bn(Y,W-1,$-10,2,20,K),bn(Y,W-10,$-1,20,2,K)})(I,U.x,I.transform.height-U.y,Qa)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const r=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let h=this.terrainFacilitator.dirty;h||(h=t?!f.cj(r,l):!f.ck(r,l)),h||(h=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),h&&(f.cl(r,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(_,v){const b=_.context,S=b.gl,E=_.transform,z=xi.unblended,R=new Lt(S.LEQUAL,Lt.ReadWrite,[0,1]),I=v.tileManager.getRenderableTiles(),F=_.useProgram("terrainDepth");b.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),b.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),b.clear({color:f.bp.transparent,depth:1});for(const U of I){const Y=v.getTerrainMesh(U.tileID),W=v.getTerrainData(U.tileID),$=E.getProjectionData({overscaledTileID:U.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),K={u_ele_delta:v.getMeshFrameDelta(E.zoom)};F.draw(b,S.TRIANGLES,R,Jt.disabled,z,Ut.backCCW,K,W,$,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments)}b.bindFramebuffer.set(null),b.viewport.set([0,0,_.width,_.height])})(this,this.style.map.terrain),(function(_,v){const b=_.context,S=b.gl,E=_.transform,z=xi.unblended,R=new Lt(S.LEQUAL,Lt.ReadWrite,[0,1]),I=v.getCoordsTexture(),F=v.tileManager.getRenderableTiles(),U=_.useProgram("terrainCoords");b.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),b.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),b.clear({color:f.bp.transparent,depth:1}),v.coordsIndex=[];for(const Y of F){const W=v.getTerrainMesh(Y.tileID),$=v.getTerrainData(Y.tileID);b.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,I.texture);const K={u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(E.zoom)},ne=E.getProjectionData({overscaledTileID:Y.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});U.draw(b,S.TRIANGLES,R,Jt.disabled,z,Ut.backCCW,K,$,ne,"terrain",W.vertexBuffer,W.indexBuffer,W.segments),v.coordsIndex.push(Y.tileID.key)}b.bindFramebuffer.set(null),b.viewport.set([0,0,_.width,_.height])})(this,this.style.map.terrain))}renderLayer(t,r,l,h,_){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(h||[]).length)&&(this.id=l.id,f.cm(l)?(function(v,b,S,E,z,R){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:I}=R,F=Jt.disabled,U=v.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(Y,W,$,K,ne,Q,ie,se,ee){const ce=W.transform,Me=W.style.map.terrain,_e=ne==="map",be=Q==="map";for(const we of Y){const Xe=K.getTile(we),Ye=Xe.getBucket($);if(!Ye||!Ye.text||!Ye.text.segments.get().length)continue;const Ne=f.ay(Ye.textSizeData,ce.zoom),We=f.aN(Xe,1,W.transform.zoom),zt=Ga(_e,W.transform,We),hi=$.layout.get("icon-text-fit")!=="none"&&Ye.hasIconData();if(Ne){const Li=Math.pow(2,ce.zoom-Xe.tileID.overscaledZ),zi=Me?(Ni,bi)=>Me.getElevation(we,Ni,bi):null;Cs(Ye,_e,be,ee,ce,zt,Li,Ne,hi,f.aO(ce,Xe,ie,se),we.toUnwrapped(),zi)}}})(E,v,S,b,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),z),S.paint.get("icon-opacity").constantOr(1)!==0&&Go(v,b,S,E,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),F,U,I),S.paint.get("text-opacity").constantOr(1)!==0&&Go(v,b,S,E,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),F,U,I),b.map.showCollisionBoxes&&(Nn(v,b,S,E,!0),Nn(v,b,S,E,!1))})(t,r,l,h,this.style.placement.variableOffsets,_):f.cn(l)?(function(v,b,S,E,z){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:R}=z,I=S.paint.get("circle-opacity"),F=S.paint.get("circle-stroke-width"),U=S.paint.get("circle-stroke-opacity"),Y=!S.layout.get("circle-sort-key").isConstant();if(I.constantOr(1)===0&&(F.constantOr(1)===0||U.constantOr(1)===0))return;const W=v.context,$=W.gl,K=v.transform,ne=v.getDepthModeForSublayer(0,Lt.ReadOnly),Q=Jt.disabled,ie=v.colorModeForRenderPass(),se=[],ee=K.getCircleRadiusCorrection();for(let ce=0;ce<E.length;ce++){const Me=E[ce],_e=b.getTile(Me),be=_e.getBucket(S);if(!be)continue;const we=S.paint.get("circle-translate"),Xe=S.paint.get("circle-translate-anchor"),Ye=f.aO(K,_e,we,Xe),Ne=be.programConfigurations.get(S.id),We=v.useProgram("circle",Ne),zt=be.layoutVertexBuffer,hi=be.indexBuffer,Li=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Me),zi={programConfiguration:Ne,program:We,layoutVertexBuffer:zt,indexBuffer:hi,uniformValues:vu(v,_e,S,Ye,ee),terrainData:Li,projectionData:K.getProjectionData({overscaledTileID:Me,applyGlobeMatrix:!R,applyTerrainMatrix:!0})};if(Y){const Ni=be.segments.get();for(const bi of Ni)se.push({segments:new f.aX([bi]),sortKey:bi.sortKey,state:zi})}else se.push({segments:be.segments,sortKey:0,state:zi})}Y&&se.sort(((ce,Me)=>ce.sortKey-Me.sortKey));for(const ce of se){const{programConfiguration:Me,program:_e,layoutVertexBuffer:be,indexBuffer:we,uniformValues:Xe,terrainData:Ye,projectionData:Ne}=ce.state;_e.draw(W,$.TRIANGLES,ne,Q,ie,Ut.backCCW,Xe,Ye,Ne,S.id,be,we,ce.segments,S.paint,v.transform.zoom,Me)}})(t,r,l,h,_):f.co(l)?(function(v,b,S,E,z){if(S.paint.get("heatmap-opacity")===0)return;const R=v.context,{isRenderingToTexture:I,isRenderingGlobe:F}=z;if(v.style.map.terrain){for(const U of E){const Y=b.getTile(U);b.hasRenderableParent(U)||(v.renderPass==="offscreen"?yh(v,Y,S,U,F):v.renderPass==="translucent"&&jn(v,S,U,I,F))}R.viewport.set([0,0,v.width,v.height])}else v.renderPass==="offscreen"?(function(U,Y,W,$){const K=U.context,ne=K.gl,Q=U.transform,ie=Jt.disabled,se=new xi([ne.ONE,ne.ONE],f.bp.transparent,[!0,!0,!0,!0]);(function(ee,ce,Me){const _e=ee.gl;ee.activeTexture.set(_e.TEXTURE1),ee.viewport.set([0,0,ce.width/4,ce.height/4]);let be=Me.heatmapFbos.get(f.cd);be?(_e.bindTexture(_e.TEXTURE_2D,be.colorAttachment.get()),ee.bindFramebuffer.set(be.framebuffer)):(be=Ci(ee,ce.width/4,ce.height/4),Me.heatmapFbos.set(f.cd,be))})(K,U,W),K.clear({color:f.bp.transparent});for(let ee=0;ee<$.length;ee++){const ce=$[ee];if(Y.hasRenderableParent(ce))continue;const Me=Y.getTile(ce),_e=Me.getBucket(W);if(!_e)continue;const be=_e.programConfigurations.get(W.id),we=U.useProgram("heatmap",be),Xe=Q.getProjectionData({overscaledTileID:ce,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Ye=Q.getCircleRadiusCorrection();we.draw(K,ne.TRIANGLES,Lt.disabled,ie,se,Ut.backCCW,ro(Me,Q.zoom,W.paint.get("heatmap-intensity"),Ye),null,Xe,W.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,W.paint,Q.zoom,be)}K.viewport.set([0,0,U.width,U.height])})(v,b,S,E):v.renderPass==="translucent"&&(function(U,Y){const W=U.context,$=W.gl;W.setColorMode(U.colorModeForRenderPass());const K=Y.heatmapFbos.get(f.cd);K&&(W.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,K.colorAttachment.get()),W.activeTexture.set($.TEXTURE1),$t(W,Y).bind($.LINEAR,$.CLAMP_TO_EDGE),U.useProgram("heatmapTexture").draw(W,$.TRIANGLES,Lt.disabled,Jt.disabled,U.colorModeForRenderPass(),Ut.disabled,hh(U,Y,0,1),null,null,Y.id,U.viewportBuffer,U.quadTriangleIndexBuffer,U.viewportSegments,Y.paint,U.transform.zoom))})(v,S)})(t,r,l,h,_):f.cp(l)?(function(v,b,S,E,z){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:R}=z,I=S.paint.get("line-opacity"),F=S.paint.get("line-width");if(I.constantOr(1)===0||F.constantOr(1)===0)return;const U=v.getDepthModeForSublayer(0,Lt.ReadOnly),Y=v.colorModeForRenderPass(),W=S.paint.get("line-dasharray"),$=W.constantOr(1),K=S.paint.get("line-pattern"),ne=K.constantOr(1),Q=S.paint.get("line-gradient"),ie=S.getCrossfadeParameters();let se;se=ne?"linePattern":$&&Q?"lineGradientSDF":$?"lineSDF":Q?"lineGradient":"line";const ee=v.context,ce=ee.gl,Me=v.transform;let _e=!0;for(const be of E){const we=b.getTile(be);if(ne&&!we.patternsLoaded())continue;const Xe=we.getBucket(S);if(!Xe)continue;const Ye=Xe.programConfigurations.get(S.id),Ne=v.context.program.get(),We=v.useProgram(se,Ye),zt=_e||We.program!==Ne,hi=v.style.map.terrain&&v.style.map.terrain.getTerrainData(be),Li=K.constantOr(null),zi=W&&W.constantOr(null);if(Li&&we.imageAtlas){const Vn=we.imageAtlas,ln=Vn.patternPositions[Li.to.toString()],un=Vn.patternPositions[Li.from.toString()];ln&&un&&Ye.setConstantPatternPositions(ln,un)}else if(zi){const Vn=S.layout.get("line-cap")==="round",ln=v.lineAtlas.getDash(zi.to,Vn),un=v.lineAtlas.getDash(zi.from,Vn);Ye.setConstantDashPositions(ln,un)}const Ni=Me.getProjectionData({overscaledTileID:be,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),bi=Me.getPixelScale();let Ki;ne?(Ki=dh(v,we,S,bi,ie),Wa(ee,ce,we,Ye,ie)):$&&Q?(Ki=so(v,we,S,bi,ie,Xe.lineClipsArray.length),Pa(v,b,ee,ce,S,Xe,be,Ye,ie)):$?(Ki=Ca(v,we,S,bi,ie),Wi(v,ee,ce,Ye,zt,ie)):Q?(Ki=Cd(v,we,S,bi,Xe.lineClipsArray.length),Da(v,b,ee,ce,S,Xe,be)):Ki=wu(v,we,S,bi);const ji=v.stencilModeForClipping(be);We.draw(ee,ce.TRIANGLES,U,ji,Y,Ut.disabled,Ki,hi,Ni,S.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,S.paint,v.transform.zoom,Ye,Xe.layoutVertexBuffer2),_e=!1}})(t,r,l,h,_):f.cq(l)?(function(v,b,S,E,z){const R=S.paint.get("fill-color"),I=S.paint.get("fill-opacity");if(I.constantOr(1)===0)return;const{isRenderingToTexture:F}=z,U=v.colorModeForRenderPass(),Y=S.paint.get("fill-pattern"),W=v.opaquePassEnabledForLayer()&&!Y.constantOr(1)&&R.constantOr(f.bp.transparent).a===1&&I.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===W){const $=v.getDepthModeForSublayer(1,v.renderPass==="opaque"?Lt.ReadWrite:Lt.ReadOnly);as(v,b,S,E,$,U,!1,F)}if(v.renderPass==="translucent"&&S.paint.get("fill-antialias")){const $=v.getDepthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,Lt.ReadOnly);as(v,b,S,E,$,U,!0,F)}})(t,r,l,h,_):f.cr(l)?(function(v,b,S,E,z){const R=S.paint.get("fill-extrusion-opacity");if(R===0)return;const{isRenderingToTexture:I}=z;if(v.renderPass==="translucent"){const F=new Lt(v.context.gl.LEQUAL,Lt.ReadWrite,v.depthRangeFor3D);if(R!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))rs(v,b,S,E,F,Jt.disabled,xi.disabled,I),rs(v,b,S,E,F,v.stencilModeFor3D(),v.colorModeForRenderPass(),I);else{const U=v.colorModeForRenderPass();rs(v,b,S,E,F,Jt.disabled,U,I)}}})(t,r,l,h,_):f.cs(l)?(function(v,b,S,E,z){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const{isRenderingToTexture:R}=z,I=v.context,F=v.style.projection.useSubdivision,U=v.getDepthModeForSublayer(0,Lt.ReadOnly),Y=v.colorModeForRenderPass();if(v.renderPass==="offscreen")(function(W,$,K,ne,Q,ie,se){const ee=W.context,ce=ee.gl;for(const Me of K){const _e=$.getTile(Me),be=_e.dem;if(!be||!be.data||!_e.needsHillshadePrepare)continue;const we=be.dim,Xe=be.stride,Ye=be.getPixels();if(ee.activeTexture.set(ce.TEXTURE1),ee.pixelStoreUnpackPremultiplyAlpha.set(!1),_e.demTexture=_e.demTexture||W.getTileTexture(Xe),_e.demTexture){const We=_e.demTexture;We.update(Ye,{premultiply:!1}),We.bind(ce.NEAREST,ce.CLAMP_TO_EDGE)}else _e.demTexture=new f.T(ee,Ye,ce.RGBA,{premultiply:!1}),_e.demTexture.bind(ce.NEAREST,ce.CLAMP_TO_EDGE);ee.activeTexture.set(ce.TEXTURE0);let Ne=_e.fbo;if(!Ne){const We=new f.T(ee,{width:we,height:we,data:null},ce.RGBA);We.bind(ce.LINEAR,ce.CLAMP_TO_EDGE),Ne=_e.fbo=ee.createFramebuffer(we,we,!0,!1),Ne.colorAttachment.set(We.texture)}ee.bindFramebuffer.set(Ne.framebuffer),ee.viewport.set([0,0,we,we]),W.useProgram("hillshadePrepare").draw(ee,ce.TRIANGLES,Q,ie,se,Ut.disabled,Ad(_e.tileID,be),null,null,ne.id,W.rasterBoundsBuffer,W.quadTriangleIndexBuffer,W.rasterBoundsSegments),_e.needsHillshadePrepare=!1}})(v,b,E,S,U,Jt.disabled,Y),I.viewport.set([0,0,v.width,v.height]);else if(v.renderPass==="translucent")if(F){const[W,$,K]=v.stencilConfigForOverlapTwoPass(E);ss(v,b,S,K,W,U,Y,!1,R),ss(v,b,S,K,$,U,Y,!0,R)}else{const[W,$]=v.getStencilConfigForOverlapAndUpdateStencilID(E);ss(v,b,S,$,W,U,Y,!1,R)}})(t,r,l,h,_):f.ct(l)?(function(v,b,S,E,z){if(v.renderPass!=="translucent"||!E.length)return;const{isRenderingToTexture:R}=z,I=v.style.projection.useSubdivision,F=v.getDepthModeForSublayer(0,Lt.ReadOnly),U=v.colorModeForRenderPass();if(I){const[Y,W,$]=v.stencilConfigForOverlapTwoPass(E);Ds(v,b,S,$,Y,F,U,!1,R),Ds(v,b,S,$,W,F,U,!0,R)}else{const[Y,W]=v.getStencilConfigForOverlapAndUpdateStencilID(E);Ds(v,b,S,W,Y,F,U,!1,R)}})(t,r,l,h,_):f.bU(l)?(function(v,b,S,E,z){if(v.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!E.length)return;const{isRenderingToTexture:R}=z,I=b.getSource(),F=v.style.projection.useSubdivision;if(I instanceof Ea)fr(v,b,S,E,null,!1,!1,I.tileCoords,I.flippedWindingOrder,R);else if(F){const[U,Y,W]=v.stencilConfigForOverlapTwoPass(E);fr(v,b,S,W,U,!1,!0,Ps,!1,R),fr(v,b,S,W,Y,!0,!0,Ps,!1,R)}else{const[U,Y]=v.getStencilConfigForOverlapAndUpdateStencilID(E);fr(v,b,S,Y,U,!1,!0,Ps,!1,R)}})(t,r,l,h,_):f.cu(l)?(function(v,b,S,E,z){const R=S.paint.get("background-color"),I=S.paint.get("background-opacity");if(I===0)return;const{isRenderingToTexture:F}=z,U=v.context,Y=U.gl,W=v.style.projection,$=v.transform,K=$.tileSize,ne=S.paint.get("background-pattern");if(v.isPatternMissing(ne))return;const Q=!ne&&R.a===1&&I===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==Q)return;const ie=Jt.disabled,se=v.getDepthModeForSublayer(0,Q==="opaque"?Lt.ReadWrite:Lt.ReadOnly),ee=v.colorModeForRenderPass(),ce=v.useProgram(ne?"backgroundPattern":"background"),Me=E||nn($,{tileSize:K,terrain:v.style.map.terrain});ne&&(U.activeTexture.set(Y.TEXTURE0),v.imageManager.bind(v.context));const _e=S.getCrossfadeParameters();for(const be of Me){const we=$.getProjectionData({overscaledTileID:be,applyGlobeMatrix:!F,applyTerrainMatrix:!0}),Xe=ne?Au(I,v,ne,{tileID:be,tileSize:K},_e):Mu(I,R),Ye=v.style.map.terrain&&v.style.map.terrain.getTerrainData(be),Ne=W.getMeshFromTileID(U,be.canonical,!1,!0,"raster");ce.draw(U,Y.TRIANGLES,se,ie,ee,Ut.backCCW,Xe,Ye,we,S.id,Ne.vertexBuffer,Ne.indexBuffer,Ne.segments)}})(t,0,l,h,_):f.cv(l)&&(function(v,b,S,E){const{isRenderingGlobe:z}=E,R=v.context,I=S.implementation,F=v.style.projection,U=v.transform,Y=U.getProjectionDataForCustomLayer(z),W={farZ:U.farZ,nearZ:U.nearZ,fov:U.fov*Math.PI/180,modelViewProjectionMatrix:U.modelViewProjectionMatrix,projectionMatrix:U.projectionMatrix,shaderData:{variantName:F.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${F.shaderPreludeCode.vertexSource}`,define:F.shaderDefine},defaultProjectionData:Y},$=I.renderingMode?I.renderingMode:"2d";if(v.renderPass==="offscreen"){const K=I.prerender;K&&(v.setCustomLayerDefaults(),R.setColorMode(v.colorModeForRenderPass()),K.call(I,R.gl,W),R.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),R.setColorMode(v.colorModeForRenderPass()),R.setStencilMode(Jt.disabled);const K=$==="3d"?v.getDepthModeFor3D():v.getDepthModeForSublayer(0,Lt.ReadOnly);R.setDepthMode(K),I.render(R.gl,W),R.setDirty(),v.setBaseState(),R.bindFramebuffer.set(null)}})(t,0,l,_))}saveTileTexture(t){const r=this._tileTextures[t.size[0]];r?r.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const r=this.imageManager.getPattern(t.from.toString()),l=this.imageManager.getPattern(t.to.toString());return!r||!l}useProgram(t,r,l=!1,h=[]){this.cache=this.cache||{};const _=!!this.style.map.terrain,v=this.style.projection,b=l?Vi.projectionMercator:v.shaderPreludeCode,S=l?rn:v.shaderDefine,E=t+(r?r.cacheKey:"")+`/${l?ya:v.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(_?"/terrain":"")+(h?`/${h.join("/")}`:"");return this.cache[E]||(this.cache[E]=new Td(this.context,Vi[t],r,zd[t],this._showOverdrawInspector,_,b,S,h)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new f.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,r;if(this._tileTextures){for(const l in this._tileTextures){const h=this._tileTextures[l];if(h)for(const _ of h)_.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((r=this.tileExtentMesh.indexBuffer)===null||r===void 0||r.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const l in this.cache){const h=this.cache[l];h&&h.program&&this.context.gl.deleteProgram(h.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:r}=this.context.gl;return this.width!==t||this.height!==r}}function xh(m,t){let r,l=!1,h=null,_=null;const v=()=>{h=null,l&&(m.apply(_,r),h=setTimeout(v,t),l=!1)};return(...b)=>(l=!0,_=this,r=b,h||v(),h)}class pn{constructor(t){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map((h=>h.split("="))).forEach((h=>{h[0]===this._hashName&&(l=h)})),(l&&l[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(!this._isValidHash(r))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:l,pitch:+(r[4]||0)}),!0},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,r)},this._removeHash=()=>{const r=this._getCurrentHash();if(r.length===0)return;const l=r.join("/");let h=l;h.split("&").length>0&&(h=h.split("&")[0]),this._hashName&&(h=`${this._hashName}=${l}`);let _=window.location.hash.replace(h,"");_.startsWith("#&")?_=_.slice(0,1)+_.slice(2):_==="#"&&(_="");let v=window.location.href.replace(/(#.+)?$/,_);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=xh(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const r=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,h=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,h),v=Math.round(r.lng*_)/_,b=Math.round(r.lat*_)/_,S=this._map.getBearing(),E=this._map.getPitch();let z="";if(z+=t?`/${v}/${b}/${l}`:`${l}/${b}/${v}`,(S||E)&&(z+="/"+Math.round(10*S)/10),E&&(z+=`/${Math.round(E)}`),this._hashName){const R=this._hashName;let I=!1;const F=window.location.hash.slice(1).split("&").map((U=>{const Y=U.split("=")[0];return Y===R?(I=!0,`${Y}=${z}`):U})).filter((U=>U));return I||F.push(`${R}=${z}`),`#${F.join("&")}`}return`#${z}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new f.V(+t[2],+t[1])}catch{return!1}const r=+t[0],l=+(t[3]||0),h=+(t[4]||0);return r>=this._map.getMinZoom()&&r<=this._map.getMaxZoom()&&l>=-180&&l<=180&&h>=this._map.getMinPitch()&&h<=this._map.getMaxPitch()}}const us={linearity:.3,easing:f.cw(0,0,.3,1)},Ol=f.e({deceleration:2500,maxSpeed:1400},us),ua=f.e({deceleration:20,maxSpeed:1400},us),Ka=f.e({deceleration:1e3,maxSpeed:360},us),qo=f.e({deceleration:1e3,maxSpeed:90},us),ca=f.e({deceleration:1e3,maxSpeed:360},us);class Nf{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:bt(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=bt();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,roll:0,pan:new f.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)r.zoom+=_.zoomDelta||0,r.bearing+=_.bearingDelta||0,r.pitch+=_.pitchDelta||0,r.roll+=_.rollDelta||0,_.panDelta&&r.pan._add(_.panDelta),_.around&&(r.around=_.around),_.pinchAround&&(r.pinchAround=_.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(r.pan.mag()){const _=Ru(r.pan.mag(),l,f.e({},Ol,t||{})),v=r.pan.mult(_.amount/r.pan.mag()),b=this._map.cameraHelper.handlePanInertia(v,this._map.transform);h.center=b.easingCenter,h.offset=b.easingOffset,Fl(h,_)}if(r.zoom){const _=Ru(r.zoom,l,ua);h.zoom=this._map.transform.zoom+_.amount,Fl(h,_)}if(r.bearing){const _=Ru(r.bearing,l,Ka);h.bearing=this._map.transform.bearing+f.an(_.amount,-179,179),Fl(h,_)}if(r.pitch){const _=Ru(r.pitch,l,qo);h.pitch=this._map.transform.pitch+_.amount,Fl(h,_)}if(r.roll){const _=Ru(r.roll,l,ca);h.roll=this._map.transform.roll+f.an(_.amount,-179,179),Fl(h,_)}if(h.zoom||h.bearing){const _=r.pinchAround===void 0?r.around:r.pinchAround;h.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),f.e(h,{noMoveStart:!0})}}function Fl(m,t){(!m.duration||m.duration<t.duration)&&(m.duration=t.duration,m.easing=t.easing)}function Ru(m,t,r){const{maxSpeed:l,linearity:h,deceleration:_}=r,v=f.an(m*h/(t/1e3),-l,l),b=Math.abs(v)/(_*h);return{easing:r.easing,duration:1e3*b,amount:v*(b/2)}}class Bn extends f.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,l,h={}){l=l instanceof MouseEvent?l:new MouseEvent(t,l);const _=Te.mousePos(r.getCanvas(),l),v=r.unproject(_);super(t,f.e({point:_,lngLat:v,originalEvent:l},h)),this._defaultPrevented=!1,this.target=r}}class Ir extends f.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,l){const h=t==="touchend"?l.changedTouches:l.touches,_=Te.touchPos(r.getCanvasContainer(),h),v=_.map((S=>r.unproject(S))),b=_.reduce(((S,E,z,R)=>S.add(E.div(R.length))),new f.P(0,0));super(t,{points:_,point:b,lngLats:v,lngLat:r.unproject(b),originalEvent:l}),this._defaultPrevented=!1}}class Ac extends f.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,l){super(t,{originalEvent:l}),this._defaultPrevented=!1}}class Ec{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Ac(t.type,this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new Bn(t.type,this._map,t))}mouseup(t){this._map.fire(new Bn(t.type,this._map,t))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new Bn(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Bn(t.type,this._map,t))}mouseover(t){this._map.fire(new Bn(t.type,this._map,t))}mouseout(t){this._map.fire(new Bn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ir(t.type,this._map,t))}touchmove(t){this._map.fire(new Ir(t.type,this._map,t))}touchend(t){this._map.fire(new Ir(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ir(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Id{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Bn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Bn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Bn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Rr{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(f.P.convert(t),this._map.terrain)}}class po{constructor(t,r){this._map=t,this._tr=new Rr(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&t.button===0&&(Te.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const l=r;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const h=this._startPos;this._lastPos=l,this._box||(this._box=Te.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const _=Math.min(h.x,l.x),v=Math.max(h.x,l.x),b=Math.min(h.y,l.y),S=Math.max(h.y,l.y);Te.setTransform(this._box,`translate(${_}px,${b}px)`),this._box.style.width=v-_+"px",this._box.style.height=S-b+"px"}mouseupWindow(t,r){if(!this._active||t.button!==0)return;const l=this._startPos,h=r;if(this.reset(),Te.suppressClick(),l.x!==h.x||l.y!==h.y)return this._map.fire(new f.l("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(l,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Te.remove(this._box),this._box=null),Te.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new f.l(t,{originalEvent:r}))}}function Ia(m,t){if(m.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${t.length}`);const r={};for(let l=0;l<m.length;l++)r[m[l].identifier]=t[l];return r}class tt{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,r,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),l.length===this.numTouches&&(this.centroid=(function(h){const _=new f.P(0,0);for(const v of h)_._add(v);return _.div(h.length)})(r),this.touches=Ia(l,r)))}touchmove(t,r,l){if(this.aborted||!this.centroid)return;const h=Ia(l,r);for(const _ in this.touches){const v=h[_];(!v||v.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,r,l){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class Lu{constructor(t){this.singleTap=new tt(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,r,l){this.singleTap.touchstart(t,r,l)}touchmove(t,r,l){this.singleTap.touchmove(t,r,l)}touchend(t,r,l){const h=this.singleTap.touchend(t,r,l);if(h){const _=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(h)<30;if(_&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class Cc{constructor(t){this._tr=new Rr(t),this._zoomIn=new Lu({numTouches:1,numTaps:2}),this._zoomOut=new Lu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,l){this._zoomIn.touchstart(t,r,l),this._zoomOut.touchstart(t,r,l)}touchmove(t,r,l){this._zoomIn.touchmove(t,r,l),this._zoomOut.touchmove(t,r,l)}touchend(t,r,l){const h=this._zoomIn.touchend(t,r,l),_=this._zoomOut.touchend(t,r,l),v=this._tr;return h?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(h)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pr{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const r=this._moveFunction(...t);if(r.bearingDelta||r.pitchDelta||r.rollDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(t,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(r)?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,r){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const h=Array.isArray(r)?r[0]:r;return!this._moved&&h.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(l,h))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&Te.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Lr=0,Nl=2,zc={[Lr]:1,[Nl]:2};class cs{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const r=Te.mouseButton(t);this._eventButton=r}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(r,l){const h=zc[l];return r.buttons===void 0||(r.buttons&h)!==h})(t,this._eventButton)}isValidEndEvent(t){return Te.mouseButton(t)===this._eventButton}}class Zo{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class Bu{constructor(t=new cs({checkCorrectEvent:()=>!0}),r=new Zo){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=r}_executeRelevantHandler(t,r,l){return t instanceof MouseEvent?r(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?l(t):void 0}startMove(t){this._executeRelevantHandler(t,(r=>this.mouseMoveStateManager.startMove(r)),(r=>this.oneFingerTouchMoveStateManager.startMove(r)))}endMove(t){this._executeRelevantHandler(t,(r=>this.mouseMoveStateManager.endMove(r)),(r=>this.oneFingerTouchMoveStateManager.endMove(r)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(r=>this.mouseMoveStateManager.isValidStartEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidStartEvent(r)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(r=>this.mouseMoveStateManager.isValidMoveEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(r)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(r=>this.mouseMoveStateManager.isValidEndEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidEndEvent(r)))}}const hs=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=t=>{t.preventDefault()}};class Dc{constructor(t,r){this._clickTolerance=t.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new f.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,r,l){return this._calculateTransform(t,r,l)}touchmove(t,r,l){if(this._active){if(!this._shouldBePrevented(l.length))return t.preventDefault(),this._calculateTransform(t,r,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,r,l){this._calculateTransform(t,r,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,l){l.length>0&&(this._active=!0);const h=Ia(l,r),_=new f.P(0,0),v=new f.P(0,0);let b=0;for(const E in h){const z=h[E],R=this._touches[E];R&&(_._add(z),v._add(z.sub(R)),b++,h[E]=z)}if(this._touches=h,this._shouldBePrevented(b)||!v.mag())return;const S=v.div(b);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(b),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ku{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,r,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,l){if(!this._firstTwoTouches)return;t.preventDefault();const[h,_]=this._firstTwoTouches,v=ds(l,r,h),b=ds(l,r,_);if(!v||!b)return;const S=this._aroundCenter?null:v.add(b).div(2);return this._move([v,b],S,t)}touchend(t,r,l){if(!this._firstTwoTouches)return;const[h,_]=this._firstTwoTouches,v=ds(l,r,h),b=ds(l,r,_);v&&b||(this._active&&Te.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ds(m,t,r){for(let l=0;l<m.length;l++)if(m[l].identifier===r)return t[l]}function bh(m,t){return Math.log(m/t)/Math.LN2}class fs extends ku{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const l=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(bh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:bh(this._distance,l),pinchAround:r}}}function Pc(m,t){return 180*m.angleWith(t)/Math.PI}class Ou extends ku{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r,l){const h=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Pc(this._vector,h),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,l=Pc(t,this._startVector);return Math.abs(l)<r}}function ps(m){return Math.abs(m.y)>Math.abs(m.x)}class Ls extends ku{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,r,l){super.touchstart(t,r,l),this._currentTouchCount=l.length}_start(t){this._lastPoints=t,ps(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const h=t[0].sub(this._lastPoints[0]),_=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,_,l.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(h.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(t,r,l){if(this._valid!==void 0)return this._valid;const h=t.mag()>=2,_=r.mag()>=2;if(!h&&!_)return;if(!h||!_)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const v=t.y>0==r.y>0;return ps(t)&&ps(r)&&v}}const mr={panStep:100,bearingStep:15,pitchStep:10};class gi{constructor(t){this._tr=new Rr(t);const r=mr;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,l=0,h=0,_=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?l=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?l=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?h=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?h=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(l=0,h=0),{cameraAnimation:b=>{const S=this._tr;b.easeTo({duration:300,easeId:"keyboardHandler",easing:wh,zoom:r?Math.round(S.zoom)+r*(t.shiftKey?2:1):S.zoom,bearing:S.bearing+l*this._bearingStep,pitch:S.pitch+h*this._pitchStep,offset:[-_*this._panStep,-v*this._panStep],center:S.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function wh(m){return m*(2-m)}const Bs=4.000244140625,mo=1/450;class Fu{constructor(t,r){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=t,this._tr=new Rr(t),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=mo}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const l=bt(),h=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,r!==0&&r%Bs==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(h*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=Te.mousePos(this._map.getCanvas(),t),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(f.V.convert(l.center)):r,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const b=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=b),typeof this._targetZoom=="number"&&(this._targetZoom+=b)}if(this._delta!==0){const b=this._type==="wheel"&&Math.abs(this._delta)>Bs?this._wheelZoomRate:this._defaultZoomRate;let S=2/(1+Math.exp(-Math.abs(this._delta*b)));this._delta<0&&S!==0&&(S=1/S);const E=typeof this._targetZoom!="number"?t.scale:f.aq(this._targetZoom);this._targetZoom=t.applyConstrain(t.getCameraLngLat(),f.at(E*S)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,l=this._startZoom,h=this._easing;let _,v=!1;if(this._type==="wheel"&&l&&h){const b=bt()-this._lastWheelEventTime,S=Math.min((b+5)/200,1),E=h(S);_=f.G.number(l,r,E),S<1?this._frameId||(this._frameId=!0):v=!0}else _=r,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=_,{noInertia:!0,needsRenderFrame:!v,zoomDelta:_-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=f.cy;if(this._prevEase){const l=this._prevEase,h=(bt()-l.start)/l.duration,_=l.easing(h+.01)-l.easing(h),v=.27/Math.sqrt(_*_+1e-4)*.01,b=Math.sqrt(.0729-v*v);r=f.cw(v,b,.25,1)}return this._prevEase={start:bt(),duration:t,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ic{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ho{constructor(t){this._tr=new Rr(t),this.reset()}reset(){this._active=!1}dblclick(t,r){return t.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nu{constructor(){this._tap=new Lu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,r,l){if(!this._swipePoint)if(this._tapTime){const h=r[0],_=t.timeStamp-this._tapTime<500,v=this._tapPoint.dist(h)<30;_&&v?l.length>0&&(this._swipePoint=h,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(t,r,l)}touchmove(t,r,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const h=r[0],_=h.y-this._swipePoint.y;return this._swipePoint=h,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,r,l)}touchend(t,r,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const h=this._tap.touchend(t,r,l);h&&(this._tapTime=t.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Th{constructor(t,r,l){this._el=t,this._mousePan=r,this._touchPan=l}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ja{constructor(t,r,l,h){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=r,this._mousePitch=l,this._mouseRoll=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Xo{constructor(t,r,l,h){this._el=t,this._touchZoom=r,this._touchRotate=l,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class at{constructor(t,r){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=r,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=Te.create("div","maplibregl-cooperative-gesture-screen",t);let r=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(r=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),h=document.createElement("div");h.className="maplibregl-desktop-message",h.textContent=r,this._container.appendChild(h);const _=document.createElement("div");_.className="maplibregl-mobile-message",_.textContent=l,this._container.appendChild(_),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Te.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,r){this._enabled&&(this._map.fire(new f.l("cooperativegestureprevented",{gestureType:t,originalEvent:r})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const lt=m=>m.zoom||m.drag||m.roll||m.pitch||m.rotate;class gr extends f.l{}function jl(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta||m.rollDelta}class ju{constructor(t,r){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,_)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=h.type==="renderFrame"?void 0:h,b={needsRenderFrame:!1},S={},E={};for(const{handlerName:I,handler:F,allowed:U}of this._handlers){if(!F.isEnabled())continue;let Y;if(this._blockedByActive(E,U,I))F.reset();else if(F[_||h.type]){if(f.cz(h,_||h.type)){const W=Te.mousePos(this._map.getCanvas(),h);Y=F[_||h.type](h,W)}else if(f.cA(h,_||h.type)){const W=this._getMapTouches(h.touches),$=Te.touchPos(this._map.getCanvas(),W);Y=F[_||h.type](h,$,W)}else f.cB(_||h.type)||(Y=F[_||h.type](h));this.mergeHandlerResult(b,S,Y,I,v),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()}(Y||F.isActive())&&(E[I]=F)}const z={};for(const I in this._previousActiveHandlers)E[I]||(z[I]=v);this._previousActiveHandlers=E,(Object.keys(z).length||jl(b))&&(this._changes.push([b,S,z]),this._triggerRenderFrame()),(Object.keys(E).length||jl(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=b;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Nf(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[h,_,v]of this._listeners)Te.addEventListener(h,_,h===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[t,r,l]of this._listeners)Te.removeEventListener(t,r,t===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(t){const r=this._map,l=r.getCanvasContainer();this._add("mapEvent",new Ec(r,t));const h=r.boxZoom=new po(r,t);this._add("boxZoom",h),t.interactive&&t.boxZoom&&h.enable();const _=r.cooperativeGestures=new at(r,t.cooperativeGestures);this._add("cooperativeGestures",_),t.cooperativeGestures&&_.enable();const v=new Cc(r),b=new Ho(r);r.doubleClickZoom=new Ic(b,v),this._add("tapZoom",v),this._add("clickZoom",b),t.interactive&&t.doubleClickZoom&&r.doubleClickZoom.enable();const S=new Nu;this._add("tapDragZoom",S);const E=r.touchPitch=new Ls(r);this._add("touchPitch",E),t.interactive&&t.touchPitch&&r.touchPitch.enable(t.touchPitch);const z=()=>r.project(r.getCenter()),R=(function({enable:Q,clickTolerance:ie,aroundCenter:se=!0,minPixelCenterThreshold:ee=100,rotateDegreesPerPixelMoved:ce=.8},Me){const _e=new cs({checkCorrectEvent:be=>Te.mouseButton(be)===0&&be.ctrlKey||Te.mouseButton(be)===2&&!be.ctrlKey});return new pr({clickTolerance:ie,move:(be,we)=>{const Xe=Me();if(se&&Math.abs(Xe.y-be.y)>ee)return{bearingDelta:f.cx(new f.P(be.x,we.y),we,Xe)};let Ye=(we.x-be.x)*ce;return se&&we.y<Xe.y&&(Ye=-Ye),{bearingDelta:Ye}},moveStateManager:_e,enable:Q,assignEvents:hs})})(t,z),I=(function({enable:Q,clickTolerance:ie,pitchDegreesPerPixelMoved:se=-.5}){const ee=new cs({checkCorrectEvent:ce=>Te.mouseButton(ce)===0&&ce.ctrlKey||Te.mouseButton(ce)===2});return new pr({clickTolerance:ie,move:(ce,Me)=>({pitchDelta:(Me.y-ce.y)*se}),moveStateManager:ee,enable:Q,assignEvents:hs})})(t),F=(function({enable:Q,clickTolerance:ie,rollDegreesPerPixelMoved:se=.3},ee){const ce=new cs({checkCorrectEvent:Me=>Te.mouseButton(Me)===2&&Me.ctrlKey});return new pr({clickTolerance:ie,move:(Me,_e)=>{const be=ee();let we=(_e.x-Me.x)*se;return _e.y<be.y&&(we=-we),{rollDelta:we}},moveStateManager:ce,enable:Q,assignEvents:hs})})(t,z);r.dragRotate=new Ja(t,R,I,F),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",I,["mouseRotate","mouseRoll"]),this._add("mouseRoll",F,["mousePitch"]),t.interactive&&t.dragRotate&&r.dragRotate.enable();const U=(function({enable:Q,clickTolerance:ie}){const se=new cs({checkCorrectEvent:ee=>Te.mouseButton(ee)===0&&!ee.ctrlKey});return new pr({clickTolerance:ie,move:(ee,ce)=>({around:ce,panDelta:ce.sub(ee)}),activateOnStart:!0,moveStateManager:se,enable:Q,assignEvents:hs})})(t),Y=new Dc(t,r);r.dragPan=new Th(l,U,Y),this._add("mousePan",U),this._add("touchPan",Y,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&r.dragPan.enable(t.dragPan);const W=new Ou,$=new fs;r.touchZoomRotate=new Xo(l,$,W,S),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",$,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&r.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new Id(r));const K=r.scrollZoom=new Fu(r,(()=>this._triggerRenderFrame()));this._add("scrollZoom",K,["mousePan"]),t.interactive&&t.scrollZoom&&r.scrollZoom.enable(t.scrollZoom);const ne=r.keyboard=new gi(r);this._add("keyboard",ne),t.interactive&&t.keyboard&&r.keyboard.enable()}_add(t,r,l){this._handlers.push({handlerName:t,handler:r,allowed:l}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!lt(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,r,l){for(const h in t)if(h!==l&&(!r||r.indexOf(h)<0))return!0;return!1}_getMapTouches(t){const r=[];for(const l of t)this._el.contains(l.target)&&r.push(l);return r}mergeHandlerResult(t,r,l,h,_){if(!l)return;f.e(t,l);const v={handlerName:h,originalEvent:l.originalEvent||_};l.zoomDelta!==void 0&&(r.zoom=v),l.panDelta!==void 0&&(r.drag=v),l.rollDelta!==void 0&&(r.roll=v),l.pitchDelta!==void 0&&(r.pitch=v),l.bearingDelta!==void 0&&(r.rotate=v)}_applyChanges(){const t={},r={},l={};for(const[h,_,v]of this._changes)h.panDelta&&(t.panDelta=(t.panDelta||new f.P(0,0))._add(h.panDelta)),h.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+h.pitchDelta),h.rollDelta&&(t.rollDelta=(t.rollDelta||0)+h.rollDelta),h.around!==void 0&&(t.around=h.around),h.pinchAround!==void 0&&(t.pinchAround=h.pinchAround),h.noInertia&&(t.noInertia=h.noInertia),f.e(r,_),f.e(l,v);this._updateMapTransform(t,r,l),this._changes=[]}_updateMapTransform(t,r,l){const h=this._map,_=h._getTransformForUpdate(),v=h.terrain;if(!(jl(t)||v&&this._terrainMovement))return this._fireEvents(r,l,!0);h._stop(!0);let{panDelta:b,zoomDelta:S,bearingDelta:E,pitchDelta:z,rollDelta:R,around:I,pinchAround:F}=t;F!==void 0&&(I=F),I=I||h.transform.centerPoint,v&&!_.isPointOnMapSurface(I)&&(I=_.centerPoint);const U={panDelta:b,zoomDelta:S,rollDelta:R,pitchDelta:z,bearingDelta:E,around:I};this._map.cameraHelper.useGlobeControls&&!_.isPointOnMapSurface(I)&&(I=_.centerPoint);const Y=I.distSqr(_.centerPoint)<.01?_.center:_.screenPointToLocation(b?I.sub(b):I);this._handleMapControls({terrain:v,tr:_,deltasForHelper:U,preZoomAroundLoc:Y,combinedEventsInProgress:r,panDelta:b}),h._applyUpdatedTransform(_),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,l,!0)}_handleMapControls({terrain:t,tr:r,deltasForHelper:l,preZoomAroundLoc:h,combinedEventsInProgress:_,panDelta:v}){const b=this._map.cameraHelper;if(b.handleMapControlsRollPitchBearingZoom(l,r),t)return b.useGlobeControls?(this._terrainMovement||!_.drag&&!_.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void b.handleMapControlsPan(l,r,h)):this._terrainMovement||!_.drag&&!_.zoom?void(_.drag&&this._terrainMovement&&v?r.setCenter(r.screenPointToLocation(r.centerPoint.sub(v))):b.handleMapControlsPan(l,r,h)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void b.handleMapControlsPan(l,r,h));b.handleMapControlsPan(l,r,h)}_fireEvents(t,r,l){const h=lt(this._eventsInProgress),_=lt(t),v={};for(const R in t){const{originalEvent:I}=t[R];this._eventsInProgress[R]||(v[`${R}start`]=I),this._eventsInProgress[R]=t[R]}!h&&_&&this._fireEvent("movestart",_.originalEvent);for(const R in v)this._fireEvent(R,v[R]);_&&this._fireEvent("move",_.originalEvent);for(const R in t){const{originalEvent:I}=t[R];this._fireEvent(R,I)}const b={};let S;for(const R in this._eventsInProgress){const{handlerName:I,originalEvent:F}=this._eventsInProgress[R];this._handlersById[I].isActive()||(delete this._eventsInProgress[R],S=r[I]||F,b[`${R}end`]=S)}for(const R in b)this._fireEvent(R,b[R]);const E=lt(this._eventsInProgress),z=(h||_)&&!E;if(z&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const R=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&R.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(R)}if(l&&z){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),I=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;!R||!R.essential&&Xt.prefersReducedMotion?(this._map.fire(new f.l("moveend",{originalEvent:S})),I(this._map.getBearing())&&this._map.resetNorth()):(I(R.bearing||this._map.getBearing())&&(R.bearing=0),R.freezeElevation=!0,this._map.easeTo(R,{originalEvent:S})),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new f.l(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new gr("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class mn extends f.E{constructor(t,r,l){super(),this._renderFrameCallback=()=>{const h=Math.min((bt()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=l.bearingSnap,this.cameraHelper=r,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,r){t.apply(this.transform),this.transform=t,this.cameraHelper=r}getCenter(){return new f.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,r){return this.jumpTo({elevation:t},r),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,r,l){return t=f.P.convert(t).mult(-1),this.panTo(this.transform.center,f.e({offset:t},r),l)}panTo(t,r,l){return this.easeTo(f.e({center:t},r),l)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,l){return this.easeTo(f.e({zoom:t},r),l)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,r){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new f.l("movestart",r)).fire(new f.l("move",r)).fire(new f.l("moveend",r))),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,l){return this.easeTo(f.e({bearing:t},r),l)}resetNorth(t,r){return this.rotateTo(0,f.e({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(f.e({bearing:0,pitch:0,roll:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}getRoll(){return this.transform.roll}setRoll(t,r){return this.jumpTo({roll:t},r),this}cameraForBounds(t,r){t=tn.convert(t).adjustAntiMeridian();const l=r&&r.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),l,r)}_cameraForBoxAndBearing(t,r,l,h){const _={top:0,bottom:0,right:0,left:0};if(typeof(h=f.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const E=h.padding;h.padding={top:E,bottom:E,right:E,left:E}}const v=f.e(_,h.padding);h.padding=v;const b=this.transform,S=new tn(t,r);return this.cameraHelper.cameraForBoxAndBearing(h,v,S,l,b)}fitBounds(t,r,l){return this._fitInternal(this.cameraForBounds(t,r),r,l)}fitScreenCoordinates(t,r,l,h,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(f.P.convert(t)),this.transform.screenPointToLocation(f.P.convert(r)),l,h),h,_)}_fitInternal(t,r,l){return t?(delete(r=f.e(t,r)).padding,r.linear?this.easeTo(r,l):this.flyTo(r,l)):this}jumpTo(t,r){this.stop();const l=this._getTransformForUpdate();let h=!1,_=!1,v=!1;const b=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,t);const S=l.zoom!==b;return"elevation"in t&&l.elevation!==+t.elevation&&l.setElevation(+t.elevation),"bearing"in t&&l.bearing!==+t.bearing&&(h=!0,l.setBearing(+t.bearing)),"pitch"in t&&l.pitch!==+t.pitch&&(_=!0,l.setPitch(+t.pitch)),"roll"in t&&l.roll!==+t.roll&&(v=!0,l.setRoll(+t.roll)),t.padding==null||l.isPaddingEqual(t.padding)||l.setPadding(t.padding),this._applyUpdatedTransform(l),this.fire(new f.l("movestart",r)).fire(new f.l("move",r)),S&&this.fire(new f.l("zoomstart",r)).fire(new f.l("zoom",r)).fire(new f.l("zoomend",r)),h&&this.fire(new f.l("rotatestart",r)).fire(new f.l("rotate",r)).fire(new f.l("rotateend",r)),_&&this.fire(new f.l("pitchstart",r)).fire(new f.l("pitch",r)).fire(new f.l("pitchend",r)),v&&this.fire(new f.l("rollstart",r)).fire(new f.l("roll",r)).fire(new f.l("rollend",r)),this.fire(new f.l("moveend",r))}calculateCameraOptionsFromTo(t,r,l,h=0){const _=f.a9.fromLngLat(t,r),v=f.a9.fromLngLat(l,h),b=v.x-_.x,S=v.y-_.y,E=v.z-_.z,z=Math.hypot(b,S,E);if(z===0)throw new Error("Can't calculate camera options with same From and To");const R=Math.hypot(b,S),I=f.at(this.transform.cameraToCenterDistance/z/this.transform.tileSize),F=180*Math.atan2(b,-S)/Math.PI;let U=180*Math.acos(R/z)/Math.PI;return U=E<0?90-U:90+U,{center:v.toLngLat(),elevation:h,zoom:I,pitch:U,bearing:F}}calculateCameraOptionsFromCameraLngLatAltRotation(t,r,l,h,_){const v=this.transform.calculateCenterFromCameraLngLatAlt(t,r,l,h);return{center:v.center,elevation:v.elevation,zoom:v.zoom,bearing:l,pitch:h,roll:_}}easeTo(t,r){this._stop(!1,t.easeId),((t=f.e({offset:[0,0],duration:500,easing:f.cy},t)).animate===!1||!t.essential&&Xt.prefersReducedMotion)&&(t.duration=0);const l=this._getTransformForUpdate(),h=this.getBearing(),_=l.pitch,v=l.roll,b="bearing"in t?this._normalizeBearing(t.bearing,h):h,S="pitch"in t?+t.pitch:_,E="roll"in t?this._normalizeBearing(t.roll,v):v,z="padding"in t?t.padding:l.padding,R=f.P.convert(t.offset);let I,F;t.around&&(I=f.V.convert(t.around),F=l.locationToScreenPoint(I));const U={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Y=this.cameraHelper.handleEaseTo(l,{bearing:b,pitch:S,roll:E,padding:z,around:I,aroundPoint:F,offsetAsPoint:R,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||h!==b,this._pitching=this._pitching||S!==_,this._rolling=this._rolling||E!==v,this._padding=!l.isPaddingEqual(z),this._zooming=this._zooming||Y.isZooming,this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,U),this.terrain&&this._prepareElevation(Y.elevationCenter),this._ease((W=>{Y.easeFunc(W),this.terrain&&!t.freezeElevation&&this._updateElevation(W),this._applyUpdatedTransform(l),this._fireMoveEvents(r)}),(W=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(r,W)}),t),this}_prepareEase(t,r,l={}){this._moving=!0,r||l.moving||this.fire(new f.l("movestart",t)),this._zooming&&!l.zooming&&this.fire(new f.l("zoomstart",t)),this._rotating&&!l.rotating&&this.fire(new f.l("rotatestart",t)),this._pitching&&!l.pitching&&this.fire(new f.l("pitchstart",t)),this._rolling&&!l.rolling&&this.fire(new f.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&r!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(l-(r-(l*t+this._elevationStart))/(1-t)),this._elevationTarget=r}this.transform.setElevation(f.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const r=t.getCameraLngLat(),l=t.getCameraAltitude(),h=this.terrain?this.terrain.getElevationForLngLatZoom(r,t.zoom):0;if(l<h){const _=this.calculateCameraOptionsFromTo(r,h,t.center,t.elevation);return{pitch:_.pitch,zoom:_.zoom}}return{}}_applyUpdatedTransform(t){const r=[];if(r.push((h=>this._elevateCameraIfInsideTerrain(h))),this.transformCameraUpdate&&r.push((h=>this.transformCameraUpdate(h))),!r.length)return;const l=t.clone();for(const h of r){const _=l.clone(),{center:v,zoom:b,roll:S,pitch:E,bearing:z,elevation:R}=h(_);v&&_.setCenter(v),R!==void 0&&_.setElevation(R),b!==void 0&&_.setZoom(b),S!==void 0&&_.setRoll(S),E!==void 0&&_.setPitch(E),z!==void 0&&_.setBearing(z),l.apply(_)}this.transform.apply(l)}_fireMoveEvents(t){this.fire(new f.l("move",t)),this._zooming&&this.fire(new f.l("zoom",t)),this._rotating&&this.fire(new f.l("rotate",t)),this._pitching&&this.fire(new f.l("pitch",t)),this._rolling&&this.fire(new f.l("roll",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const l=this._zooming,h=this._rotating,_=this._pitching,v=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new f.l("zoomend",t)),h&&this.fire(new f.l("rotateend",t)),_&&this.fire(new f.l("pitchend",t)),v&&this.fire(new f.l("rollend",t)),this.fire(new f.l("moveend",t))}flyTo(t,r){if(!t.essential&&Xt.prefersReducedMotion){const we=f.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(we,r)}this.stop(),t=f.e({offset:[0,0],speed:1.2,curve:1.42,easing:f.cy},t);const l=this._getTransformForUpdate(),h=l.bearing,_=l.pitch,v=l.roll,b=l.padding,S="bearing"in t?this._normalizeBearing(t.bearing,h):h,E="pitch"in t?+t.pitch:_,z="roll"in t?this._normalizeBearing(t.roll,v):v,R="padding"in t?t.padding:l.padding,I=f.P.convert(t.offset);let F=l.centerPoint.add(I);const U=l.screenPointToLocation(F),Y=this.cameraHelper.handleFlyTo(l,{bearing:S,pitch:E,roll:z,padding:R,locationAtOffset:U,offsetAsPoint:I,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let W=t.curve;const $=Math.max(l.width,l.height),K=$/Y.scaleOfZoom,ne=Y.pixelPathLength;typeof Y.scaleOfMinZoom=="number"&&(W=Math.sqrt($/Y.scaleOfMinZoom/ne*2));const Q=W*W;function ie(we){const Xe=(K*K-$*$+(we?-1:1)*Q*Q*ne*ne)/(2*(we?K:$)*Q*ne);return Math.log(Math.sqrt(Xe*Xe+1)-Xe)}function se(we){return(Math.exp(we)-Math.exp(-we))/2}function ee(we){return(Math.exp(we)+Math.exp(-we))/2}const ce=ie(!1);let Me=function(we){return ee(ce)/ee(ce+W*we)},_e=function(we){return $*((ee(ce)*(se(Xe=ce+W*we)/ee(Xe))-se(ce))/Q)/ne;var Xe},be=(ie(!0)-ce)/W;if(Math.abs(ne)<2e-6||!isFinite(be)){if(Math.abs($-K)<1e-6)return this.easeTo(t,r);const we=K<$?-1:1;be=Math.abs(Math.log(K/$))/W,_e=()=>0,Me=Xe=>Math.exp(we*W*Xe)}return t.duration="duration"in t?+t.duration:1e3*be/("screenSpeed"in t?+t.screenSpeed/W:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=h!==S,this._pitching=E!==_,this._rolling=z!==v,this._padding=!l.isPaddingEqual(R),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(Y.targetCenter),this._ease((we=>{const Xe=we*be,Ye=1/Me(Xe),Ne=_e(Xe);this._rotating&&l.setBearing(f.G.number(h,S,we)),this._pitching&&l.setPitch(f.G.number(_,E,we)),this._rolling&&l.setRoll(f.G.number(v,z,we)),this._padding&&(l.interpolatePadding(b,R,we),F=l.centerPoint.add(I)),Y.easeFunc(we,Ye,Ne,F),this.terrain&&!t.freezeElevation&&this._updateElevation(we),this._applyUpdatedTransform(l),this._fireMoveEvents(r)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(r)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,r){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,r)}return t||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(t,r,l){l.animate===!1||l.duration===0?(t(1),r()):(this._easeStart=bt(),this._easeOptions=l,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,r){t=f.W(t,-180,180);const l=Math.abs(t-r);return Math.abs(t-360-r)<l&&(t-=360),Math.abs(t+360-r)<l&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(f.V.convert(t),this.transform):null}}const Qi={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class on{constructor(t=Qi){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=Te.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Te.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Te.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Te.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,r){const l=this._map._getUIString(`AttributionControl.${r}`);t.title=l,t.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((h=>typeof h!="string"?"":h))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}const r=this._map.style.tileManagers;for(const h in r){const _=r[h];if(_.used||_.usedForTerrain){const v=_.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t=t.filter((h=>String(h).trim())),t.sort(((h,_)=>h.length-_.length)),t=t.filter(((h,_)=>{for(let v=_+1;v<t.length;v++)if(t[v].indexOf(h)>=0)return!1;return!0}));const l=t.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,t.length?(this._innerContainer.innerHTML=Te.sanitize(l),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Vu{constructor(t={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=Te.create("div","maplibregl-ctrl");const r=Te.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Te.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ks{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,l=r?this._queue.concat(r):this._queue;for(const h of l)if(h.id===t)return void(h.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const l of r)if(!l.cancelled&&(l.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Vt=f.aU([{name:"a_pos3d",type:"Int16",components:3}]);class ci extends f.E{constructor(t){super(),this._lastTilesetChange=bt(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,r){this.tileManager.update(t,r),this._renderableTilesKeys=[];const l={};for(const h of nn(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r,calculateTileZoom:this.tileManager._source.calculateTileZoom}))l[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.terrainRttPosMatrix32f=new Float64Array(16),f.c7(h.terrainRttPosMatrix32f,0,f.a5,f.a5,0,0,1),this._tiles[h.key]=new Be(h,this.tileSize),this._lastTilesetChange=bt());for(const h in this._tiles)l[h]||delete this._tiles[h]}freeRtt(t){for(const r in this._tiles){const l=this._tiles[r];(!t||l.tileID.equals(t)||l.tileID.isChildOf(t)||t.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,r){return r?this._getTerrainCoordsForTileRanges(t,r):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const r={};for(const l of this._renderableTilesKeys){const h=this._tiles[l].tileID,_=t.clone(),v=f.bk();if(h.canonical.equals(t.canonical))f.c7(v,0,f.a5,f.a5,0,0,1);else if(h.canonical.isChildOf(t.canonical)){const b=h.canonical.z-t.canonical.z,S=h.canonical.x-(h.canonical.x>>b<<b),E=h.canonical.y-(h.canonical.y>>b<<b),z=f.a5>>b;f.c7(v,0,z,z,0,0,1),f.O(v,v,[-S*z,-E*z,0])}else{if(!t.canonical.isChildOf(h.canonical))continue;{const b=t.canonical.z-h.canonical.z,S=t.canonical.x-(t.canonical.x>>b<<b),E=t.canonical.y-(t.canonical.y>>b<<b),z=f.a5>>b;f.c7(v,0,f.a5,f.a5,0,0,1),f.O(v,v,[S*z,E*z,0]),f.Q(v,v,[1/2**b,1/2**b,0])}}_.terrainRttPosMatrix32f=new Float32Array(v),r[l]=_}return r}_getTerrainCoordsForTileRanges(t,r){const l={};for(const h of this._renderableTilesKeys){const _=this._tiles[h].tileID;if(!this._isWithinTileRanges(_,r))continue;const v=t.clone(),b=f.bk();if(_.canonical.z===t.canonical.z){const S=t.canonical.x-_.canonical.x,E=t.canonical.y-_.canonical.y;f.c7(b,0,f.a5,f.a5,0,0,1),f.O(b,b,[S*f.a5,E*f.a5,0])}else if(_.canonical.z>t.canonical.z){const S=_.canonical.z-t.canonical.z,E=_.canonical.x-(_.canonical.x>>S<<S),z=_.canonical.y-(_.canonical.y>>S<<S),R=t.canonical.x-(_.canonical.x>>S),I=t.canonical.y-(_.canonical.y>>S),F=f.a5>>S;f.c7(b,0,F,F,0,0,1),f.O(b,b,[-E*F+R*f.a5,-z*F+I*f.a5,0])}else{const S=t.canonical.z-_.canonical.z,E=t.canonical.x-(t.canonical.x>>S<<S),z=t.canonical.y-(t.canonical.y>>S<<S),R=(t.canonical.x>>S)-_.canonical.x,I=(t.canonical.y>>S)-_.canonical.y,F=f.a5<<S;f.c7(b,0,F,F,0,0,1),f.O(b,b,[E*f.a5+R*F,z*f.a5+I*F,0])}v.terrainRttPosMatrix32f=new Float32Array(b),l[h]=v}return l}getSourceTile(t,r){const l=this.tileManager._source;let h=t.overscaledZ-this.deltaZoom;if(h>l.maxzoom&&(h=l.maxzoom),h<l.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(h).key);let _=this.findTileInCaches(this._sourceTileCache[t.key]);if(!_?.dem&&r)for(;h>=l.minzoom&&!_?.dem;)_=this.findTileInCaches(t.scaledTo(h--).key);return _}findTileInCaches(t){let r=this.tileManager.getTileByID(t);return r||(r=this.tileManager._outOfViewCache.getByKey(t),r)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,r){return r[t.canonical.z]&&t.canonical.x>=r[t.canonical.z].minTileX&&t.canonical.x<=r[t.canonical.z].maxTileX&&t.canonical.y>=r[t.canonical.z].minTileY&&t.canonical.y<=r[t.canonical.z].maxTileY}}class jt{constructor(t,r,l){this._meshCache={},this.painter=t,this.tileManager=new ci(r),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,r,l,h=f.a5){var _;if(!(r>=0&&r<h&&l>=0&&l<h))return 0;const v=this.getTerrainData(t),b=(_=v.tile)===null||_===void 0?void 0:_.dem;if(!b)return 0;const S=f.cC([],[r/h*f.a5,l/h*f.a5],v.u_terrain_matrix),E=[S[0]*b.dim,S[1]*b.dim],z=Math.floor(E[0]),R=Math.floor(E[1]),I=E[0]-z,F=E[1]-R;return b.get(z,R)*(1-I)*(1-F)+b.get(z+1,R)*I*(1-F)+b.get(z,R+1)*(1-I)*F+b.get(z+1,R+1)*I*F}getElevationForLngLatZoom(t,r){if(!f.cD(r,t.wrap()))return 0;const{tileID:l,mercatorX:h,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(t,r);return this.getElevation(l,h%f.a5,_%f.a5,f.a5)}getElevationForLngLat(t,r){const l=nn(r,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let h=0;for(const _ of l)_.canonical.z>h&&(h=Math.min(_.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(t,h)}getElevation(t,r,l,h=f.a5){return this.getDEMElevation(t,r,l,h)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const h=this.painter.context,_=new f.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new f.T(h,_,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new f.T(h,new f.R({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=f.ar([])}const r=this.tileManager.getSourceTile(t,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const h=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new f.T(h,r.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),r.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const l=r&&r.toString()+r.tileID.key+t.key;if(l&&!this._demMatrixCache[l]){const h=this.tileManager.getSource().maxzoom;let _=t.canonical.z-r.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=h?_=t.canonical.z-h:f.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=t.canonical.x-(t.canonical.x>>_<<_),b=t.canonical.y-(t.canonical.y>>_<<_),S=f.cE(new Float64Array(16),[1/(f.a5<<_),1/(f.a5<<_),0]);f.O(S,S,[v*f.a5,b*f.a5,0]),this._demMatrixCache[t.key]={matrix:S,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(t){const r=this.painter,l=r.width/devicePixelRatio,h=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new f.T(r.context,{width:l,height:h,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new f.T(r.context,{width:l,height:h,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(l,h,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,l,h))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,v=0;_<this._coordsTextureSize;_++)for(let b=0;b<this._coordsTextureSize;b++,v+=4)r[v+0]=255&b,r[v+1]=255&_,r[v+2]=b>>8<<4|_>>8,r[v+3]=0;const l=new f.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),h=new f.T(t,l,t.gl.RGBA,{premultiply:!1});return h.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const r=new Uint8Array(4),l=this.painter.context,h=l.gl,_=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),b=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(_,b-v-1,1,1,h.RGBA,h.UNSIGNED_BYTE,r),l.bindFramebuffer.set(null);const S=r[0]+(r[2]>>4<<8),E=r[1]+((15&r[2])<<8),z=this.coordsIndex[255-r[3]],R=z&&this.tileManager.getTileByID(z);if(!R)return null;const I=this._coordsTextureSize,F=(1<<R.tileID.canonical.z)*I;return new f.a9((R.tileID.canonical.x*I+S)/F+R.tileID.wrap,(R.tileID.canonical.y*I+E)/F,this.getElevation(R.tileID,S,E,I))}depthAtPoint(t){const r=new Uint8Array(4),l=this.painter.context,h=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),h.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,r),l.bindFramebuffer.set(null),(r[0]/16777216+r[1]/65536+r[2]/256+r[3])/256}getTerrainMesh(t){var r;const l=((r=this.painter.style.projection)===null||r===void 0?void 0:r.transitionState)>0,h=l&&t.canonical.y===0,_=l&&t.canonical.y===(1<<t.canonical.z)-1,v=`m_${h?"n":""}_${_?"s":""}`;if(this._meshCache[v])return this._meshCache[v];const b=this.painter.context,S=new f.cF,E=new f.aY,z=this.meshSize,R=f.a5/z,I=z*z;for(let ee=0;ee<=z;ee++)for(let ce=0;ce<=z;ce++)S.emplaceBack(ce*R,ee*R,0);for(let ee=0;ee<I;ee+=z+1)for(let ce=0;ce<z;ce++)E.emplaceBack(ce+ee,z+ce+ee+1,z+ce+ee+2),E.emplaceBack(ce+ee,z+ce+ee+2,ce+ee+1);const F=S.length,U=F+(z+1),Y=(z+1)*z,W=h?f.br:0,$=h?0:1,K=_?f.bs:f.a5,ne=_?0:1;for(let ee=0;ee<=z;ee++)S.emplaceBack(ee*R,W,$);for(let ee=0;ee<=z;ee++)S.emplaceBack(ee*R,K,ne);for(let ee=0;ee<z;ee++)E.emplaceBack(Y+ee,U+ee,U+ee+1),E.emplaceBack(Y+ee,U+ee+1,Y+ee+1),E.emplaceBack(0+ee,F+ee+1,F+ee),E.emplaceBack(0+ee,0+ee+1,F+ee+1);const Q=S.length,ie=Q+2*(z+1);for(const ee of[0,1])for(let ce=0;ce<=z;ce++)for(const Me of[0,1])S.emplaceBack(ee*f.a5,ce*R,Me);for(let ee=0;ee<2*z;ee+=2)E.emplaceBack(Q+ee,Q+ee+1,Q+ee+3),E.emplaceBack(Q+ee,Q+ee+3,Q+ee+2),E.emplaceBack(ie+ee,ie+ee+3,ie+ee+1),E.emplaceBack(ie+ee,ie+ee+2,ie+ee+3);const se=new Ei(b.createVertexBuffer(S,Vt.members),b.createIndexBuffer(E),f.aX.simpleSegment(0,0,S.length,E.length));return this._meshCache[v]=se,se}getMeshFrameDelta(t){return 2*Math.PI*f.bE/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,r){var l;if(!f.cD(r,t.wrap()))return 0;const{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(t,r);return(l=this.getMinMaxElevation(h).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(t){const r=this.getTerrainData(t).tile,l={minElevation:null,maxElevation:null};return r&&r.dem&&(l.minElevation=r.dem.min*this.exaggeration,l.maxElevation=r.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(t,r){const l=f.a9.fromLngLat(t.wrap()),h=(1<<r)*f.a5,_=l.x*h,v=l.y*h,b=Math.floor(_/f.a5),S=Math.floor(v/f.a5);return{tileID:new f.a2(r,0,r,b,S),mercatorX:_,mercatorY:v}}}class qi{constructor(t,r,l){this._context=t,this._size=r,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new f.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(l.texture),{id:t,fbo:r,texture:l,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((r=>t.id!==r)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const _r={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Br{constructor(t,r){this.painter=t,this.terrain=r,this.pool=new qi(t.context,30,r.tileManager.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((l=>!t._layers[l].isHidden(r))),this._coordsAscending={};for(const l in t.tileManagers){this._coordsAscending[l]={};const h=t.tileManagers[l].getVisibleCoordinates(),_=t.tileManagers[l].getSource(),v=_ instanceof Ea?_.terrainTileRanges:null;for(const b of h){const S=this.terrain.tileManager.getTerrainCoords(b,v);for(const E in S)this._coordsAscending[l][E]||(this._coordsAscending[l][E]=[]),this._coordsAscending[l][E].push(S[E])}}this._coordsAscendingStr={};for(const l of t._order){const h=t._layers[l],_=h.source;if(_r[h.type]&&!this._coordsAscendingStr[_]){this._coordsAscendingStr[_]={};for(const v in this._coordsAscending[_])this._coordsAscendingStr[_][v]=this._coordsAscending[_][v].map((b=>b.key)).sort().join()}}for(const l of this._renderableTiles)for(const h in this._coordsAscendingStr){const _=this._coordsAscendingStr[h][l.tileID.key];_&&_!==l.rttCoords[h]&&(l.rtt=[])}}renderLayer(t,r){if(t.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},r),{isRenderingToTexture:!0}),h=t.type,_=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(_r[h]&&(this._prevType&&_r[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(t.id),!v))return!0;if(_r[this._prevType]||_r[h]&&v){this._prevType=h;const b=this._stacks.length-1,S=this._stacks[b]||[];for(const E of this._renderableTiles){if(this.pool.isFull()&&(Mc(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(E),E.rtt[b]){const R=this.pool.getObjectForId(E.rtt[b].id);if(R.stamp===E.rtt[b].stamp){this.pool.useObject(R);continue}}const z=this.pool.getOrCreateFreeObject();this.pool.useObject(z),this.pool.stampObject(z),E.rtt[b]={id:z.id,stamp:z.stamp},_.context.bindFramebuffer.set(z.fbo.framebuffer),_.context.clear({color:f.bp.transparent,stencil:0}),_.currentStencilSource=void 0;for(let R=0;R<S.length;R++){const I=_.style._layers[S[R]],F=I.source?this._coordsAscending[I.source][E.tileID.key]:[E.tileID];_.context.viewport.set([0,0,z.fbo.width,z.fbo.height]),_._renderTileClippingMasks(I,F,!0),_.renderLayer(_,_.style.tileManagers[I.source],I,F,l),I.source&&(E.rttCoords[I.source]=this._coordsAscendingStr[I.source][E.tileID.key])}}return Mc(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),_r[h]}return!1}}const Yo={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},$o=De,Os={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Qi,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:f.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},Sh={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Fi{constructor(t,r,l=!1){this.mousedown=_=>{this.startMove(_,Te.mousePos(this.element,_)),Te.addEventListener(window,"mousemove",this.mousemove),Te.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=_=>{this.move(_,Te.mousePos(this.element,_))},this.mouseup=_=>{this._rotatePitchHandler.dragEnd(_),this.offTemp()},this.touchstart=_=>{_.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Te.touchPos(this.element,_.targetTouches)[0],this.startMove(_,this._startPos),Te.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Te.addEventListener(window,"touchend",this.touchend))},this.touchmove=_=>{_.targetTouches.length!==1?this.reset():(this._lastPos=Te.touchPos(this.element,_.targetTouches)[0],this.move(_,this._lastPos))},this.touchend=_=>{_.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=r;const h=new Bu;this._rotatePitchHandler=new pr({clickTolerance:3,move:(_,v)=>{const b=r.getBoundingClientRect(),S=new f.P((b.bottom-b.top)/2,(b.right-b.left)/2);return{bearingDelta:f.cx(new f.P(_.x,v.y),v,S),pitchDelta:l?-.5*(v.y-_.y):void 0}},moveStateManager:h,enable:!0,assignEvents:()=>{}}),this.map=t,Te.addEventListener(r,"mousedown",this.mousedown),Te.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),Te.addEventListener(r,"touchcancel",this.reset)}startMove(t,r){this._rotatePitchHandler.dragStart(t,r),Te.disableDrag()}move(t,r){const l=this.map,{bearingDelta:h,pitchDelta:_}=this._rotatePitchHandler.dragMove(t,r)||{};h&&l.setBearing(l.getBearing()+h),_&&l.setPitch(l.getPitch()+_)}off(){const t=this.element;Te.removeEventListener(t,"mousedown",this.mousedown),Te.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),Te.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Te.removeEventListener(window,"touchend",this.touchend),Te.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){Te.enableDrag(),Te.removeEventListener(window,"mousemove",this.mousemove),Te.removeEventListener(window,"mouseup",this.mouseup),Te.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Te.removeEventListener(window,"touchend",this.touchend)}}let kr;function Vl(m,t,r,l=!1){if(l||!r.getCoveringTilesDetailsProvider().allowWorldCopies())return m?.wrap();const h=new f.V(m.lng,m.lat);if(m=new f.V(m.lng,m.lat),t){const _=new f.V(m.lng-360,m.lat),v=new f.V(m.lng+360,m.lat),b=r.locationToScreenPoint(m).distSqr(t);r.locationToScreenPoint(_).distSqr(t)<b?m=_:r.locationToScreenPoint(v).distSqr(t)<b&&(m=v)}for(;Math.abs(m.lng-r.center.lng)>180;){const _=r.locationToScreenPoint(m);if(_.x>=0&&_.y>=0&&_.x<=r.width&&_.y<=r.height)break;m.lng>r.center.lng?m.lng-=360:m.lng+=360}return m.lng!==h.lng&&r.isPointOnMapSurface(r.locationToScreenPoint(m))?m:h}const Ul={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Uu(m,t,r){const l=m.classList;for(const h in Ul)l.remove(`maplibregl-${r}-anchor-${h}`);l.add(`maplibregl-${r}-anchor-${t}`)}class Gu extends f.E{constructor(t){if(super(),this._onKeyPress=r=>{const l=r.code,h=r.charCode||r.keyCode;l!=="Space"&&l!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=r=>{const l=r.originalEvent.target,h=this._element;this._popup&&(l===h||h.contains(l))&&this.togglePopup()},this._update=r=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();(r?.type==="terrain"||r?.type==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=Vl(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||r&&r.type!=="moveend"||(this._pos=this._pos.round()),Te.setTransform(this._element,`${Ul[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${_} ${h}`),Xt.frameAsync(new AbortController).then((()=>{this._updateOpacity(r&&r.type==="moveend")})).catch((()=>{}))},this._onMove=r=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new f.l("dragstart"))),this.fire(new f.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new f.l("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=f.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Te.create("div");const r=Te.createNS("http://www.w3.org/2000/svg","svg"),l=41,h=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${l}px`),r.setAttributeNS(null,"width",`${h}px`),r.setAttributeNS(null,"viewBox",`0 0 ${h} ${l}`);const _=Te.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const v=Te.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const b=Te.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const $ of S){const K=Te.createNS("http://www.w3.org/2000/svg","ellipse");K.setAttributeNS(null,"opacity","0.04"),K.setAttributeNS(null,"cx","10.5"),K.setAttributeNS(null,"cy","5.80029008"),K.setAttributeNS(null,"rx",$.rx),K.setAttributeNS(null,"ry",$.ry),b.appendChild(K)}const E=Te.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill",this._color);const z=Te.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),E.appendChild(z);const R=Te.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000");const I=Te.createNS("http://www.w3.org/2000/svg","path");I.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild(I);const F=Te.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(6.0, 7.0)"),F.setAttributeNS(null,"fill","#FFFFFF");const U=Te.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Y=Te.createNS("http://www.w3.org/2000/svg","circle");Y.setAttributeNS(null,"fill","#000000"),Y.setAttributeNS(null,"opacity","0.25"),Y.setAttributeNS(null,"cx","5.5"),Y.setAttributeNS(null,"cy","5.5"),Y.setAttributeNS(null,"r","5.4999962");const W=Te.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#FFFFFF"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962"),U.appendChild(Y),U.appendChild(W),v.appendChild(b),v.appendChild(E),v.appendChild(R),v.appendChild(F),v.appendChild(U),r.appendChild(v),r.setAttributeNS(null,"height",l*this._scale+"px"),r.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(r),this._offset=f.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(r=>{r.preventDefault()})),this._element.addEventListener("mousedown",(r=>{r.preventDefault()})),Uu(this._element,this._anchor,"marker"),t&&t.className)for(const r of t.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Te.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=f.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const h=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var r,l;const h=(r=this._map)===null||r===void 0?void 0:r.terrain,_=this._map.transform.isLocationOccluded(this._lngLat);if(!h||_){const F=_?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==F&&(this._element.style.opacity=F))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const v=this._map,b=v.terrain.depthAtPoint(this._pos),S=v.terrain.getElevationForLngLat(this._lngLat,v.transform);if(v.transform.lngLatToCameraDepth(this._lngLat,S)-b<.006)return void(this._element.style.opacity=this._opacity);const E=-this._offset.y/v.transform.pixelsPerMeter,z=Math.sin(v.getPitch()*Math.PI/180)*E,R=v.terrain.depthAtPoint(new f.P(this._pos.x,this._pos.y-this._offset.y)),I=v.transform.lngLatToCameraDepth(this._lngLat,S+z)-R>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&I&&this._popup.remove(),this._element.style.opacity=I?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=f.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,r){return(this._opacity===void 0||t===void 0&&r===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),r!==void 0&&(this._opacityWhenCovered=r),this._map&&this._updateOpacity(!0),this}}const qu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let go=0,Fs=!1;const ea={maxWidth:100,unit:"metric"};function Zi(m,t,r){const l=r&&r.maxWidth||100,h=m._container.clientHeight/2,_=m._container.clientWidth/2,v=m.unproject([_-l/2,h]),b=m.unproject([_+l/2,h]),S=Math.round(m.project(b).x-m.project(v).x),E=Math.min(l,S,m._container.clientWidth),z=v.distanceTo(b);if(r&&r.unit==="imperial"){const R=3.2808*z;R>5280?ms(t,E,R/5280,m._getUIString("ScaleControl.Miles")):ms(t,E,R,m._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?ms(t,E,z/1852,m._getUIString("ScaleControl.NauticalMiles")):z>=1e3?ms(t,E,z/1e3,m._getUIString("ScaleControl.Kilometers")):ms(t,E,z,m._getUIString("ScaleControl.Meters"))}function ms(m,t,r,l){const h=(function(_){const v=Math.pow(10,`${Math.floor(_)}`.length-1);let b=_/v;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:(function(S){const E=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*E)/E})(b),v*b})(r);m.style.width=t*(h/r)+"px",m.innerHTML=`${h}&nbsp;${l}`}const Wo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Qo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Gl(m){if(m){if(typeof m=="number"){const t=Math.round(Math.abs(m)/Math.SQRT2);return{center:new f.P(0,0),top:new f.P(0,m),"top-left":new f.P(t,t),"top-right":new f.P(-t,t),bottom:new f.P(0,-m),"bottom-left":new f.P(t,-t),"bottom-right":new f.P(-t,-t),left:new f.P(m,0),right:new f.P(-m,0)}}if(m instanceof f.P||Array.isArray(m)){const t=f.P.convert(m);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:f.P.convert(m.center||[0,0]),top:f.P.convert(m.top||[0,0]),"top-left":f.P.convert(m["top-left"]||[0,0]),"top-right":f.P.convert(m["top-right"]||[0,0]),bottom:f.P.convert(m.bottom||[0,0]),"bottom-left":f.P.convert(m["bottom-left"]||[0,0]),"bottom-right":f.P.convert(m["bottom-right"]||[0,0]),left:f.P.convert(m.left||[0,0]),right:f.P.convert(m.right||[0,0])}}return Gl(new f.P(0,0))}const Or=De;O.AJAXError=f.cI,O.Event=f.l,O.Evented=f.E,O.LngLat=f.V,O.MercatorCoordinate=f.a9,O.Point=f.P,O.addProtocol=f.cJ,O.config=f.c,O.removeProtocol=f.cK,O.AttributionControl=on,O.BoxZoomHandler=po,O.CanvasSource=V,O.CooperativeGesturesHandler=at,O.DoubleClickZoomHandler=Ic,O.DragPanHandler=Th,O.DragRotateHandler=Ja,O.EdgeInsets=qa,O.FullscreenControl=class extends f.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var t;let r=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=r?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)r=r.shadowRoot.fullscreenElement;r===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:f.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=Te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Te.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=Te.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Te.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new f.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new f.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},O.GeoJSONSource=Fn,O.GeolocateControl=class extends f.E{constructor(m){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new f.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new f.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const r=new f.V(t.coords.longitude,t.coords.latitude),l=t.coords.accuracy,h=this._map.getBearing(),_=f.e({bearing:h},this.options.fitBoundsOptions),v=tn.fromLngLat(r,l);this._map.fitBounds(v,_,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const r=new f.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Fs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new f.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=Te.create("button","maplibregl-ctrl-geolocate",this._container),Te.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){f.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Te.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Gu({element:this._dotElement}),this._circleElement=Te.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Gu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(r=>{const l=r?.[0]instanceof ResizeObserverEntry;r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new f.l("trackuserlocationend")),this.fire(new f.l("userlocationlostfocus")))}))}},this.options=f.e({},qu,m)}onAdd(m){return this._map=m,this._container=Te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return f._(this,arguments,void 0,(function*(t=!1){if(kr!==void 0&&!t)return kr;if(window.navigator.permissions===void 0)return kr=!!window.navigator.geolocation,kr;try{kr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{kr=!!window.navigator.geolocation}return kr}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Te.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,go=0,Fs=!1}_isOutOfMapMaxBounds(m){const t=this._map.getMaxBounds(),r=m.coords;return t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const m=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&m))return;const t=this._map.project(m),r=this._map.unproject([t.x+100,t.y]),l=m.distanceTo(r)/100,h=2*this._accuracy/l;this._circleElement.style.width=`${h.toFixed(2)}px`,this._circleElement.style.height=`${h.toFixed(2)}px`}trigger(){if(!this._setup)return f.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new f.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":go--,Fs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new f.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new f.l("trackuserlocationstart")),this.fire(new f.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),go++,go>1?(m={maximumAge:6e5,timeout:0},Fs=!0):(m=this.options.positionOptions,Fs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},O.GlobeControl=class{constructor(){this._toggleProjection=()=>{var m;const t=(m=this._map.getProjection())===null||m===void 0?void 0:m.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var m;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((m=this._map.getProjection())===null||m===void 0?void 0:m.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(m){return this._map=m,this._container=Te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=Te.create("button","maplibregl-ctrl-globe",this._container),Te.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){Te.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},O.Hash=pn,O.ImageSource=Ea,O.KeyboardHandler=gi,O.LngLatBounds=tn,O.LogoControl=Vu,O.Map=class extends mn{constructor(m){var t,r;f.cG.mark(f.cH.create);const l=Object.assign(Object.assign(Object.assign({},Os),m),{canvasContextAttributes:Object.assign(Object.assign({},Os.canvasContextAttributes),m.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const h=new An,_=new Ro;if(l.minZoom!==void 0&&h.setMinZoom(l.minZoom),l.maxZoom!==void 0&&h.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&h.setMinPitch(l.minPitch),l.maxPitch!==void 0&&h.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&h.setRenderWorldCopies(l.renderWorldCopies),l.transformConstrain!==null&&h.setConstrainOverride(l.transformConstrain),super(h,_,{bearingSnap:l.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new ks,this._controls=[],this._mapId=f.af(),this._lostContextStyle={style:null,images:null},this._contextLost=b=>{b.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const S of Object.values(this.style._layers))if(S.type==="custom"&&console.warn(`Custom layer with id '${S.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),S._listeners)for(const[E]of Object.entries(S._listeners))console.warn(`Custom layer with id '${S.id}' had event listeners for event '${E}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new f.l("webglcontextlost",{originalEvent:b}))},this._contextRestored=b=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new f.l("webglcontextrestored",{originalEvent:b}))},this._onMapScroll=b=>{if(b.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Yo),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this._zoomLevelsToOverscale=l.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=l.transformCameraUpdate,this.transformConstrain=l.transformConstrain,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,l.reduceMotion!==void 0&&(Xt.prefersReducedMotion=l.reduceMotion),this._imageQueueHandle=It.addThrottleControl((()=>this.isMoving())),this._requestManager=new Dn(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let b=!1;const S=xh((E=>{this._trackResize&&!this._removed&&(this.resize(E),this.redraw())}),50);this._resizeObserver=new ResizeObserver((E=>{b?S(E):b=!0})),this._resizeObserver.observe(this._container)}this.handlers=new ju(this,l),this._hash=l.hash&&new pn(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,f.e({},l.fitBoundsOptions,{duration:0}))));const v=typeof l.style=="string"||((r=(t=l.style)===null||t===void 0?void 0:t.projection)===null||r===void 0?void 0:r.type)!=="globe";this.resize(null,v),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new on(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.maplibreLogo&&this.addControl(new Vu,l.logoPosition),this.on("style.load",(()=>{if(v||this._resizeTransform(),this.transform.unmodified){const b=f.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(b)}})),this.on("data",(b=>{this._update(b.dataType==="style"),this.fire(new f.l(`${b.dataType}data`,b))})),this.on("dataloading",(b=>{this.fire(new f.l(`${b.dataType}dataloading`,b))})),this.on("dataabort",(b=>{this.fire(new f.l("sourcedataabort",b))}))}_getMapId(){return this._mapId}setGlobalStateProperty(m,t){return this.style.setGlobalStateProperty(m,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(m,t){if(t===void 0&&(t=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new f.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=m.onAdd(this);this._controls.push(m);const l=this._controlPositions[t];return t.indexOf("bottom")!==-1?l.insertBefore(r,l.firstChild):l.appendChild(r),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new f.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(m);return t>-1&&this._controls.splice(t,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}coveringTiles(m){return nn(this.transform,m)}calculateCameraOptionsFromTo(m,t,r,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLat(r,this.transform)),super.calculateCameraOptionsFromTo(m,t,r,l)}resize(m,t=!0){const[r,l]=this._containerDimensions(),h=this._getClampedPixelRatio(r,l);if(this._resizeCanvas(r,l,h),this.painter.resize(r,l,h),this.painter.overLimit()){const v=this.painter.context.gl;this._maxCanvasSize=[v.drawingBufferWidth,v.drawingBufferHeight];const b=this._getClampedPixelRatio(r,l);this._resizeCanvas(r,l,b),this.painter.resize(r,l,b)}this._resizeTransform(t);const _=!this._moving;return _&&(this.stop(),this.fire(new f.l("movestart",m)).fire(new f.l("move",m))),this.fire(new f.l("resize",m)),_&&this.fire(new f.l("moveend",m)),this}_resizeTransform(m=!0){var t;const[r,l]=this._containerDimensions();this.transform.resize(r,l,m),(t=this._requestedCameraState)===null||t===void 0||t.resize(r,l,m)}_getClampedPixelRatio(m,t){const{0:r,1:l}=this._maxCanvasSize,h=this.getPixelRatio(),_=m*h,v=t*h;return Math.min(_>r?r/_:1,v>l?l/v:1)*h}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(tn.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom){const t=this._getTransformForUpdate();return t.setMinZoom(m),this._applyUpdatedTransform(t),this._update(),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom){const t=this._getTransformForUpdate();return t.setMaxZoom(m),this._applyUpdatedTransform(t),this._update(),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.setMinPitch(m),this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(m>=this.transform.minPitch)return this.transform.setMaxPitch(m),this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.setRenderWorldCopies(m),this._update()}setTransformConstrain(m){return this.transform.setConstrainOverride(m),this._update()}project(m){return this.transform.locationToScreenPoint(f.V.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.screenPointToLocation(f.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,t,r){if(m==="mouseenter"||m==="mouseover"){let l=!1;return{layers:t,listener:r,delegates:{mousemove:_=>{const v=t.filter((S=>this.getLayer(S))),b=v.length!==0?this.queryRenderedFeatures(_.point,{layers:v}):[];b.length?l||(l=!0,r.call(this,new Bn(m,this,_.originalEvent,{features:b}))):l=!1},mouseout:()=>{l=!1}}}}if(m==="mouseleave"||m==="mouseout"){let l=!1;return{layers:t,listener:r,delegates:{mousemove:v=>{const b=t.filter((S=>this.getLayer(S)));(b.length!==0?this.queryRenderedFeatures(v.point,{layers:b}):[]).length?l=!0:l&&(l=!1,r.call(this,new Bn(m,this,v.originalEvent)))},mouseout:v=>{l&&(l=!1,r.call(this,new Bn(m,this,v.originalEvent)))}}}}{const l=h=>{const _=t.filter((b=>this.getLayer(b))),v=_.length!==0?this.queryRenderedFeatures(h.point,{layers:_}):[];v.length&&(h.features=v,r.call(this,h),delete h.features)};return{layers:t,listener:r,delegates:{[m]:l}}}}_saveDelegatedListener(m,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(t)}_removeDelegatedListener(m,t,r){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const l=this._delegatedListeners[m];for(let h=0;h<l.length;h++){const _=l[h];if(_.listener===r&&_.layers.length===t.length&&_.layers.every((v=>t.includes(v)))){for(const v in _.delegates)this.off(v,_.delegates[v]);return void l.splice(h,1)}}}on(m,t,r){if(r===void 0)return super.on(m,t);const l=typeof t=="string"?[t]:t,h=this._createDelegatedListener(m,l,r);this._saveDelegatedListener(m,h);for(const _ in h.delegates)this.on(_,h.delegates[_]);return{unsubscribe:()=>{this._removeDelegatedListener(m,l,r)}}}once(m,t,r){if(r===void 0)return super.once(m,t);const l=typeof t=="string"?[t]:t,h=this._createDelegatedListener(m,l,r);for(const _ in h.delegates){const v=h.delegates[_];h.delegates[_]=(...b)=>{this._removeDelegatedListener(m,l,r),v(...b)}}this._saveDelegatedListener(m,h);for(const _ in h.delegates)this.once(_,h.delegates[_]);return this}off(m,t,r){return r===void 0?super.off(m,t):(this._removeDelegatedListener(m,typeof t=="string"?[t]:t,r),this)}queryRenderedFeatures(m,t){if(!this.style)return[];let r;const l=m instanceof f.P||Array.isArray(m),h=l?m:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(l?{}:m)||{},h instanceof f.P||typeof h[0]=="number")r=[f.P.convert(h)];else{const _=f.P.convert(h[0]),v=f.P.convert(h[1]);r=[_,new f.P(v.x,_.y),v,new f.P(_.x,v.y),_]}return this.style.queryRenderedFeatures(r,t,this.transform)}querySourceFeatures(m,t){return this.style.querySourceFeatures(m,t)}setStyle(m,t){return(t=f.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(m,t))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const t=this._locale[m];if(t==null)throw new Error(`Missing UI string '${m}'`);return t}_updateStyle(m,t){var r,l;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(m,t)));const h=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new no(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,t,h):this.style.loadJSON(m,t,h),this):((l=(r=this.style)===null||r===void 0?void 0:r.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new no(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,t){if(typeof m=="string"){const r=this._requestManager.transformRequest(m,"Style");f.j(r,new AbortController).then((l=>{this._updateDiff(l.data,t)})).catch((l=>{l&&this.fire(new f.k(l))}))}else typeof m=="object"&&this._updateDiff(m,t)}_updateDiff(m,t){try{this.style.setState(m,t)&&this._update(!0)}catch(r){f.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(m,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():f.w("There is no style added to the map.")}addSource(m,t){return this._lazyInitEmptyStyle(),this.style.addSource(m,t),this._update(!0)}isSourceLoaded(m){const t=this.style&&this.style.tileManagers[m];if(t!==void 0)return t.loaded();this.fire(new f.k(new Error(`There is no tile manager with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const t=this.style.tileManagers[m.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&t.reload();for(const r in this.style._layers){const l=this.style._layers[r];l.type==="hillshade"&&l.source===m.source&&f.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),l.type==="color-relief"&&l.source===m.source&&f.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new jt(this.painter,t,m),this.painter.renderToTexture=new Br(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=r=>{var l;r.dataType==="style"?this.terrain.tileManager.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==m.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((l=r.source)===null||l===void 0?void 0:l.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new f.l("terrain",{terrain:m})),this}getTerrain(){var m,t;return(t=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const m=this.style&&this.style.tileManagers;for(const t of Object.values(m))if(!t.areTilesLoaded())return!1;return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}setSourceTileLodParams(m,t,r){if(r){const l=this.getSource(r);if(!l)throw new Error(`There is no source with ID "${r}", cannot set LOD parameters`);l.calculateTileZoom=mi(Math.max(1,m),Math.max(1,t))}else for(const l in this.style.tileManagers)this.style.tileManagers[l].getSource().calculateTileZoom=mi(Math.max(1,m),Math.max(1,t));return this._update(!0),this}refreshTiles(m,t){const r=this.style.tileManagers[m];if(!r)throw new Error(`There is no tile manager with ID "${m}", cannot refresh tile`);t===void 0?r.reload(!0):r.refreshTiles(t.map((l=>new f.ac(l.z,l.x,l.y))))}addImage(m,t,r={}){const{pixelRatio:l=1,sdf:h=!1,stretchX:_,stretchY:v,content:b,textFitWidth:S,textFitHeight:E}=r;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||f.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new f.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:z,height:R,data:I}=t,F=t;return this.style.addImage(m,{data:new f.R({width:z,height:R},new Uint8Array(I)),pixelRatio:l,stretchX:_,stretchY:v,content:b,textFitWidth:S,textFitHeight:E,sdf:h,version:0,userImage:F}),F.onAdd&&F.onAdd(this,m),this}}{const{width:z,height:R,data:I}=Xt.getImageData(t);this.style.addImage(m,{data:new f.R({width:z,height:R},I),pixelRatio:l,stretchX:_,stretchY:v,content:b,textFitWidth:S,textFitHeight:E,sdf:h,version:0})}}updateImage(m,t){const r=this.style.getImage(m);if(!r)return this.fire(new f.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=t instanceof HTMLImageElement||f.b(t)?Xt.getImageData(t):t,{width:h,height:_,data:v}=l;if(h===void 0||_===void 0)return this.fire(new f.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==r.data.width||_!==r.data.height)return this.fire(new f.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const b=!(t instanceof HTMLImageElement||f.b(t));return r.data.replace(v,b),this.style.updateImage(m,r),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new f.k(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return It.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,t){return this._lazyInitEmptyStyle(),this.style.addLayer(m,t),this._update(!0)}moveLayer(m,t){return this.style.moveLayer(m,t),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,t,r){return this.style.setLayerZoomRange(m,t,r),this._update(!0)}setFilter(m,t,r={}){return this.style.setFilter(m,t,r),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,t,r,l={}){return this.style.setPaintProperty(m,t,r,l),this._update(!0)}getPaintProperty(m,t){return this.style.getPaintProperty(m,t)}setLayoutProperty(m,t,r,l={}){return this.style.setLayoutProperty(m,t,r,l),this._update(!0)}getLayoutProperty(m,t){return this.style.getLayoutProperty(m,t)}setGlyphs(m,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,t,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,t,r,(l=>{l||this._update(!0)})),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,t,(r=>{r||this._update(!0)})),this}setLight(m,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(m,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(m,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,t){return this.style.setFeatureState(m,t),this._update()}removeFeatureState(m,t){return this.style.removeFeatureState(m,t),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,t=0;return this._container&&(m=this._container.clientWidth||400,t=this._container.clientHeight||300),[m,t]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const t=this._canvasContainer=Te.create("div","maplibregl-canvas-container",m);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=Te.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),l=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],l);const h=this._controlContainer=Te.create("div","maplibregl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((v=>{_[v]=Te.create("div",`maplibregl-ctrl-${v} `,h)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,t,r){this._canvas.width=Math.floor(r*m),this._canvas.height=Math.floor(r*t),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const m=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(l=>{t={requestedAttributes:m},l&&(t.statusMessage=l.statusMessage,t.type=l.type)}),{once:!0});let r=null;if(r=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,m):this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m),!r){const l="Failed to initialize WebGL";throw t?(t.message=l,new Error(JSON.stringify(t))):new Error(l)}this.painter=new Pd(r,this.transform),Yi.testSupport(r)}migrateProjection(m,t){super.migrateProjection(m,t),this.painter.transform=m,this.fire(new f.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){var t,r,l,h,_;const v=this._idleTriggered?this._fadeDuration:0,b=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let S=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,I=bt();this.style.zoomHistory.update(R,I);const F=new f.H(R,{now:I,fadeDuration:v,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),U=F.crossFadingFactor();U===1&&U===this._crossFadingFactor||(S=!0,this._crossFadingFactor=U),this.style.update(F)}const E=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0!==b;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((h=this.style.projection)===null||h===void 0?void 0:h.transitionState,(_=this.style.projection)===null||_===void 0?void 0:_.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||E)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,E),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,showPadding:this.showPadding}),this.fire(new f.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,f.cG.mark(f.cH.load),this.fire(new f.l("load"))),this.style&&(this.style.hasTransitions()||S)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const z=this._sourcesDirty||this._styleDirty||this._placementDirty;return z||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new f.l("idle")),!this._loaded||this._fullyLoaded||z||(this._fullyLoaded=!0,f.cG.mark(f.cH.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),It.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Te.remove(this._canvasContainer),Te.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),f.cG.clearMetrics(),this._removed=!0,this.fire(new f.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Xt.frame(this._frameRequest,(m=>{f.cG.frame(m),this._frameRequest=null;try{this._render(m)}catch(t){if(!f.Z(t)&&!(function(r){return r.message===ho})(t))throw t}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return $o}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),this.style.setProjection(m),this._update(!0)}},O.MapMouseEvent=Bn,O.MapTouchEvent=Ir,O.MapWheelEvent=Ac,O.Marker=Gu,O.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const t=this._map.getZoom(),r=t===this._map.getMaxZoom(),l=t===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,r)=>{const l=this._map._getUIString(`NavigationControl.${r}`);t.title=l,t.setAttribute("aria-label",l)},this.options=f.e({},Sh,m),this._container=Te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),Te.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),Te.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=Te.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Fi(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Te.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,t){const r=Te.create("button",m,this._container);return r.type="button",r.addEventListener("click",t),r}},O.Popup=class extends f.E{constructor(m){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&Te.remove(this._content),this._container&&(Te.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new f.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Te.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Te.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const v of this.options.className.split(" "))this._container.classList.add(v);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Vl(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const r=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let l=this.options.anchor;const h=Gl(this.options.offset);if(!l){const v=this._container.offsetWidth,b=this._container.offsetHeight;let S;S=r.y+h.bottom.y<b?["top"]:r.y>this._map.transform.height-b?["bottom"]:[],r.x<v/2?S.push("left"):r.x>this._map.transform.width-v/2&&S.push("right"),l=S.length===0?"bottom":S.join("-")}let _=r.add(h[l]);this.options.subpixelPositioning||(_=_.round()),Te.setTransform(this._container,`${Ul[l]} translate(${_.x}px,${_.y}px)`),Uu(this._container,l,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=f.e(Object.create(Wo),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new f.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=f.V.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const t=document.createDocumentFragment(),r=document.createElement("body");let l;for(r.innerHTML=m;l=r.firstChild,l;)t.appendChild(l);return this.setDOMContent(t)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Te.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=Te.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Qo);m&&m.focus()}},O.RasterDEMTileSource=Hr,O.RasterTileSource=$s,O.ScaleControl=class{constructor(m){this._onMove=()=>{Zi(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Zi(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},ea),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=Te.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Te.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},O.ScrollZoomHandler=Fu,O.Style=no,O.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=Te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Te.create("button","maplibregl-ctrl-terrain",this._container),Te.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Te.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},O.TwoFingersTouchPitchHandler=Ls,O.TwoFingersTouchRotateHandler=Ou,O.TwoFingersTouchZoomHandler=fs,O.TwoFingersTouchZoomRotateHandler=Xo,O.VectorTileSource=Ts,O.VideoSource=me,O.addSourceType=(m,t)=>f._(void 0,void 0,void 0,(function*(){if(H(m))throw new Error(`A source type called "${m}" already exists.`);((r,l)=>{j[r]=l})(m,t)})),O.clearPrewarmedResources=function(){const m=Yt;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(ht),Yt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},O.createTileMesh=yd,O.getMaxParallelImageRequests=function(){return f.c.MAX_PARALLEL_IMAGE_REQUESTS},O.getRTLTextPluginStatus=function(){return fe().getRTLTextPluginStatus()},O.getVersion=function(){return Or},O.getWorkerCount=function(){return _t.workerCount},O.getWorkerUrl=function(){return f.c.WORKER_URL},O.importScriptInWorkers=function(m){return Ys().broadcast("IS",m)},O.isTimeFrozen=function(){return di.isFrozen()},O.now=bt,O.prewarm=function(){Bi().acquire(ht)},O.restoreNow=function(){di.restoreNow()},O.setMaxParallelImageRequests=function(m){f.c.MAX_PARALLEL_IMAGE_REQUESTS=m},O.setNow=function(m){di.setNow(m)},O.setRTLTextPlugin=function(m,t){return fe().setRTLTextPlugin(m,t)},O.setWorkerCount=function(m){_t.workerCount=m},O.setWorkerUrl=function(m){f.c.WORKER_URL=m}}));var mt=Tt;return mt}))})(qm)),qm.exports}var g_=m_();const pg=gg(g_);function __({item:et,onClick:Wt}){return et?At.jsxs("div",{className:"marker-container",onClick:Wt,children:[At.jsx("div",{className:"modern-floating-card",children:At.jsx("div",{className:"card-glass-header",children:At.jsxs("div",{className:"text-content",children:[At.jsx("div",{className:"card-title",children:et?.title||"Untitled Project"}),et.description&&At.jsx("div",{className:"card-subtitle",children:et.description})]})})}),At.jsx("div",{className:"marker-line"})]}):null}function y_({focusCoords:et,activeProjectCoords:Wt,items:Tt,onProjectClick:Se,isDrawerOpen:yt,showAll:mt}){const O=bs.useRef(null),f=bs.useRef(null),De=bs.useRef([]),qe=bs.useRef([]);return bs.useEffect(()=>{if(f.current)return O.current=new pg.Map({container:f.current,style:"https://tiles.basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",center:[0,20],zoom:2.2,attributionControl:!1,maxTileCacheSize:500,fadeDuration:300,minZoom:2.4}),O.current.on("style.load",()=>{O.current?.setProjection({type:"globe"}),O.current?.setRenderWorldCopies(!0)}),()=>O.current?.remove()},[]),bs.useEffect(()=>{const xt=O.current;if(!xt)return;xt.stop();const ut=yt?450:100,Bt=100;if(Wt){xt.flyTo({center:Wt,zoom:12,padding:{top:Bt,bottom:Bt,left:100,right:ut},duration:1500,essential:!0});return}if(mt&&!yt){xt.flyTo({center:[0,20],zoom:2.2,padding:{top:0,bottom:0,left:0,right:0},duration:1500,essential:!0});return}if(Tt&&Tt.length>0){if(Tt.length===1)xt.flyTo({center:[Tt[0].lng,Tt[0].lat],zoom:12,padding:{top:100,bottom:100,left:100,right:yt?450:100},duration:1500,essential:!0});else{const Xt=Tt.map(Yi=>Yi.lat),di=Tt.map(Yi=>Yi.lng),bt=[[Math.min(...di),Math.min(...Xt)],[Math.max(...di),Math.max(...Xt)]],Te=xt.cameraForBounds(bt,{padding:{top:150,bottom:150,left:150,right:yt?500:150}});Te&&xt.flyTo({center:Te.center,zoom:Te.zoom,duration:1500,essential:!0})}return}xt.flyTo({center:[0,20],zoom:2.2,padding:{top:0,bottom:0,left:0,right:0},duration:1500})},[et,Tt,yt,Wt,mt]),bs.useEffect(()=>{if(!O.current)return;De.current.forEach(ut=>ut.remove()),De.current=[];const xt=[...qe.current];qe.current=[],setTimeout(()=>{xt.forEach(ut=>{try{ut.unmount()}catch{}})},0),Tt.length!==0&&Tt.forEach(ut=>{const Bt=[ut.lng,ut.lat];if(ut.lng===void 0||ut.lat===void 0)return;const Xt=document.createElement("div"),di=Vg.createRoot(Xt);di.render(At.jsx(__,{item:ut,onClick:()=>Se(ut)})),qe.current.push(di);const bt=new pg.Marker({element:Xt,anchor:"bottom",pitchAlignment:"map",rotationAlignment:"viewport"}).setLngLat(Bt).addTo(O.current),Te=document.createElement("div");Te.className="pulse-wrapper",Te.innerHTML='<div class="pulse-dot"></div><div class="pulse-ring"></div>';const Yi=new pg.Marker({element:Te,pitchAlignment:"map",rotationAlignment:"map",anchor:"center"}).setLngLat(Bt).addTo(O.current);De.current.push(bt,Yi)})},[Tt]),At.jsx("div",{ref:f,style:{width:"100%",height:"100%"}})}function v_({onSearch:et}){const[Wt,Tt]=bs.useState(""),Se=mt=>{mt.key==="Enter"&&et(Wt)},yt=()=>{Tt(""),et("")};return At.jsxs("div",{className:"search-bar-wrapper",children:[At.jsx("input",{type:"text",placeholder:"Search country...",value:Wt,onChange:mt=>Tt(mt.target.value),onKeyDown:Se}),Wt&&At.jsx("button",{className:"clear-x",onClick:yt,children:""})]})}async function x_(et){if(!et)return null;const Wt=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(et)}`,Se=await(await fetch(Wt,{headers:{"User-Agent":"globe-maplibre-demo"}})).json();return Se.length?[parseFloat(Se[0].lon),parseFloat(Se[0].lat)]:null}const b_={coords:[-106.3468,56.1304],projects:[{id:"aurora-01",title:"Aurora",lat:43.9988,lng:-79.44829,description:"A high-altitude cinematic capture of the Northern Lights.",icon:"sparkles",thumbnail:"https://path-to-small-preview.jpg",details:{longDescription:"Extended technical details about the Aurora project...",media:[{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Aurora-1.png",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Aurora-2.png",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Aurora-3.png",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Aurora-4.png",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Aurora-4-1.png",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Aurora-3-1.png",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Aurora-2-1.png",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Aurora-1-1.png",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Aurora-6.png",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Aurora-5.png",caption:"Static Render"},{type:"video",src:"https://youtu.be/DVYXIENRRNs",caption:"Animation"}],links:[{label:"Visit Site",url:"https://www.aurora.ca/business-and-development/auroras-digital-twin/"},{label:"Digital Twin",url:"https://aurora.metaworldx.com/"}]}},{id:"toronto-01",title:"Toronto",lat:43.64253,lng:-79.38707,description:"A high-altitude cinematic capture of the Northern Lights.",icon:"sparkles",thumbnail:"https://path-to-small-preview.jpg",details:{longDescription:"Extended technical details about the Aurora project...",media:[{type:"image",src:"https://metaworldx.com/wp-content/uploads/2016/01/Toronto-Digital-Twin-4.jpg",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2016/01/Toronto-Digital-Twin-3.jpg",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2016/01/Toronto-Digital-Twin-2.jpg",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2016/01/Toronto-Digital-Twin-1.jpg",caption:"Static Render"},{type:"video",src:"https://youtu.be/1K15kGJLS4k?si=5px3kd6FkvXPX0rD",caption:"Animation"}],links:[{label:"Visit Site",url:"https://metaworldx.com/project/toronto-digital-twin/"}]}}]},w_={coords:[25.2092,55.27014],projects:[{id:"airport-01",title:"Dubai Airport",lat:25.25244,lng:55.36828,description:"A high-altitude cinematic capture of the Northern Lights.",icon:"sparkles",thumbnail:"https://path-to-small-preview.jpg",details:{longDescription:"Extended technical details about the Aurora project...",media:[{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Dubai-Airport-1.jpg",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Dubai-Airport-3.jpg",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Dubai-Airport-2.jpg",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Dubai-Airport-1.png",caption:"Static Render"},{type:"video",src:"https://youtu.be/DVYXIENRRNs",caption:"Animation"}],links:[{label:"Visit Site",url:"https://metaworldx.com/project/dubai-airport/"}]}},{id:"siliconoasis-01",title:"Dubai Silicon Oasis",lat:25.11858,lng:55.38057,description:"A high-altitude cinematic capture of the Northern Lights.",icon:"sparkles",thumbnail:"https://path-to-small-preview.jpg",details:{longDescription:"Extended technical details about the Aurora project...",media:[{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Dubai-Silicon-Oasis-1-scaled.jpg",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Dubai-Silicon-Oasis-2-scaled.jpg",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Dubai-Silicon-Oasis-3-scaled.jpg",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Dubai-Silicon-Oasis-4-scaled.jpg",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Dubai-Silicon-Oasis-2-1.jpg",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Dubai-Silicon-Oasis-1-1.jpg",caption:"Static Render"},{type:"video",src:"https://drive.google.com/file/d/1vFZjwqzJqT-ABV6dss4U4-jgn2P6vvMc/view?usp=sharing",caption:"Animation"}],links:[{label:"Visit Site",url:"https://metaworldx.com/project/dubai-airport/"},{label:"Digital Twin",url:"https://connector.eagle3dstreaming.com/v5/adeeMWX/DubaiSiliconOasis/DubaiLatest"}]}}]},T_={coords:[25.2092,55.27014],projects:[{id:"thedam-01",title:"The Dam",lat:17.70091,lng:42.6487,description:"A high-altitude cinematic capture of the Northern Lights.",icon:"sparkles",thumbnail:"https://path-to-small-preview.jpg",details:{longDescription:"Extended technical details about the Aurora project...",media:[{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/The-Dam-1.png",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/The-Dam-6.png",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/The-Dam-4.png",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/The-Dam-3.png",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/The-Dam-2.png",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/The-Dam-1.jpg",caption:"Static Render"},{type:"video",src:"https://youtu.be/DVYXIENRRNs",caption:"Animation"}],links:[{label:"Visit Site",url:"https://metaworldx.com/project/dubai-airport/"},{label:"Digital Twin",url:"https://connector.eagle3dstreaming.com/v5/adeeMWX/Dam/Dam"}]}},{id:"luxuryvilla-01",title:"Luxury Smart Villa",lat:29.80132,lng:39.89514,description:"A high-altitude cinematic capture of the Northern Lights.",icon:"sparkles",thumbnail:"https://path-to-small-preview.jpg",details:{longDescription:"Extended technical details about the Aurora project...",media:[{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Luxury-Smart-Villa-4.png",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Luxury-Smart-Villa-3.png",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Luxury-Smart-Villa-2.png",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Luxury-Smart-Villa-1.png",caption:"Static Render"},{type:"video",src:"https://youtu.be/DVYXIENRRNs",caption:"Animation"}],links:[{label:"Visit Site",url:"https://metaworldx.com/project/dubai-airport/"}]}},{id:"neom-01",title:"Neom",lat:28.09779,lng:35.11815,description:"A high-altitude cinematic capture of the Northern Lights.",icon:"sparkles",thumbnail:"https://path-to-small-preview.jpg",details:{longDescription:"Extended technical details about the Aurora project...",media:[{type:"video",src:"https://drive.google.com/file/d/1FdFvLSLDGPo5uSviu3fQMA3s_WXKfqkK/view?usp=sharing",caption:"Animation"}],links:[{label:"Digital Twin",url:"https://connector.eagle3dstreaming.com/v5/adeeMWX/Neom/Neom"}]}}]},S_={coords:[25.2092,55.27014],projects:[{id:"losangeles-01",title:"LA Wildfires",lat:34.05172,lng:-118.27843,description:"A high-altitude cinematic capture of the Northern Lights.",icon:"sparkles",thumbnail:"https://path-to-small-preview.jpg",details:{longDescription:"Extended technical details about the Aurora project...",media:[{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/LA-Wildfires-5.png",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/LA-Wildfires-4.png",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/LA-Wildfires-3.png",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/LA-Wildfires-2.png",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/LA-Wildfires-1.png",caption:"Static Render"},{type:"video",src:"https://youtu.be/DVYXIENRRNs",caption:"Animation"}],links:[{label:"Visit Site",url:"https://metaworldx.com/project/la-wildfire/"},{label:"Digital Twin",url:"https://aurora.metaworldx.com/"}]}}]},M_={coords:[25.2092,55.27014],projects:[{id:"martinique-01",title:"Martinique",lat:14.68601,lng:-61.03383,description:"A high-altitude cinematic capture of the Northern Lights.",icon:"sparkles",thumbnail:"https://path-to-small-preview.jpg",details:{longDescription:"Extended technical details about the Aurora project...",media:[{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Martinique-3.png",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Martinique-2.png",caption:"Static Render"},{type:"image",src:"https://metaworldx.com/wp-content/uploads/2025/01/Martinique-1.png",caption:"Static Render"},{type:"video",src:"https://youtu.be/DVYXIENRRNs",caption:"Animation"}],links:[{label:"Visit Site",url:"https://metaworldx.com/project/la-wildfire/"},{label:"Digital Twin",url:"https://aurora.metaworldx.com/"}]}}]},A_={coords:[25.2092,55.27014],projects:[{id:"madrid-01",title:"Madrid",lat:14.68601,lng:-61.03383,description:"A high-altitude cinematic capture of the Northern Lights.",icon:"sparkles",thumbnail:"https://path-to-small-preview.jpg",details:{longDescription:"Extended technical details about the Aurora project...",media:[],links:[{label:"Digital Twin",url:"https://connector.eagle3dstreaming.com/v5/adeeMWX/Madrid/MadridMwX"}]}}]},E_={coords:[25.2092,55.27014],projects:[{id:"muscat-01",title:"Muscat Bay",lat:23.54829,lng:58.63562,description:"A high-altitude cinematic capture of the Northern Lights.",icon:"sparkles",thumbnail:"https://path-to-small-preview.jpg",details:{longDescription:"Extended technical details about the Aurora project...",media:[{type:"video",src:"https://drive.google.com/file/d/1oHVUY3ayIuNftSdvD-Vio7arsHC7nX2F/view?usp=sharing",caption:"Animation"}],links:[{label:"Digital Twin",url:"https://connector.eagle3dstreaming.com/v6/eyJvd25lciI6ImFkZWVNV1giLCJhcHBOYW1lIjoiTXVzY2F0QmF5IiwiY29uZmlnTmFtZSI6Ik11c2NhdEJheSJ9"}]}},{id:"waste-01",title:"Waste Management",lat:23.29889,lng:58.42928,description:"A high-altitude cinematic capture of the Northern Lights.",icon:"sparkles",thumbnail:"https://path-to-small-preview.jpg",details:{longDescription:"Extended technical details about the Aurora project...",media:[],links:[{label:"Digital Twin",url:"https://connector.eagle3dstreaming.com/v6/eyJvd25lciI6ImFkZWVNV1giLCJhcHBOYW1lIjoiV2FzdGVNYW5hZ2VtZW50IiwiY29uZmlnTmFtZSI6Ik9tYW5XTSJ9"}]}}]},C_={coords:[25.2092,55.27014],projects:[{id:"school-01",title:"School",lat:40.60305,lng:-75.48126,description:"A high-altitude cinematic capture of the Northern Lights.",icon:"sparkles",thumbnail:"https://path-to-small-preview.jpg",details:{longDescription:"Extended technical details about the Aurora project...",media:[{type:"video",src:"https://drive.google.com/file/d/1CndIh_jQMLhQRTPFzmpBTKrynGWARqDn/view?usp=sharing",caption:"Animation"}],links:[{label:"Digital Twin",url:"https://connector.eagle3dstreaming.com/v5/adeeMWX/School/School"}]}}]},mg={Canada:b_,Dubai:w_,Saudi:T_,LA:S_,caribbean:M_,madrid:A_,oman:E_,pennsylvania:C_};function z_({project:et,onClose:Wt}){const[Tt,Se]=bs.useState(null);if(!et)return null;const yt=mt=>mt?mt.includes("youtube.com/watch?v=")?`https://www.youtube.com/embed/${mt.split("v=")[1]?.split("&")[0]}`:mt.includes("youtu.be/")?`https://www.youtube.com/embed/${mt.split("youtu.be/")[1]?.split("?")[0]}`:mt.includes("drive.google.com")?mt.replace(/\/view.*|\/edit.*/,"/preview"):mt:"";return At.jsxs(At.Fragment,{children:[At.jsxs("div",{className:"side-drawer glass-panel",children:[At.jsx("button",{type:"button",className:"close-btn",onClick:Wt,"aria-label":"Close drawer",children:""}),At.jsxs("div",{className:"drawer-content",children:[At.jsxs("div",{className:"drawer-header",children:[At.jsx("span",{className:"category-tag",children:"Project Detail"}),At.jsx("h2",{children:et.title})]}),At.jsx("p",{className:"description",children:et.description}),At.jsx("div",{className:"media-gallery",children:et.details?.media?.map((mt,O)=>At.jsxs("div",{className:"media-card",onClick:()=>Se(mt),children:[mt.type==="image"?At.jsx("img",{src:mt.src,alt:mt.caption}):At.jsxs("div",{className:"video-thumb-placeholder",children:[At.jsx("div",{className:"play-icon",children:""}),At.jsx("span",{className:"video-label",children:"Play Video"})]}),At.jsx("div",{className:"media-info",children:At.jsx("span",{children:mt.caption})})]},`media-${O}`))}),et.details?.links&&et.details.links.length>0&&At.jsxs("div",{className:"project-links-container",children:[At.jsx("h3",{className:"section-label",children:"Resources"}),At.jsx("div",{className:"links-grid",children:et.details.links.map((mt,O)=>At.jsxs("a",{href:mt.url,target:"_blank",rel:"noopener noreferrer",className:"action-link-button glass-button",children:[At.jsx("span",{className:"link-icon",children:""}),mt.label]},`link-${O}`))})]})]})]}),Tt&&At.jsxs("div",{className:"full-screen-overlay glass-morph-overlay",onClick:()=>Se(null),children:[At.jsx("div",{className:"overlay-close",children:""}),At.jsxs("div",{className:"overlay-content-wrapper",onClick:mt=>mt.stopPropagation(),children:[Tt.type==="image"?At.jsx("img",{src:Tt.src,className:"maximized-media",alt:"Full view"}):At.jsx("div",{className:"iframe-container",style:{width:"100%",minWidth:"100%"},children:At.jsx("iframe",{src:yt(Tt.src),frameBorder:"0",allow:"autoplay; fullscreen; picture-in-picture",allowFullScreen:!0})}),At.jsx("div",{className:"overlay-caption",children:Tt.caption})]})]})]})}const D_="/mwxglobe/assets/mwxlogo500x62-05_xzxqV.png",P_="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAABAlBMVEUAAAD///8C19P8/Pw7Ozv29vYwMDDa2toDuesrKysC4NwBJSNtbW0C0tLf398C2NQBqMwBnsnr6+vJycleXl5lZWW3t7fl5eUBosqampq9vb02NjYBsM0Nw+8Bt83y8vICyNCSkpJ6enpJSUkBLztSUlIh2PUVy/EPDw9AQECCgoIAksgBrMwbGxsCsOIBus5C+/8AmMkCw9ClpaUAKTMi2fU48fwt5fkYz/IALzkBQ08BxtEAksYBWFcBSkkBGhwAOko51dkPW20AQ2AAO1w25/Ujvd4BOT8DQVIdttwAi8UKT1oe2vkcvOEAMjIAHSgCv8MAS04Bq70CusEBKy8Dx9i9GaVIAAAH5klEQVR4nO2aa1vaSBiGQTzUKggoigKKWBFF5eAiVLHadhWP22rt//8rO8nMm8wxhOq1H/Z67k8mMwm5M+/MvDMxkQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAf0XjrZfOTh/ZCtfmfEqx7zad4VfMZfzDfX6YWbVWnqO6BVtpQVy77R+dfa22yofFYk7wyf0MV6y4WMxmD8ubrfOvX19evZO1wk5tx1I5yZmObZhPEspxylZ3J6i7YSteFYWL/PDbdbv/uFepfOAcOxWvWGmlUtkbPPZP26eD4pV3cmVld2d+22mYim24nNQMT9THVFgP6s7Y7pXXyr7X29f1Qaj4l/0RPgm/HvPrZXPFkX+2Nl872ahZQn1Cw/CZyXBFHNnCNBNW3jVLd40r/z5un/YGQTPaFa8Cv+ubTi57yAUTi6XZ/dm3t+Fi0jBMbPGjvFm7lAorn5jF9LakPvq9ySK1Hql4y/Q8v+t6cZjLljdHVLC9XyqsjDFctHVU1yMHhtSbzFY6kCqvmXebE78tn/t+P2hfe83o6ou3vP16d51O0RtoRmHRSsE6XiqGW2MM87IgGVKYrhvVpT5riZKSKFEHodv74ulpP4hUXfGqslfv929yzZw/kHZHibEohsnlyLobiiAZJmb44Zxe/YjH7xovPtCLqYW1ieS22exLkXr8QxHce+zX75pD4VeNIagZ2rpLAPWb7S3VkMJ0Vqtf4Kd3eGgbL2/ZEqS+Yuf+hkcqd5QUHx57T837TjFbLre63Wr1nxiCuqF10FceOHnSmFENaUzUW2lVGPCm39ITDmuQCsXcadiMYaA+7B3fN3N+9+ueV2MKGobOUbUUBOOsZkijqd5Ka+JszRqN9MIsr/Q2N2z2mOJAUxzeU/fz/KpfYgkahrZR30fMbTMN05DCVL1gmlr2iP+hTZjiohlbLnmb69w/hVPj8Wd++kfol06nYwqaho7RhkYZNicYhhSmaiuJbjtN04I2X8zYGz5QbHbYmCoilebFy5cWbz8mGC9ErYaWYZ9Np1JfMwwbeVsrca9MeLES/5SyOvr9bY41Yy+YGqkVL39xvan4goqhu2soqZlhGESc5c7roY3y5tYjgtRXLDLFOx6pUl9c+On5TSKoZm0iy5jRc4N5MZbwKc80pFcj50RiuvPzqDXpakEmKkg9zopFFqlBEhcqTjHBuH3QMKR5QE+x1PzKNKTRVG4lMUf4f58YF1D+Z+QBkmKWNWMzSOKoLy6kP07SgnrmTb1DfbVa5mkxXDXfTCoMa2pjSedAeWdRirm2P+CwSKXh5ufCJIL62oJSKXkZQufoAS2Gi9ptgjOiS/MrpMl9eVyQckXmOBxSpLqXxJMYBu0VjvzGMs5iSGN/2EqrSh0uFI5EImWNCtJAsdOkJO7PFI2XTzP7vPYw4ThhM9zQ2ySvHB9or42GpnFPd3bII1VMjX+kaBg2xBiQEcc0yoTDus2woL2XXTXYG/wwyOtX4wSpUPQd2XKj50Xq53cwDKJyQ34WeX1rM6Q8mqbSbX4YvBYtrcnHClLGQ7nsK7LlBp8aJ1c0Denp/N+3jTxWww35tcgJDUdM8GLC3E9qL8Ap2Nosl/1mbIrlxoerdzCUclCaPZQljtVQhKnI2+dTalTSgn5H8R0bpM+/W74i741sudEbVO4mVbQZihwkuVUS0ZRRSq2GlCxwh5oi5JGXo3QuXpA+n3e7THGTK+aaIombcLixGs4rO0568mg1pIbnzbYsN6jPqtym4kfHbLRfVM+ZYrdFkdoZ+kncoDJZX7QaBpk2RWsMQzHF82ZKGbHt31Fs9onObWzs6IIMobhZFmNq3Zsan67ebqjs/OrbrHZDmje99hbD8aJWTDP+sv2+mmA67Sv6kRoMOMM7NjU+Pp293VDaCTQ2UuyG8nPzTDuYHKmY7pRy/KbMM1sl+Yq8GV9eqBk7/teNOJtsYwyDvdGMUeIwXAxjL2+JQhaaNaWieWOJi6V0qHjebTVexYBTFElcfEWnoVjfqA0RZUijaSPcoZGZTmmb5FFBerE0lU6Hjr8uEwmmKJpx6O0Z12MHqtNQvGrLlwCHIYVpLbHN/9CGyjVqUxEd5qsLBae8ZW6g+Mv/Pvjq9UYRqf32dWxFt6Hfm2wv2mVYo35r3XlKnIj18e7YIP2ytDQlOf585adH0oDjJXExFSMMWaNYsw6XobhX/oiX69vn9N1EDNO2/S4OCQrFarDgHUnzhpfExeuLUYYNe1rlNBSTvuhn+45fFAmNMye9CAS542VYxBX59M+SuOtYilGGDpyGIkzFLR1Xl8YEqSKo76qNWmEzepH6HONx39MwIRtav9wngoTGFaSq4JK+6TQKkzgvUuMovquh/MHQ9YlnOTKGv0QLskxASlRzw157vOK7GkofwVOuf4+JDFJNcMqybfgsrzeGd+2xW6fvaihGUQ/X2q8QFaRjQpTzLCWqXhJ3MeZx39VQClPX2k8MtJZ/zfAmelXQ0TzPynpjeDNGMRnZLazQB3hLHIajqeuGvNT6Ce/io8KUM/4uzn8zWDPe3HnzRvYh8nFn530i6+jwS/SP2vLt3DfkFayT4YLKpa0O51LhR0RNAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4H/Hv9YY7mRZ/aZMAAAAAElFTkSuQmCC";function I_(){const[et,Wt]=bs.useState(null),[Tt,Se]=bs.useState([]),[yt,mt]=bs.useState(null),[O,f]=bs.useState(!1),De=Object.values(mg).flatMap(Bt=>Bt.projects),qe=O?De:Tt,xt=()=>{const Bt=!O;f(Bt),Bt&&(Wt(null),Se([]),mt(null))};async function ut(Bt){if(f(!1),!Bt||Bt.trim()===""){Wt(null),Se([]),mt(null);return}const Xt=await x_(Bt);if(Xt){Wt(Xt);const di=Object.keys(mg).find(Te=>Te.toLowerCase()===Bt.toLowerCase().trim()),bt=di?mg[di]:null;Se(bt?.projects||[]),mt(null)}}return At.jsxs("div",{className:"app-container",children:[At.jsx("div",{className:"bg-texture-overlay"}),At.jsx("div",{className:"logo-overlay",children:At.jsx("div",{className:`logo-glass-container ${yt?"collapsed":""}`,onClick:()=>{f(!1),ut("")},children:At.jsx("img",{src:yt?P_:D_,alt:"Logo",className:`app-logo ${yt?"logo-icon":"logo-full"}`})})}),At.jsx("div",{className:"map-wrapper",children:At.jsx(y_,{focusCoords:et,items:qe,onProjectClick:Bt=>mt(Bt),isDrawerOpen:!!yt,activeProjectCoords:yt?[yt.lng,yt.lat]:null,showAll:O})}),At.jsx("div",{className:"controls-overlay",children:At.jsxs("button",{className:`glass-button toggle-all ${O?"active":""}`,onClick:xt,children:[At.jsx("span",{className:"icon",children:O?"":""}),O?"Hide All Projects":"View All Projects"]})}),At.jsx(z_,{project:yt,onClose:()=>mt(null)}),At.jsx("div",{className:"search-overlay",children:At.jsx("div",{className:"search-bar-container",children:At.jsx(v_,{onSearch:ut})})})]})}f_.createRoot(document.getElementById("root")).render(At.jsx(s_.StrictMode,{children:At.jsx(I_,{})}));
